{"version":3,"sources":["webpack:///./src/module/sw-promotion-v2/view/sw-promotion-v2-conditions/sw-promotion-v2-conditions.html.twig","webpack:///./src/module/sw-promotion-v2/view/sw-promotion-v2-conditions/index.js"],"names":["_Shopware$Data","Shopware","Data","Criteria","EntityCollection","types","Utils","template","inject","props","promotion","type","Object","required","default","data","excludedPromotions","this","createPromotionCollection","personaRestrictedRules","orderRestrictedRules","cartRestrictedRules","computed","exclusionCriteria","criteria","addFilter","not","equals","id","personaRuleFilter","addAssociation","addSorting","sort","cartConditionsRuleFilter","orderConditionsFilter","created","createdComponent","methods","loadExclusions","_this","isEmpty","exclusionIds","promotionRepository","repositoryFactory","create","equalsAny","search","then","excluded","onChangeExclusions","promotions","map","Context","api"],"mappings":"8HAAe,ICKfA,EAAuCC,SAASC,KAAxCC,EAAQH,EAARG,SAAUC,EAAgBJ,EAAhBI,iBACZC,EAAQJ,SAASK,MAAMD,MAGd,WACXE,SDVW,2tJCYXC,OAAQ,CACJ,oBACA,MACA,UACA,oCAGJC,MAAO,CACHC,UAAW,CACPC,KAAMC,OACNC,UAAU,EACVC,QAAO,WACH,OAAO,QAKnBC,KAAI,WACA,MAAO,CACHC,mBAAoBC,KAAKC,4BACzBC,uBAAwB,GACxBC,qBAAsB,GACtBC,oBAAqB,KAI7BC,SAAU,CACNC,kBAAiB,WACb,IAAMC,EAAW,IAAIrB,EAAS,EAAG,IAEjC,OADAqB,EAASC,UAAUtB,EAASuB,IAAI,MAAO,CAACvB,EAASwB,OAAO,KAAMV,KAAKP,UAAUkB,OACtEJ,GAGXK,kBAAiB,WACb,IAAML,EAAW,IAAIrB,EAAS,EAAG,IAKjC,OAHAqB,EAASM,eAAe,cACnBC,WAAW5B,EAAS6B,KAAK,OAAQ,OAAO,IAEtCR,GAGXS,yBAAwB,WACpB,IAAMT,EAAW,IAAIrB,EAAS,EAAG,IAKjC,OAHAqB,EAASM,eAAe,cACnBC,WAAW5B,EAAS6B,KAAK,OAAQ,OAAO,IAEtCR,GAGXU,sBAAqB,WACjB,IAAMV,EAAW,IAAIrB,EAAS,EAAG,IAKjC,OAHAqB,EAASM,eAAe,cACnBC,WAAW5B,EAAS6B,KAAK,OAAQ,OAAO,IAEtCR,IAIfW,QAAO,WACHlB,KAAKmB,oBAGTC,QAAS,CACLD,iBAAgB,WACZnB,KAAKqB,kBAGTA,eAAc,WAAI,IAADC,EAAA,KACb,GAAIlC,EAAMmC,QAAQvB,KAAKP,UAAU+B,cAC7BxB,KAAKD,mBAAqBC,KAAKC,gCADnC,CAKA,IAAMwB,EAAsBzB,KAAK0B,kBAAkBC,OAAO,aACpDpB,EAAY,IAAIrB,EAAS,EAAG,IAAKsB,UAAUtB,EAAS0C,UAAU,KAAM5B,KAAKP,UAAU+B,eAEzFC,EAAoBI,OAAOtB,GAAUuB,MAAK,SAACC,GACvCT,EAAKvB,mBAAqBgC,OAIlCC,mBAAkB,SAACC,GACfjC,KAAKP,UAAU+B,aAAeS,EAAWC,KAAI,SAACzC,GAC1C,OAAOA,EAAUkB,MAGrBX,KAAKqB,kBAGTpB,0BAAyB,WACrB,OAAO,IAAId,EAAiB,aAAc,YAAaH,SAASmD,QAAQC,IAAK,IAAIlD,EAAS,EAAG","file":"static/js/f57ea42acc9b7de0a80e.js","sourcesContent":["export default \"\\n{% block sw_promotion_v2_conditions %}\\n<div class=\\\"sw-promotion-v2-conditions\\\">\\n\\n    \\n    {% block sw_promotion_v2_conditions_pre_conditions_card %}\\n    <sw-card\\n        :title=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.cardTitlePreConditions')\\\"\\n        position-identifier=\\\"sw-promotion-conditions-pre-conditions\\\"\\n    >\\n\\n        \\n        {% block sw_promotion_v2_conditions_pre_conditions_sales_channel_selection %}\\n        <sw-promotion-v2-sales-channel-select\\n            class=\\\"sw-promotion-v2-conditions__sales-channel-selection\\\"\\n            :promotion=\\\"promotion\\\"\\n            :entity-collection=\\\"promotion.salesChannels\\\"\\n            :disabled=\\\"!acl.can('promotion.editor')\\\"\\n            :label=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel')\\\"\\n            :placeholder=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel')\\\"\\n        />\\n        {% endblock %}\\n\\n        \\n        {% block sw_promotion_v2_conditions_pre_conditions_prevent_combination %}\\n        <sw-switch-field\\n            {% if VUE3 %}\\n            v-model:value=\\\"promotion.preventCombination\\\"\\n            {% else %}\\n            v-model=\\\"promotion.preventCombination\\\"\\n            {% endif %}\\n            class=\\\"sw-promotion-v2-conditions__prevent-combination\\\"\\n            :disabled=\\\"!acl.can('promotion.editor')\\\"\\n            :label=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPreventCombination')\\\"\\n            :text=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.helpTextPreventCombination')\\\"\\n        />\\n        {% endblock %}\\n\\n        \\n        {% block sw_promotion_v2_conditions_pre_conditions_exclusions %}\\n        <sw-entity-multi-select\\n            class=\\\"sw-promotion-v2-conditions__rules-exclusion-selection\\\"\\n            :label=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelPromotionExclusions')\\\"\\n            :placeholder=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderPromotionExclusions')\\\"\\n            :criteria=\\\"exclusionCriteria\\\"\\n            :entity-collection=\\\"excludedPromotions\\\"\\n            :disabled=\\\"!acl.can('promotion.editor') || promotion.preventCombination\\\"\\n            {% if VUE3 %}\\n            @update:entity-collection=\\\"onChangeExclusions\\\"\\n            {% else %}\\n            @change=\\\"onChangeExclusions\\\"\\n            {% endif %}\\n        />\\n        {% endblock %}\\n\\n    </sw-card>\\n    {% endblock %}\\n\\n    \\n    {% block sw_promotion_v2_rule_conditions_card %}\\n    <sw-card\\n        :title=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.cardTitleRuleConditions')\\\"\\n        position-identifier=\\\"sw-promotion-conditions-rules\\\"\\n    >\\n\\n        \\n        {% block sw_promotion_v2_rule_conditions_rule_select_customer %}\\n        <sw-promotion-v2-rule-select\\n            v-if=\\\"promotion\\\"\\n            {% if VUE3 %}\\n            v-model:collection=\\\"promotion.personaRules\\\"\\n            {% else %}\\n            v-model=\\\"promotion.personaRules\\\"\\n            {% endif %}\\n            class=\\\"sw-promotion-v2-conditions__rule-select-customer\\\"\\n            :local-mode=\\\"promotion.isNew()\\\"\\n            :criteria=\\\"personaRuleFilter\\\"\\n            :label=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelCustomerSelect')\\\"\\n            :placeholder=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderCustomerSelect')\\\"\\n            :rule-scope=\\\"['checkout']\\\"\\n            :disabled=\\\"!acl.can('promotion.editor')\\\"\\n            rule-aware-group-key=\\\"personaPromotions\\\"\\n        />\\n        {% endblock %}\\n\\n        \\n        {% block sw_promotion_v2_rule_conditions_rule_select_cart_conditions %}\\n        <sw-promotion-v2-cart-condition-form\\n            :promotion=\\\"promotion\\\"\\n            :restricted-rules=\\\"cartRestrictedRules\\\"\\n        />\\n        {% endblock %}\\n\\n        \\n        {% block sw_promotion_v2_rule_conditions_rule_select_order_conditions %}\\n        <sw-promotion-v2-rule-select\\n            v-if=\\\"promotion\\\"\\n            {% if VUE3 %}\\n            v-model:collection=\\\"promotion.orderRules\\\"\\n            {% else %}\\n            v-model=\\\"promotion.orderRules\\\"\\n            {% endif %}\\n            class=\\\"sw-promotion-v2-conditions__rule-select-order-conditions\\\"\\n            :label=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.labelOrderConditionSelect')\\\"\\n            :placeholder=\\\"$tc('sw-promotion-v2.detail.conditions.preConditions.placeholderOrderConditionSelect')\\\"\\n            :criteria=\\\"orderConditionsFilter\\\"\\n            :rule-scope=\\\"['checkout']\\\"\\n            :disabled=\\\"!acl.can('promotion.editor')\\\"\\n            rule-aware-group-key=\\\"orderPromotions\\\"\\n        />\\n        {% endblock %}\\n\\n    </sw-card>\\n    {% endblock %}\\n\\n</div>\\n{% endblock %}\\n\";","/**\n * @package buyers-experience\n */\nimport template from './sw-promotion-v2-conditions.html.twig';\n\nconst { Criteria, EntityCollection } = Shopware.Data;\nconst types = Shopware.Utils.types;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    inject: [\n        'repositoryFactory',\n        'acl',\n        'feature',\n        'ruleConditionDataProviderService',\n    ],\n\n    props: {\n        promotion: {\n            type: Object,\n            required: false,\n            default() {\n                return null;\n            },\n        },\n    },\n\n    data() {\n        return {\n            excludedPromotions: this.createPromotionCollection(),\n            personaRestrictedRules: [],\n            orderRestrictedRules: [],\n            cartRestrictedRules: [],\n        };\n    },\n\n    computed: {\n        exclusionCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addFilter(Criteria.not('and', [Criteria.equals('id', this.promotion.id)]));\n            return criteria;\n        },\n\n        personaRuleFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions')\n                .addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n\n        cartConditionsRuleFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions')\n                .addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n\n        orderConditionsFilter() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('conditions')\n                .addSorting(Criteria.sort('name', 'ASC', false));\n\n            return criteria;\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.loadExclusions();\n        },\n\n        loadExclusions() {\n            if (types.isEmpty(this.promotion.exclusionIds)) {\n                this.excludedPromotions = this.createPromotionCollection();\n                return;\n            }\n\n            const promotionRepository = this.repositoryFactory.create('promotion');\n            const criteria = (new Criteria(1, 25)).addFilter(Criteria.equalsAny('id', this.promotion.exclusionIds));\n\n            promotionRepository.search(criteria).then((excluded) => {\n                this.excludedPromotions = excluded;\n            });\n        },\n\n        onChangeExclusions(promotions) {\n            this.promotion.exclusionIds = promotions.map((promotion) => {\n                return promotion.id;\n            });\n\n            this.loadExclusions();\n        },\n\n        createPromotionCollection() {\n            return new EntityCollection('/promotion', 'promotion', Shopware.Context.api, new Criteria(1, 25));\n        },\n    },\n};\n"],"sourceRoot":""}