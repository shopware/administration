(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[341],{"0nor":function(e,n,t){var r=t("S74V");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,t("P8hj").default)("f5f5203e",r,!0,{})},S74V:function(e,n,t){},rIDd:function(e,n,t){"use strict";t.r(n);var r=t("CsSd"),o=t.n(r),a=t("6lmj"),i=t.n(a);function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var c=Shopware.Service;var l={namespaced:!0,state:function(){return{customer:null,defaultSalesChannel:null,cart:{token:null,lineItems:[],price:{totalPrice:null},deliveries:[]},context:{token:"",customer:null,paymentMethod:{translated:{distinguishableName:""}},shippingMethod:{translated:{name:""}},currency:{isoCode:"EUR",symbol:"â‚¬",totalRounding:{decimals:2}},salesChannel:{id:""},context:{currencyId:"",languageIdChain:[]}},promotionCodes:[],disabledAutoPromotion:!1}},mutations:{setCustomer:function(e,n){e.context.customer=n,e.customer=n},setDefaultSalesChannel:function(e,n){e.defaultSalesChannel=n},setCartToken:function(e,n){e.cart.token=n},setCart:function(e,n){var t=e.cart.lineItems.filter((function(e){return""===e.label}));e.cart=n,e.cart.lineItems=function(e,n){return n.slice().reverse(),[].concat(i()(e),i()(n))}(t,e.cart.lineItems)},setCartLineItems:function(e,n){e.cart.lineItems=n},setCurrency:function(e,n){e.context.currency=n},setContext:function(e,n){e.context=n},setPromotionCodes:function(e,n){e.promotionCodes=n},removeEmptyLineItem:function(e,n){e.cart.lineItems=e.cart.lineItems.filter((function(e){return e.id!==n}))},removeInvalidPromotionCodes:function(e){e.promotionCodes=e.promotionCodes.filter((function(e){return!e.isInvalid}))},setDisabledAutoPromotion:function(e,n){e.disabledAutoPromotion=n}},getters:{isCustomerActive:function(e){var n;return!(null==e||null===(n=e.context.customer)||void 0===n||!n.active)},isCartTokenAvailable:function(e){var n;return!(null==e||null===(n=e.cart)||void 0===n||!n.token)},currencyId:function(e){var n;return null!==(n=null==e?void 0:e.context.context.currencyId)&&void 0!==n?n:""},invalidPromotionCodes:function(e){return e.promotionCodes.filter((function(e){return e.isInvalid}))},cartErrors:function(e){var n,t;return null!==(n=null==e||null===(t=e.cart)||void 0===t?void 0:t.errors)&&void 0!==n?n:null}},actions:{selectExistingCustomer:function(e,n){var t,r=e.commit,a=n.customer;r("setCustomer",a),r("setDefaultSalesChannel",function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},null!==(t=null==a?void 0:a.salesChannel)&&void 0!==t?t:null))},createCart:function(e,n){var t=e.commit,r=n.salesChannelId;return c("cartStoreService").createCart(r).then((function(e){var n=e.data.token;return t("setCartToken",n),n})).then((function(e){return c("contextStoreService").getSalesChannelContext(r,e).then((function(e){return t("setContext",e.data)}))}))},getCart:function(e,n){var t=e.commit,r=n.salesChannelId,o=n.contextToken;if(32!=="".concat(o).length)throw new Error("Invalid context token");return Promise.all([c("cartStoreService").getCart(r,o).then((function(e){return t("setCart",e.data)})),c("contextStoreService").getSalesChannelContext(r,o).then((function(e){return t("setContext",e.data)}))])},cancelCart:function(e,n){var t=n.salesChannelId,r=n.contextToken;if(32!=="".concat(r).length)throw new Error("Invalid context token");return c("cartStoreService").cancelCart(t,r)},updateCustomerContext:function(e,n){var t=n.customerId,r=n.salesChannelId,o=n.contextToken;return c("contextStoreService").updateCustomerContext(t,r,o)},updateOrderContext:function(e,n){var t=n.context,r=n.salesChannelId,o=n.contextToken;return c("contextStoreService").updateContext(t,r,o)},getContext:function(e,n){var t=n.salesChannelId,r=n.contextToken;return c("contextStoreService").getSalesChannelContext(t,r)},saveOrder:function(e,n){var t=n.salesChannelId,r=n.contextToken;return c("checkoutStoreService").checkout(t,r)},removeLineItems:function(e,n){var t=e.commit,r=n.salesChannelId,o=n.contextToken,a=n.lineItemKeys;return c("cartStoreService").removeLineItems(r,o,a).then((function(e){return t("setCart",e.data)}))},saveLineItem:function(e,n){var t=e.commit,r=n.salesChannelId,o=n.contextToken,a=n.item;return c("cartStoreService").saveLineItem(r,o,a).then((function(e){return t("setCart",e.data)}))},saveMultipleLineItems:function(e,n){var t=e.commit,r=n.salesChannelId,o=n.contextToken,a=n.items;return c("cartStoreService").addMultipleLineItems(r,o,a).then((function(e){return t("setCart",e.data)}))},addPromotionCode:function(e,n){var t=e.commit,r=n.salesChannelId,o=n.contextToken,a=n.code;return c("cartStoreService").addPromotionCode(r,o,a).then((function(e){return t("setCart",e.data)}))},modifyShippingCosts:function(e,n){var t=e.commit,r=n.salesChannelId,o=n.contextToken,a=n.shippingCosts;return c("cartStoreService").modifyShippingCosts(r,o,a).then((function(e){return t("setCart",e.data.data)}))},remindPayment:function(e,n){var t=n.orderTransactionId;return c("orderStateMachineService").transitionOrderTransactionState(t,"remind")}}},d=(t("0nor"),Shopware),u=d.Context,m=d.State,h=d.Mixin,v=Shopware.Data.Criteria;n.default=Shopware.Component.wrapComponentConfig({template:'\n{% block sw_order_create %}\n<sw-page class="sw-order-create">\n    \n    {% block sw_order_create_smart_bar_header %}\n    <template #smart-bar-header>\n        \n        {% block sw_order_create_smart_bar_header_title %}\n        <h2 v-if="!showInitialModal">\n            \n            {% block sw_order_create_smart_bar_header_title_text %}\n            {{ $tc(\'sw-order.create.textNewOrder\') }}\n            {% endblock %}\n        </h2>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_order_create_smart_bar_actions %}\n    <template #smart-bar-actions>\n        \n        {% block sw_order_create_smart_bar_actions_slot %}\n        <template v-if="!showInitialModal">\n            \n            {% block sw_order_create_smart_bar_actions_cancel %}\n            <sw-button @click="onCancelOrder">\n                {{ $tc(\'sw-order.create.buttonCancelOrder\') }}\n            </sw-button>\n            {% endblock %}\n            \n            {% block sw_order_create_smart_bar_actions_add %}\n            <sw-button-process\n                variant="primary"\n                :disabled="isLoading"\n                :is-loading="isLoading"\n                :process-success="isSaveSuccessful"\n                {% if VUE3 %}\n                @update:process-success="saveFinish"\n                {% else %}\n                @process-finish="saveFinish"\n                {% endif %}\n                @click.prevent="onSaveOrder"\n            >\n                {{ $tc(\'sw-order.create.buttonSaveOrder\') }}\n            </sw-button-process>\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_order_create_language_switch %}\n    <template #language-switch>\n        <sw-language-switch\n            disabled\n        />\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_order_create_content %}\n    <template #content>\n        \n        {% block sw_order_create_content_view %}\n        <sw-card-view>\n            \n            {% block sw_order_create_content_tabs %}\n            <sw-tabs\n                v-if="!showInitialModal"\n                class="sw-order-create__tabs"\n                position-identifier="sw-order-create"\n            >\n                \n                {% block sw_order_create_content_tabs_general %}\n                <sw-tabs-item\n                    class="sw-order-create__tab-general"\n                    :route="{ name: \'sw.order.create.general\' }"\n                    :title="$tc(\'sw-order.detail.tabGeneral\')"\n                >\n                    {{ $tc(\'sw-order.detail.tabGeneral\') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                \n                {% block sw_order_create_content_tabs_details %}\n                <sw-tabs-item\n                    class="sw-order-create__tab-details"\n                    :route="{ name: \'sw.order.create.details\' }"\n                    :title="$tc(\'sw-order.detail.tabDetails\')"\n                >\n                    {{ $tc(\'sw-order.detail.tabDetails\') }}\n                </sw-tabs-item>\n                {% endblock %}\n            </sw-tabs>\n            {% endblock %}\n\n            \n            {% block sw_order_create_content_view %}\n            {% if VUE3 %}\n            <router-view\n                v-slot="{ Component }"\n            >\n                <component\n                    :is="Component"\n                    @error="showError"\n                />\n            </router-view>\n            {% else %}\n            <router-view\n                @error="showError"\n            />\n            {% endif %}\n            {% endblock %}\n        </sw-card-view>\n        {% endblock %}\n\n        \n        {% block sw_order_create_invalid_promotion_modal %}\n        <sw-order-create-invalid-promotion-modal\n            v-if="showInvalidCodeModal"\n            @confirm="removeInvalidCode"\n            @close="closeInvalidCodeModal"\n        />\n        {% endblock %}\n\n        \n        {% block sw_order_create_remind_payment_modal %}\n        <sw-modal\n            v-if="showRemindPaymentModal"\n            class="sw-order-create__remind-payment-modal"\n            :title="$tc(\'sw-order.create.remindPaymentModal.title\')"\n            :is-loading="remindPaymentModalLoading"\n            @modal-close="onRemindPaymentModalClose"\n        >\n            \n            {% block sw_order_create_remind_payment_modal_content %}\n            <p>{{ $tc(\'sw-order.create.remindPaymentModal.text\', 0, {paymentMethodName: paymentMethodName }) }}</p>\n            {% endblock %}\n\n            <template #modal-footer>\n                \n                {% block sw_order_create_remind_payment_modal_footer %}\n                <sw-button\n                    class="sw-order-create__remind-payment-modal-decline"\n                    size="small"\n                    @click="onRemindPaymentModalClose"\n                >\n                    {{ $tc(\'global.default.no\') }}\n                </sw-button>\n\n                <sw-button\n                    class="sw-order-create__remind-payment-modal-remind"\n                    variant="primary"\n                    size="small"\n                    @click="onRemindCustomer"\n                >\n                    {{ $tc(\'sw-order.create.remindPaymentModal.primaryAction\') }}\n                </sw-button>\n                {% endblock %}\n\n            </template>\n        </sw-modal>\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["repositoryFactory","feature"],mixins:[h.getByName("notification")],data:function(){return{isLoading:!1,isSaveSuccessful:!1,showInvalidCodeModal:!1,showRemindPaymentModal:!1,remindPaymentModalLoading:!1,orderId:null,orderTransaction:null,paymentMethodName:""}},computed:{customer:function(){return m.get("swOrder").customer},cart:function(){return m.get("swOrder").cart},invalidPromotionCodes:function(){return m.getters["swOrder/invalidPromotionCodes"]},isSaveOrderValid:function(){return this.customer&&this.cart.token&&this.cart.lineItems.length&&!this.invalidPromotionCodes.length},paymentMethodRepository:function(){return this.repositoryFactory.create("payment_method")},showInitialModal:function(){return"sw.order.create.initial"===this.$route.name}},beforeCreate:function(){m.registerModule("swOrder",l)},created:function(){this.createdComponent()},beforeDestroy:function(){this.unregisterModule()},methods:{createdComponent:function(){m.getters["context/isSystemDefaultLanguage"]||m.commit("context/resetLanguageToDefault")},unregisterModule:function(){m.unregisterModule("swOrder")},redirectToOrderList:function(){this.$router.push({name:"sw.order.index"})},saveFinish:function(){this.orderId&&(this.isSaveSuccessful=!1,m.commit("context/setLanguageId",localStorage.getItem("sw-admin-current-language")||Shopware.Defaults.systemLanguageId),this.$router.push({name:"sw.order.detail",params:{id:this.orderId}}))},onSaveOrder:function(){var e,n=this;return this.isSaveOrderValid?(this.isLoading=!0,this.isSaveSuccessful=!1,m.dispatch("swOrder/saveOrder",{salesChannelId:null===(e=this.customer)||void 0===e?void 0:e.salesChannelId,contextToken:this.cart.token}).then((function(e){var t,r,o;n.orderId=null==e||null===(t=e.data)||void 0===t?void 0:t.id,n.orderTransaction=null==e||null===(r=e.data)||void 0===r||null===(o=r.transactions)||void 0===o?void 0:o[0],n.orderTransaction&&(n.paymentMethodRepository.get(n.orderTransaction.paymentMethodId,u.api,new v(1,1)).then((function(e){var t,r;n.paymentMethodName=null!==(t=null==e||null===(r=e.translated)||void 0===r?void 0:r.distinguishableName)&&void 0!==t?t:""})),n.showRemindPaymentModal=!0)})).catch((function(e){return n.showError(e)})).finally((function(){n.isLoading=!1}))):(this.invalidPromotionCodes.length>0?this.openInvalidCodeModal():this.showError(),Promise.resolve())},onCancelOrder:function(){var e=this;null!==this.customer&&null!==this.cart?m.dispatch("swOrder/cancelCart",{salesChannelId:this.customer.salesChannelId,contextToken:this.cart.token}).then((function(){return e.redirectToOrderList()})):this.redirectToOrderList()},showError:function(){var e,n,t,r,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=(null==o||null===(e=o.response)||void 0===e||null===(n=e.data)||void 0===n||null===(t=n.errors)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.detail)||null;this.createNotificationError({message:a||this.$tc("sw-order.create.messageSaveError")})},openInvalidCodeModal:function(){this.showInvalidCodeModal=!0},closeInvalidCodeModal:function(){this.showInvalidCodeModal=!1},removeInvalidCode:function(){m.commit("swOrder/removeInvalidPromotionCodes"),this.closeInvalidCodeModal()},onRemindPaymentModalClose:function(){this.isSaveSuccessful=!0,this.showRemindPaymentModal=!1},onRemindCustomer:function(){var e,n=this;this.remindPaymentModalLoading=!0,m.dispatch("swOrder/remindPayment",{orderTransactionId:null===(e=this.orderTransaction)||void 0===e?void 0:e.id}).then((function(){n.remindPaymentModalLoading=!1,n.onRemindPaymentModalClose()}))}}})}}]);