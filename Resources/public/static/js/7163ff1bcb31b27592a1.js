(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[632],{fm54:function(e,n,t){"use strict";t.r(n);var a=Shopware.Mixin,s=Shopware.Data,i=s.EntityCollection,o=s.Criteria;n.default={template:'\n{% block sw_settings_search_index %}\n<sw-page class="sw-settings-search">\n    \n    {% block sw_settings_search_smart_bar_header %}\n    <template #smart-bar-header>\n        <h2>\n            \n            {% block sw_settings_search_smart_bar_header_title_text %}\n            {{ $tc(\'sw-settings.index.title\') }}\n            <sw-icon\n                name="regular-chevron-right-xs"\n                small\n            />\n            {{ $tc(\'sw-settings-search.general.mainMenuItemGeneral\') }}\n            {% endblock %}\n        </h2>\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_search_language_switch %}\n    <template #language-switch>\n        <sw-language-switch @on-change="onChangeLanguage" />\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_search_smart_bar_actions %}\n    <template #smart-bar-actions>\n        \n        {% block sw_settings_search_smart_bar_actions_save %}\n        <sw-button-process\n            v-tooltip.bottom="tooltipSave"\n            class="sw-settings-search__button-save"\n            variant="primary"\n            :disabled="!allowSave"\n            :is-loading="isLoading"\n            :process-success="isSaveSuccessful"\n            @process-finish="saveFinish"\n            @click.prevent="onSaveSearchSettings"\n        >\n            {{ $tc(\'global.default.save\') }}\n        </sw-button-process>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_search_content %}\n    <template #content>\n        <sw-card-view>\n            \n            {% block sw_settings_search_tabs_header %}\n            <sw-tabs position-identifier="sw-settings-search-header">\n                \n                {% block sw_setting_search_tabs_general %}\n                <sw-tabs-item\n                    v-bind="$props"\n                    class="sw-settings-search__general-tab"\n                    :route="{ name: \'sw.settings.search.index.general\' }"\n                    @click="onTabChange"\n                >\n                    {{ $tc(\'sw-settings-search.page.generalTab\') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                \n                {% block sw_setting_search_tabs_live_search %}\n                <sw-tabs-item\n                    v-bind="$props"\n                    class="sw-settings-search__live-search-tab"\n                    :route="{ name: \'sw.settings.search.index.liveSearch\' }"\n                >\n                    {{ $tc(\'sw-settings-search.page.liveSearchTab\') }}\n                </sw-tabs-item>\n                {% endblock %}\n            </sw-tabs>\n            {% endblock %}\n\n            \n            {% block sw_settings_search_tabs_content %}\n            <template v-if="isLoading">\n                <sw-skeleton />\n                <sw-skeleton />\n            </template>\n\n            {# v-show is used here as underlying components influence the loading state and v-if would destroy this behaviour #}\n            <router-view\n                v-show="!isLoading"\n                :is-loading="isLoading"\n                :product-search-configs="productSearchConfigs"\n                :current-sales-channel-id="currentSalesChannelId"\n                :search-terms="searchTerms"\n                :search-results="searchResults"\n                @edit-change="onEditChanged"\n                @sales-channel-change="onSalesChannelChanged"\n                @live-search-results-change="onLiveSearchResultsChanged"\n                @excluded-search-terms-load="getProductSearchConfigs"\n            />\n            {% endblock %}\n        </sw-card-view>\n\n        \n        {% block sw_settings_search_discard_model %}\n        <sw-confirm-modal\n            v-if="isDisplayingLeavePageWarning"\n            class="sw_settings_search_leave_modal"\n            type="yesno"\n            :text="$tc(\'sw-settings-search.textLeaveConfirm\')"\n            @confirm="onConfirmLeave"\n            @close="onCloseLeaveModal"\n            @cancel="onCancelLeaveModal"\n        />\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["repositoryFactory","acl"],mixins:[a.getByName("notification")],shortcuts:{"SYSTEMKEY+S":{active:function(){return this.allowSave},method:"onSaveSearchSettings"},ESCAPE:"onCancel"},data:function(){return{productSearchConfigs:{andLogic:!0,minSearchLength:2},isLoading:!1,currentSalesChannelId:null,searchTerms:"",searchResults:null,defaultConfig:null,isSaveSuccessful:!1,nextRoute:null,isDisplayingLeavePageWarning:!1,leaveConfirmation:!1,isEditing:!1}},computed:{productSearchRepository:function(){return this.repositoryFactory.create("product_search_config")},productSearchFieldRepository:function(){return this.repositoryFactory.create("product_search_config_field")},productSearchConfigsCriteria:function(){var e=new o(1,25);return e.addAssociation("configFields"),e.addFilter(o.equals("languageId",Shopware.Context.api.languageId)),e},productDefaultConfigsCriteria:function(){var e=new o(1,25);return e.addAssociation("configFields"),e.addFilter(o.equals("languageId",Shopware.Context.api.systemLanguageId)),e},allowSave:function(){return this.acl.can("product_search_config.editor")||this.acl.can("product_search_config.creator")},tooltipSave:function(){if(!this.allowSave)return{message:this.$tc("sw-privileges.tooltip.warning"),disabled:this.allowSave,showOnDisabledElements:!0};var e=this.$device.getSystemKey();return{message:"".concat(e," + S"),appearance:"light"}}},created:function(){this.createdComponent()},beforeRouteUpdate:function(e,n,t){this.unsavedDataLeaveHandler(e,n,t)},beforeRouteLeave:function(e,n,t){this.unsavedDataLeaveHandler(e,n,t)},methods:{createdComponent:function(){this.getDefaultSearchConfig(),this.getProductSearchConfigs()},getProductSearchConfigs:function(){var e=this;this.isLoading=!0,this.productSearchRepository.search(this.productSearchConfigsCriteria).then((function(n){n.total?e.productSearchConfigs=n.first():e.onSaveDefaultSearchConfig()})).catch((function(n){e.createNotificationError({message:n.message})})).finally((function(){e.isLoading=!1}))},getDefaultSearchConfig:function(){var e=this;this.productSearchRepository.search(this.productDefaultConfigsCriteria).then((function(n){e.defaultConfig=n.first()})).catch((function(n){e.createNotificationError({message:n.message})}))},createDefaultSearchConfig:function(){var e=this.productSearchRepository.create();return e.andLogic=this.defaultConfig.andLogic,e.minSearchLength=this.defaultConfig.minSearchLength,e.excludedTerms=[],e.languageId=Shopware.Context.api.languageId,e},createConfigFields:function(){var e=this;if(!this.defaultConfig||!this.defaultConfig.configFields.length)return null;var n=new i(this.productSearchFieldRepository.route,this.productSearchFieldRepository.entityName,Shopware.Context.api);return this.defaultConfig.configFields.forEach((function(t){var a=e.productSearchFieldRepository.create();a.field=t.field,a.ranking=t.ranking,a.searchable=t.searchable,a.tokenize=t.tokenize,a.customFieldId=null,a.searchConfigId=e.productSearchConfigs.id,n.add(a)})),n},onSaveDefaultSearchConfig:function(){var e=this;this.productSearchConfigs=this.createDefaultSearchConfig(),this.productSearchConfigs.configFields=this.createConfigFields(),this.productSearchRepository.save(this.productSearchConfigs).then((function(){e.getProductSearchConfigs()})).catch((function(){e.createNotificationError({message:e.$tc("sw-settings-search.notification.saveError")})}))},onChangeLanguage:function(){this.getDefaultSearchConfig(),this.getProductSearchConfigs()},onTabChange:function(){this.getProductSearchConfigs()},onSaveSearchSettings:function(){var e=this;this.isLoading=!0,this.productSearchRepository.save(this.productSearchConfigs).then((function(){e.createNotificationSuccess({message:e.$tc("sw-settings-search.notification.saveSuccess")}),e.getProductSearchConfigs(),e.isSaveSuccessful=!0})).catch((function(){e.createNotificationError({message:e.$tc("sw-settings-search.notification.saveError")})})).finally((function(){e.isLoading=!1,e.isEditing=!1}))},saveFinish:function(){this.isSaveSuccessful=!1},fetchSalesChannels:function(){var e=this;this.salesChannelRepository.search(new o(1,25)).then((function(n){e.salesChannels=n}))},unsavedDataLeaveHandler:function(e,n,t){if(this.leaveConfirmation)return this.leaveConfirmation=!1,void t();this.isEditing?(this.isDisplayingLeavePageWarning=!0,this.nextRoute=e,t(!1)):t()},onSalesChannelChanged:function(e){this.currentSalesChannelId=e},onLiveSearchResultsChanged:function(e){var n=e.searchTerms,t=e.searchResults;this.searchTerms=n,this.searchResults=t},onEditChanged:function(e){this.isEditing=e},onConfirmLeave:function(){var e=this;this.leaveConfirmation=!0,this.isDisplayingLeavePageWarning=!1,this.isEditing=!1,this.$nextTick((function(){e.$router.push({name:e.nextRoute.name,params:e.nextRoute.params})}))},onCloseLeaveModal:function(){this.isDisplayingLeavePageWarning=!1},onCancelLeaveModal:function(){this.isDisplayingLeavePageWarning=!1}}}}}]);