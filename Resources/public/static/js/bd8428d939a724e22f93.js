(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[32459],{198234:function(){},532459:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return a}}),t(494324);let{Component:d,Mixin:o}=Shopware,{mapGetters:r}=d.getComponentHelper();var a={template:'\n{% block sw_product_media_form %}\n<div\n    class="sw-product-media-form"\n    :class="{ \'is--disabled\': disabled }"\n>\n    \n    {% block sw_product_media_form_upload %}\n    <sw-upload-listener\n        v-if="!isLoading"\n        :upload-tag="product.id"\n        auto-upload\n        @media-upload-finish="successfulUpload"\n        @media-upload-fail="onUploadFailed"\n    />\n\n    <sw-media-upload-v2\n        v-if="!isLoading && acl.can(\'product.editor\')"\n        variant="regular"\n        :upload-tag="product.id"\n        :scroll-target="$parent.$el"\n        :default-folder="product.getEntityName()"\n        :file-accept="fileAccept"\n        @media-upload-sidebar-open="onOpenMedia"\n    />\n    {% endblock %}\n\n    \n    {% block sw_product_media_form_grid %}\n    <div class="sw-product-media-form__previews">\n        <div class="sw-product-media-form__cover-container sw-product-media-form__column">\n            \n            {% block sw_product_media_form_cover_preview %}\n            <div\n                v-if="product.cover || cover"\n                class="sw-product-media-form__preview-cover"\n            >\n                <div class="preview-cover">\n                    \n                    {% block sw_product_media_form_cover_image %}\n                    <sw-media-preview-v2\n                        :key="cover ? cover.media?.url : product.cover.media?.url"\n                        class="sw-product-media-form__cover-image"\n                        :source="cover ? cover.mediaId : product.cover.mediaId"\n                    />\n                    {% endblock %}\n                    <span>{{ $tc(\'sw-product.mediaForm.coverSubline\') }}</span>\n                </div>\n            </div>\n            <div\n                v-else\n                class="sw-product-media-form__cover-image is--placeholder"\n            >\n                {{ $tc(\'sw-product.mediaForm.coverSubline\') }}\n            </div>\n            {% endblock %}\n        </div>\n\n        <div\n            v-if="!isLoading"\n            class="sw-product-media-form__grid sw-product-media-form__column"\n            :style="gridAutoRows"\n        >\n            {%  block sw_product_media_form_grid_items %}\n            <sw-product-image\n                v-for="mediaItem in mediaItems"\n                :key="mediaItem.id"\n                v-draggable="{ dragGroup: \'product-media\', data: mediaItem, onDragEnter: onMediaItemDragSort }"\n                v-droppable="{ dragGroup: \'product-media\', data: mediaItem }"\n                :is-cover="isCover(mediaItem)"\n                :is-spatial="isSpatial(mediaItem)"\n                :is-ar-ready="isArReady(mediaItem)"\n                :is-placeholder="mediaItem.isPlaceholder"\n                :media-id="mediaItem.mediaId"\n                :show-cover-label="showCoverLabel"\n                @sw-product-image-delete="removeFile(mediaItem)"\n                @sw-product-image-cover="markMediaAsCover(mediaItem)"\n            />\n            {% endblock %}\n        </div>\n        <sw-loader v-else />\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["repositoryFactory","acl","systemConfigApiService"],emits:["media-open"],mixins:[o.getByName("notification")],props:{disabled:{type:Boolean,required:!1,default:!1},isInherited:{type:Boolean,required:!1,default:!1},fileAccept:{type:String,required:!1,default:"*/*"}},data(){return{showCoverLabel:!0,isMediaLoading:!1,columnCount:5,columnWidth:90,globalIsArReady:!1}},computed:{product(){let e=Shopware.State.get("swProductDetail");return this.isInherited?e.parentProduct:e.product},mediaItems(){let e=this.productMedia.slice(),i=this.getPlaceholderCount(this.columnCount);if(0===i)return e;for(let t=0;t<i;t+=1)e.push(this.createPlaceholderMedia(e));return e},cover(){if(!this.product)return null;let e=this.product.cover?this.product.cover.mediaId:this.product.coverId;return this.product.media.find(i=>i.id===e)},...r("swProductDetail",{isStoreLoading:"isLoading"}),isLoading(){return this.isMediaLoading||this.isStoreLoading},productMediaRepository(){return this.repositoryFactory.create("product_media")},mediaRepository(){return this.repositoryFactory.create("media")},productMedia(){return this.product?this.product.media:[]},productMediaStore(){return this.product.getAssociation("media")},gridAutoRows(){return`grid-auto-rows: ${this.columnWidth}`},currentCoverID(){return this.productMedia.find(e=>e.media.id===this.product.coverId).id}},created(){this.onCreated()},methods:{onCreated(){this.systemConfigApiService.getValues("core.media").then(e=>{this.globalIsArReady=e["core.media.defaultEnableAugmentedReality"]}).catch(e=>{throw e})},onOpenMedia(){this.$emit("media-open")},updateColumnCount(){this.$nextTick(()=>{if(this.isLoading)return!1;let e=window.getComputedStyle(this.$refs.grid,null).getPropertyValue("grid-template-columns").split(" ");return this.columnCount=e.length,this.columnWidth=e[0],!0})},getPlaceholderCount(e){this.productMedia.length+3<2*e&&(e*=2);let i=e;return 0!==this.productMedia.length&&(i=e-this.productMedia.length%e)===e?0:i},createPlaceholderMedia(e){return{isPlaceholder:!0,isCover:0===e.length,media:{isPlaceholder:!0,name:""},mediaId:e.length.toString()}},buildProductMedia(e){this.isLoading=!0;let i=this.productMediaStore.create();return i.mediaId=e,0===this.productMedia.length?(i.position=0,this.product.cover=i,this.product.coverId=i.id):i.position=this.productMedia.length+1,this.isLoading=!1,i},async successfulUpload({targetId:e}){let i=this.product.media.find(i=>i.mediaId===e);if(i){let t=await this.mediaRepository.get(e),d=this.createMediaAssociation(e);d.media=t;let o=this.product.cover?.id===i.id;this.product.media.remove(i.id),this.product.media.add(d),o&&(this.product.coverId=d.id,this.product.cover=d);return}let t=this.createMediaAssociation(e);this.product.media.add(t)},createMediaAssociation(e){let i=this.productMediaRepository.create();return i.productId=this.product.id,i.mediaId=e,this.product.media.length<=0?(i.position=0,this.product.coverId=i.id):i.position=this.product.media.length,i},onUploadFailed(e){let i=this.product.media.find(i=>i.mediaId===e.targetId);i&&(this.product.coverId===i.id&&(this.product.coverId=null),this.product.media.remove(i.id)),this.product.isLoading=!1},removeCover(){this.product.cover=null,this.product.coverId=null},isCover(e){let i=this.product.cover?this.product.cover.id:this.product.coverId;return 0!==this.product.media.length&&!e.isPlaceholder&&e.id===i},isSpatial(e){return e.media?.fileExtension==="glb"||!!e.media?.url?.endsWith(".glb")},isArReady(e){return e.media?.config?.spatial?.arReady??this.globalIsArReady},removeFile(e){this.product.coverId===e.id&&(this.product.cover=null,this.product.coverId=null),null===this.product.coverId&&this.product.media.length>0&&(this.product.coverId=this.product.media.first().id),this.product.media.remove(e.id)},markMediaAsCover(e){this.product.cover=e,this.product.coverId=e.id,this.product.media.moveItem(e.position,0),this.updateMediaItemPositions()},onDropMedia(e){if(this.product.media.find(i=>i.mediaId===e.id))return;let i=this.createMediaAssociation(e.mediaItem.id);0===this.product.media.length&&(i.position=0,this.product.cover=i,this.product.coverId=i.id),this.product.media.add(i)},onMediaItemDragSort(e,i,t){!0===t&&(e.id!==this.product.coverId||0!==e.position)&&(i.id!==this.product.coverId||0!==i.position)&&(this.product.media.moveItem(e.position,i.position),this.updateMediaItemPositions())},updateMediaItemPositions(){this.productMedia.forEach((e,i)=>{e.position=i})}}}},494324:function(e,i,t){var d=t(198234);d.__esModule&&(d=d.default),"string"==typeof d&&(d=[[e.id,d,""]]),d.locals&&(e.exports=d.locals),t(745346).Z("0b72c5b6",d,!0,{})}}]);