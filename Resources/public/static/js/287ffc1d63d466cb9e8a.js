(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[571],{980004:function(){},571:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return a}});var d=t(500624);t(410975);let{ShopwareError:r}=Shopware.Classes,{Mixin:n,EntityDefinition:i}=Shopware,{Criteria:o}=Shopware.Data;var a={template:'\n{% block sw_customer_detail_addresses %}\n<div class="sw-customer-detail-addresses">\n\n    \n    {% block sw_customer_detail_addresses_card %}\n    <sw-card\n        position-identifier="sw-customer-detail-addresses"\n        :is-loading="isLoading"\n        :large="true"\n    >\n        \n        {% block sw_customer_detail_addresses_toolbar %}\n        <template #toolbar>\n            <sw-card-filter\n                placeholder=""\n                @sw-card-filter-term-change="onChange"\n            >\n                <template #filter>\n                    \n                    {% block sw_customer_detail_addresses_add_button %}\n                    <sw-button\n                        class="sw-customer-detail-addresses__add-address-action"\n                        :disabled="!customerEditMode"\n                        size="small"\n                        @click="onCreateNewAddress"\n                    >\n                        <sw-icon\n                            name="regular-plus-circle-s"\n                            small\n                        />\n                        {{ $tc(\'sw-customer.detailAddresses.buttonAddAddress\') }}\n                    </sw-button>\n                    {% endblock %}\n                </template>\n            </sw-card-filter>\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_customer_detail_addresses_add_modal %}\n        <sw-modal\n            v-if="currentAddress"\n            :title="$tc(\'sw-customer.detailAddresses.modalTitleAddress\')"\n            @modal-close="onCloseAddressModal"\n        >\n\n            \n            {% block sw_customer_detail_addresses_add_modal_address_form %}\n            <sw-customer-address-form\n                :address="currentAddress"\n                :customer="activeCustomer"\n            >\n\n                <sw-customer-address-form-options\n                    :address="currentAddress"\n                    :customer="activeCustomer"\n                    :custom-field-sets="customerAddressCustomFieldSets"\n                    @default-address-change="onChangeDefaultAddress"\n                />\n\n            </sw-customer-address-form>\n            {% endblock %}\n\n            \n            {% block sw_customer_detail_addresses_add_modal_footer %}\n            <template #modal-footer>\n                \n                {% block sw_customer_detail_addresses_add_modal_cancel %}\n                <sw-button\n                    size="small"\n                    @click="onCloseAddressModal"\n                >\n                    {{ $tc(\'sw-customer.detailAddresses.buttonCancel\') }}\n                </sw-button>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_add_modal_apply %}\n                <sw-button\n                    variant="primary"\n                    size="small"\n                    @click="onSaveAddress"\n                >\n                    {{ $tc(\'sw-customer.detailAddresses.buttonApply\') }}\n                </sw-button>\n                {% endblock %}\n            </template>\n            {% endblock %}\n        </sw-modal>\n        {% endblock %}\n\n        \n        {% block sw_customer_detail_addresses_grid %}\n        <template #grid>\n            <sw-one-to-many-grid\n                ref="addressGrid"\n                :collection="sortedAddresses"\n                :local-mode="false"\n                :columns="addressColumns"\n                :show-selection="false"\n                :sort-direction="addressSortDirection"\n                :sort-by="addressSortProperty"\n                :is-loading="isLoading"\n                @column-sort="setAddressSorting"\n            >\n                \n                {% block sw_customer_detail_addresses_grid_columns %}\n                \n                {% block sw_customer_detail_addresses_grid_columns_default_shipping_address %}\n                <template #column-defaultShippingAddress="{ item }">\n                    <sw-radio-field\n                        v-model:value="activeCustomer.defaultShippingAddressId"\n                        :disabled="!customerEditMode"\n                        name="defaultShippingAddress"\n                        :options="[{ value: item.id }]"\n                        @update:value="onChangeDefaultShippingAddress"\n                    />\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_default_billing_address %}\n                <template #column-defaultBillingAddress="{ item }">\n                    <sw-radio-field\n                        v-model:value="activeCustomer.defaultBillingAddressId"\n                        :disabled="!customerEditMode"\n                        name="defaultBillingAddress"\n                        :options="[{ value: item.id }]"\n                        @update:value="onChangeDefaultBillingAddress"\n                    />\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_last_name %}\n                <template #column-lastName="{ item }">\n                    <a\n                        v-if="customerEditMode"\n                        role="link"\n                        tabindex="0"\n                        @click="onEditAddress(item.id)"\n                        @keydown.enter="onEditAddress(item.id)"\n                    >\n                        {{ item.lastName }}\n                    </a>\n\n                    <template v-else>\n                        {{ item.lastName }}\n                    </template>\n                </template>\n                {% endblock %}\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_actions %}\n                <template #actions="{ item }">\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_edit %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onEditAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuEdit\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_duplicate %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onDuplicateAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDuplicate\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_defaultShippingAddress %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onChangeDefaultShippingAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDefaultShippingAddress\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_defaultBillingAddress %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onChangeDefaultBillingAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDefaultBillingAddress\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_delete %}\n                    <sw-context-menu-item\n                        variant="danger"\n                        :disabled="!customerEditMode || isDefaultAddress(item.id)"\n                        @click="onDeleteAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDelete\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_action_modals %}\n                <template #action-modals="{ item }">\n                    \n                    {% block sw_customer_detail_addresses_delete_modal %}\n                    <sw-modal\n                        v-if="showDeleteAddressModal === item.id"\n                        :title="$tc(\'global.default.warning\')"\n                        variant="small"\n                        @modal-close="onCloseDeleteAddressModal"\n                    >\n                        \n                        {% block sw_customer_detail_addresses_delete_modal_confirm_delete_text %}\n                        <p class="sw-customer-detail-addresses__confirm-delete-text">\n                            {{ $tc(\'sw-customer.detailAddresses.textDeleteAddressConfirm\') }}\n                        </p>\n                        {% endblock %}\n\n                        \n                        {% block sw_customer_detail_addresses_delete_modal_address_item %}\n                        <sw-address\n                            class="sw-customer-detail-addresses__confirm-delete-address"\n                            :address="item"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_customer_detail_addresses_delete_modal_footer %}\n                        <template #modal-footer>\n                            \n                            {% block sw_customer_detail_addresses_delete_modal_cancel %}\n                            <sw-button\n                                size="small"\n                                @click="onCloseDeleteAddressModal"\n                            >\n                                {{ $tc(\'sw-customer.detailAddresses.buttonCancel\') }}\n                            </sw-button>\n                            {% endblock %}\n\n                            \n                            {% block sw_customer_detail_addresses_delete_modal_confirm %}\n                            <sw-button\n                                variant="danger"\n                                size="small"\n                                @click="onConfirmDeleteAddress(item.id)"\n                            >\n                                {{ $tc(\'sw-customer.detailAddresses.buttonDelete\') }}\n                            </sw-button>\n                            {% endblock %}\n                        </template>\n                        {% endblock %}\n                    </sw-modal>\n                    {% endblock %}\n                </template>\n                {% endblock %}\n            </sw-one-to-many-grid>\n        </template>\n        {% endblock %}\n    </sw-card>\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory"],mixins:[n.getByName("notification")],props:{customer:{type:Object,required:!0},customerEditMode:{type:Boolean,required:!0}},data(){return{isLoading:!1,activeCustomer:this.customer,showAddAddressModal:!1,showEditAddressModal:!1,showDeleteAddressModal:!1,addressSortProperty:null,addressSortDirection:"",currentAddress:null,customerAddressCustomFieldSets:null}},computed:{customerRepository(){return this.repositoryFactory.create("customer")},customFieldSetRepository(){return this.repositoryFactory.create("custom_field_set")},customerAddressRepository(){return this.repositoryFactory.create("customer_address")},addressColumns(){return this.getAddressColumns()},addressRepository(){return this.repositoryFactory.create(this.activeCustomer.addresses.entity,this.activeCustomer.addresses.source)},sortedAddresses(){return this.addressSortProperty?this.activeCustomer.addresses.sort((e,s)=>{let t=e[this.addressSortProperty],d=s[this.addressSortProperty],r=null;return("string"==typeof t&&"string"==typeof d&&(r=t.toUpperCase()>d.toUpperCase()),"number"==typeof t&&"number"==typeof d&&(r=t-d>0),null!==r)?"DESC"===this.addressSortDirection?r?-1:1:r?1:-1:0}):this.activeCustomer.addresses},salutationRepository(){return this.repositoryFactory.create("salutation")},salutationCriteria(){let e=new o(1,1);return e.addFilter(o.equals("salutationKey","not_specified")),e}},created(){this.createdComponent()},methods:{createdComponent(){if(this.isLoading=!0,!this.activeCustomer.id&&this.$route.params.id){this.customerRepository.get(this.$route.params.id).then(e=>{this.activeCustomer=e,this.isLoading=!1});return}if(!this.activeCustomer.id){this.$router.push({name:"sw.customer.detail.base",params:{id:this.$route.params.id}});return}let e=new o(1,25);e.addFilter(o.equals("relations.entityName","customer_address")),this.customFieldSetRepository.search(e).then(e=>{this.customerAddressCustomFieldSets=e}),this.isLoading=!1},getAddressColumns(){return[{property:"defaultShippingAddress",label:this.$tc("sw-customer.detailAddresses.columnDefaultShippingAddress"),align:"center",iconLabel:"regular-shopping-cart",iconTooltip:this.$tc("sw-customer.detailAddresses.columnDefaultShippingAddress")},{property:"defaultBillingAddress",label:this.$tc("sw-customer.detailAddresses.columnDefaultBillingAddress"),align:"center",iconLabel:"regular-file-text",iconTooltip:this.$tc("sw-customer.detailAddresses.columnDefaultBillingAddress")},{property:"lastName",label:this.$tc("sw-customer.detailAddresses.columnLastName")},{property:"firstName",label:this.$tc("sw-customer.detailAddresses.columnFirstName")},{property:"company",label:this.$tc("sw-customer.detailAddresses.columnCompany")},{property:"street",label:this.$tc("sw-customer.detailAddresses.columnStreet")},{property:"zipcode",label:this.$tc("sw-customer.detailAddresses.columnZipCode"),align:"right"},{property:"city",label:this.$tc("sw-customer.detailAddresses.columnCity")}]},setAddressSorting(e){this.addressSortProperty=e.property;let s="ASC";this.addressSortProperty===e.dataIndex&&this.addressSortDirection===s&&(s="DESC"),this.addressSortProperty=e.dataIndex,this.addressSortDirection=s},onCreateNewAddress(){this.showAddAddressModal=!0,this.createNewCustomerAddress()},async createNewCustomerAddress(){let e=await this.getDefaultSalutation(),s=this.addressRepository.create();s.customerId=this.activeCustomer.id,s.salutationId=e,this.currentAddress=s},onSaveAddress(){if(null===this.currentAddress||!this.isValidAddress(this.currentAddress))return;let e=this.activeCustomer.addresses.get(this.currentAddress.id);null==e&&(e=this.addressRepository.create(Shopware.Context.api,this.currentAddress.id)),Object.assign(e,this.currentAddress),this.customer.addresses.has(e.id)&&this.customer.addresses.remove(e.id),this.customer.addresses.push(e),this.currentAddress=null},isValidAddress(e){let s=["createdAt"],t=Object.keys(i.getRequiredFields("customer_address")),n=!0;return t.forEach(t=>{-1!==s.indexOf(t)||(0,d.C1)(e[t])||(n=!1,Shopware.State.dispatch("error/addApiError",{expression:`customer_address.${this.currentAddress.id}.${t}`,error:new r({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})}))}),n},onCloseAddressModal(){this.defaultShippingAddressId&&(this.activeCustomer.defaultShippingAddressId=this.defaultShippingAddressId),this.defaultBillingAddressId&&(this.activeCustomer.defaultBillingAddressId=this.defaultBillingAddressId),this.$route.query.detailId&&(this.$route.query.detailId=null),this.currentAddress=null},onEditAddress(e){let s=this.addressRepository.create(Shopware.Context.api,e);Object.assign(s,this.activeCustomer.addresses.get(e)),this.currentAddress=s,this.showEditAddressModal=e},onDeleteAddress(e){this.isDefaultAddress(e)||(this.showDeleteAddressModal=e)},onConfirmDeleteAddress(e){return this.onCloseDeleteAddressModal(),this.customerAddressRepository.delete(e).then(()=>{this.refreshList()})},onCloseDeleteAddressModal(){this.showDeleteAddressModal=!1},isDefaultAddress(e){return this.activeCustomer.defaultBillingAddressId===e||this.activeCustomer.defaultShippingAddressId===e},onChangeDefaultBillingAddress(e){this.activeCustomer.defaultBillingAddressId=e,this.customer.defaultBillingAddressId=e},onChangeDefaultShippingAddress(e){this.activeCustomer.defaultShippingAddressId=e,this.customer.defaultShippingAddressId=e},async onDuplicateAddress(e){let{id:s}=await this.customerAddressRepository.clone(e),t=await this.customerAddressRepository.get(s);this.activeCustomer.addresses.push(t)},onChangeDefaultAddress(e){if(!e.value){this.defaultShippingAddressId&&(this.activeCustomer.defaultShippingAddressId=this.defaultShippingAddressId),this.defaultBillingAddressId&&(this.activeCustomer.defaultBillingAddressId=this.defaultBillingAddressId);return}let s=this.createPrefix(e.name,"-address"),t=`default${s}AddressId`;this[t]=this.activeCustomer[t],this.activeCustomer[t]=e.id,this.customer[t]=e.id},onChange(e){this.activeCustomer.addresses.criteria.setPage(1),this.activeCustomer.addresses.criteria.setTerm(e),this.refreshList()},refreshList(){this.$refs.addressGrid.load()},createPrefix(e,s){let t=e.replace(s,"");return`${t.charAt(0).toUpperCase()}${t.slice(1)}`},async getDefaultSalutation(){let e=await this.salutationRepository.searchIds(this.salutationCriteria);return e.data?.[0]}}}},410975:function(e,s,t){var d=t(980004);d.__esModule&&(d=d.default),"string"==typeof d&&(d=[[e.id,d,""]]),d.locals&&(e.exports=d.locals),t(745346).Z("54785089",d,!0,{})}}]);