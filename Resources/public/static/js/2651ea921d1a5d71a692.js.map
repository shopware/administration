{"version":3,"sources":["webpack:///./src/module/sw-product-stream/component/sw-product-stream-modal-preview/index.js","webpack:///./src/module/sw-product-stream/component/sw-product-stream-modal-preview/sw-product-stream-modal-preview.html.twig","webpack:///./src/module/sw-product-stream/component/sw-product-stream-modal-preview/sw-product-stream-modal-preview.scss"],"names":["Context","Shopware","Criteria","Data","template","inject","props","filters","type","Array","required","data","products","selectedSalesChannel","searchTerm","page","total","limit","isLoading","computed","salesChannelRepository","this","repositoryFactory","create","salesChannelCriteria","criteria","addSorting","sort","previewCriteria","setTerm","productColumns","property","label","$tc","routerLink","align","currencyFilter","Filter","getByName","stockColorVariantFilter","created","createdComponent","methods","onSearchTermChange","_this","loadEntityData","then","onSalesChannelChange","_this2","_this3","loadSalesChannels","finally","_this4","productStreamPreviewService","preview","mapFiltersForSearch","app","systemCurrencyId","result","Object","values","elements","_this5","searchIds","_ref","at","_this6","map","condition","field","operator","value","parameters","queries","mapped","_objectSpread","closeModal","$emit","getPriceForDefaultCurrency","product","cheapest","calculatedCheapestPrice","real","calculatedPrice","calculatedPrices","length","unitPrice","onPageChange","_ref2","_this7","_ref2$page","_ref2$limit","content","__esModule","default","module","i","locals","exports","add"],"mappings":"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","file":"static/js/2651ea921d1a5d71a692.js","sourcesContent":["/*\n * @package business-ops\n */\n\nimport template from './sw-product-stream-modal-preview.html.twig';\nimport './sw-product-stream-modal-preview.scss';\n\nconst { Context } = Shopware;\nconst { Criteria } = Shopware.Data;\n\n/**\n * @private\n */\nexport default {\n    template,\n\n    inject: ['repositoryFactory', 'productStreamPreviewService'],\n\n    props: {\n        filters: {\n            type: Array,\n            required: true,\n        },\n    },\n    data() {\n        return {\n            products: [],\n            selectedSalesChannel: null,\n            searchTerm: '',\n            page: 1,\n            total: false,\n            limit: 25,\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        salesChannelRepository() {\n            return this.repositoryFactory.create('sales_channel');\n        },\n\n        salesChannelCriteria() {\n            const criteria = new Criteria(1, 1);\n            criteria.addSorting(Criteria.sort('type.iconName', 'ASC'));\n\n            return criteria;\n        },\n\n        previewCriteria() {\n            const criteria = new Criteria(this.page, this.limit);\n            criteria.setTerm(this.searchTerm);\n\n            return criteria;\n        },\n\n        productColumns() {\n            return [\n                {\n                    property: 'name',\n                    label: this.$tc('sw-product-stream.filter.values.product'),\n                    type: 'text',\n                    routerLink: 'sw.product.detail',\n                }, {\n                    property: 'manufacturer.name',\n                    label: this.$tc('sw-product-stream.filter.values.manufacturerId'),\n                }, {\n                    property: 'active',\n                    label: this.$tc('sw-product-stream.filter.values.active'),\n                    align: 'center',\n                    type: 'bool',\n                }, {\n                    property: 'price',\n                    label: this.$tc('sw-product-stream.filter.values.price'),\n                }, {\n                    property: 'stock',\n                    label: this.$tc('sw-product-stream.filter.values.stock'),\n                    align: 'right',\n                },\n            ];\n        },\n\n        currencyFilter() {\n            return Shopware.Filter.getByName('currency');\n        },\n\n        stockColorVariantFilter() {\n            return Shopware.Filter.getByName('stockColorVariant');\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        onSearchTermChange(searchTerm) {\n            this.searchTerm = searchTerm;\n            this.page = 1;\n            this.isLoading = true;\n            this.loadEntityData()\n                .then(() => {\n                    this.isLoading = false;\n                });\n        },\n        onSalesChannelChange() {\n            this.page = 1;\n            this.isLoading = true;\n            this.loadEntityData()\n                .then(() => {\n                    this.isLoading = false;\n                });\n        },\n        createdComponent() {\n            this.isLoading = true;\n\n            return this.loadSalesChannels()\n                .then(() => {\n                    return this.loadEntityData();\n                })\n                .finally(() => {\n                    this.isLoading = false;\n                });\n        },\n\n        loadEntityData() {\n            if (!this.selectedSalesChannel) {\n                return false;\n            }\n\n            return this.productStreamPreviewService.preview(\n                this.selectedSalesChannel,\n                this.previewCriteria,\n                this.mapFiltersForSearch(this.filters),\n                {\n                    'sw-currency-id': Context.app.systemCurrencyId,\n                    'sw-inheritance': true,\n                },\n            ).then((result) => {\n                this.products = Object.values(result.elements);\n                this.total = result.total;\n            });\n        },\n\n        loadSalesChannels() {\n            return this.salesChannelRepository.searchIds(this.salesChannelCriteria).then(({ data }) => {\n                this.selectedSalesChannel = data.at(0);\n            });\n        },\n\n        mapFiltersForSearch(filters) {\n            return filters.map((condition) => {\n                const { field, type, operator, value, parameters, queries } = condition;\n                const mappedQueries = this.mapFiltersForSearch(queries);\n                const mapped = { field, type, operator, value, parameters, queries: mappedQueries };\n\n                if (field === 'id' || field === 'product.id') {\n                    return {\n                        type: 'multi',\n                        field: null,\n                        operator: 'OR',\n                        value: null,\n                        parameters: null,\n                        queries: [mapped, { ...mapped, ...{ field: 'parentId' } }],\n                    };\n                }\n\n                return mapped;\n            });\n        },\n\n        closeModal() {\n            this.$emit('modal-close');\n        },\n\n        getPriceForDefaultCurrency(product) {\n            const cheapest = product.calculatedCheapestPrice;\n            let real = product.calculatedPrice;\n\n            if (product.calculatedPrices.length > 0) {\n                real = product.calculatedPrices[product.calculatedPrices.length - 1];\n            }\n\n            if (cheapest.unitPrice !== real.unitPrice) {\n                return real;\n            }\n\n            return cheapest;\n        },\n\n        onPageChange({ page = 1, limit = 25 }) {\n            this.isLoading = true;\n\n            this.page = page;\n            this.limit = limit;\n\n            this.loadEntityData()\n                .then(() => {\n                    this.isLoading = false;\n                });\n        },\n    },\n};\n","export default \"\\n{% block sw_product_stream_modal_preview %}\\n<sw-modal\\n    class=\\\"sw-product-stream-modal-preview\\\"\\n    :title=\\\"`${$tc('sw-product-stream.previewModal.title')} (${total || 0})`\\\"\\n    :is-loading=\\\"isLoading\\\"\\n    variant=\\\"full\\\"\\n    @modal-close=\\\"closeModal\\\"\\n>\\n    \\n    {% block sw_product_stream_modal_preview_content %}\\n    <div class=\\\"sw-product-stream-modal-preview__content\\\">\\n        \\n        {% block sw_product_stream_modal_preview_content_header %}\\n        <sw-container class=\\\"sw-product-stream-modal-preview__content-header\\\">\\n            \\n            {% block sw_product_stream_modal_preview_search_field_label %}\\n            <sw-label class=\\\"sw-product-stream-modal-preview__search-field-label\\\">\\n                \\n                {% block sw_product_stream_modal_preview_search_field %}\\n                <sw-simple-search-field\\n                    class=\\\"sw-product-stream-modal-preview__search-field\\\"\\n                    variant=\\\"form\\\"\\n                    :value=\\\"searchTerm\\\"\\n                    :delay=\\\"750\\\"\\n                    @search-term-change=\\\"onSearchTermChange\\\"\\n                />\\n                {% endblock %}\\n            </sw-label>\\n            {% endblock %}\\n            \\n            {% block sw_product_stream_modal_preview_sales_channel_field_label %}\\n            <sw-label class=\\\"sw-product-stream-modal-preview__sales-channel-field-label\\\">\\n                \\n                {% block sw_product_stream_modal_preview_sales_channel_field %}\\n                <sw-entity-single-select\\n                    {% if VUE3 %}\\n                    v-model:value=\\\"selectedSalesChannel\\\"\\n                    {% else %}\\n                    v-model=\\\"selectedSalesChannel\\\"\\n                    {% endif %}\\n                    :disabled=\\\"isLoading\\\"\\n                    entity=\\\"sales_channel\\\"\\n                    class=\\\"sw-product-stream-modal-preview__sales-channel-field\\\"\\n                    :label=\\\"$tc('sw-settings.system-config.labelSalesChannelSelect')\\\"\\n                    {% if VUE3 %}\\n                    @update:value=\\\"onSalesChannelChange\\\"\\n                    {% else %}\\n                    @change=\\\"onSalesChannelChange\\\"\\n                    {% endif %}\\n                />\\n                {% endblock %}\\n            </sw-label>\\n            {% endblock %}\\n        </sw-container>\\n        {% endblock %}\\n\\n        \\n        {% block sw_product_stream_modal_preview_grid %}\\n        <sw-data-grid\\n            v-if=\\\"total\\\"\\n            :data-source=\\\"products\\\"\\n            :columns=\\\"productColumns\\\"\\n            :show-selection=\\\"false\\\"\\n            :show-actions=\\\"false\\\"\\n            :show-previews=\\\"true\\\"\\n            :is-loading=\\\"isLoading\\\"\\n            full-page\\n        >\\n\\n            <template #column-name=\\\"{ item, column }\\\">\\n                \\n                {% block sw_product_stream_modal_preview_grid_column_name %}\\n                <router-link :to=\\\"{ name: column.routerLink, params: { id: item.id } }\\\">\\n                    <sw-product-variant-info :variations=\\\"item.variation\\\">\\n                        {{ item.name || item.translated.name }}\\n                    </sw-product-variant-info>\\n                </router-link>\\n                {% endblock %}\\n            </template>\\n\\n            <template #column-active=\\\"{ item }\\\">\\n                \\n                {% block sw_product_stream_modal_preview_grid_column_active %}\\n                <sw-data-grid-column-boolean\\n                    :value=\\\"item.active\\\"\\n                    :is-inline-edit=\\\"false\\\"\\n                />\\n                {% endblock %}\\n            </template>\\n\\n            <template #column-price=\\\"{ item }\\\">\\n                \\n                {% block sw_product_stream_modal_preview_grid_column_price %}\\n                {{ currencyFilter(getPriceForDefaultCurrency(item).unitPrice, 'EUR') }}\\n                {% endblock %}\\n            </template>\\n\\n            <template #column-stock=\\\"{ item }\\\">\\n                \\n                {% block sw_product_stream_modal_preview_grid_column_stock %}\\n                {{ item.stock }}\\n                <sw-color-badge :variant=\\\"stockColorVariantFilter(item.stock)\\\" />\\n                {% endblock %}\\n            </template>\\n\\n            <template #pagination>\\n                \\n                {% block sw_product_stream_modal_preview_grid_pagination %}\\n                <sw-pagination\\n                    v-bind=\\\"{ total, page, limit }\\\"\\n                    :total-visible=\\\"7\\\"\\n                    :auto-hide=\\\"false\\\"\\n                    @page-change=\\\"onPageChange\\\"\\n                />\\n                {% endblock %}\\n            </template>\\n        </sw-data-grid>\\n        {% endblock %}\\n\\n        \\n        {% block sw_product_stream_modal_preview_empty_state %}\\n        <sw-empty-state\\n            v-if=\\\"!total && !isLoading\\\"\\n            :absolute=\\\"false\\\"\\n            :title=\\\"$tc('sw-product-stream.previewModal.empty')\\\"\\n        />\\n        {% endblock %}\\n    </div>\\n    {% endblock %}\\n\\n    \\n    {% block sw_product_stream_modal_preview_footer %}\\n    <template #modal-footer>\\n        \\n        {% block sw_product_stream_modal_preview_close_button %}\\n        <sw-button\\n            class=\\\"sw-product-stream-modal-preview__close-action\\\"\\n            variant=\\\"primary\\\"\\n            @click.prevent=\\\"closeModal\\\"\\n        >\\n            {{ $tc('sw-product-stream.previewModal.close') }}\\n        </sw-button>\\n        {% endblock %}\\n    </template>\\n    {% endblock %}\\n</sw-modal>\\n{% endblock %}\\n\";","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--15-1!../../../../../node_modules/css-loader/dist/cjs.js??ref--15-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--15-3!./sw-product-stream-modal-preview.scss\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"f1fcffaa\", content, true, {});"],"sourceRoot":""}