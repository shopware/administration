(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[15],{PMCM:function(e,t,n){"use strict";t.a=Object.freeze({ACCOUNT_TYPE_PRIVATE:"private",ACCOUNT_TYPE_BUSINESS:"business"})},dK8t:function(e,t,n){"use strict";n.r(t);var r=n("7yzw"),s=n.n(r),o=n("CsSd"),a=n.n(o),i=n("92Mt"),c=n.n(i),d=(n("pGxB"),n("PMCM"));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=Shopware.Mixin,p=Shopware.Data.Criteria,h=Shopware.Component.getComponentHelper().mapPageErrors;t.default={template:'\n{% block sw_order_new_customer_modal %}\n<sw-modal\n    :title="$tc(\'sw-order.createBase.detailsHeader.buttonAddNewCustomer\')"\n    @modal-close="onClose"\n>\n    \n    {% block sw_order_new_customer_modal_tabs %}\n    <sw-tabs\n        class="sw-order-new-customer-modal"\n        position-identifier="sw-order-new-customer-modal"\n        default-item="details"\n    >\n        <template #default="{ active }">\n            \n            {% block sw_order_new_customer_modal_tabs_details %}\n            <sw-tabs-item\n                name="details"\n                :active-tab="active"\n                :has-error="swOrderNewCustomerDetailError"\n            >\n                {{ $tc(\'sw-order.newCustomerModal.labelDetails\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_tabs_billing %}\n            <sw-tabs-item\n                name="billingAddress"\n                :active-tab="active"\n                :has-error="swOrderNewCustomerAddressError"\n            >\n                {{ $tc(\'sw-order.createBase.detailsBody.labelBillingAddress\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_tabs_shipping %}\n            <sw-tabs-item\n                name="shippingAddress"\n                :active-tab="active"\n                :has-error="!isSameBilling && swOrderNewCustomerAddressError"\n            >\n                {{ $tc(\'sw-order.createBase.detailsBody.labelShippingAddress\') }}\n            </sw-tabs-item>\n            {% endblock %}\n        </template>\n\n        <template #content="{ active }">\n            \n            {% block sw_order_new_customer_modal_content_details %}\n            <div v-if="active ===\'details\'">\n                \n                {% block sw_order_new_customer_modal_content_details_guest %}\n                <sw-switch-field\n                    {% if VUE3 %}\n                    v-model:value="customer.guest"\n                    {% else %}\n                    v-model="customer.guest"\n                    {% endif %}\n                    no-margin-top\n                    :label="$tc(\'sw-order.newCustomerModal.labelGuest\')"\n                />\n                {% endblock %}\n                \n                {% block sw_order_new_customer_modal_content_details_form %}\n                <sw-customer-base-form\n                    :is-loading="isLoading"\n                    :customer="customer"\n                    @sales-channel-change="onChangeSalesChannel"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_content_shipping %}\n            <div v-if="active === \'shippingAddress\'">\n                \n                {% block sw_order_new_customer_modal_content_shipping_same_billing %}\n                <sw-switch-field\n                    {% if VUE3 %}\n                    v-model:value="isSameBilling"\n                    {% else %}\n                    v-model="isSameBilling"\n                    {% endif %}\n                    no-margin-top\n                    :label="$tc(\'sw-customer.addressForm.labelSameBillingAddress\')"\n                />\n                {% endblock %}\n\n                \n                {% block sw_order_new_customer_modal_content_shipping_form %}\n                <sw-customer-address-form\n                    :customer="customer"\n                    :disabled="isSameBilling"\n                    :address="shippingAddress"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_content_billing %}\n            <div v-if="active ===\'billingAddress\'">\n                \n                {% block sw_order_new_customer_modal_content_billing_form %}\n                <sw-customer-address-form\n                    :customer="customer"\n                    :address="billingAddress"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </template>\n    </sw-tabs>\n    {% endblock %}\n\n    \n    {% block sw_order_new_customer_modal_actions %}\n    <template #modal-footer>\n        \n        {% block sw_order_new_customer_modal_action_close %}\n        <sw-button\n            size="small"\n            @click="onClose"\n        >\n            {{ $tc(\'global.default.cancel\') }}\n        </sw-button>\n        {% endblock %}\n\n        \n        {% block sw_order_new_customer_modal_actions_apply %}\n        <sw-button\n            size="small"\n            variant="primary"\n            :is-loading="isLoading"\n            @click="onSave"\n        >\n            {{ $tc(\'global.default.save\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n',inject:["repositoryFactory","numberRangeService","systemConfigApiService","customerValidationService"],mixins:[m.getByName("notification")],data:function(){return{customer:null,salesChannels:null,isLoading:!1,customerNumberPreview:""}},computed:l(l({},h({"sw.order.new.customer.detail":{customer:["firstName","lastName","email","salesChannelId","customerNumber","defaultPaymentMethodId","groupId"]},"sw.order.new.customer.address":{customer_address:["firstName","lastName","street","city","countryId"]}})),{},{customerRepository:function(){return this.repositoryFactory.create("customer")},addressRepository:function(){return this.repositoryFactory.create("customer_address")},shippingAddress:function(){return this.isSameBilling?this.billingAddress:null!==this.customer?this.customer.addresses.get(this.customer.defaultShippingAddressId):null},billingAddress:function(){return null!==this.customer?this.customer.addresses.get(this.customer.defaultBillingAddressId):null},isSameBilling:{get:function(){return null===this.customer||this.customer.defaultBillingAddressId===this.customer.defaultShippingAddressId},set:function(e){var t=this;if(!0===e)return this.customer.defaultShippingAddressId=this.customer.defaultBillingAddressId,void(this.customer.isNew()&&(this.customer.addresses=this.customer.addresses.filter((function(e){return e.id===t.customer.defaultBillingAddressId}))));var n=this.addressRepository.create();this.customer.addresses.add(n),this.customer.defaultShippingAddressId=n.id}},validCompanyField:function(){var e,t,n;return(null===(e=this.customer)||void 0===e?void 0:e.accountType)!==d.a.ACCOUNT_TYPE_BUSINESS||(null===(t=this.customer)||void 0===t||null===(n=t.company)||void 0===n?void 0:n.trim().length)},languageRepository:function(){return this.repositoryFactory.create("language")},languageCriteria:function(){var e,t=new p;return t.setLimit(1),null!==(e=this.customer)&&void 0!==e&&e.salesChannelId&&t.addFilter(p.equals("salesChannelDefaultAssignments.id",this.customer.salesChannelId)),t},languageId:function(){return this.loadLanguage(this.customer.salesChannelId)},salutationRepository:function(){return this.repositoryFactory.create("salutation")},salutationCriteria:function(){var e=new p(1,1);return e.addFilter(p.equals("salutationKey","not_specified")),e}}),watch:{"customer.salesChannelId":function(e){var t=this;this.systemConfigApiService.getValues("core.systemWideLoginRegistration").then((function(n){n["core.systemWideLoginRegistration.isCustomerBoundToSalesChannel"]&&(t.customer.boundSalesChannelId=e)}))},"customer.accountType":function(e){var t;e!==d.a.ACCOUNT_TYPE_BUSINESS&&Shopware.State.dispatch("error/removeApiError",{expression:"customer_address.".concat(null===(t=this.billingAddress)||void 0===t?void 0:t.id,".company")})}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;return s()(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.customer=e.customerRepository.create(),t.next=3,e.getDefaultSalutationId();case 3:n=t.sent,(r=e.addressRepository.create()).salutationId=n,e.customer.addresses.add(r),e.customer.defaultShippingAddressId=r.id,e.customer.defaultBillingAddressId=r.id,e.customer.accountType=d.a.ACCOUNT_TYPE_PRIVATE,e.customer.vatIds=[],e.customer.salutationId=n;case 12:case"end":return t.stop()}}),t)})))()},onSave:function(){var e=this;return s()(c.a.mark((function t(){var n,r,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=!1,t.next=3,e.validateEmail();case 3:if((r=t.sent)&&r.isValid||(n=!0),e.validCompanyField||(e.createErrorMessageForCompanyField(),n=!0),e.customer.accountType===d.a.ACCOUNT_TYPE_PRIVATE&&(e.customer.vatIds=[]),!n){t.next=11;break}return e.createNotificationError({message:e.$tc("sw-customer.detail.messageSaveError")}),e.isLoading=!1,t.abrupt("return",!1);case 11:return s=Promise.resolve(),e.customerNumberPreview===e.customer.customerNumber&&(s=e.numberRangeService.reserve("customer",e.customer.salesChannelId).then((function(t){e.customerNumberPreview=t.number,e.customer.customerNumber=t.number}))),t.abrupt("return",s.then((function(){return e.saveCustomer()})));case 14:case"end":return t.stop()}}),t)})))()},saveCustomer:function(){var e=this;return s()(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.languageId;case 2:return n=t.sent,r=l(l({},Shopware.Context.api),{languageId:n}),t.abrupt("return",e.customerRepository.save(e.customer,r).then((function(t){return e.$emit("on-select-existing-customer",e.customer.id),e.isLoading=!1,e.onClose(),t})).catch((function(){e.createNotificationError({message:e.$tc("sw-customer.detail.messageSaveError")}),e.isLoading=!1})));case 5:case"end":return t.stop()}}),t)})))()},onChangeSalesChannel:function(e){var t=this;this.customer.salesChannelId=e,this.numberRangeService.reserve("customer",e,!0).then((function(e){t.customerNumberPreview=e.number,t.customer.customerNumber=e.number}))},onClose:function(){this.$emit("close")},createErrorMessageForCompanyField:function(){Shopware.State.dispatch("error/addApiError",{expression:"customer_address.".concat(this.billingAddress.id,".company"),error:new Shopware.Classes.ShopwareError({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})})},validateEmail:function(){var e=this,t=this.customer,n=t.id,r=t.email,s=t.boundSalesChannelId;return r?this.customerValidationService.checkCustomerEmail({id:n,email:r,boundSalesChannelId:s}).then((function(e){return e})).catch((function(t){var n,r;t&&Shopware.State.dispatch("error/addApiError",{expression:"customer.".concat(e.customer.id,".email"),error:null==t||null===(n=t.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.errors[0]})})):Promise.resolve({isValid:!0})},loadLanguage:function(e){var t=this;return s()(c.a.mark((function n(){var r,s;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Shopware.Context.api.languageId,e){n.next=3;break}return n.abrupt("return",r);case 3:return n.next=5,t.languageRepository.searchIds(t.languageCriteria);case 5:if(null!=(s=n.sent)&&s.data){n.next=8;break}return n.abrupt("return",r);case 8:return n.abrupt("return",s.data[0]);case 9:case"end":return n.stop()}}),n)})))()},getDefaultSalutationId:function(){var e=this;return s()(c.a.mark((function t(){var n,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.salutationRepository.searchIds(e.salutationCriteria);case 2:return r=t.sent,t.abrupt("return",null===(n=r.data)||void 0===n?void 0:n[0]);case 4:case"end":return t.stop()}}),t)})))()}}}},pGxB:function(e,t,n){var r=n("uEkT");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("P8hj").default)("7aa04da8",r,!0,{})},uEkT:function(e,t,n){}}]);
//# sourceMappingURL=401643d3930c7cd7e0f0.js.map