"use strict";(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[55139],{455139:function(o,n,i){i.r(n),i.d(n,{default:function(){return s}});let{Criteria:t,EntityCollection:e}=Shopware.Data,r=Shopware.Utils.types;var s={template:'\n{% block sw_promotion_v2_conditions %}\n<div class="sw-promotion-v2-conditions">\n\n    \n    {% block sw_promotion_v2_conditions_pre_conditions_card %}\n    <sw-card\n        :title="$tc(\'sw-promotion-v2.detail.conditions.preConditions.cardTitlePreConditions\')"\n        position-identifier="sw-promotion-conditions-pre-conditions"\n    >\n\n        \n        {% block sw_promotion_v2_conditions_pre_conditions_sales_channel_selection %}\n        <sw-promotion-v2-sales-channel-select\n            class="sw-promotion-v2-conditions__sales-channel-selection"\n            :promotion="promotion"\n            :entity-collection="promotion.salesChannels"\n            :disabled="!acl.can(\'promotion.editor\')"\n            :label="$tc(\'sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel\')"\n            :placeholder="$tc(\'sw-promotion-v2.detail.conditions.preConditions.labelPromotionSalesChannel\')"\n        />\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_conditions_pre_conditions_prevent_combination %}\n        <sw-switch-field\n            v-model:value="promotion.preventCombination"\n            class="sw-promotion-v2-conditions__prevent-combination"\n            :disabled="!acl.can(\'promotion.editor\')"\n            :label="$tc(\'sw-promotion-v2.detail.conditions.preConditions.labelPreventCombination\')"\n            :text="$tc(\'sw-promotion-v2.detail.conditions.preConditions.helpTextPreventCombination\')"\n        />\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_conditions_pre_conditions_exclusions %}\n        <sw-entity-multi-select\n            class="sw-promotion-v2-conditions__rules-exclusion-selection"\n            :label="$tc(\'sw-promotion-v2.detail.conditions.preConditions.labelPromotionExclusions\')"\n            :placeholder="$tc(\'sw-promotion-v2.detail.conditions.preConditions.placeholderPromotionExclusions\')"\n            :criteria="exclusionCriteria"\n            :entity-collection="excludedPromotions"\n            :disabled="!acl.can(\'promotion.editor\') || promotion.preventCombination"\n            @update:entity-collection="onChangeExclusions"\n        />\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n    \n    {% block sw_promotion_v2_rule_conditions_card %}\n    <sw-card\n        :title="$tc(\'sw-promotion-v2.detail.conditions.preConditions.cardTitleRuleConditions\')"\n        position-identifier="sw-promotion-conditions-rules"\n    >\n\n        \n        {% block sw_promotion_v2_rule_conditions_rule_select_customer %}\n        <sw-promotion-v2-rule-select\n            v-if="promotion"\n            v-model:collection="promotion.personaRules"\n            class="sw-promotion-v2-conditions__rule-select-customer"\n            :local-mode="promotion.isNew()"\n            :criteria="personaRuleFilter"\n            :label="$tc(\'sw-promotion-v2.detail.conditions.preConditions.labelCustomerSelect\')"\n            :placeholder="$tc(\'sw-promotion-v2.detail.conditions.preConditions.placeholderCustomerSelect\')"\n            :rule-scope="[\'checkout\']"\n            :disabled="!acl.can(\'promotion.editor\')"\n            rule-aware-group-key="personaPromotions"\n        />\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_rule_conditions_rule_select_cart_conditions %}\n        <sw-promotion-v2-cart-condition-form\n            :promotion="promotion"\n            :restricted-rules="cartRestrictedRules"\n        />\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_rule_conditions_rule_select_order_conditions %}\n        <sw-promotion-v2-rule-select\n            v-if="promotion"\n            v-model:collection="promotion.orderRules"\n            class="sw-promotion-v2-conditions__rule-select-order-conditions"\n            :label="$tc(\'sw-promotion-v2.detail.conditions.preConditions.labelOrderConditionSelect\')"\n            :placeholder="$tc(\'sw-promotion-v2.detail.conditions.preConditions.placeholderOrderConditionSelect\')"\n            :criteria="orderConditionsFilter"\n            :rule-scope="[\'checkout\']"\n            :disabled="!acl.can(\'promotion.editor\')"\n            rule-aware-group-key="orderPromotions"\n        />\n        {% endblock %}\n\n    </sw-card>\n    {% endblock %}\n\n</div>\n{% endblock %}\n',inject:["repositoryFactory","acl","feature","ruleConditionDataProviderService"],props:{promotion:{type:Object,required:!1,default(){return null}}},data(){return{excludedPromotions:this.createPromotionCollection(),personaRestrictedRules:[],orderRestrictedRules:[],cartRestrictedRules:[]}},computed:{exclusionCriteria(){let o=new t(1,25);return o.addFilter(t.not("and",[t.equals("id",this.promotion.id)])),o},personaRuleFilter(){let o=new t(1,25);return o.addAssociation("conditions").addSorting(t.sort("name","ASC",!1)),o},cartConditionsRuleFilter(){let o=new t(1,25);return o.addAssociation("conditions").addSorting(t.sort("name","ASC",!1)),o},orderConditionsFilter(){let o=new t(1,25);return o.addAssociation("conditions").addSorting(t.sort("name","ASC",!1)),o}},created(){this.createdComponent()},methods:{createdComponent(){this.loadExclusions()},loadExclusions(){if(r.isEmpty(this.promotion.exclusionIds)){this.excludedPromotions=this.createPromotionCollection();return}let o=this.repositoryFactory.create("promotion"),n=new t(1,25).addFilter(t.equalsAny("id",this.promotion.exclusionIds));o.search(n).then(o=>{this.excludedPromotions=o})},onChangeExclusions(o){this.promotion.exclusionIds=o.map(o=>o.id),this.loadExclusions()},createPromotionCollection(){return new e("/promotion","promotion",Shopware.Context.api,new t(1,25))}}}}}]);