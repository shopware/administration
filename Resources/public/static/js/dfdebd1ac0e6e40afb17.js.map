{"version":3,"sources":["webpack:///./src/module/sw-order/component/sw-order-document-settings-modal/sw-order-document-settings-modal.scss","webpack:///./src/module/sw-order/component/sw-order-document-settings-modal/index.js","webpack:///./src/module/sw-order/component/sw-order-document-settings-modal/sw-order-document-settings-modal.html.twig"],"names":["content","__esModule","default","module","i","locals","exports","add","_Shopware","Shopware","Mixin","isEmpty","Utils","types","template","inject","mixins","getByName","props","order","type","Object","required","currentDocumentType","isLoadingDocument","Boolean","isLoadingPreview","data","showModal","selectedDocumentFile","uploadDocument","documentConfig","custom","documentNumber","documentComment","documentDate","documentNumberPreview","features","uploadFileSizeLimit","fileAcceptTypes","showMediaModal","computed","documentPreconditionsFulfilled","modalTitle","this","_this$currentDocument","_this$currentDocument2","_this$currentDocument3","documentTypeName","translated","name","concat","$tc","mediaRepository","repositoryFactory","create","created","createdComponent","methods","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","reserveDocumentNumber","sent","Date","toISOString","stop","onCreateDocument","_arguments","arguments","_this2","_callee2","additionalAction","_context2","length","undefined","$emit","createNotificationInfo","message","addAdditionalInformationToDocument","callDocumentCreate","referencedDocumentId","isPreview","_this3","_callee3","_yield$_this3$numberR","number","_context3","numberRangeService","reserve","technicalName","salesChannelId","abrupt","onPreview","onConfirm","onCancel","openMediaModal","closeMediaModal","onAddMediaFromLibrary","media","_this4","_callee4","_context4","validateFile","successfulUploadFromUrl","res","_this5","get","targetId","then","response","$refs","fileInput","checkFileSize","checkFileType","documentMediaFileId","id","removeCustomDocument","sourceDocument","onAddDocument"],"mappings":"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","file":"static/js/dfdebd1ac0e6e40afb17.js","sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--15-1!../../../../../node_modules/css-loader/dist/cjs.js??ref--15-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--15-3!./sw-order-document-settings-modal.scss\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"eacf610c\", content, true, {});","import template from './sw-order-document-settings-modal.html.twig';\nimport './sw-order-document-settings-modal.scss';\n\n/**\n * @package checkout\n */\n\nconst { Mixin, Utils } = Shopware;\nconst { isEmpty } = Utils.types;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    inject: ['numberRangeService', 'feature', 'repositoryFactory'],\n\n    mixins: [\n        Mixin.getByName('notification'),\n    ],\n\n    props: {\n        order: {\n            type: Object,\n            required: true,\n        },\n        currentDocumentType: {\n            type: Object,\n            required: true,\n        },\n        isLoadingDocument: {\n            type: Boolean,\n            required: true,\n        },\n        isLoadingPreview: {\n            type: Boolean,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            showModal: false,\n            selectedDocumentFile: null,\n            uploadDocument: false,\n            documentConfig: {\n                custom: {},\n                documentNumber: 0,\n                documentComment: '',\n                documentDate: '',\n            },\n            documentNumberPreview: false,\n            features: {\n                uploadFileSizeLimit: 52428800,\n                fileAcceptTypes: 'application/pdf',\n            },\n            showMediaModal: false,\n        };\n    },\n\n    computed: {\n        documentPreconditionsFulfilled() {\n            // can be overwritten in extending component\n            return true;\n        },\n\n        modalTitle() {\n            if (this.currentDocumentType) {\n                const documentTypeName = this.currentDocumentType?.translated?.name || this.currentDocumentType?.name;\n                return `${this.$tc('sw-order.documentModal.modalTitle')} - ${documentTypeName}`;\n            }\n\n            return this.$tc('sw-order.documentModal.modalTitle');\n        },\n\n        mediaRepository() {\n            return this.repositoryFactory.create('media');\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        async createdComponent() {\n            this.documentConfig.documentNumber = await this.reserveDocumentNumber(true);\n            this.documentNumberPreview = this.documentConfig.documentNumber;\n            this.documentConfig.documentDate = (new Date()).toISOString();\n        },\n\n        async onCreateDocument(additionalAction = false) {\n            this.$emit('loading-document');\n\n            if (this.documentNumberPreview === this.documentConfig.documentNumber) {\n                const documentNumber = await this.reserveDocumentNumber(false);\n\n                if (documentNumber !== this.documentConfig.documentNumber) {\n                    this.createNotificationInfo({\n                        message: this.$tc('sw-order.documentCard.info.DOCUMENT__NUMBER_WAS_CHANGED'),\n                    });\n                }\n\n                this.documentConfig.documentNumber = documentNumber;\n            }\n\n            await this.addAdditionalInformationToDocument();\n            this.callDocumentCreate(additionalAction);\n        },\n\n        callDocumentCreate(additionalAction, referencedDocumentId = null) {\n            this.$emit(\n                'document-create',\n                this.documentConfig,\n                additionalAction,\n                referencedDocumentId,\n                (this.uploadDocument ? this.selectedDocumentFile : null),\n            );\n        },\n\n        async reserveDocumentNumber(isPreview) {\n            const { number } = await this.numberRangeService.reserve(\n                `document_${this.currentDocumentType.technicalName}`,\n                this.order.salesChannelId,\n                isPreview,\n            );\n\n            return number;\n        },\n\n        addAdditionalInformationToDocument() {\n            // override in specific document-settings-modals to add additional data to your document\n        },\n\n        onPreview() {\n            this.$emit('preview-show', this.documentConfig);\n        },\n\n        onConfirm() {\n            this.$emit('page-leave-confirm');\n        },\n\n        onCancel() {\n            this.$emit('page-leave');\n        },\n\n        openMediaModal() {\n            this.showMediaModal = true;\n        },\n\n        closeMediaModal() {\n            this.showMediaModal = false;\n        },\n\n        async onAddMediaFromLibrary(media) {\n            if (isEmpty(media)) {\n                return;\n            }\n\n            this.validateFile(media[0]);\n        },\n\n        successfulUploadFromUrl(res) {\n            this.mediaRepository.get(res.targetId).then(response => {\n                this.validateFile(response);\n            });\n        },\n\n        validateFile(response) {\n            if (this.$refs.fileInput.checkFileSize(response) && this.$refs.fileInput.checkFileType(response)) {\n                this.selectedDocumentFile = response;\n                this.documentConfig.documentMediaFileId = response.id;\n            }\n        },\n\n        removeCustomDocument() {\n            this.documentConfig.documentMediaFileId = null;\n            this.selectedDocumentFile = null;\n            this.sourceDocument = null;\n        },\n\n        onAddDocument(data) {\n            this.selectedDocumentFile = data[0];\n        },\n    },\n};\n","export default \"\\n\\n{% block sw_order_document_settings_modal %}\\n<sw-modal\\n    :title=\\\"modalTitle\\\"\\n    class=\\\"sw-order-document-settings-modal\\\"\\n    @modal-close=\\\"onCancel\\\"\\n>\\n    \\n    {% block sw_order_document_settings_modal_form_first_row %}\\n    <sw-container\\n        columns=\\\"1fr 1fr\\\"\\n        gap=\\\"0px 14px\\\"\\n    >\\n        \\n        {% block sw_order_document_settings_modal_form_document_number %}\\n        <sw-text-field\\n            {% if VUE3 %}\\n            v-model:value=\\\"documentConfig.documentNumber\\\"\\n            {% else %}\\n            v-model=\\\"documentConfig.documentNumber\\\"\\n            {% endif %}\\n            :label=\\\"$tc('sw-order.documentModal.labelDocumentNumber')\\\"\\n        />\\n        {% endblock %}\\n        \\n        {% block sw_order_document_settings_modal_form_document_date %}\\n        <sw-datepicker\\n            {% if VUE3 %}\\n            v-model:value=\\\"documentConfig.documentDate\\\"\\n            {% else %}\\n            v-model=\\\"documentConfig.documentDate\\\"\\n            {% endif %}\\n            date-type=\\\"date\\\"\\n            required\\n            :label=\\\"$tc('sw-order.documentModal.labelDocumentDate')\\\"\\n        />\\n        {% endblock %}\\n    </sw-container>\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_document_settings_modal_form_file_upload %}\\n    \\n    {% block sw_order_document_settings_modal_form_file_upload_toggle %}\\n    <sw-switch-field\\n        {% if VUE3 %}\\n        v-model:value=\\\"uploadDocument\\\"\\n        {% else %}\\n        v-model=\\\"uploadDocument\\\"\\n        {% endif %}\\n        {% if VUE3 %}\\n        name=\\\"sw-field--uploadDocument\\\"\\n        {% endif %}\\n        class=\\\"sw-order-document-settings-modal__file-toggle\\\"\\n        :label=\\\"$tc('sw-order.documentModal.fileInputLabel')\\\"\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_document_settings_modal_form_file_upload_input %}\\n    <sw-upload-listener\\n        v-if=\\\"uploadDocument\\\"\\n        auto-upload\\n        :upload-tag=\\\"order.id\\\"\\n        @media-upload-finish=\\\"successfulUploadFromUrl\\\"\\n    />\\n    <sw-media-upload-v2\\n        v-if=\\\"uploadDocument\\\"\\n        ref=\\\"fileInput\\\"\\n        variant=\\\"small\\\"\\n        class=\\\"sw-order-document-settings-modal__file-input\\\"\\n        use-file-data\\n        :source=\\\"selectedDocumentFile\\\"\\n        :allow-multi-select=\\\"false\\\"\\n        :file-accept=\\\"features.fileAcceptTypes\\\"\\n        :max-file-size=\\\"features.uploadFileSizeLimit\\\"\\n        default-folder=\\\"document\\\"\\n        :upload-tag=\\\"order.id\\\"\\n        @media-upload-add-file=\\\"onAddDocument\\\"\\n        @media-upload-sidebar-open=\\\"openMediaModal\\\"\\n        @media-upload-remove-image=\\\"removeCustomDocument\\\"\\n    />\\n    {% endblock %}\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_document_settings_modal_media_modal %}\\n    <sw-media-modal-v2\\n        v-if=\\\"showMediaModal\\\"\\n        :allow-multi-select=\\\"false\\\"\\n        :file-accept=\\\"features.fileAcceptTypes\\\"\\n        @media-modal-selection-change=\\\"onAddMediaFromLibrary\\\"\\n        @modal-close=\\\"closeMediaModal\\\"\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_document_settings_modal_form_additional_content %}{% endblock %}\\n\\n    \\n    {% block sw_order_document_settings_modal_form_document_comment %}\\n    <sw-textarea-field\\n        {% if VUE3 %}\\n        v-model:value=\\\"documentConfig.documentComment\\\"\\n        {% else %}\\n        v-model=\\\"documentConfig.documentComment\\\"\\n        {% endif %}\\n        {% if VUE3 %}\\n        name=\\\"sw-field--documentConfig-documentComment\\\"\\n        {% endif %}\\n        class=\\\"sw-order-document-settings-modal__comment\\\"\\n        :label=\\\"$tc('sw-order.documentModal.labelDocumentComment')\\\"\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_document_settings_modal_form_document_footer %}\\n    <template #modal-footer>\\n        \\n        {% block sw_order_document_settings_modal_form_document_footer_preview %}\\n        <sw-button\\n            class=\\\"sw-order-document-settings-modal__preview-button\\\"\\n            size=\\\"small\\\"\\n            :disabled=\\\"isLoadingDocument\\\"\\n            :is-loading=\\\"isLoadingPreview\\\"\\n            @click=\\\"onPreview\\\"\\n        >\\n            {{ $tc('sw-order.documentModal.labelPreview') }}\\n        </sw-button>\\n        {% endblock %}\\n\\n        <div>\\n            \\n            {% block sw_order_document_settings_modal_form_document_footer_cancel %}\\n            <sw-button\\n                size=\\\"small\\\"\\n                @click=\\\"onCancel\\\"\\n            >\\n                {{ $tc('sw-order.documentModal.labelCancel') }}\\n            </sw-button>\\n            {% endblock %}\\n\\n            \\n            {% block sw_order_document_settings_modal_form_document_footer_split_button %}\\n            <sw-button-group split-button>\\n                \\n                {% block sw_order_document_settings_modal_form_document_footer_split_button_create %}\\n                <sw-button\\n                    class=\\\"sw-order-document-settings-modal__create\\\"\\n                    variant=\\\"primary\\\"\\n                    size=\\\"small\\\"\\n                    :disabled=\\\"!documentPreconditionsFulfilled || isLoadingPreview\\\"\\n                    :is-loading=\\\"isLoadingDocument\\\"\\n                    @click=\\\"onCreateDocument\\\"\\n                >\\n                    {{ $tc('sw-order.documentModal.labelCreate') }}\\n                </sw-button>\\n                {% endblock %}\\n\\n                \\n                {% block sw_order_document_settings_modal_form_document_footer_split_button_context %}\\n                <sw-context-button\\n                    :disabled=\\\"!documentPreconditionsFulfilled\\\"\\n                >\\n                    \\n                    {% block sw_order_document_settings_modal_form_document_footer_split_button_context_arrow %}\\n                    <template #button>\\n                        <sw-button\\n                            square\\n                            variant=\\\"primary\\\"\\n                            size=\\\"small\\\"\\n                            :disabled=\\\"!documentPreconditionsFulfilled\\\"\\n                        >\\n                            <sw-icon\\n                                name=\\\"regular-chevron-down-xs\\\"\\n                                size=\\\"16\\\"\\n                            />\\n                        </sw-button>\\n                    </template>\\n                    {% endblock %}\\n\\n                    \\n                    {% block sw_order_document_settings_modal_form_document_footer_split_button_context_create_send %}\\n                    <sw-context-menu-item\\n                        class=\\\"sw-order-document-settings-modal__send-button\\\"\\n                        @click=\\\"onCreateDocument('send')\\\"\\n                    >\\n                        {{ $tc('sw-order.documentModal.labelCreateSend') }}\\n                    </sw-context-menu-item>\\n                    {% endblock %}\\n\\n                    \\n                    {% block sw_order_document_settings_modal_form_document_footer_split_button_context_create_download %}\\n                    <sw-context-menu-item\\n                        class=\\\"sw-order-document-settings-modal__download-button\\\"\\n                        @click=\\\"onCreateDocument('download')\\\"\\n                    >\\n                        {{ $tc('sw-order.documentModal.labelCreateDownloadPdf') }}\\n                    </sw-context-menu-item>\\n                    {% endblock %}\\n                </sw-context-button>\\n                {% endblock %}\\n            </sw-button-group>\\n            {% endblock %}\\n        </div>\\n    </template>\\n    {% endblock %}\\n</sw-modal>\\n{% endblock %}\\n\";"],"sourceRoot":""}