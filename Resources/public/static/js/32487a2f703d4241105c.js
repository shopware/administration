(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[82557],{733014:function(){},182557:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return p}}),t(371136);let{Mixin:n,Context:r,Data:{Criteria:s}}=Shopware,{cloneDeep:l}=Shopware.Utils.object,{mapState:a,mapGetters:c}=Shopware.Component.getComponentHelper();var p={template:'\n{% block sw_settings_shipping_price_matrix %}\n<sw-card\n    :title="cardTitle"\n    :is-loading="isLoading"\n    class="sw-settings-shipping-price-matrix"\n    position-identifier="sw-settings-shipping-price-matrix"\n>\n    \n    {% block sw_settings_shipping_price_matrix_topbar_alert %}\n    <sw-alert\n        v-if="priceGroup.isNew"\n        class="sw-settings-shipping-price-matrix__new-matrix-alert"\n        variant="warning"\n        :title="$tc(\'global.default.warning\')"\n        :closable="false"\n    >\n        {{ $tc(\'sw-settings-shipping.priceMatrix.newMatrixAlertMessage\') }}\n    </sw-alert>\n    {% endblock %}\n    \n    {% block sw_settings_shipping_price_matrix_topbar %}\n    <sw-container\n        columns="1fr 160px 35px"\n        gap="0px 24px"\n        class="sw-settings-shipping-price-matrix__top-container"\n    >\n        \n        {% block sw_settings_shipping_price_matrix_topbar_rule_select %}\n        <sw-select-rule-create\n            class="sw-settings-shipping-price-matrix__top-container-rule-select"\n            :rule-id="priceGroup.ruleId"\n            :rule-filter="ruleFilterCriteria"\n            size="small"\n            :disabled="disabled || undefined"\n            :placeholder="mainRulePlaceholder"\n            rule-aware-group-key="shippingMethodPrices"\n            :restricted-rule-ids="usedRules"\n            :restricted-rule-ids-tooltip-label="$tc(\'sw-settings-shipping.priceMatrix.ruleAlreadyUsed\')"\n            @save-rule="onSaveMainRule"\n        />\n        {% endblock %}\n\n        \n        {% block sw_settings_shipping_price_matrix_topbar_new_price %}\n        <sw-button\n            size="x-small"\n            class="sw-settings-shipping-price-matrix__top-container-add-new-rule"\n            :variant="!showDataGrid ? \'\': \'ghost\'"\n            :disabled="!showDataGrid || disabled"\n            @click="onAddNewShippingPrice"\n        >\n            <template v-if="isRuleMatrix">\n                {{ $tc(\'sw-settings-shipping.priceMatrix.addNewRule\') }}\n            </template>\n            <template v-else>\n                {{ $tc(\'sw-settings-shipping.priceMatrix.addNewShippingPrice\') }}\n            </template>\n        </sw-button>\n        {% endblock %}\n\n        \n        {% block sw_settings_shipping_price_matrix_topbar_context_button %}\n        <sw-context-button\n            :disabled="!showDataGrid || disabled"\n            class="sw-settings-shipping-price-matrix__price-group-context"\n        >\n            \n            {% block sw_settings_shipping_price_matrix_topbar_context_button_duplicate %}\n            <sw-context-menu-item\n                v-tooltip="{\n                    showDelay: 300,\n                    showOnDisabledElements: true,\n                    message: $tc(\'sw-settings-shipping.priceMatrix.newMatrixAlreadyExists\'),\n                    disabled: !newPriceMatrixExists\n                }"\n                :disabled="newPriceMatrixExists"\n                class="sw-settings-shipping-price-matrix__action-duplicate"\n                @click="$emit(\'duplicate-price-matrix\', priceGroup)"\n            >\n                {{ $tc(\'sw-settings-shipping.priceMatrix.duplicateMatrixContextLabel\') }}\n            </sw-context-menu-item>\n            {% endblock %}\n            \n            {% block sw_settings_shipping_price_matrix_topbar_context_button_delete %}\n            <sw-context-menu-item\n                class="sw-settings-shipping-price-matrix__action-delete"\n                variant="danger"\n                @click="onDeletePriceMatrix"\n            >\n                {{ $tc(\'sw-settings-shipping.priceMatrix.deleteMatrixContextLabel\') }}\n            </sw-context-menu-item>\n            {% endblock %}\n        </sw-context-button>\n        {% endblock %}\n    </sw-container>\n    {% endblock %}\n\n    \n    {% block sw_settings_shipping_price_matrix_price_grid %}\n    <sw-data-grid\n        v-if="showDataGrid"\n        :data-source="priceGroup.prices"\n        :columns="ruleColumns"\n        :show-selection="false"\n        :show-settings="true"\n        :compact-mode="true"\n    >\n        \n        {% block sw_settings_shipping_price_matrix_price_grid_column_calculcation_rule %}\n        <template\n            #column-calculationRule="{ item, itemIndex, compact }"\n        >\n            <sw-select-rule-create\n                class="sw-settings-shipping-price-matrix__column-calculation-rule-select"\n                size="small"\n                :disabled="disabled"\n                :rule-id="item.calculationRuleId"\n                :rule-filter="shippingRuleFilterCriteria"\n                :placeholder="$tc(\'sw-settings-shipping.priceMatrix.chooseCustomRule\')"\n                rule-aware-group-key="shippingMethodPriceCalculations"\n                :restricted-rule-ids="usedCalculationRules"\n                :restricted-rule-ids-tooltip-label="$tc(\'sw-settings-shipping.priceMatrix.ruleAlreadyUsedInMatrix\')"\n                @save-rule="(ruleId) => onSaveCustomShippingRule(ruleId, item)"\n            >\n                <template #rule-modal="{ showRuleModal, onSaveRule, onCloseRuleModal }">\n                    <sw-price-rule-modal\n                        v-if="showRuleModal"\n                        rule-aware-group-key="shippingMethodPriceCalculations"\n                        @save="onSaveRule"\n                        @modal-close="onCloseRuleModal"\n                    />\n                </template>\n            </sw-select-rule-create>\n        </template>\n        {% endblock %}\n        \n        {% block sw_settings_shipping_price_matrix_price_grid_column_quantity_start %}\n        <template\n            #column-quantityStart="{ item, itemIndex, compact }"\n        >\n            <sw-number-field\n                v-model:value="item.quantityStart"\n                :disabled="disabled"\n                :name="`sw-field--${item.id}-quantity-start`"\n                :number-type="numberFieldType"\n                :size="compact ? \'small\' : \'default\'"\n                :min="priceGroup.prices[itemIndex - 1] ? priceGroup.prices[itemIndex - 1].quantityEnd : 0"\n                :max="item.quantityEnd ? item.quantityEnd : null"\n                :digits="3"\n            />\n        </template>\n        {% endblock %}\n        \n        {% block sw_settings_shipping_price_matrix_price_grid_column_quantity_end %}\n        <template\n            #column-quantityEnd="{ item, itemIndex, compact }"\n        >\n            <sw-number-field\n                v-model:value="item.quantityEnd"\n                :disabled="disabled"\n                :name="`sw-field--${item.id}-quantity-end`"\n                :number-type="numberFieldType"\n                :size="compact ? \'small\' : \'default\'"\n                :placeholder="$tc(\'sw-settings-shipping.priceMatrix.any\')"\n                :validation="item.quantityEnd === null || item.quantityEnd > item.quantityStart"\n                :min="item.quantityStart"\n                :digits="3"\n                @update:value="onQuantityEndChange(item)"\n            />\n        </template>\n        {% endblock %}\n        \n        {% block sw_settings_shipping_price_matrix_price_grid_currencies_list %}\n        <template\n            v-for="currency in currencies"\n            :key="currency.isoCode"\n            #[`column-price-${currency.isoCode}`]="{ item, column, compact }"\n        >\n            <sw-inherit-wrapper\n                class="sw-settings-shipping-price-matrix__price"\n                :value="getPrice(item, currency)"\n                :has-parent="!currency.isSystemDefault"\n                :inherited-value="currency.isSystemDefault ? null : convertDefaultPriceToCurrencyPrice(item, currency)"\n                @update:value="setPrice(item, currency, $event)"\n            >\n                <template #content="props">\n\n                    <sw-inheritance-switch\n                        v-if="!currency.isSystemDefault"\n                        class="sw-settings-shipping-price-matrix__price-inherit-icon"\n                        :is-inherited="props.isInherited"\n                        :disabled="disabled"\n                        @inheritance-restore="props.restoreInheritance"\n                        @inheritance-remove="props.removeInheritance"\n                    />\n\n                    <sw-number-field\n                        v-model:value="props.currentValue.gross"\n                        :name="`sw-field--${item.id}-${currency.id}-gross`"\n                        :size="compact ? \'small\' : \'default\'"\n                        class="sw-settings-shipping-price-matrix__price-input"\n                        :digits="50"\n                        :disabled="props.isInherited || disabled"\n                    />\n                    <sw-number-field\n                        v-model:value="props.currentValue.net"\n                        :name="`sw-field--${item.id}-${currency.id}-net`"\n                        :size="compact ? \'small\' : \'default\'"\n                        class="sw-settings-shipping-price-matrix__price-input"\n                        :digits="50"\n                        :disabled="props.isInherited || disabled"\n                    />\n                </template>\n            </sw-inherit-wrapper>\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_settings_shipping_price_matrix_price_grid_actions %}\n        <template #actions="{ item }">\n            \n            {% block sw_settings_shipping_price_matrix_price_grid_actions_delete %}\n            <sw-context-menu-item\n                :disabled="disableDeleteButton || disabled"\n                variant="danger"\n                @click="onDeleteShippingPrice(item)"\n            >\n                {{ $tc(\'sw-settings-shipping.priceMatrix.contextMenuDeletePrice\') }}\n            </sw-context-menu-item>\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </sw-data-grid>\n    {% endblock %}\n\n    \n    {% block sw_settings_shipping_price_matrix_empty %}\n    <div\n        v-else\n        class="sw-settings-shipping-price-matrix__empty"\n    >\n        \n        {% block sw_settings_shipping_price_matrix_empty_text %}\n        <p class="sw-settings-shipping-price-matrix__empty-text">\n            {{ $tc(\'sw-settings-shipping.priceMatrix.emptyText\') }}\n        </p>\n        {% endblock %}\n        <sw-container\n            columns="1fr 10px 1fr"\n            gap="0px 24px"\n        >\n            \n            {% block sw_settings_shipping_price_matrix_empty_property_store %}\n            <sw-single-select\n                class="sw-settings-shipping-price-matrix__empty--select-property"\n                :options="calculationTypes"\n                :value="priceGroup.calculation"\n                :disabled="disabled"\n                size="small"\n                show-clearable-button\n                :placeholder="$tc(\'sw-settings-shipping.priceMatrix.selectProperty\')"\n                @update:value="onCalculationChange"\n            />\n            {% endblock %}\n\n            <p class="sw-settings-shipping-price-matrix__empty-text-or">\n                {{ $tc(\'sw-settings-shipping.priceMatrix.textOr\') }}\n            </p>\n\n            \n            {% block sw_settings_shipping_price_matrix_empty_rule_select %}\n            <sw-select-rule-create\n                size="small"\n                :disabled="disabled"\n                :placeholder="$tc(\'sw-settings-shipping.priceMatrix.chooseCustomRule\')"\n                rule-aware-group-key="shippingMethodPriceCalculations"\n                :restricted-rule-ids="usedCalculationRules"\n                :restricted-rule-ids-tooltip-label="$tc(\'sw-settings-shipping.priceMatrix.ruleAlreadyUsedInMatrix\')"\n                @save-rule="(ruleId) => { onSaveCustomShippingRule(ruleId) }"\n            >\n                <template #rule-modal="{ showRuleModal, onSaveRule, onCloseRuleModal }">\n                    <sw-price-rule-modal\n                        v-if="showRuleModal"\n                        rule-aware-group-key="shippingMethodPriceCalculations"\n                        @save="onSaveRule"\n                        @modal-close="onCloseRuleModal"\n                    />\n                </template>\n            </sw-select-rule-create>\n            {% endblock %}\n        </sw-container>\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_settings_shipping_price_matrix_delete_modal %}\n    <sw-modal\n        v-if="showDeleteModal"\n        :title="$tc(\'global.default.warning\')"\n        variant="small"\n        @modal-close="onCloseDeleteModal"\n    >\n        \n        {% block sw_settings_shipping_price_matrix_delete_modal_confirm_delete_text %}\n        <p class="sw-settings-shipping-price-matrix__confirm-delete-text">\n            {{ confirmDeleteText }}\n        </p>\n        {% endblock %}\n\n        \n        {% block sw_settings_shipping_price_matrix_delete_modal_footer %}\n        <template #modal-footer>\n            \n            {% block sw_settings_shipping_price_matrix_delete_modal_cancel %}\n            <sw-button\n                size="small"\n                @click="onCloseDeleteModal"\n            >\n                {{ $tc(\'sw-settings-shipping.priceMatrix.buttonCancel\') }}\n            </sw-button>\n            {% endblock %}\n\n            \n            {% block sw_settings_shipping_price_matrix_delete_modal_confirm %}\n            <sw-button\n                variant="danger"\n                size="small"\n                @click="onConfirmDeleteShippingPrice"\n            >\n                {{ $tc(\'sw-settings-shipping.priceMatrix.buttonDelete\') }}\n            </sw-button>\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </sw-modal>\n    {% endblock %}\n</sw-card>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["repositoryFactory","feature"],emits:["duplicate-price-matrix","delete-price-matrix"],mixins:[n.getByName("placeholder"),n.getByName("notification")],props:{priceGroup:{type:Object,required:!0},disabled:{type:Boolean,required:!1,default:!1}},data(){return{calculationTypes:[{label:this.$tc("sw-settings-shipping.priceMatrix.calculationLineItemCount"),value:1},{label:this.$tc("sw-settings-shipping.priceMatrix.calculationPrice"),value:2},{label:this.$tc("sw-settings-shipping.priceMatrix.calculationWeight"),value:3},{label:this.$tc("sw-settings-shipping.priceMatrix.calculationVolume"),value:4}],showDeleteModal:!1,isLoading:!1,ruleColumns:[]}},computed:{...a("swShippingDetail",["shippingMethod","currencies"]),...c("swShippingDetail",["defaultCurrency","usedRules","unrestrictedPriceMatrixExists","newPriceMatrixExists"]),ruleRepository(){return this.repositoryFactory.create("rule")},shippingPriceRepository(){return this.repositoryFactory.create("shipping_method_price")},labelQuantityStart(){return({1:"sw-settings-shipping.priceMatrix.columnQuantityStart",2:"sw-settings-shipping.priceMatrix.columnPriceStart",3:"sw-settings-shipping.priceMatrix.columnWeightStart",4:"sw-settings-shipping.priceMatrix.columnVolumeStart"})[this.priceGroup.calculation]||"sw-settings-shipping.priceMatrix.columnQuantityStart"},labelQuantityEnd(){return({1:"sw-settings-shipping.priceMatrix.columnQuantityEnd",2:"sw-settings-shipping.priceMatrix.columnPriceEnd",3:"sw-settings-shipping.priceMatrix.columnWeightEnd",4:"sw-settings-shipping.priceMatrix.columnVolumeEnd"})[this.priceGroup.calculation]||"sw-settings-shipping.priceMatrix.columnQuantityEnd"},numberFieldType(){return({1:"int",2:"float",3:"float",4:"float"})[this.priceGroup.calculation]||"float"},confirmDeleteText(){let e=this.priceGroup.rule?this.priceGroup.rule.name:"";return this.$tc("sw-settings-shipping.priceMatrix.textDeleteConfirm",Number(!!this.priceGroup.rule),{name:e})},currencyColumns(){return this.currencies.map((e,i)=>{let t=e.translated.name||e.name;return t=`${t} ${this.$tc("sw-settings-shipping.priceMatrix.labelGrossNet")}`,{property:`price-${e.isoCode}`,label:t,visible:0===i,allowResize:!0,primary:!!e.isSystemDefault,rawData:!1,width:"200px"}})},showDataGrid(){return!!this.priceGroup.calculation||this.priceGroup.prices.some(e=>e.calculationRuleId)},disableDeleteButton(){return this.priceGroup.prices.length<=1},ruleFilterCriteria(){let e=new s(1,25);return e.addFilter(s.multi("OR",[s.contains("rule.moduleTypes.types","price"),s.equals("rule.moduleTypes",null)])),e.addAssociation("conditions").addSorting(s.sort("name","ASC",!1)),e},shippingRuleFilterCriteria(){let e=new s(1,25);return e.addFilter(s.multi("OR",[s.contains("rule.moduleTypes.types","shipping"),s.equals("rule.moduleTypes",null)])),e.addAssociation("conditions"),e},isRuleMatrix(){return!this.priceGroup.calculation},usedCalculationRules(){let e=[];return this.isRuleMatrix&&this.priceGroup.prices.forEach(i=>{e.includes(i.calculationRuleId)||e.push(i.calculationRuleId)}),e},mainRulePlaceholder(){return this.priceGroup.isNew?this.$tc("sw-settings-shipping.priceMatrix.chooseOrCreateRule"):this.$tc("sw-settings-shipping.priceMatrix.noRestriction")},cardTitle(){return this.priceGroup.rule||this.priceGroup.isNew?this.priceGroup.rule?this.priceGroup.rule.name:this.$tc("sw-settings-shipping.priceMatrix.titleCard"):this.$tc("sw-settings-shipping.priceMatrix.noRestriction")}},watch:{isRuleMatrix(){this.createdComponent()}},created(){this.createdComponent()},methods:{createdComponent(){this.ruleColumns=[],this.isRuleMatrix?this.ruleColumns.push({property:"calculationRule",label:"sw-settings-shipping.priceMatrix.columnCalculationRule",allowResize:!0,primary:!0,rawData:!0,width:"250px"}):(this.ruleColumns.push({property:"quantityStart",label:this.labelQuantityStart,allowResize:!0,primary:!0,rawData:!0,width:"130px"}),this.ruleColumns.push({property:"quantityEnd",label:this.labelQuantityEnd,allowResize:!0,rawData:!0,primary:!0,width:"130px"})),this.ruleColumns.push(...this.currencyColumns)},onAddNewShippingPrice(){let e=this.priceGroup.prices[this.priceGroup.prices.length-1],i=this.shippingPriceRepository.create(r.api);if(i.shippingMethodId=this.shippingMethod.id,i.ruleId=this.priceGroup.ruleId,i.currencyPrice=l(e.currencyPrice),e._inNewMatrix&&(i._inNewMatrix=!0),this.isRuleMatrix){this.shippingMethod.prices.push(i);return}e.quantityEnd||(e.quantityEnd=e.quantityStart),i.calculation=e.calculation,1===this.priceGroup.calculation?i.quantityStart=e.quantityEnd+1>1?e.quantityEnd+1:2:i.quantityStart=e.quantityEnd,i.quantityEnd=null,this.shippingMethod.prices.push(i)},onSaveMainRule(e){if(!e&&this.unrestrictedPriceMatrixExists&&this.priceGroup.ruleId!==e){this.createNotificationError({message:this.$tc("sw-settings-shipping.priceMatrix.unrestrictedRuleAlreadyExistsMessage")});return}this.ruleRepository.get(e,r.api).then(i=>{this.priceGroup.prices.forEach(t=>{t.ruleId=e,t.rule=i,t._inNewMatrix&&delete t._inNewMatrix})})},onSaveCustomShippingRule(e,i){i||(i=this.priceGroup.prices[0]),this.$nextTick(()=>{this.isLoading=!0}),this.ruleRepository.get(e,r.api).then(t=>{i.calculationRuleId=e,i.calculationRule=t,this.isLoading=!1})},onCalculationChange(e){this.priceGroup.prices.forEach(i=>{i.calculation=Number(e),i.ruleId=this.priceGroup.ruleId})},onDeletePriceMatrix(){this.showDeleteModal=!0},onConfirmDeleteShippingPrice(){this.showDeleteModal=!1,this.$nextTick(()=>{this.$emit("delete-price-matrix",this.priceGroup)})},onCloseDeleteModal(){this.showDeleteModal=!1},onDeleteShippingPrice(e){if(this.priceGroup.prices.length<=1){this.createNotificationInfo({message:this.$tc("sw-settings-shipping.priceMatrix.deletionNotPossibleMessage")});return}let i=this.priceGroup.prices.indexOf(e);void 0===e.quantityEnd||null===e.quantityEnd?this.priceGroup.prices[i-1].quantityEnd=null:this.priceGroup.prices[i+1].quantityStart=e.quantityStart,this.shippingMethod.prices.remove(e.id)},convertDefaultPriceToCurrencyPrice(e,i){e.currencyPrice||this.initCurrencyPrice(e);let t=e.currencyPrice.find(e=>e.currencyId===this.defaultCurrency.id);return this.convertPrice(t,i)},initCurrencyPrice(e){e.currencyPrice=[{currencyId:this.defaultCurrency.id,gross:0,linked:!1,net:0}]},getPrice(e,i){return this.getPriceOfCurrency(e,i)||null},setPrice(e,i,t){if(!t){e.currencyPrice=e.currencyPrice.filter(e=>e.currencyId!==i.id);return}let n={currencyId:i.id,gross:t.gross,linked:!1,net:t.net};e.currencyPrice.push(n)},getPriceOfCurrency(e,i){return e.currencyPrice||this.initCurrencyPrice(e),e.currencyPrice.find(e=>e.currencyId===i.id)},convertPrice(e,i){return{net:e.net*i.factor,gross:e.gross*i.factor,currencyId:i.id,linked:!1}},onQuantityEndChange(e){this.priceGroup.prices.indexOf(e)+1===this.priceGroup.prices.length&&this.onAddNewShippingPrice()}}}},371136:function(e,i,t){var n=t(733014);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),t(745346).Z("7c41bcf0",n,!0,{})}}]);