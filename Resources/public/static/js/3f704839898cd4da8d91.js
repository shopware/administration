(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[42935],{3741:function(){},42935:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}}),n(23039);let{Mixin:s,Context:i}=Shopware,{EntityCollection:a,Criteria:l}=Shopware.Data;var o={template:'\n{% block sw_sales_channel_detail_products %}\n<sw-card\n    v-if="salesChannel && products"\n    position-identifier="sw-sales-channel-detail-products"\n    class="sw-sales-channel-detail-products"\n    :is-loading="isLoading"\n>\n    \n    {% block sw_sales_channel_detail_products_filled_state %}\n    <template\n        v-if="products.length > 0 || searchTerm"\n        #grid\n    >\n        \n        {% block sw_sales_channel_detail_products_card_section %}\n        <sw-container rows="auto 500px">\n            \n            {% block sw_sales_channel_detail_products_card_section_secondary %}\n            <sw-card-section secondary>\n                <sw-container\n                    columns="1fr auto"\n                    gap="0 15px"\n                >\n                    \n                    {% block sw_sales_channel_detail_products_card_section_secondary_input %}\n                    <sw-simple-search-field\n                        v-model:value="searchTerm"\n                        variant="form"\n                        size="small"\n                        @search-term-change="onChangeSearchTerm"\n                    />\n                    {% endblock %}\n\n                    \n                    {% block sw_sales_channel_detail_products_card_section_secondary_button %}\n                    <sw-button\n                        v-tooltip="{\n                            message: $tc(\'sw-privileges.tooltip.warning\'),\n                            disabled: acl.can(\'sales_channel.editor\'),\n                            showOnDisabledElements: true\n                        }"\n                        variant="ghost"\n                        size="small"\n                        :disabled="!acl.can(\'sales_channel.editor\')"\n                        @click="openAddProductsModal"\n                    >\n                        {{ $tc(\'sw-sales-channel.detail.products.buttonAddProducts\', 0) }}\n                    </sw-button>\n                    {% endblock %}\n                </sw-container>\n            </sw-card-section>\n            {% endblock %}\n\n            \n            {% block sw_sales_channel_detail_products_card_section_primary %}\n            <sw-card-section divider="top">\n                \n                {% block sw_sales_channel_detail_products_card_section_primary_filled_state %}\n                <sw-entity-listing\n                    v-if="products.length > 0"\n                    ref="entityListing"\n                    class="sw-sales-channel-detail-products__list"\n                    identifier="sw-sales-channel-detail-products-list"\n                    detail-route="sw.product.detail"\n                    :repository="productRepository"\n                    :items="products"\n                    :data-source="products"\n                    :columns="productColumns"\n                    :plain-appearance="true"\n                    :skeleton-item-amount="limit"\n                    :is-loading="isLoading"\n                    :allow-inline-edit="false"\n                    :allow-view="acl.can(\'sales_channel.viewer\')"\n                    :allow-edit="acl.can(\'product.editor\')"\n                    :allow-delete="acl.can(\'sales_channel.deleter\')"\n                    :is-record-selectable="isProductRemovable"\n                    @selection-change="onProductSelectionChange"\n                >\n                    <template #selection-content="{ item, isSelected, isRecordSelectable, selectItem, itemIdentifierProperty }">\n                        <slot v-bind="{ item, isSelected, isRecordSelectable, selectItem, itemIdentifierProperty }">\n                            <div class="sw-data-grid__cell-content">\n                                \n                                {% block sw_sales_channel_detail_products_listing_select_item_checkbox %}\n                                <sw-checkbox-field\n                                    v-tooltip="{\n                                        message: $tc(\'sw-sales-channel.detail.products.inheritVariantNotRemovableTooltip\'),\n                                        disabled: isRecordSelectable(item),\n                                        showOnDisabledElements: true\n                                    }"\n                                    :disabled="!isRecordSelectable(item)"\n                                    :value="isSelected(item[itemIdentifierProperty])"\n                                    @update:value="selectItem($event, item)"\n                                />\n                                {% endblock %}\n                            </div>\n                        </slot>\n                    </template>\n                    <template #column-name="{ item }">\n                        <slot v-bind="{ item }">\n                            \n                            {% block sw_sales_channel_detail_products_listing_column_name %}\n                            <sw-product-variant-info\n                                :variations="item.variation"\n                            >\n                                <router-link :to="{ name: \'sw.product.detail\', params: { id: item.id } }">\n                                    {{ item.translated.name || item.name }}\n                                </router-link>\n                            </sw-product-variant-info>\n                            {% endblock %}\n                        </slot>\n                    </template>\n\n                    <template #column-active="{ item }">\n                        \n                        {% block sw_sales_channel_detail_products_listing_column_active %}\n                        <sw-icon\n                            small\n                            :name="item.active === false ? \'regular-times-s\' : \'regular-checkmark-xs\'"\n                            :color="item.active === false ? \'#de294c\' : \'#37d046\'"\n                        />\n                        {% endblock %}\n                    </template>\n\n                    <template #pagination>\n                        \n                        {% block sw_sales_channel_detail_products_listing_pagination %}\n                        <sw-pagination\n                            v-bind="{ page, limit, total }"\n                            :total-visible="5"\n                            :auto-hide="false"\n                            @page-change="onChangePage"\n                        />\n                        {% endblock %}\n                    </template>\n\n                    <template #delete-action="{ item }">\n                        \n                        {% block sw_sales_channel_detail_products_listing_delete_action %}\n                        <sw-context-menu-item\n                            variant="warning"\n                            :disabled="!isProductRemovable(item)"\n                            @click="onDeleteProduct(item)"\n                        >\n                            {{ $tc(\'global.default.remove\') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n                    </template>\n\n                    <template #bulk>\n                        \n                        {% block sw_sales_channel_detail_products_listing_bulk %}\n                        <a\n                            class="link link-warning"\n                            role="button"\n                            tabindex="0"\n                            @click="onDeleteProducts"\n                            @keydown.enter="onDeleteProducts"\n                        >\n                            {{ $tc(\'global.default.remove\') }}\n                        </a>\n                        {% endblock %}\n                    </template>\n                </sw-entity-listing>\n                {% endblock %}\n\n                \n                {% block sw_sales_channel_detail_products_card_section_primary_empty_state %}\n                <sw-empty-state\n                    v-else\n                    :show-description="false"\n                    :title="$tc(\'sw-sales-channel.detail.products.titleEmptyStateTable\')"\n                >\n                    <template #icon>\n                        \n                        {% block sw_sales_channel_detail_products_card_section_primary_image %}\n                        <img\n                            :src="assetFilter(\'/administration/static/img/empty-states/products-empty-state.svg\')"\n                            :alt="$tc(\'sw-sales-channel.detail.products.titleEmptyStateTable\')"\n                        >\n                        {% endblock %}\n                    </template>\n                </sw-empty-state>\n                {% endblock %}\n            </sw-card-section>\n            {% endblock %}\n        </sw-container>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_sales_channel_detail_products_empty_state %}\n    <sw-empty-state\n        v-if="products.length <= 0 && !searchTerm && !isLoading"\n        :show-description="false"\n        :absolute="false"\n        :title="$tc(\'sw-sales-channel.detail.products.titleEmptyState\')"\n    >\n        <template #icon>\n            \n            {% block sw_sales_channel_detail_products_empty_state_image %}\n            <img\n                :src="assetFilter(\'/administration/static/img/empty-states/products-empty-state.svg\')"\n                :alt="$tc(\'sw-sales-channel.detail.products.titleEmptyState\')"\n            >\n            {% endblock %}\n        </template>\n\n        <template #actions>\n            \n            {% block sw_sales_channel_detail_products_empty_state_button %}\n            <sw-button\n                v-tooltip="{\n                    message: $tc(\'sw-privileges.tooltip.warning\'),\n                    disabled: acl.can(\'sales_channel.editor\'),\n                    showOnDisabledElements: true\n                }"\n                variant="ghost"\n                :disabled="!acl.can(\'sales_channel.editor\')"\n                @click="openAddProductsModal"\n            >\n                {{ $tc(\'sw-sales-channel.detail.products.buttonAddProducts\', 0) }}\n            </sw-button>\n            {% endblock %}\n        </template>\n    </sw-empty-state>\n    {% endblock %}\n\n    \n    {% block sw_sales_channel_detail_products_assignment_modal %}\n    <sw-sales-channel-products-assignment-modal\n        v-if="showProductsModal"\n        :sales-channel="salesChannel"\n        :is-assign-product-loading="isAssignProductLoading"\n        @modal-close="showProductsModal = false"\n        @products-add="onAddProducts"\n    />\n    {% endblock %}\n</sw-card>\n{% endblock %}\n',inject:["repositoryFactory","feature","acl"],mixins:[s.getByName("notification")],props:{salesChannel:{type:Object,required:!1,default:()=>{}}},data(){return{products:[],productSelection:[],isLoading:!1,searchTerm:null,page:1,limit:25,total:0,showProductsModal:!1,isAssignProductLoading:!1}},computed:{productRepository(){return this.repositoryFactory.create("product")},productVisibilityRepository(){return this.repositoryFactory.create("product_visibility")},productCriteria(){let e=new l(this.page,this.limit);return e.setTotalCountMode(1),e.addAssociation("visibilities.salesChannel"),e.addAssociation("options.group"),e.addFilter(l.equals("product.visibilities.salesChannelId",this.salesChannel.id)),this.searchTerm&&e.setTerm(this.searchTerm),e},productColumns(){return[{property:"name",label:this.$tc("sw-sales-channel.detail.products.columnProductName"),allowResize:!0,primary:!0},{property:"active",label:this.$tc("sw-sales-channel.detail.products.columnActive"),allowResize:!0,align:"center"},{property:"productNumber",label:this.$tc("sw-sales-channel.detail.products.columnProductNumber"),allowResize:!0}]},assetFilter(){return Shopware.Filter.getByName("asset")}},watch:{salesChannel:{deep:!0,immediate:!0,handler(e,t){e&&t?.id!==e.id&&this.getProducts()}}},methods:{getProducts(){if(!this.salesChannel?.id)return Promise.reject();let e={...i.api};return e.inheritance=!0,this.isLoading=!0,this.productRepository.search(this.productCriteria,e).then(e=>{this.products=e,this.total=e.total,this.total>0&&this.products.length<=0&&(this.page=1===this.page?1:this.page-1,this.getProducts())}).catch(()=>{this.products=[]}).finally(()=>{this.isLoading=!1})},onDeleteProduct(e){let t=this.getDeleteId(e);return this.productVisibilityRepository.delete(t,i.api).then(()=>{this.getProducts(),this.$refs.entityListing.resetSelection()}).catch(e=>{if(e?.response?.data?.errors){this.showNotificationError(e.response.data.errors);return}this.createNotificationError({message:e.message})})},onDeleteProducts(){let e=Object.values(this.productSelection).map(e=>this.getDeleteId(e));return this.isLoading=!0,this.productVisibilityRepository.syncDeleted(e,i.api).then(()=>{this.isLoading=!1,this.getProducts(),this.$refs.entityListing.resetSelection()}).catch(e=>{if(this.isLoading=!1,e?.response?.data?.data?.product_visibility?.result){this.showNotificationError(e.response.data.data.product_visibility.result);return}this.createNotificationError({message:e.message})})},getDeleteId(e){return e.visibilities.find(e=>e.salesChannelId===this.salesChannel.id).id},showNotificationError(e){e.forEach(e=>{e.errors?this.showNotificationError(e.errors):this.createNotificationError({message:`${e.code}: ${e.detail}`})})},onChangePage(e){this.page=e.page,this.limit=e.limit,this.products.criteria.sortings.forEach(({field:e,naturalSorting:t,order:n})=>{this.productCriteria.addSorting(l.sort(e,n,t))}),this.getProducts()},onChangeSearchTerm(e){this.searchTerm=e,e&&(this.page=1),this.getProducts()},openAddProductsModal(){this.showProductsModal=!0},onAddProducts(e){if(e.length<=0)return this.showProductsModal=!1,Promise.reject();let t=new a(this.productVisibilityRepository.route,this.productVisibilityRepository.entityName,i.api);return e.forEach(e=>{if(this.products?.has(e.id))return;let n=this.productVisibilityRepository.create(i.api);Object.assign(n,{visibility:30,productId:e.id,salesChannelId:this.salesChannel.id,salesChannel:this.salesChannel}),t.add(n)}),this.isAssignProductLoading=!0,this.saveProductVisibilities(t).then(()=>{this.getProducts()}).catch(e=>{this.createNotificationError({message:e})}).finally(()=>{this.showProductsModal=!1,this.isAssignProductLoading=!1})},saveProductVisibilities(e){return e.length<=0?Promise.resolve():this.productVisibilityRepository.saveAll(e,i.api)},isProductRemovable(e){let t=e.visibilities.find(e=>e.salesChannelId===this.salesChannel.id);return e.parentId!==t?.productId},onProductSelectionChanged(e){this.productSelection=e}}}},23039:function(e,t,n){var s=n(3741);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals),n(45346).Z("2ea3b4eb",s,!0,{})}}]);