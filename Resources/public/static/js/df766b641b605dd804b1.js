(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[323],{"00+i":function(e,n,t){},MSNM:function(e,n,t){var o=t("00+i");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,t("P8hj").default)("eacf610c",o,!0,{})},aXSQ:function(e,n,t){"use strict";t.r(n);var o=t("7yzw"),d=t.n(o),c=t("92Mt"),r=t.n(c),i=(t("MSNM"),Shopware),a=i.Mixin,l=i.Utils.types.isEmpty;n.default={template:'\n\n{% block sw_order_document_settings_modal %}\n<sw-modal\n    :title="modalTitle"\n    class="sw-order-document-settings-modal"\n    @modal-close="onCancel"\n>\n    \n    {% block sw_order_document_settings_modal_form_first_row %}\n    <sw-container\n        columns="1fr 1fr"\n        gap="0px 14px"\n    >\n        \n        {% block sw_order_document_settings_modal_form_document_number %}\n        <sw-text-field\n            v-model="documentConfig.documentNumber"\n            :label="$tc(\'sw-order.documentModal.labelDocumentNumber\')"\n        />\n        {% endblock %}\n        \n        {% block sw_order_document_settings_modal_form_document_date %}\n        <sw-datepicker\n            v-model="documentConfig.documentDate"\n            date-type="date"\n            required\n            :label="$tc(\'sw-order.documentModal.labelDocumentDate\')"\n        />\n        {% endblock %}\n    </sw-container>\n    {% endblock %}\n\n    \n    {% block sw_order_document_settings_modal_form_file_upload %}\n    \n    {% block sw_order_document_settings_modal_form_file_upload_toggle %}\n    <sw-switch-field\n        v-model="uploadDocument"\n        class="sw-order-document-settings-modal__file-toggle"\n        :label="$tc(\'sw-order.documentModal.fileInputLabel\')"\n    />\n    {% endblock %}\n\n    \n    {% block sw_order_document_settings_modal_form_file_upload_input %}\n    <sw-upload-listener\n        v-if="uploadDocument"\n        auto-upload\n        :upload-tag="order.id"\n        @media-upload-finish="successfulUploadFromUrl"\n    />\n    <sw-media-upload-v2\n        v-if="uploadDocument"\n        ref="fileInput"\n        variant="small"\n        class="sw-order-document-settings-modal__file-input"\n        use-file-data\n        :source="selectedDocumentFile"\n        :allow-multi-select="false"\n        :file-accept="features.fileAcceptTypes"\n        :max-file-size="features.uploadFileSizeLimit"\n        default-folder="document"\n        :upload-tag="order.id"\n        @media-upload-add-file="onAddDocument"\n        @media-upload-sidebar-open="openMediaModal"\n        @media-upload-remove-image="removeCustomDocument"\n    />\n    {% endblock %}\n    {% endblock %}\n\n    \n    {% block sw_order_document_settings_modal_media_modal %}\n    <sw-media-modal-v2\n        v-if="showMediaModal"\n        :allow-multi-select="false"\n        :file-accept="features.fileAcceptTypes"\n        @media-modal-selection-change="onAddMediaFromLibrary"\n        @modal-close="closeMediaModal"\n    />\n    {% endblock %}\n\n    \n    {% block sw_order_document_settings_modal_form_additional_content %}{% endblock %}\n\n    \n    {% block sw_order_document_settings_modal_form_document_comment %}\n    <sw-textarea-field\n        v-model="documentConfig.documentComment"\n        class="sw-order-document-settings-modal__comment"\n        :label="$tc(\'sw-order.documentModal.labelDocumentComment\')"\n    />\n    {% endblock %}\n\n    \n    {% block sw_order_document_settings_modal_form_document_footer %}\n    <template #modal-footer>\n        \n        {% block sw_order_document_settings_modal_form_document_footer_preview %}\n        <sw-button\n            class="sw-order-document-settings-modal__preview-button"\n            size="small"\n            :disabled="isLoadingDocument"\n            :is-loading="isLoadingPreview"\n            @click="onPreview"\n        >\n            {{ $tc(\'sw-order.documentModal.labelPreview\') }}\n        </sw-button>\n        {% endblock %}\n\n        <div>\n            \n            {% block sw_order_document_settings_modal_form_document_footer_cancel %}\n            <sw-button\n                size="small"\n                @click="onCancel"\n            >\n                {{ $tc(\'sw-order.documentModal.labelCancel\') }}\n            </sw-button>\n            {% endblock %}\n\n            \n            {% block sw_order_document_settings_modal_form_document_footer_split_button %}\n            <sw-button-group split-button>\n                \n                {% block sw_order_document_settings_modal_form_document_footer_split_button_create %}\n                <sw-button\n                    class="sw-order-document-settings-modal__create"\n                    variant="primary"\n                    size="small"\n                    :disabled="!documentPreconditionsFulfilled || isLoadingPreview"\n                    :is-loading="isLoadingDocument"\n                    @click="onCreateDocument"\n                >\n                    {{ $tc(\'sw-order.documentModal.labelCreate\') }}\n                </sw-button>\n                {% endblock %}\n\n                \n                {% block sw_order_document_settings_modal_form_document_footer_split_button_context %}\n                <sw-context-button\n                    :disabled="!documentPreconditionsFulfilled"\n                >\n                    \n                    {% block sw_order_document_settings_modal_form_document_footer_split_button_context_arrow %}\n                    <template #button>\n                        <sw-button\n                            square\n                            variant="primary"\n                            size="small"\n                            :disabled="!documentPreconditionsFulfilled"\n                        >\n                            <sw-icon\n                                name="regular-chevron-down-xs"\n                                size="16"\n                            />\n                        </sw-button>\n                    </template>\n                    {% endblock %}\n\n                    \n                    {% block sw_order_document_settings_modal_form_document_footer_split_button_context_create_send %}\n                    <sw-context-menu-item\n                        class="sw-order-document-settings-modal__send-button"\n                        @click="onCreateDocument(\'send\')"\n                    >\n                        {{ $tc(\'sw-order.documentModal.labelCreateSend\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_order_document_settings_modal_form_document_footer_split_button_context_create_download %}\n                    <sw-context-menu-item\n                        class="sw-order-document-settings-modal__download-button"\n                        @click="onCreateDocument(\'download\')"\n                    >\n                        {{ $tc(\'sw-order.documentModal.labelCreateDownloadPdf\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n                </sw-context-button>\n                {% endblock %}\n            </sw-button-group>\n            {% endblock %}\n        </div>\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n',inject:["numberRangeService","feature","repositoryFactory"],mixins:[a.getByName("notification")],props:{order:{type:Object,required:!0},currentDocumentType:{type:Object,required:!0},isLoadingDocument:{type:Boolean,required:!0},isLoadingPreview:{type:Boolean,required:!0}},data:function(){return{showModal:!1,selectedDocumentFile:null,uploadDocument:!1,documentConfig:{custom:{},documentNumber:0,documentComment:"",documentDate:""},documentNumberPreview:!1,features:{uploadFileSizeLimit:52428800,fileAcceptTypes:"application/pdf"},showMediaModal:!1}},computed:{documentPreconditionsFulfilled:function(){return!0},modalTitle:function(){if(this.currentDocumentType){var e,n,t,o=(null===(e=this.currentDocumentType)||void 0===e||null===(n=e.translated)||void 0===n?void 0:n.name)||(null===(t=this.currentDocumentType)||void 0===t?void 0:t.name);return"".concat(this.$tc("sw-order.documentModal.modalTitle")," - ").concat(o)}return this.$tc("sw-order.documentModal.modalTitle")},mediaRepository:function(){return this.repositoryFactory.create("media")}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;return d()(r.a.mark((function n(){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.reserveDocumentNumber(!0);case 2:e.documentConfig.documentNumber=n.sent,e.documentNumberPreview=e.documentConfig.documentNumber,e.documentConfig.documentDate=(new Date).toISOString();case 5:case"end":return n.stop()}}),n)})))()},onCreateDocument:function(){var e=arguments,n=this;return d()(r.a.mark((function t(){var o,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.length>0&&void 0!==e[0]&&e[0],n.$emit("loading-document"),n.documentNumberPreview!==n.documentConfig.documentNumber){t.next=8;break}return t.next=5,n.reserveDocumentNumber(!1);case 5:(d=t.sent)!==n.documentConfig.documentNumber&&n.createNotificationInfo({message:n.$tc("sw-order.documentCard.info.DOCUMENT__NUMBER_WAS_CHANGED")}),n.documentConfig.documentNumber=d;case 8:return t.next=10,n.addAdditionalInformationToDocument();case 10:n.callDocumentCreate(o);case 11:case"end":return t.stop()}}),t)})))()},callDocumentCreate:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.$emit("document-create",this.documentConfig,e,n,this.uploadDocument?this.selectedDocumentFile:null)},reserveDocumentNumber:function(e){var n=this;return d()(r.a.mark((function t(){var o,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.numberRangeService.reserve("document_".concat(n.currentDocumentType.technicalName),n.order.salesChannelId,e);case 2:return o=t.sent,d=o.number,t.abrupt("return",d);case 5:case"end":return t.stop()}}),t)})))()},addAdditionalInformationToDocument:function(){},onPreview:function(){this.$emit("preview-show",this.documentConfig)},onConfirm:function(){this.$emit("page-leave-confirm")},onCancel:function(){this.$emit("page-leave")},openMediaModal:function(){this.showMediaModal=!0},closeMediaModal:function(){this.showMediaModal=!1},onAddMediaFromLibrary:function(e){var n=this;return d()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!l(e)){t.next=2;break}return t.abrupt("return");case 2:n.validateFile(e[0]);case 3:case"end":return t.stop()}}),t)})))()},successfulUploadFromUrl:function(e){var n=this;this.mediaRepository.get(e.targetId).then((function(e){n.validateFile(e)}))},validateFile:function(e){this.$refs.fileInput.checkFileSize(e)&&this.$refs.fileInput.checkFileType(e)&&(this.selectedDocumentFile=e,this.documentConfig.documentMediaFileId=e.id)},removeCustomDocument:function(){this.documentConfig.documentMediaFileId=null,this.selectedDocumentFile=null,this.sourceDocument=null},onAddDocument:function(e){this.selectedDocumentFile=e[0]}}}}}]);