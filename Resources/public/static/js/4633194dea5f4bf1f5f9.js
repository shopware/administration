(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[262],{"6hZD":function(e,t,n){"use strict";n.r(t);var i=n("c1oF"),r=n.n(i),s=n("CsSd"),o=n.n(s);n("Ah4A");function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var c=Shopware,d=c.Component,h=c.State,u=d.getComponentHelper(),g=u.mapPropertyErrors,m=u.mapState,f=u.mapGetters,w=Shopware.Utils,v=Shopware.Utils.string,p=v.camelCase,_=v.capitalizeString,b=w.types.isEmpty;t.default={template:'\n{% block sw_flow_trigger %}\n<div\n    class="sw-flow-trigger"\n    :class="swFlowTriggerClasses"\n>\n    \n    {% block sw_flow_trigger_select_field %}\n    <div class="sw-flow-trigger__select-toolbar">\n        <sw-contextual-field\n            v-tooltip="{\n                message: getEventName(eventName),\n                disabled: !eventName || isUnknownTrigger,\n            }"\n            class="sw-flow-trigger__search-field"\n            :required="!isTemplate"\n            :label="$tc(\'sw-flow.detail.trigger.name\')"\n            :disabled="disabled"\n            :error="flowEventNameError"\n        >\n            <template #sw-field-input="{ identification, disabled, error, size, setFocusClass, removeFocusClass }">\n                \n                {% block sw_flow_trigger_select_field_input %}\n                \n                <input\n                    ref="searchInput"\n                    v-model="searchTerm"\n                    type="text"\n                    class="sw-flow-trigger__input-field"\n                    :placeholder="triggerNamePlaceholder"\n                    :disabled="disabled"\n                    @focus="openDropdown({ setFocusClass, removeFocusClass });"\n                >\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_loader %}\n                <sw-loader\n                    v-if="isLoading"\n                    class="sw-flow-trigger__loader"\n                    size="16px"\n                />\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_dropdown_icon %}\n                <sw-icon\n                    class="sw-flow-trigger__dropdown-icon"\n                    name="regular-chevron-down-xs"\n                    size="10px"\n                    @click="openDropdown({ setFocusClass, removeFocusClass });"\n                />\n                {% endblock %}\n            </template>\n        </sw-contextual-field>\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_flow_trigger_select_transition %}\n    <transition name="sw-flow-trigger__fade-down">\n        \n        {% block sw_flow_trigger_event_selection %}\n        <div\n            v-if="isExpanded"\n            class="sw-flow-trigger__event-selection"\n        >\n\n            \n            {% block sw_flow_trigger_container %}\n            <sw-container class="sw-flow-trigger__event-container">\n\n                \n                {% block sw_flow_trigger_select_tree %}\n                <sw-tree\n                    v-if="showTreeView"\n                    ref="flowTriggerTree"\n                    :active-tree-item-id="eventName"\n                    route-params-active-element-id="eventName"\n                    :sortable="false"\n                    :items="eventTree"\n                    :searchable="false"\n                    :disable-context-menu="true"\n                    :on-change-route="changeTrigger"\n                    bind-items-to-folder\n                >\n\n                    \n                    {% block sw_flow_trigger_tree_headline %}\n                    <template #headline>\n                        <span></span>\n                    </template>\n                    {% endblock %}\n\n                    \n                    {% block sw_flow_trigger_tree_search %}\n                    <template #search>\n                        <span></span>\n                    </template>\n                    {% endblock %}\n\n                    <template\n                        #items="{\n                            treeItems,\n                            sortable,\n                            disableContextMenu,\n                            onChangeRoute,\n                            newElementId,\n                            checkItem\n                        }"\n                    >\n                        <sw-tree-item\n                            v-for="item in treeItems"\n                            :key="item.id"\n                            should-focus\n                            :active-focus-id="selectedTreeItem.id"\n                            :sortable="sortable"\n                            :item="item"\n                            :on-change-route="onChangeRoute"\n                            :display-checkbox="false"\n                            @check-item="checkItem"\n                        >\n\n                            \n                            {% block sw_flow_trigger_tree_item_actions %}\n                            <template #actions>\n                                <span></span>\n                            </template>\n                            {% endblock %}\n                        </sw-tree-item>\n                    </template>\n                </sw-tree>\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_search_list %}\n                <ul\n                    v-else-if="searchResult.length > 0 && searchTerm.length > 0"\n                    class="sw-flow-trigger__search-results"\n                >\n                    \n                    {% block sw_flow_trigger_search_list_item %}\n                    \n                    <li\n                        v-for="item in searchResult"\n                        :key="item.id"\n                        class="sw-flow-trigger__search-result"\n                        :class="{ \'is--focus\': isSearchResultInFocus(item)}"\n                        @click="onClickSearchItem(item)"\n                    >\n                        \n                        {% block sw_flow_trigger_search_list_item_icon %}\n                        <div class="sw-flow-trigger__search-result-icon">\n                            <sw-icon\n                                name="regular-circle-xxs"\n                                size="18"\n                            />\n                        </div>\n                        {% endblock %}\n\n                        \n                        {% block sw_flow_trigger_search_list_item_name %}\n                        <span class="sw-flow-trigger__search-result-name">\n                            \n                            {% block sw_flow_trigger_search_list_item_name_highlight %}\n                            <sw-highlight-text\n                                :search-term="searchTerm"\n                                :text="getEventName(item.name)"\n                            />\n                            {% endblock %}\n                        </span>\n                        {% endblock %}\n                    </li>\n                    {% endblock %}\n                </ul>\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_search_empty %}\n                <p\n                    v-else\n                    class="sw-flow-trigger__empty"\n                >\n                    {{ $tc(\'sw-flow.detail.trigger.textNoEvent\') }}\n                </p>\n                {% endblock %}\n\n            </sw-container>\n        {% endblock %}\n        </div>\n        {% endblock %}\n    </transition>\n    {% endblock %}\n\n    \n    {% block sw_flow_event_change_confirm_modal %}\n    <sw-flow-event-change-confirm-modal\n        v-if="showConfirmModal"\n        @modal-confirm="onConfirm"\n        @modal-close="onCloseConfirm"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","businessEventService"],props:{overlay:{type:Boolean,required:!1,default:!0},disabled:{type:Boolean,required:!1,default:!1},eventName:{type:String,required:!0},isUnknownTrigger:{type:Boolean,required:!1,default:!1}},data:function(){return{events:[],isExpanded:!1,isLoading:!1,searchTerm:"",searchResult:[],searchResultFocusItem:{},selectedTreeItem:{},setInputFocusClass:null,removeInputFocusClass:null,showConfirmModal:!1,triggerSelect:{}}},computed:a(a(a({swFlowTriggerClasses:function(){return{overlay:this.overlay}},formatEventName:function(){return this.eventName?this.getEventName(this.eventName):this.eventName},showTreeView:function(){return this.eventTree.length>=0&&(this.searchTerm.length<=0||this.searchTerm===this.formatEventName)},eventTree:function(){return this.getEventTree(this.triggerEvents)},isTemplate:function(){var e;return"template"===(null===(e=this.$route.query)||void 0===e?void 0:e.type)},triggerNamePlaceholder:function(){return this.isUnknownTrigger?this.$tc("sw-flow.detail.trigger.unknownTriggerPlaceholder"):this.$tc("sw-flow.detail.trigger.placeholder")}},m("swFlowState",["flow","triggerEvents"])),f("swFlowState",["isSequenceEmpty"])),g("flow",["eventName"])),watch:{eventName:{immediate:!0,handler:function(e){e&&(this.$route.params.eventName=e,this.searchTerm=this.getEventName(e))}},searchTerm:function(e){var t=this;if(e&&e!==this.formatEventName){var n=e.split(/[\W_]+/gi);this.searchResult=this.triggerEvents.filter((function(e){var i=t.getEventName(e.name).toLowerCase();return n.every((function(e){return i.includes(e.toLowerCase())}))})),this.searchResult.length>0&&(this.searchResultFocusItem=this.searchResult[0])}},selectedTreeItem:function(e){var t=this;null!=e&&e.id&&w.debounce((function(){for(var n=0,i=!1,r=t.findTreeItemVNodeById(e.id).$el;!i;)r.classList.contains("sw-tree__content")?i=!0:(n+=r.offsetTop,r=r.offsetParent);r.scrollTo({top:n-r.clientHeight/2-50,behavior:"smooth"})}),50)()}},created:function(){this.createdComponent()},beforeDestroy:function(){this.beforeDestroyComponent()},methods:{createdComponent:function(){document.addEventListener("click",this.handleClickEvent),document.addEventListener("keydown",this.handleGeneralKeyEvents),this.isLoading=!0,Shopware.State.dispatch("swFlowState/fetchTriggerActions"),h.commit("swFlowState/setTriggerEvent",this.getDataByEvent(this.eventName)),h.dispatch("swFlowState/setRestrictedRules",this.eventName),this.isLoading=!1},beforeDestroyComponent:function(){document.removeEventListener("click",this.handleClickEvent),document.removeEventListener("keydown",this.handleGeneralKeyEvents)},handleClickEvent:function(e){var t=e.target;if(!t.closest(".sw-tree-item .is--no-children.is--disabled"))if(t.closest(".sw-tree-item .is--no-children .sw-tree-item__content")||t.closest(".sw-flow-trigger__search-result"))this.closeDropdown();else if(null===t.closest(".sw-flow-trigger")){if(t.closest("svg"))return;this.closeDropdown(),this.searchTerm!==this.formatEventName&&(this.searchTerm=this.formatEventName)}},handleGeneralKeyEvents:function(e){if("keydown"===e.type&&this.isExpanded)switch(e.key.toLowerCase()){case"tab":case"escape":this.closeDropdown();break;case"arrowdown":case"arrowleft":case"arrowright":case"arrowup":this.handleArrowKeyEvents(e);break;case"enter":if(this.searchTerm.length>0&&this.searchTerm!==this.formatEventName)this.onClickSearchItem(this.searchResultFocusItem),this.closeDropdown();else{var t;if((null===(t=this.selectedTreeItem)||void 0===t?void 0:t.childCount)>0)return;this.changeTrigger(this.selectedTreeItem),this.closeDropdown()}}},handleArrowKeyEvents:function(e){var t=e.key.toLowerCase();if(this.searchTerm.length>0&&this.searchTerm!==this.formatEventName)switch(t){case"arrowdown":e.preventDefault(),this.changeSearchSelection("next");break;case"arrowup":e.preventDefault(),this.changeSearchSelection("previous")}else{var n=this.findTreeItemVNodeById();switch(t){case"arrowdown":var i;if(null!=n&&null!==(i=n.item)&&void 0!==i&&i.id){if(n.opened){var r=this.getFirstChildById(n.item.id);r&&(this.selectedTreeItem=r);break}var s=this.getSibling(!0,n.item);if(s){this.selectedTreeItem=s;break}if(s=this.getClosestSiblingAncestor(n.item.parentId)){this.selectedTreeItem=s;break}}break;case"arrowup":var o;if(null!=n&&null!==(o=n.item)&&void 0!==o&&o.id){var l,a=this.findTreeItemVNodeById(n.item.parentId);if((null==a||null===(l=a.item)||void 0===l?void 0:l.children[0].id)===n.item.id){var c=a.item;c&&(this.selectedTreeItem=c);break}var d=this.getSibling(!1,n.item);d&&(this.selectedTreeItem=this.getClosestSiblingDescendant(d))}break;case"arrowright":this.toggleSelectedTreeItem(!0);break;case"arrowleft":if(!this.toggleSelectedTreeItem(!1)){var h=n.item.parentId,u=this.findTreeItemVNodeById(h);u&&(this.selectedTreeItem=u.item)}}}},getClosestSiblingAncestor:function(e){var t,n=this.findTreeItemVNodeById(e),i=this.getSibling(!0,n.item);return i||(null!=n&&null!==(t=n.item)&&void 0!==t&&t.parentId?this.getClosestSiblingAncestor(n.item.parentId):null)},getClosestSiblingDescendant:function(e){var t=this.findTreeItemVNodeById(e.id);if(t.opened&&t.item.childCount>0){var n=t.item.children.length-1,i=t.item.children[n];return 0===i.childCount?i:this.getClosestSiblingDescendant(i)}return e},getFirstChildById:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$refs.flowTriggerTree.treeItems,n=t.find((function(t){return t.id===e}));if(n)return n.children[0];for(var i=0;i<t.length;i+=1){var r=this.getFirstChildById(e,t[i].children);if(r)return r}return null},getSibling:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.$refs.flowTriggerTree.treeItems;if(!t)return null;var i=null,r=n.indexOf(t);if(i=r<0?null:e?n[r+1]:n[r-1])return i;for(var s=0;s<n.length;s+=1){var o=this.getSibling(e,t,n[s].children);if(o)return o}return null},changeSearchSelection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"next",t="previous"===e?-1:1,n=this.searchResult.indexOf(this.searchResultFocusItem),i=this.searchResult[n+t];void 0!==i&&(this.searchResultFocusItem=i)},toggleSelectedTreeItem:function(e){var t=this.findTreeItemVNodeById();return!(null==t||!t.openTreeItem||t.opened===e)&&(t.openTreeItem(),!0)},findTreeItemVNodeById:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedTreeItem.id,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$refs.flowTriggerTree.$children,i=!1;if(Array.isArray(n)?i=n.find((function(e){var n;return!(null==e||null===(n=e.item)||void 0===n||!n.id)&&e.item.id===t})):null!=n&&null!==(e=n.item)&&void 0!==e&&e.id&&(i=n.item.id===t),i)return i;for(var r=!1,s=0;s<n.length&&!(r=this.findTreeItemVNodeById(t,n[s].$children));s+=1);return r},openDropdown:function(e){var t=this,n=e.setFocusClass,i=e.removeFocusClass;this.setInputFocusClass=n,this.removeInputFocusClass=i,this.setInputFocusClass(),this.isExpanded=!0,this.isLoading||this.$nextTick((function(){if(t.searchTerm===t.formatEventName){var e=t.eventTree.find((function(e){return e.id===t.eventName}));t.selectedTreeItem=e||t.$refs.flowTriggerTree.treeItems[0]}}))},closeDropdown:function(){this.removeInputFocusClass&&this.removeInputFocusClass(),this.isExpanded=!1},changeTrigger:function(e){if(!(null!=e&&e.disabled||(null==e?void 0:e.childCount)>0))if(this.isSequenceEmpty){var t=e.data.id;h.commit("swFlowState/setTriggerEvent",this.getDataByEvent(t)),h.dispatch("swFlowState/setRestrictedRules",t),this.$emit("option-select",t)}else this.showConfirmModal=this.flow.eventName!==e.id,this.triggerSelect=this.getDataByEvent(e.id)},onConfirm:function(){h.commit("swFlowState/setTriggerEvent",this.triggerSelect),h.dispatch("swFlowState/setRestrictedRules",this.triggerSelect.name),this.$emit("option-select",this.triggerSelect.name)},onCloseConfirm:function(){this.showConfirmModal=!1,this.triggerSelect={}},getBusinessEvents:function(){var e=this;return this.isLoading=!0,this.businessEventService.getBusinessEvents().then((function(t){e.events=t,h.commit("swFlowState/setTriggerEvent",e.getDataByEvent(e.eventName)),h.dispatch("swFlowState/setRestrictedRules",e.eventName)})).finally((function(){e.isLoading=!1}))},getLastEventName:function(e){var t=e.parentId,n=void 0===t?null:t,i=e.id,s=n?i.split(".").reverse():[i],o=r()(s,1)[0];return this.getEventNameTranslated(o)},getDataByEvent:function(e){return this.triggerEvents.find((function(t){return t.name===e}))},hasOnlyStopFlow:function(e){return 0===(this.triggerEvents.find((function(t){return t.name===e})).aware||[]).length},getEventTree:function(e){var t=this,n={};e.forEach((function(e){var t=e.name.split(".");if(0!==t.length){!function e(t,n,i){var r=n[t],s=n[t+1];i[r]=i[r]||{id:r,parentId:null,children:{}},s&&(i[r].children[s]=i[r].children[s]||{id:"".concat(i[r].id,".").concat(s),parentId:i[r].id,children:{}},e(t+1,n,i[r].children))}(0,t,n)}}));return function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return n.forEach((function(n){var r=n.children?Object.values(n.children):[];i.push({id:n.id,name:t.getLastEventName(n),childCount:r.length,parentId:n.parentId,disabled:b(n.children)&&t.hasOnlyStopFlow(n.id),disabledToolTipText:b(n.children)&&t.hasOnlyStopFlow(n.id)?t.$tc("sw-flow.detail.trigger.textHint"):null}),r.length>0&&(i=e(r,i))})),i}(Object.values(n))},getBreadcrumb:function(e){return e?e.split(".").map((function(e){return _(e)})).join(" / ").replace(/_|-/g," "):""},onClickSearchItem:function(e){this.searchTerm=this.formatEventName,this.searchResult=[],this.isSequenceEmpty?(this.$emit("option-select",e.name),h.commit("swFlowState/setTriggerEvent",e),h.dispatch("swFlowState/setRestrictedRules",e.name)):(this.showConfirmModal=!0,this.triggerSelect=e)},getEventName:function(e){var t=this;return this.isUnknownTrigger?"":e?e.split(".").map((function(e){return t.getEventNameTranslated(e)})).join(" / "):e},isSearchResultInFocus:function(e){return e.name===this.searchResultFocusItem.name},getEventNameTranslated:function(e){var t=this,n=p(e),i=["sw-flow-app.triggers-app.".concat(n),"sw-flow-custom-event.event-tree.".concat(n),"sw-flow.triggers.".concat(n)].find((function(e){return t.$te(e)}));return i?this.$tc(i):e.replace(/_|-/g," ")}}}},Ah4A:function(e,t,n){var i=n("POix");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,n("P8hj").default)("a75d698a",i,!0,{})},POix:function(e,t,n){}}]);