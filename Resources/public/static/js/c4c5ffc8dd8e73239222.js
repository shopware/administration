(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[16],{Dnla:function(e,n,s){var t=s("dULW");t.__esModule&&(t=t.default),"string"==typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);(0,s("ydqr").default)("fb5eae26",t,!0,{})},HpF6:function(e,n,s){"use strict";n.a=Object.freeze({ACCOUNT_TYPE_PRIVATE:"private",ACCOUNT_TYPE_BUSINESS:"business"})},dULW:function(e,n,s){},fT1k:function(e,n,s){"use strict";s.r(n);var t=s("HZZ/"),r=s.n(t),o=s("hJxD"),i=s.n(o),a=(s("Dnla"),s("HpF6")),c=Shopware.Mixin;n.default={template:'\n{% block sw_order_new_customer_modal %}\n<sw-modal\n    :title="$tc(\'sw-order.createBase.detailsHeader.buttonAddNewCustomer\')"\n    @modal-close="onClose"\n>\n    \n    {% block sw_order_new_customer_modal_tabs %}\n    <sw-tabs\n        class="sw-order-new-customer-modal"\n        position-identifier="sw-order-new-customer-modal"\n        default-item="details"\n    >\n        <template #default="{ active }">\n            \n            {% block sw_order_new_customer_modal_tabs_details %}\n            <sw-tabs-item\n                name="details"\n                :active-tab="active"\n            >\n                {{ $tc(\'sw-order.newCustomerModal.labelDetails\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_tabs_billing %}\n            <sw-tabs-item\n                name="billingAddress"\n                :active-tab="active"\n            >\n                {{ $tc(\'sw-order.createBase.detailsBody.labelBillingAddress\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_tabs_shipping %}\n            <sw-tabs-item\n                name="shippingAddress"\n                :active-tab="active"\n            >\n                {{ $tc(\'sw-order.createBase.detailsBody.labelShippingAddress\') }}\n            </sw-tabs-item>\n            {% endblock %}\n        </template>\n\n        <template #content="{ active }">\n            \n            {% block sw_order_new_customer_modal_content_details %}\n            <div v-if="active ===\'details\'">\n                \n                {% block sw_order_new_customer_modal_content_details_guest %}\n                <sw-field\n                    v-model="customer.guest"\n                    no-margin-top\n                    type="switch"\n                    :label="$tc(\'sw-order.newCustomerModal.labelGuest\')"\n                />\n                {% endblock %}\n                \n                {% block sw_order_new_customer_modal_content_details_form %}\n                <sw-customer-base-form\n                    :is-loading="isLoading"\n                    :customer="customer"\n                    @sales-channel-change="onChangeSalesChannel"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_content_shipping %}\n            <div v-if="active === \'shippingAddress\'">\n                \n                {% block sw_order_new_customer_modal_content_shipping_same_billing %}\n                <sw-field\n                    v-model="isSameBilling"\n                    no-margin-top\n                    type="switch"\n                    :label="$tc(\'sw-customer.addressForm.labelSameBillingAddress\')"\n                />\n                {% endblock %}\n\n                \n                {% block sw_order_new_customer_modal_content_shipping_form %}\n                <sw-customer-address-form\n                    :customer="customer"\n                    :disabled="isSameBilling"\n                    :address="shippingAddress"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n\n            \n            {% block sw_order_new_customer_modal_content_billing %}\n            <div v-if="active ===\'billingAddress\'">\n                \n                {% block sw_order_new_customer_modal_content_billing_form %}\n                <sw-customer-address-form\n                    :customer="customer"\n                    :address="billingAddress"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </template>\n    </sw-tabs>\n    {% endblock %}\n\n    \n    {% block sw_order_new_customer_modal_actions %}\n    <template #modal-footer>\n        \n        {% block sw_order_new_customer_modal_action_close %}\n        <sw-button\n            size="small"\n            @click="onClose"\n        >\n            {{ $tc(\'global.default.cancel\') }}\n        </sw-button>\n        {% endblock %}\n\n        \n        {% block sw_order_new_customer_modal_actions_apply %}\n        <sw-button\n            size="small"\n            variant="primary"\n            :is-loading="isLoading"\n            @click="onSave"\n        >\n            {{ $tc(\'global.default.save\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n',inject:["repositoryFactory","numberRangeService","systemConfigApiService","customerValidationService"],mixins:[c.getByName("notification")],data:function(){return{customer:null,salesChannels:null,isLoading:!1,customerNumberPreview:""}},computed:{customerRepository:function(){return this.repositoryFactory.create("customer")},addressRepository:function(){return this.repositoryFactory.create("customer_address")},shippingAddress:function(){return this.isSameBilling?this.billingAddress:null!==this.customer?this.customer.addresses.get(this.customer.defaultShippingAddressId):null},billingAddress:function(){return null!==this.customer?this.customer.addresses.get(this.customer.defaultBillingAddressId):null},isSameBilling:{get:function(){return null===this.customer||this.customer.defaultBillingAddressId===this.customer.defaultShippingAddressId},set:function(e){var n=this;if(!0===e)return this.customer.defaultShippingAddressId=this.customer.defaultBillingAddressId,void(this.customer.isNew()&&(this.customer.addresses=this.customer.addresses.filter((function(e){return e.id===n.customer.defaultBillingAddressId}))));var s=this.addressRepository.create();this.customer.addresses.add(s),this.customer.defaultShippingAddressId=s.id}},validCompanyField:function(){var e;return this.customer.accountType!==a.a.ACCOUNT_TYPE_BUSINESS||(null===(e=this.customer.company)||void 0===e?void 0:e.trim().length)}},watch:{"customer.salesChannelId":function(e){var n=this;this.systemConfigApiService.getValues("core.systemWideLoginRegistration").then((function(s){s["core.systemWideLoginRegistration.isCustomerBoundToSalesChannel"]&&(n.customer.boundSalesChannelId=e)}))},"customer.accountType":function(e){e!==a.a.ACCOUNT_TYPE_BUSINESS&&Shopware.State.dispatch("error/removeApiError",{expression:"customer_address.".concat(this.billingAddress.id,".company")})}},created:function(){this.createdComponent()},methods:{createdComponent:function(){this.customer=this.customerRepository.create();var e=this.addressRepository.create();this.customer.addresses.add(e),this.customer.defaultShippingAddressId=e.id,this.customer.defaultBillingAddressId=e.id,this.customer.accountType=a.a.ACCOUNT_TYPE_PRIVATE,this.customer.vatIds=[]},onSave:function(){var e=this;return r()(i.a.mark((function n(){var s,t,r;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=!1,n.next=3,e.validateEmail();case 3:if((t=n.sent)&&t.isValid||(s=!0),e.validCompanyField||(e.createErrorMessageForCompanyField(),s=!0),e.customer.accountType===a.a.ACCOUNT_TYPE_PRIVATE&&(e.customer.vatIds=[]),!s){n.next=11;break}return e.createNotificationError({message:e.$tc("sw-customer.detail.messageSaveError")}),e.isLoading=!1,n.abrupt("return",!1);case 11:return r=Promise.resolve(),e.customerNumberPreview===e.customer.customerNumber&&(r=e.numberRangeService.reserve("customer",e.customer.salesChannelId).then((function(n){e.customerNumberPreview=n.number,e.customer.customerNumber=n.number}))),n.abrupt("return",r.then((function(){return e.saveCustomer()})));case 14:case"end":return n.stop()}}),n)})))()},saveCustomer:function(){var e=this;return this.customerRepository.save(this.customer).then((function(){e.$emit("on-select-existing-customer",e.customer.id),e.isLoading=!1,e.onClose()})).catch((function(){e.createNotificationError({message:e.$tc("sw-customer.detail.messageSaveError")}),e.isLoading=!1}))},onChangeSalesChannel:function(e){var n=this;this.customer.salesChannelId=e,this.numberRangeService.reserve("customer",e,!0).then((function(e){n.customerNumberPreview=e.number,n.customer.customerNumber=e.number}))},onClose:function(){this.$emit("close")},createErrorMessageForCompanyField:function(){Shopware.State.dispatch("error/addApiError",{expression:"customer_address.".concat(this.billingAddress.id,".company"),error:new Shopware.Classes.ShopwareError({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})})},validateEmail:function(){var e=this,n=this.customer,s=n.id,t=n.email,r=n.boundSalesChannelId;return t?this.customerValidationService.checkCustomerEmail({id:s,email:t,boundSalesChannelId:r}).then((function(e){return e})).catch((function(n){var s,t;n&&Shopware.State.dispatch("error/addApiError",{expression:"customer.".concat(e.customer.id,".email"),error:null==n||null===(s=n.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.errors[0]})})):Promise.resolve({isValid:!0})}}}}}]);