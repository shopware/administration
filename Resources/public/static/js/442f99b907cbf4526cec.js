(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[387],{L9xK:function(n,e,t){"use strict";t.r(e);var i=t("J58c"),o=t.n(i);t("q20n");function s(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function c(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?s(Object(t),!0).forEach((function(e){o()(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var r=Shopware.Data.Criteria;e.default={template:'\n{% block sw_promotion_v2_settings_discount_type %}\n<div class="sw-promotion-v2-settings-discount-type">\n    <sw-container\n        columns="1fr 1fr"\n        gap="20px"\n    >\n\n        \n        {% block sw_promotion_v2_settings_discount_type_type %}\n        <sw-select-field\n            v-model="discount.type"\n            class="sw-promotion-v2-settings-discount-type__field-select-discount-type"\n            :label="$tc(\'sw-promotion-v2.detail.discounts.settings.discountType.labelDiscountType\')"\n            :disabled="!acl.can(\'promotion.editor\')"\n        >\n\n            \n            {% block sw_promotion_v2_settings_discount_type_type_options %}\n            <option\n                v-for="selection in getDiscountTypeSelection()"\n                :key="selection.value"\n                :disabled="selection.disabled"\n                :value="selection.value"\n            >\n                {{ selection.display }}\n            </option>\n            {% endblock %}\n\n        </sw-select-field>\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_settings_discount_type_price %}\n        <sw-number-field\n            v-model="discount.value"\n            class="sw-promotion-v2-settings-discount-type__field-price"\n            :id-suffix="discount.id"\n            :min="0"\n            :max="discount.type === \'percentage\' ? 100 : null"\n            :label="labelValue"\n            :disabled="discount.type === \'free\' || !acl.can(\'promotion.editor\')"\n        >\n\n            \n            {% block sw_promotion_v2_settings_discount_type_price_suffix %}\n            <template #suffix>\n                <span v-if="isPercentageType">%</span>\n                <span v-else>{{ currencySymbol }}</span>\n            </template>\n            {% endblock %}\n\n        </sw-number-field>\n        {% endblock %}\n\n    </sw-container>\n\n    <sw-container\n        columns="1fr 1fr"\n        gap="20px"\n    >\n\n        \n        {% block sw_promotion_v2_settings_discount_type_apply_discount_to %}\n        <sw-select-field\n            v-model="discount.applierKey"\n            class="sw-promotion-v2-settings-discount-type__field-apply-discount-to"\n            :label="$tc(\'sw-promotion-v2.detail.discounts.settings.discountType.labelApplyDiscountTo\')"\n            :disabled="discount.type === \'free\' || !acl.can(\'promotion.editor\')"\n        >\n\n            \n            {% block sw_promotion_v2_settings_discount_type_apply_discount_to_options %}\n            <option\n                v-for="selection in getApplyDiscountToSelection()"\n                :key="selection.value"\n                :disabled="selection.disabled"\n                :value="selection.value"\n            >\n                {{ selection.display }}\n            </option>\n            {% endblock %}\n\n        </sw-select-field>\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_settings_discount_type_max_discount_value %}\n        <sw-number-field\n            v-model="discount.maxValue"\n            class="sw-promotion-v2-settings-discount-type__field-max-discount"\n            :id-suffix="discount.id"\n            :label="$tc(\'sw-promotion-v2.detail.discounts.settings.discountType.labelMaxDiscountValue\')"\n            :disabled="discount.type !== \'percentage\' || !acl.can(\'promotion.editor\')"\n            allow-empty\n            @change="onMaxValueChanged"\n        >\n\n            \n            {% block sw_promotion_v2_settings_discount_type_max_discount_value_suffix %}\n            <template #suffix>\n                <span>{{ currencySymbol }}</span>\n            </template>\n            {% endblock %}\n\n        </sw-number-field>\n        {% endblock %}\n\n    </sw-container>\n\n    \n    {% block sw_promotion_v2_settings_discount_type_advanced_prices_link %}\n    \n    <a\n        v-if="showAdvancedPricesLink"\n        class="sw-promotion-v2-settings-discount-type__advanced-prices"\n        @click="onClickAdvancedPrices"\n    >\n        {{ $tc(\'sw-promotion-v2.detail.discounts.pricesModal.linkAdvancedPrices\') }}\n        <sw-icon\n            name="regular-long-arrow-right"\n            small\n        />\n    </a>\n    {% endblock %}\n\n    \n    {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal %}\n    <sw-modal\n        v-if="displayAdvancedPricesModal"\n        :title="$tc(\'sw-promotion-v2.detail.discounts.pricesModal.advancedPricesHeader\')"\n        class="sw-promotion-v2-settings-discounts-type__advanced-prices-modal"\n        @modal-close="onCloseAdvancedPricesModal"\n    >\n\n        \n        {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal_grid %}\n        <sw-one-to-many-grid\n            :collection="discount.promotionDiscountPrices"\n            :local-mode="true"\n            :columns="currencyPriceColumns"\n            :show-selection="false"\n            :show-actions="!acl.can(\'promotion.editor\')"\n        >\n\n            \n            {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal_grid_column_name %}\n            <template #column-currency.translated.name="{ item }">\n                <p class="sw-promotion-v2-settings-discounts-type__advances-prices-column-name">\n                    {{ item.currency.translated.name }}\n                </p>\n            </template>\n            {% endblock %}\n\n            \n            {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal_grid_column_price %}\n            <template #column-price="{ item }">\n                <sw-number-field\n                    v-model="item.price"\n                    class="sw-promotion-v2-settings-discounts-type__advanced-prices-column-price"\n                    type="text"\n                    size="small"\n                    :disabled="!acl.can(\'promotion.editor\')"\n                >\n\n                    \n                    {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal_grid_column_price_suffix %}\n                    <template #suffix>\n                        {{ item.currency.symbol }}\n                    </template>\n                    {% endblock %}\n\n                </sw-number-field>\n            </template>\n            {% endblock %}\n\n        </sw-one-to-many-grid>\n        {% endblock %}\n\n        \n        {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal_footer %}\n        <template #modal-footer>\n\n            \n            {% block sw_promotion_v2_settings_discount_type_advanced_prices_modal_footer_button_close %}\n            <sw-button\n                variant="primary"\n                size="small"\n                @click="onCloseAdvancedPricesModal"\n            >\n                {{ $tc(\'sw-promotion-v2.detail.discounts.pricesModal.closeModal\') }}\n            </sw-button>\n            {% endblock %}\n\n        </template>\n        {% endblock %}\n\n    </sw-modal>\n    {% endblock %}\n\n</div>\n{% endblock %}\n',inject:["acl","repositoryFactory"],props:{discount:{type:Object,required:!0},discountScope:{type:String,required:!0,validator:function(n){return["basic","buy-x-get-y","shipping-discount"].includes(n)}},preselectedDiscountType:{type:String,required:!1,validator:function(n){return["fixed","fixed_unit","percentage","free"].includes(n)},default:function(){return"fixed"}},preselectedApplyDiscountTo:{type:String,required:!1,validator:function(n){return["ALL","SELECT"].includes(n)},default:function(){return"ALL"}}},data:function(){return{displayAdvancedPricesModal:!1,currencies:[],defaultCurrency:null,currencySymbol:null}},computed:{isPercentageType:function(){return["percentage","free"].includes(this.discount.type)},labelValue:function(){return this.$tc("sw-promotion-v2.detail.discounts.settings.discountType.labelValue",!this.isPercentageType)},showAdvancedPricesLink:function(){return["absolute","fixed","fixed_unit"].includes(this.discount.type)},currencyPriceColumns:function(){return[{property:"currency.translated.name",label:this.$tc("sw-promotion-v2.detail.discounts.pricesModal.labelCurrency")},{property:"price",dataIndex:"price",label:this.$tc("sw-promotion-v2.detail.discounts.pricesModal.labelPrice")}]},currencyRepository:function(){return this.repositoryFactory.create("currency")},advancedPricesRepo:function(){return this.repositoryFactory.create("promotion_discount_prices")},currencyCriteria:function(){return new r(1,25).addSorting(r.sort("name","ASC"))},showMaxValueAdvancedPrices:function(){return"percentage"===this.discount.type&&null!==this.discount.maxValue}},watch:{"discount.type":function(n,e){if("percentage"===e&&(this.discount.maxValue=null),"free"===n)return this.discount.applierKey="SELECT",void(this.discount.value=100);"absolute"===n?(this.discount.applierKey="SELECT",this.discount.usageKey="ALL"):"percentage"===n&&(this.discount.value=Math.min(this.discount.value,100))}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var n=this;if(this.currencyRepository.search(this.currencyCriteria).then((function(e){n.currencies=e,n.defaultCurrency=n.currencies.find((function(n){return n.isSystemDefault})),n.currencySymbol=n.defaultCurrency.symbol})),this.discount.isNew){var e={type:this.discount.type||this.preselectedDiscountType,applierKey:this.discount.applierKey||this.preselectedApplyDiscountTo};"basic"===this.discountScope?e=c(c({},e),{},{scope:"cart"}):"buy-x-get-y"===this.discountScope?e=c(c({},e),{},{scope:"set"}):"shipping-discount"===this.discountScope&&(e=c(c({},e),{},{scope:"delivery"})),Object.assign(this.discount,e)}},getDiscountTypeSelection:function(){var n="sw-promotion-v2.detail.discounts.settings.discountType.discountTypeSelection";return[{value:"percentage",display:this.$tc("".concat(n,".displayPercentage"))},{value:"delivery"===this.discount.scope?"absolute":"fixed",display:this.$tc("".concat(n,".displayFixedDiscount"))},{value:"fixed_unit",display:this.$tc("".concat(n,".displayFixedPrice"))},{value:"free",display:this.$tc("".concat(n,".displayFree"))}]},getApplyDiscountToSelection:function(){var n="sw-promotion-v2.detail.discounts.settings.discountType.applyDiscountTo";return[{value:"ALL",display:this.$tc("".concat(n,".displayTotalPrice"))},{value:"SELECT",display:this.$tc("".concat(n,".displayProductPrice"))}]},onClickAdvancedPrices:function(){var n=this;this.currencies.forEach((function(e){n.setCurrencyForDiscountPrices(e)||(n.showMaxValueAdvancedPrices?n.prepareAdvancedPrices(e,n.discount.maxValue):n.prepareAdvancedPrices(e,n.discount.value))})),this.displayAdvancedPricesModal=!0},clearAdvancedPrices:function(){var n=this;this.discount.promotionDiscountPrices.getIds().forEach((function(e){n.discount.promotionDiscountPrices.remove(e)}))},setCurrencyForDiscountPrices:function(n){var e=n.id;return this.discount.promotionDiscountPrices.some((function(t){return t.currencyId===e&&(t.currency=n,!0)}))},prepareAdvancedPrices:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Math.max(e*n.factor,0),i=this.advancedPricesRepo.create();Object.assign(i,{discountId:this.discount.id,price:t,currencyId:n.id,currency:n}),this.discount.promotionDiscountPrices.add(i)},onMaxValueChanged:function(n){null!==n&&0!==n||(0===n&&(this.discount.maxValue=null),this.clearAdvancedPrices())},onCloseAdvancedPricesModal:function(){var n=this;if("percentage"===this.discount.type&&null===this.discount.maxValue)return this.clearAdvancedPrices(),void(this.displayAdvancedPricesModal=!1);this.discount.promotionDiscountPrices.forEach((function(e){"percentage"===n.discount.type&&(e.price=e.price>100?n.getMaxValue(n.discount.type):e.price),e.price<=0&&(e.price=0),e.price=Math.max(e.price,0)})),this.displayAdvancedPricesModal=!1}}}},fRR6:function(n,e,t){},q20n:function(n,e,t){var i=t("fRR6");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);(0,t("ydqr").default)("ade8432a",i,!0,{})}}]);