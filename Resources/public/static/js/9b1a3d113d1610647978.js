(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[640],{imoI:function(e,t,n){"use strict";n.r(t);var l={namespaced:!0,state:function(){return{salesChannelCollection:null,seoUrlCollection:null,originalSeoUrls:[],defaultSeoUrl:null,currentSeoUrl:null}},mutations:{setSeoUrlCollection:function(e,t){e.seoUrlCollection=t},setOriginalSeoUrls:function(e,t){e.originalSeoUrls=t},setCurrentSeoUrl:function(e,t){e.currentSeoUrl=t},setDefaultSeoUrl:function(e,t){e.defaultSeoUrl=t},setSalesChannelCollection:function(e,t){e.salesChannelCollection=t}},getters:{isLoading:function(e){return e.loading},getNewOrModifiedUrls:function(e){return function(){var t=[];return e.seoUrlCollection.forEach((function(n){if(null!==n.seoPathInfo){var l=e.originalSeoUrls.find((function(e){return e.id===n.id}));l&&l.seoPathInfo===n.seoPathInfo||(l||n.seoPathInfo)&&t.push(n)}})),t}}}},o=Shopware.Data.Criteria,r=Shopware.Data.EntityCollection;t.default={template:'\n{% block sw_seo_url %}\n<div class="sw-seo-url">\n    <sw-card\n        class="sw-seo-url__card"\n        position-identifier="sw-seo-url"\n        :title="$tc(\'sw-seo-url.titleCard\')"\n        :is-loading="isLoading"\n    >\n        \n        {% block sw_seo_url_card %}\n        <template v-if="showEmptySeoUrlError">\n            {{ $tc(\'sw-seo-url.textEmptySeoUrls\') }}\n        </template>\n\n        <template v-else>\n            \n            {% block sw_seo_url_card_seo_path %}\n            <sw-inherit-wrapper\n                v-model="currentSeoUrl.seoPathInfo"\n                :has-parent="currentSalesChannelId !== null && !isHeadlessSalesChannel && hasDefaultTemplate"\n                :inherited-value="(currentSeoUrl.salesChannelId !== null && !isHeadlessSalesChannel) ? defaultSeoUrl.seoPathInfo : null"\n            >\n\n                <template #content="props">\n                    \n                    {% block sw_seo_url_card_seo_path_edit %}\n                    <sw-text-field\n                        :map-inheritance="props"\n                        :value="props.currentValue"\n                        :disabled="props.isInherited || isHeadlessSalesChannel || !allowInput"\n                        :disable-inheritance-toggle="isHeadlessSalesChannel"\n                        :label="$tc(\'sw-seo-url.labelSeoPathInfo\')"\n                        :help-text="seoUrlHelptext"\n                        @input="props.updateCurrentValue"\n                    />\n                    {% endblock %}\n                </template>\n\n            </sw-inherit-wrapper>\n            {% endblock %}\n        </template>\n\n        \n        {% block sw_seo_url_card_toolbar %}\n        <template\n            v-if="!showEmptySeoUrlError"\n            #toolbar\n        >\n            <sw-sales-channel-switch\n                ref="salesChannelSwitch"\n                :disabled="disabled"\n                :label="$tc(\'sw-seo-url.labelSalesChannelSelect\')"\n                @change-sales-channel-id="onSalesChannelChanged"\n            />\n        </template>\n        {% endblock %}\n\n        <div\n            v-if="hasAdditionalSeoSlot"\n            class="sw-seo-url__card-seo-additional"\n        >\n            <slot\n                name="seo-additional"\n                v-bind="{currentSalesChannelId}"\n            >\n                \n                {% block sw_seo_url_additional %}{% endblock %}\n            </slot>\n        </div>\n\n        {% endblock %}\n    </sw-card>\n</div>\n{% endblock %}\n',inject:["repositoryFactory"],mixins:[],props:{salesChannelId:{type:String,required:!1,default:null},urls:{type:Array,required:!1,default:function(){return[]}},isLoading:{type:Boolean,required:!1,default:!1},hasDefaultTemplate:{type:Boolean,required:!1,default:!0},disabled:{type:Boolean,required:!1,default:!1},resultLimit:{type:Number,required:!1,default:25}},data:function(){return{currentSalesChannelId:this.salesChannelId,showEmptySeoUrlError:!1}},computed:{seoUrlCollection:function(){return Shopware.State.get("swSeoUrl").seoUrlCollection},currentSeoUrl:function(){return Shopware.State.get("swSeoUrl")?Shopware.State.get("swSeoUrl").currentSeoUrl:{}},defaultSeoUrl:function(){return Shopware.State.get("swSeoUrl").defaultSeoUrl},seoUrlRepository:function(){return this.repositoryFactory.create("seo_url")},salesChannelRepository:function(){return this.repositoryFactory.create("sales_channel")},isHeadlessSalesChannel:function(){var e=this;if(!Shopware.State.get("swSeoUrl"))return!0;if(null===Shopware.State.get("swSeoUrl").salesChannelCollection)return!0;var t=Shopware.State.get("swSeoUrl").salesChannelCollection.find((function(t){return t.id===e.currentSalesChannelId}));return null!==this.currentSalesChannelId&&"f183ee5650cf4bdb8a774337575067a6"===(null==t?void 0:t.typeId)},seoUrlHelptext:function(){return this.isHeadlessSalesChannel?this.$tc("sw-seo-url.textSeoUrlsDisallowedForHeadless"):null},hasAdditionalSeoSlot:function(){return this.$scopedSlots.hasOwnProperty("seo-additional")},allowInput:function(){return this.hasDefaultTemplate||null!==this.currentSalesChannelId}},watch:{urls:function(){this.initSeoUrlCollection(),this.refreshCurrentSeoUrl()}},beforeCreate:function(){Shopware.State.list().includes("swSeoUrl")||Shopware.State.registerModule("swSeoUrl",l)},created:function(){this.$root.$on("seo-url-save-finish",this.clearDefaultSeoUrls),this.createdComponent()},beforeDestroy:function(){this.$root.$off("seo-url-save-finish",this.clearDefaultSeoUrls),Shopware.State.unregisterModule("swSeoUrl")},methods:{createdComponent:function(){this.initSalesChannelCollection(),this.initSeoUrlCollection(),this.showEmptySeoUrlError||this.refreshCurrentSeoUrl()},initSalesChannelCollection:function(){var e=new o(1,this.resultLimit);e.addAssociation("type"),this.salesChannelRepository.search(e).then((function(e){Shopware.State.commit("swSeoUrl/setSalesChannelCollection",e)}))},initSeoUrlCollection:function(){var e=this;this.showEmptySeoUrlError=!1;var t=new r(this.seoUrlRepository.route,this.seoUrlRepository.schema.entity,Shopware.Context.api,new o(1,this.resultLimit)),n=this.urls.find((function(e){return null===e.salesChannelId}));void 0===n&&(this.hasDefaultTemplate||this.urls.length<=0)&&(this.showEmptySeoUrlError=!0);var l=this.seoUrlRepository.create();Object.assign(l,n),t.add(l),Shopware.State.commit("swSeoUrl/setDefaultSeoUrl",l),this.urls.forEach((function(n){var l=e.seoUrlRepository.create();Object.assign(l,n),t.add(l)})),Shopware.State.get("swSeoUrl").defaultSeoUrl||(this.showEmptySeoUrlError=!0),Shopware.State.commit("swSeoUrl/setSeoUrlCollection",t),Shopware.State.commit("swSeoUrl/setOriginalSeoUrls",this.urls),this.clearDefaultSeoUrls()},clearDefaultSeoUrls:function(){var e=this;this.seoUrlCollection.forEach((function(t){t.id!==e.defaultSeoUrl.id&&t.seoPathInfo===e.defaultSeoUrl.seoPathInfo&&(t.seoPathInfo=null)}))},refreshCurrentSeoUrl:function(){var e=this,t=Shopware.Context.api.languageId,n=this.seoUrlCollection.find((function(n){return n.languageId===t&&n.salesChannelId===e.currentSalesChannelId}));if(!n){var l,o,r,s,a,i,u=this.seoUrlRepository.create(),h=this.seoUrlCollection.find((function(e){return e.pathInfo&&e.routeName&&e.foreignKey}))||{};return u.foreignKey=null!==(l=null===(o=this.defaultSeoUrl)||void 0===o?void 0:o.foreignKey)&&void 0!==l?l:h.foreignKey,u.isCanonical=!0,u.languageId=t,u.salesChannelId=this.currentSalesChannelId,u.routeName=null!==(r=null===(s=this.defaultSeoUrl)||void 0===s?void 0:s.routeName)&&void 0!==r?r:h.routeName,u.pathInfo=null!==(a=null===(i=this.defaultSeoUrl)||void 0===i?void 0:i.pathInfo)&&void 0!==a?a:h.pathInfo,u.isModified=!0,this.seoUrlCollection.add(u),void Shopware.State.commit("swSeoUrl/setCurrentSeoUrl",u)}Shopware.State.commit("swSeoUrl/setCurrentSeoUrl",n)},onSalesChannelChanged:function(e){this.currentSalesChannelId=e,this.$emit("on-change-sales-channel",e),this.refreshCurrentSeoUrl()}}}}}]);