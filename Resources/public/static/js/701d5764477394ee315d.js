(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[21872],{62354:function(){},21872:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return m}}),l(87788);let{Mixin:a}=Shopware,{Criteria:n}=Shopware.Data,{mapPropertyErrors:o}=Shopware.Component.getComponentHelper(),i=Shopware.Utils;var m={template:'\n{% block sw_flow_create_mail_template_modal %}\n<sw-modal\n    class="sw-flow-create-mail-template-modal"\n    :title="$tc(\'sw-flow.modals.mail.titleNewEmailTemplate\')"\n    :closable="false"\n    @modal-close="onClose"\n>\n    \n    {% block sw_flow_create_mail_template_modal_content %}\n    \n    {% block sw_flow_create_mail_template_modal_type_selection %}\n    <sw-entity-single-select\n        v-model:value="mailTemplate.mailTemplateTypeId"\n        name="sw-field--mailTemplate-mailTemplateTypeId"\n        class="sw-flow-create-mail-template-modal__type"\n        entity="mail_template_type"\n        required\n        :label="$tc(\'sw-flow.modals.mail.labelMailType\')"\n        :placeholder="$tc(\'sw-flow.modals.mail.placeholderMailType\')"\n        :error="mailTemplateMailTemplateTypeIdError"\n        @update:value="onChangeType"\n    />\n    {% endblock %}\n\n    \n    {% block sw_flow_create_mail_template_modal_info %}\n    <sw-container\n        columns="1fr 1fr"\n        gap="30px"\n    >\n        \n        {% block sw_flow_create_mail_template_modal_subject %}\n        <sw-text-field\n            v-model:value="mailTemplate.subject"\n            name="sw-field--mailTemplate-subject"\n            class="sw-flow-create-mail-template-modal__subject"\n            required\n            :label="$tc(\'sw-flow.modals.mail.labelSubject\')"\n            :placeholder="$tc(\'sw-flow.modals.mail.placeholderSubject\')"\n            :error="mailTemplateSubjectError"\n        />\n        {% endblock %}\n\n        \n        {% block sw_flow_create_mail_template_modal_sender_name %}\n        <sw-text-field\n            v-model:value="mailTemplate.senderName"\n            name="sw-field--mailTemplate-senderName"\n            class="sw-flow-create-mail-template-modal__sender-name"\n            :label="$tc(\'sw-flow.modals.mail.labelSenderName\')"\n            :placeholder="$tc(\'sw-flow.modals.mail.placeholderSenderName\')"\n        />\n        {% endblock %}\n    </sw-container>\n    {% endblock %}\n\n    \n    {% block sw_flow_create_mail_template_modal_description %}\n    <sw-textarea-field\n        v-model:value="mailTemplate.description"\n        name="sw-field--mailTemplate-description"\n        class="sw-flow-create-mail-template-modal__description"\n        :label="$tc(\'sw-flow.modals.mail.labelDescription\')"\n        :placeholder="$tc(\'sw-flow.modals.mail.placeholderDescription\')"\n    />\n    {% endblock %}\n\n    \n    {% block sw_flow_create_mail_template_modal_plain_content %}\n    <sw-code-editor\n        ref="plainEditor"\n        :key="`${mailTemplate.mailTemplateTypeId}plain`"\n        v-model:value="mailTemplate.contentPlain"\n        class="sw-flow-create-mail-template-modal__content-plain"\n        name="content_plain"\n        completion-mode="entity"\n        :label="$tc(\'sw-flow.modals.mail.labelContentPlain\')"\n        :placeholder="placeholder(mailTemplate, \'contentPlain\', $tc(\'sw-flow.modals.mail.placeholderPlain\'))"\n        :completer-function="outerCompleterFunction"\n        :editor-config="editorConfig"\n        :error="mailTemplateContentPlainError"\n        required\n    />\n    {% endblock %}\n\n    \n    {% block sw_flow_create_mail_template_modal_html_content %}\n    <sw-code-editor\n        ref="htmlEditor"\n        :key="`${mailTemplate.mailTemplateTypeId}html`"\n        v-model:value="mailTemplate.contentHtml"\n        class="sw-flow-create-mail-template-modal__content-html"\n        name="content_html"\n        completion-mode="entity"\n        :label="$tc(\'sw-flow.modals.mail.labelContentHtml\')"\n        :placeholder="placeholder(mailTemplate, \'contentPlain\', $tc(\'sw-flow.modals.mail.placeholderHtml\'))"\n        :completer-function="outerCompleterFunction"\n        :editor-config="editorConfig"\n        :error="mailTemplateContentHtmlError"\n        required\n    />\n    {% endblock %}\n    {% endblock %}\n\n    \n    {% block sw_flow_create_mail_template_modal_footer %}\n    <template #modal-footer>\n        \n        {% block sw_flow_create_mail_template_modal_footer_cancel_button %}\n        <sw-button\n            class="sw-flow-create-mail-template-modal__cancel-button"\n            size="small"\n            @click="onClose"\n        >\n            {{ $tc(\'global.default.cancel\') }}\n        </sw-button>\n        {% endblock %}\n\n        \n        {% block sw_flow_create_mail_template_modal_footer_save_button %}\n        <sw-button\n            class="sw-flow-create-mail-template-modal__save-button"\n            variant="primary"\n            size="small"\n            :is-loading="isLoading"\n            @click="onAddMailTemplate"\n        >\n            {{ $tc(\'sw-flow.modals.mail.buttonAddMailTemplate\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n',inject:["mailService","entityMappingService","repositoryFactory"],mixins:[a.getByName("placeholder"),a.getByName("notification")],data(){return{mailTemplate:{},mailTemplateType:{},editorConfig:{enableBasicAutocompletion:!0},isLoading:!1}},computed:{mailTemplateRepository(){return this.repositoryFactory.create("mail_template")},mailTemplateTypeRepository(){return this.repositoryFactory.create("mail_template_type")},mailTemplateCriteria(){let e=new n(1,25);return e.addAssociation("mailTemplateType"),e},outerCompleterFunction(){var e,t;return e=this.entityMappingService,t=this.mailTemplateType,function(l){let a=[];return Object.keys(e.getEntityMapping(l,t.availableEntities)).forEach(e=>{a.push({value:e})}),a}},...o("mailTemplate",["contentHtml","contentPlain","mailTemplateTypeId","subject"])},created(){this.createdComponent()},methods:{createdComponent(){Shopware.State.getters["context/isSystemDefaultLanguage"]||Shopware.State.commit("context/resetLanguageToDefault"),this.mailTemplate=this.mailTemplateRepository.create(Shopware.Context.api,i.createId())},onClose(){this.$emit("modal-close")},onAddMailTemplate(){let e=this.mailTemplate.subject||this.placeholder(this.mailTemplate,"subject");return this.isSaveSuccessful=!1,this.isLoading=!0,this.mailTemplateRepository.save(this.mailTemplate).then(()=>{this.getMailTemplate()}).catch(t=>{let l="";if(this.isLoading=!1,t.response.data.errors.length>0){let e=t.response.data.errors[0].detail;l=`<br/> ${this.$tc("sw-mail-template.detail.textErrorMessage")}: "${e}"`}this.createNotificationError({message:this.$tc("sw-mail-template.detail.messageSaveError",0,{subject:e})+l})})},getMailTemplateType(){return this.mailTemplate?.mailTemplateTypeId?this.mailTemplateTypeRepository.get(this.mailTemplate.mailTemplateTypeId).then(e=>{this.mailTemplateType=e,this.$refs.htmlEditor.defineAutocompletion(this.outerCompleterFunction),this.$refs.plainEditor.defineAutocompletion(this.outerCompleterFunction)}):Promise.resolve()},async onChangeType(e){if(e)try{await this.getMailTemplateType()}catch(t){let e="";if(t.response.data.errors.length>0){let l=t.response.data.errors[0].detail;e=`<br/> ${this.$tc("sw-mail-template.detail.textErrorMessage")}: "${l}"`}this.createNotificationError({message:e})}},getMailTemplate(){return this.mailTemplateRepository.get(this.mailTemplate.id,Shopware.Context.api,this.mailTemplateCriteria).then(e=>{this.$emit("process-finish",e)}).catch(()=>{this.$emit("process-finish",null)}).finally(()=>{this.isLoading=!1,this.onClose()})}}}},87788:function(e,t,l){var a=l(62354);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),l(45346).Z("37b3ce26",a,!0,{})}}]);