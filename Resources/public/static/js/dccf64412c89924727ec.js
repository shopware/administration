(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[331],{DOjU:function(e,o,t){"use strict";t.r(o);var n=t("CsSd"),r=t.n(n);t("m/t6");function i(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?i(Object(t),!0).forEach((function(o){r()(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var a=Shopware.Component,d=Shopware.Data.ChangesetGenerator,c=a.getComponentHelper().mapState;o.default={template:'\n{% block sw_order_promotion_field %}\n<div class="sw-order-promotion-field">\n\n    \n    {% block sw_order_promotion_field_codes %}\n    <sw-order-promotion-tag-field\n        {% if VUE3 %}\n        v-model:value="promotionCodeTags"\n        {% else %}\n        v-model="promotionCodeTags"\n        {% endif %}\n        :disabled="!hasLineItem || isLoading || !acl.can(\'order_line_item.editor\')"\n        :currency="currency"\n        :label="$tc(\'sw-order.detailsTab.promotionsField.labelPromotions\')"\n        :placeholder="$tc(\'sw-order.detailsTab.promotionsField.placeholderPromotions\')"\n        :error="promotionError"\n        @on-remove-code="onRemoveExistingCode"\n    />\n    {% endblock %}\n\n    \n    {% block sw_order_promotion_field_switch %}\n    <sw-switch-field\n        {% if VUE3 %}\n        v-model:value="disabledAutoPromotions"\n        {% else %}\n        v-model="disabledAutoPromotions"\n        {% endif %}\n        :disabled="isLoading || !acl.can(\'order_line_item.editor\')"\n        :label="$tc(\'sw-order.detailsTab.promotionsField.labelToggleAutomaticPromotions\')"\n    />\n    {% endblock %}\n\n</div>\n{% endblock %}\n',inject:["repositoryFactory","orderService","acl"],mixins:["notification"],props:{isLoading:{type:Boolean,required:!1,default:!1}},data:function(){return{promotionError:null,disabledAutoPromotions:!1}},computed:s(s({},c("swOrderDetail",["order","versionContext"])),{},{orderLineItemRepository:function(){return this.repositoryFactory.create("order_line_item")},hasLineItem:function(){return this.order.lineItems.filter((function(e){return e.hasOwnProperty("id")})).length>0},currency:function(){return this.order.currency},manualPromotions:function(){return this.order.lineItems.filter((function(e){return"promotion"===e.type&&null!==e.referencedId}))},automaticPromotions:function(){return this.order.lineItems.filter((function(e){return"promotion"===e.type&&null===e.referencedId}))},promotionCodeTags:{get:function(){return this.manualPromotions.map((function(e){return e.payload}))},set:function(e){var o=this.manualPromotions;if(this.promotionError=null,!(e.length<o.length)){var t=o.length,n=e[t];e.length>o.length&&this.onSubmitCode(n.code),t>0&&n.isInvalid&&(this.promotionError={detail:this.$tc("sw-order.createBase.textInvalidPromotionCode")})}}},hasAutomaticPromotions:function(){return this.automaticPromotions.length>0},changesetGenerator:function(){return new d},hasOrderUnsavedChanges:function(){return null!==this.changesetGenerator.generate(this.order).changes}}),watch:{disabledAutoPromotions:function(e,o){o!==this.hasAutomaticPromotions&&this.toggleAutomaticPromotions(e)},automaticPromotions:function(){this.disabledAutoPromotions=!this.hasAutomaticPromotions}},created:function(){this.createdComponent()},methods:{createdComponent:function(){this.disabledAutoPromotions=!this.hasAutomaticPromotions},deleteAutomaticPromotions:function(){var e=this;if(0===this.automaticPromotions.length)return Promise.resolve();var o=[];return this.automaticPromotions.forEach((function(t){o.push(e.orderLineItemRepository.delete(t.id,e.versionContext))})),Promise.all(o).then((function(){e.automaticPromotions.forEach((function(o){e.createNotificationSuccess({message:e.$tc("sw-order.detailBase.textPromotionRemoved",0,{promotion:o.label})})}))})).catch((function(o){e.$emit("loading-change",!1),e.$emit("error",o)}))},toggleAutomaticPromotions:function(e){var o=this;if(this.$emit("loading-change",!0),this.hasOrderUnsavedChanges)return this.$emit("loading-change",!1),this.handleUnsavedOrderChangesResponse(),void this.$nextTick((function(){o.disabledAutoPromotions=!e}));this.deleteAutomaticPromotions().then((function(){return o.orderService.toggleAutomaticPromotions(o.order.id,o.order.versionId,e)})).then((function(e){o.handlePromotionResponse(e),o.$emit("reload-entity-data")})).catch((function(e){o.$emit("loading-change",!1),o.$emit("error",e)}))},onSubmitCode:function(e){var o=this;if(this.$emit("loading-change",!0),this.hasOrderUnsavedChanges)return this.$emit("loading-change",!1),void this.handleUnsavedOrderChangesResponse();this.orderService.addPromotionToOrder(this.order.id,this.order.versionId,e).then((function(e){o.handlePromotionResponse(e),o.$emit("reload-entity-data")})).catch((function(e){o.$emit("loading-change",!1),o.$emit("error",e)}))},handlePromotionResponse:function(e){var o=this;Object.values(e.data.errors).forEach((function(e){switch(e.level){case 0:o.createNotificationSuccess({message:e.message});break;case 10:o.createNotificationWarning({message:e.message});break;default:o.createNotificationError({message:e.message})}}))},handleUnsavedOrderChangesResponse:function(){this.createNotificationWarning({message:this.$tc("sw-order.detailBase.textUnsavedChanges",0)})},onRemoveExistingCode:function(e){var o=this;if(this.$emit("loading-change",!0),this.hasOrderUnsavedChanges)return this.$emit("loading-change",!1),void this.handleUnsavedOrderChangesResponse();var t=this.order.lineItems.find((function(o){return"promotion"===o.type&&o.payload.code===e.code}));this.orderLineItemRepository.delete(t.id,this.versionContext).then((function(){o.$emit("reload-entity-data")})).catch((function(e){o.$emit("loading-change",!1),o.$emit("error",e)}))},getLineItemByPromotionCode:function(e){return this.order.lineItems.find((function(o){return"promotion"===o.type&&o.payload.code===e}))}}}},hjWP:function(e,o,t){},"m/t6":function(e,o,t){var n=t("hjWP");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t("P8hj").default)("8e361e16",n,!0,{})}}]);