(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[82163],{873283:function(){},282163:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var n=s(558343);s(716417);let{Component:i,Mixin:a,Utils:o}=Shopware,{mapPropertyErrors:c}=i.getComponentHelper(),{ShopwareError:l}=Shopware.Classes,{debounce:r}=Shopware.Utils,{cloneDeep:d,getObjectDiff:g}=Shopware.Utils.object,{warn:p}=Shopware.Utils.debug,{Criteria:m}=Shopware.Data;var h={template:'\n{% block sw_cms_detail %}\n<sw-page\n    class="sw-cms-detail"\n    :show-search-bar="false"\n    :show-smart-bar="false"\n>\n    \n    {% block sw_cms_detail_content %}\n    <template #content>\n        <div class="sw-cms-detail__content">\n            \n            {% block sw_cms_detail_toolbar %}\n            <sw-cms-toolbar>\n                \n                {% block sw_cms_detail_toolbar_language_switch %}\n                <template #language-switch>\n                    <sw-language-switch\n                        :disabled="isLoading || page.locked || undefined"\n                        :allow-edit="acl.can(\'cms.editor\')"\n                        :save-changes-function="saveOnLanguageChange"\n                        :abort-change-function="abortOnLanguageChange"\n                        @on-change="onChangeLanguage"\n                    />\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_toolbar_title %}\n                <template #title>\n                    <div class="sw-cms-detail__page-info">\n                        \n                        {% block sw_cms_detail_toolbar_back_button %}\n                        <a\n                            class="sw-cms-detail__back-btn"\n                            role="link"\n                            tabindex="0"\n                            :aria-label="$tc(\'global.default.back\')"\n                            @click="onClickBack"\n                            @keyup.enter="onClickBack"\n                        >\n                            <sw-icon name="regular-times" />\n                        </a>\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_toolbar_page_name %}\n                        <h2 class="sw-cms-detail__page-name">\n                            {{ placeholder(page, \'name\') }}\n                        </h2>\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_toolbar_page_type %}\n                        <div\n                            v-if="page.type"\n                            class="sw-cms-detail__page-type"\n                        >\n                            {{ $tc(pageType?.title ?? \'\') }}\n                        </div>\n                        {% endblock %}\n\n                        <div\n                            v-if="isDefaultLayout"\n                            class="sw-cms-detail__page-defaults"\n                        >\n                            {{ $tc(\'sw-cms.detail.label.defaultLayout\') }}\n                        </div>\n                    </div>\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_toolbar_device_actions %}\n                <template #tools>\n                    <div\n                        v-if="pageHasSections"\n                        class="sw-cms-detail__device-actions"\n                    >\n                        \n                        {% block sw_cms_detail_toolbar_device_actions_mobile %}\n                        <sw-icon\n                            name="regular-mobile"\n                            :class="{ \'is--active\': currentDeviceView === \'mobile\' }"\n                            @click="onDeviceViewChange(\'mobile\')"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_toolbar_device_actions_tablet_landscape %}\n                        <sw-icon\n                            name="regular-tablet"\n                            :class="{ \'is--active\': currentDeviceView === \'tablet-landscape\' }"\n                            @click="onDeviceViewChange(\'tablet-landscape\')"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_toolbar_device_actions_desktop %}\n                        <sw-icon\n                            name="regular-desktop"\n                            :class="{ \'is--active\': currentDeviceView === \'desktop\' }"\n                            @click="onDeviceViewChange(\'desktop\')"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_toolbar_device_actions_form %}\n                        <sw-icon\n                            name="regular-bars-square"\n                            :class="{ \'is--active\': currentDeviceView === \'form\', \'is--disabled\': !acl.can(\'cms.editor\') }"\n                            @click="onDeviceViewChange(\'form\')"\n                        />\n                        {% endblock %}\n                    </div>\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_toolbar_actions %}\n                <template #actions>\n                    <div class="sw-cms-detail__actions">\n\n                        \n                        {% block sw_cms_detail_toolbar_actions_save %}\n                        <sw-button-process\n                            v-tooltip.bottom="tooltipSave"\n                            class="sw-cms-detail__save-action"\n                            :is-loading="isLoading"\n                            :process-success="isSaveSuccessful"\n                            :disabled="isLoading || page.locked || !acl.can(\'cms.editor\') || undefined"\n                            variant="primary"\n                            @update:process-success="saveFinish"\n                            @click="onSave"\n                        >\n                            {{ $tc(\'sw-cms.detail.label.buttonSave\') }}\n                        </sw-button-process>\n                        {% endblock %}\n                    </div>\n                </template>\n                {% endblock %}\n            </sw-cms-toolbar>\n            {% endblock %}\n\n            \n            {% block sw_cms_detail_stage_container %}\n            <div class="sw-cms-detail__stage-container">\n                <sw-overlay v-if="page.locked" />\n\n                \n                {% block sw_cms_detail_loader %}\n                <sw-loader v-if="isLoading" />\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_stage_form_view %}\n                <div\n                    v-if="currentDeviceView === \'form\'"\n                    class="sw-cms-detail__page-form"\n                >\n                    \n                    {% block sw_cms_detail_page_notification %}\n                    <div\n                        v-if="page.locked"\n                        class="sw-cms-detail__page-notification"\n                    >\n                        <sw-alert\n                            class="sw-cms-detail__page-notification-alert"\n                            variant="info"\n                        >\n                            {{ $tc(\'sw-cms.detail.label.lockedNotification\') }}\n                        </sw-alert>\n                    </div>\n                    {% endblock %}\n\n                    <sw-cms-page-form\n                        v-if="!isLoading"\n                        :page="page"\n                    />\n                </div>\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_stage_wrapper %}\n                <div\n                    v-else\n                    class="sw-cms-detail__stage"\n                >\n\n                    \n                    {% block sw_cms_detail_toolbar_notification %}\n                    \n                    {% block sw_cms_detail_toolbar_notification_errors %}\n                    <div\n                        v-if="hasPageErrors"\n                        class="sw-cms-detail__page-notification"\n                    >\n                        <sw-alert\n                            class="sw-cms-detail__page-notification-alert is--error"\n                            variant="error"\n                        >\n                            {{ $tc(\'sw-cms.detail.notification.errorCollectionText\') }}\n                            <li\n                                v-for="(error, index) in pageErrors"\n                                :key="index"\n                            >\n                                {{ error.detail }}\n                            </li>\n                        </sw-alert>\n                    </div>\n                    {% endblock %}\n\n                    \n                    {% block sw_cms_detail_toolbar_notification_warnings %}\n                    <div\n                        v-if="validationWarnings.length > 0"\n                        class="sw-cms-detail__page-notification"\n                    >\n                        <sw-alert\n                            class="sw-cms-detail__page-notification-alert is--warning"\n                            variant="warning"\n                        >\n                            {{ $tc(\'sw-cms.detail.notification.warningCollectionText\') }}\n                            <li\n                                v-for="(warning, index) in validationWarnings"\n                                :key="index"\n                            >\n                                {{ warning }}\n                            </li>\n                        </sw-alert>\n                    </div>\n                    {% endblock %}\n\n                    \n                    {% block sw_cms_detail_toolbar_notification_infos %}\n                    <div\n                        v-if="page.locked"\n                        class="sw-cms-detail__page-notification is--info"\n                    >\n                        <sw-alert\n                            class="sw-cms-detail__page-notification-alert"\n                            variant="info"\n                        >\n                            {{ $tc(\'sw-cms.detail.label.lockedNotification\') }}\n                        </sw-alert>\n                    </div>\n                    {% endblock %}\n                    {% endblock %}\n\n                    \n                    {% block sw_cms_detail_stage_empty_stage %}\n                    <div\n                        v-if="!isLoading && !pageHasSections"\n                        class="sw-cms-detail__empty-stage"\n                    >\n\n                        \n                        {% block sw_cms_detail_stage_empty_stade_content %}\n                        <div class="sw-cms-detail__empty-stage-content">\n                            <h2 class="sw-cms-detail__empty-stage-headline">\n                                {{ $tc(\'sw-cms.detail.label.headlineEmptyState\') }}\n                            </h2>\n                            <p class="sw-cms-detail__empty-stage-claim">\n                                {{ $tc(\'sw-cms.detail.label.claimEmptyState\') }}\n                            </p>\n                            <sw-cms-stage-add-section\n                                :key="0"\n                                :disabled="!acl.can(\'cms.editor\') || undefined"\n                                :force-choose="true"\n                                @stage-section-add="onAddSection($event, 0, true)"\n                            />\n                        </div>\n                        {% endblock %}\n                    </div>\n                    {% endblock %}\n\n                    \n                    {% block sw_cms_detail_stage %}\n                    <div\n                        v-else\n                        :id="`page-${page.id}`"\n                        class="sw-cms-stage"\n                        :class="cmsStageClasses"\n                    >\n\n                        \n                        {% block sw_cms_detail_stage_add_first_section %}\n                        <sw-cms-stage-add-section\n                            :key="0"\n                            :disabled="!acl.can(\'cms.editor\') || undefined"\n                            @stage-section-add="onAddSection($event, 0, true)"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_stage_content %}\n                        <template v-if="!isLoading">\n                            <template\n                                v-for="(section, index) in page.sections"\n                                :key="section.id"\n                            >\n\n                                \n                                {% block sw_cms_detail_stage_content_section %}\n                                <sw-cms-section\n                                    class="sw-cms-stage-section"\n                                    :page="page"\n                                    :section="section"\n                                    :active="selectedSection !== null && selectedSection.id === section.id"\n                                    :disabled="!acl.can(\'cms.editor\') || undefined"\n                                    @page-config-open="pageConfigOpen"\n                                    @block-duplicate="onBlockDuplicate"\n                                />\n                                {% endblock %}\n                            </template>\n                        </template>\n                        {% endblock %}\n\n                        \n                        {% block sw_cms_detail_stage_add_last_section %}\n                        <sw-cms-stage-add-section\n                            :key="page.sections.length + 1"\n                            :disabled="!acl.can(\'cms.editor\') || undefined"\n                            @stage-section-add="onAddSection($event, page.sections.length, true)"\n                        />\n                        {% endblock %}\n                    </div>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_sidebar %}\n                <sw-cms-sidebar\n                    ref="cmsSidebar"\n                    :page="page"\n                    :demo-entity="currentMappingEntity"\n                    :demo-entity-id-prop="demoEntityId"\n                    :disabled="!acl.can(\'cms.editor\') || undefined"\n                    :is-default-layout="isDefaultLayout"\n                    @demo-entity-change="onDemoEntityChange"\n                    @block-duplicate="onBlockDuplicate"\n                    @section-duplicate="onSectionDuplicate"\n                    @block-stage-drop="onPageUpdate"\n                    @page-type-change="onPageTypeChange"\n                    @page-update="onPageUpdate"\n                    @page-save="onPageSave"\n                    @open-layout-assignment="onOpenLayoutAssignment"\n                    @open-layout-set-as-default="onOpenLayoutSetAsDefault"\n                />\n                {% endblock %}\n\n                \n                {% block sw_cms_detail_layout_assignment_modal %}\n                <sw-cms-layout-assignment-modal\n                    v-if="showLayoutAssignmentModal"\n                    :page="page"\n                    @modal-close="closeLayoutAssignmentModal"\n                />\n                {% endblock %}\n\n                <sw-confirm-modal\n                    v-if="showLayoutSetAsDefaultModal"\n                    class="sw-cms-detail__confirm-set-as-default-modal"\n                    :title="$tc(\'sw-cms.components.setDefaultLayoutModal.title\')"\n                    :text="$tc(\'sw-cms.components.setDefaultLayoutModal.infoText\', page.type === \'product_detail\')"\n                    @confirm="onConfirmLayoutSetAsDefault"\n                    @cancel="onCloseLayoutSetAsDefault"\n                    @close="onCloseLayoutSetAsDefault"\n                />\n\n                \n                {% block sw_cms_detail_missing_element_modal %}\n                <sw-cms-missing-element-modal\n                    v-if="showMissingElementModal"\n                    :missing-elements="missingElements"\n                    @modal-close="onCloseMissingElementModal"\n                    @modal-save="onSaveMissingElementModal"\n                    @modal-dont-remind-change="onChangeDontRemindCheckbox"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </div>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["repositoryFactory","entityFactory","entityHydrator","loginService","cmsService","cmsDataResolverService","acl","appCmsService","systemConfigApiService","cmsPageTypeService"],mixins:[a.getByName("cms-state"),a.getByName("notification"),a.getByName("placeholder")],shortcuts:{"SYSTEMKEY+S":"onSave"},data(){return{pageId:null,pageOrigin:null,page:{sections:[]},salesChannels:[],isLoading:!1,isSaveSuccessful:!1,currentSalesChannelKey:null,selectedBlockSectionId:null,currentMappingEntity:null,currentMappingEntityRepo:null,demoEntityId:null,validationWarnings:[],productDetailBlocks:[{type:"cross-selling",elements:[{slot:"content",type:"cross-selling",config:{}}]},{type:"product-description-reviews",elements:[{slot:"content",type:"product-description-reviews",config:{}}]},{type:"gallery-buybox",elements:[{slot:"left",type:"image-gallery",config:{}},{slot:"right",type:"buy-box",config:{}}]},{type:"product-heading",elements:[{slot:"left",type:"product-name",config:{}},{slot:"right",type:"manufacturer-logo",config:{}}]}],showLayoutAssignmentModal:!1,showLayoutSetAsDefaultModal:!1,isDefaultLayout:!1,showMissingElementModal:!1,missingElements:[]}},metaInfo(){return{title:this.$createTitle(this.identifier)}},computed:{identifier(){return this.placeholder(this.page,"name")},pageRepository(){return this.repositoryFactory.create("cms_page")},sectionRepository(){return this.repositoryFactory.create("cms_section")},blockRepository(){return this.repositoryFactory.create("cms_block")},slotRepository(){return this.repositoryFactory.create("cms_slot")},salesChannelRepository(){return this.repositoryFactory.create("sales_channel")},defaultFolderRepository(){return this.repositoryFactory.create("media_default_folder")},cmsBlocks(){return this.cmsService.getCmsBlockRegistry()},productRepository(){return this.repositoryFactory.create("product")},cmsStageClasses(){return[`is--${this.currentDeviceView}`]},cmsPageTypeSettings(){let e=n.Z.TYPE_MAPPING_ENTITIES;return e.hasOwnProperty(this.page.type)?e[this.page.type]:{entity:null,mode:"static"}},blockConfigDefaults(){return{name:null,marginBottom:null,marginTop:null,marginLeft:null,marginRight:null,sizingMode:"boxed",visibility:{desktop:!0,tablet:!0,mobile:!0}}},tooltipSave(){if(!this.acl.can("cms.editor"))return{message:this.$tc("sw-privileges.tooltip.warning"),disabled:this.acl.can("cms.editor"),showOnDisabledElements:!0};let e=this.$device.getSystemKey();return{message:`${e} + S`,appearance:"light"}},addBlockTitle(){return this.isSystemDefaultLanguage?this.$tc("sw-cms.detail.sidebar.titleBlockOverview"):this.$tc("sw-cms.general.disabledAddingBlocksToolTip")},pageHasSections(){return this.page.sections.length>0},loadPageCriteria(){let e=new m(1,1),t=m.sort("position","ASC",!0);return e.getAssociation("sections").addSorting(t).addAssociation("backgroundMedia").getAssociation("blocks").addSorting(t).addAssociation("backgroundMedia").addAssociation("slots"),e.getAssociation("categories").setPage(1).setLimit(25),e.getAssociation("landingPages").setLimit(25),e.getAssociation("products").setLimit(25),e.getAssociation("products.manufacturer").setLimit(25),e},demoProductCriteria(){let e=new m(1,25);return e.addAssociation("media"),e.addAssociation("deliveryTime"),e.addAssociation("manufacturer.media"),e.addAssociation("cover"),e},currentDeviceView(){return this.cmsPageState.currentCmsDeviceView},isProductPage(){return this.page.type===n.Z.PAGE_TYPES.PRODUCT_DETAIL},requiredFieldErrors(){return[this.pageNameError].filter(e=>!!e)},pageErrors(){return[this.requiredFieldErrors.find(e=>!!e),this.pageSectionsError,this.pageBlocksError,this.pageSlotsError,this.pageSlotConfigError].filter(e=>!!e)},hasPageErrors(){return this.pageErrors.length>0},pageType(){this.cmsPageTypeService.getType(this.page.type)},layoutVersionContext(){return Shopware.Context.api},...c("page",["name","sections","blocks","slots","slotConfig"])},created(){this.createdComponent()},beforeUnmount(){this.beforeDestroyedComponent()},methods:{createdComponent(){Shopware.ExtensionAPI.publishData({id:"sw-cms-detail__page",path:"page",scope:this}),Shopware.State.commit("adminMenu/collapseSidebar");let e=Shopware.State.getters["context/isSystemDefaultLanguage"];if(this.cmsPageState.setIsSystemDefaultLanguage(e),this.resetCmsPageState(),this.$route.params.id){this.pageId=this.$route.params.id,this.isLoading=!0,Shopware.State.commit("shopwareApps/setSelectedIds",[this.pageId]);let e=new m(1,25);e.addFilter(m.equals("typeId","8A243080F92E4C719546314B577CF82B")),this.salesChannelRepository.search(e).then(e=>{this.salesChannels=e,this.salesChannels.length>0&&(this.currentSalesChannelKey=this.salesChannels[0].id,this.loadPage(this.pageId))})}this.setPageContext()},setPageContext(){this.getDefaultFolderId().then(e=>{this.cmsPageState.setDefaultMediaFolderId(e)})},resetCmsPageState(){this.cmsPageState.resetCmsPageState()},getDefaultFolderId(){let e=new m(1,1);return e.addAssociation("folder"),e.addFilter(m.equals("entity",this.cmsPageState.pageEntityName)),this.defaultFolderRepository.search(e).then(e=>{let t=e.first();return t.folder?.id?t.folder.id:null})},beforeDestroyedComponent(){let e=this.cmsPageState;e.removeCurrentPage(),e.removeSelectedBlock(),e.removeSelectedSection()},loadPage(e){return this.isLoading=!0,this.pageRepository.get(e,Shopware.Context.api,this.loadPageCriteria).then(e=>{this.page={sections:[]},this.page=e,this.cmsPageState.setCurrentPageType(e.type),this.acl.can("system_config:read")&&this.setDefaultLayout(),this.cmsDataResolverService.resolve(this.page).then(()=>{if(this.updateSectionAndBlockPositions(),this.cmsPageState.setCurrentPage(this.page),this.updateDataMapping(),this.pageOrigin=d(this.page),this.selectedBlock){let e=this.selectedBlock.id,t=this.selectedBlock.sectionId;this.page.sections.forEach(s=>{s.id===t&&s.blocks.forEach(s=>{s.id===e&&this.setSelectedBlock(t,s)})})}Shopware.ExtensionAPI.publishData({id:"sw-cms-detail__page",path:"page",scope:this}),this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.createNotificationError({title:e.message,message:e.response}),p(this._name,e.message,e.response)})}).catch(e=>{this.isLoading=!1,this.createNotificationError({title:e.message,message:e.response.statusText}),p(this._name,e.message,e.response)})},updateDataMapping(){let e=this.cmsPageTypeSettings.entity;if(!e){this.cmsPageState.removeCurrentMappingEntity(),this.cmsPageState.removeCurrentMappingTypes(),this.cmsPageState.removeCurrentDemoEntity(),this.cmsPageState.removeCurrentDemoProducts(),this.currentMappingEntity=null,this.currentMappingEntityRepo=null,this.demoEntityId=null;return}this.cmsPageState.currentMappingEntity!==e&&(this.cmsPageState.setCurrentMappingEntity(e),this.cmsPageState.setCurrentMappingTypes(this.cmsService.getEntityMappingTypes(e)),this.currentMappingEntity=e,this.currentMappingEntityRepo=this.repositoryFactory.create(e),this.onDemoEntityChange())},onDeviceViewChange(e){("form"!==e||this.acl.can("cms.editor"))&&(this.cmsPageState.setCurrentCmsDeviceView(e),"form"===e&&this.setSelectedBlock(null,null))},setSelectedBlock(e,t=null){this.selectedBlockSectionId=e,this.cmsPageState.setBlock(t)},onChangeLanguage(){return this.isLoading=!0,this.salesChannelRepository.search(new m(1,25)).then(e=>{this.salesChannels=e;let t=Shopware.State.getters["context/isSystemDefaultLanguage"];return this.cmsPageState.setIsSystemDefaultLanguage(t),this.loadPage(this.pageId)})},abortOnLanguageChange(){return Object.keys(g(this.page,this.pageOrigin)).length>0},saveOnLanguageChange(){return this.onSave()},async loadDemoProduct(e){let t=m.fromCriteria(this.demoProductCriteria);t.setLimit(1),e&&t.setIds([e]);let s={...Shopware.Context.api,inheritance:!0},n=await this.productRepository.search(t,s);this.cmsPageState.setCurrentDemoEntity(n[0])},async loadDemoCategory(e){let t=new m(1,1);t.addAssociation("media"),e&&t.setIds([e]);let s=(await this.repositoryFactory.create("category").search(t))[0];this.demoEntityId=s.id,this.cmsPageState.setCurrentDemoEntity(s),this.loadDemoCategoryProducts(s)},async loadDemoCategoryProducts(e){let t=m.fromCriteria(this.demoProductCriteria);t.setLimit(8),t.addFilter(m.equals("categoriesRo.id",e.id)),t.addFilter(m.equals("parentId",null));let s=await this.productRepository.search(t);this.cmsPageState.setCurrentDemoProducts(s)},onDemoEntityChange(e){let t=this.cmsPageTypeSettings?.entity,s=this.cmsPageState;if(s.removeCurrentDemoEntity(),s.removeCurrentDemoProducts(),"product"===t){e&&this.loadDemoProduct(e);return}"category"===t&&this.loadDemoCategory(e)},onAddSection(e,t,s=!1){if(!e||"undefined"===t)return;let n=this.sectionRepository.create();n.type=e,n.sizingMode="boxed",n.position=t,n.pageId=this.page.id,n.visibility={desktop:!0,tablet:!0,mobile:!0},this.page.sections.splice(t,0,n),this.updateSectionAndBlockPositions(),s&&this.onSave()},onCloseBlockConfig(){this.cmsPageState.removeSelectedItem()},pageConfigOpen(e=null){let t=this.$refs.cmsSidebar.$refs;if("blocks"===e){if(!this.isSystemDefaultLanguage)return;t.blockSelectionSidebar.openContent();return}if("itemConfig"===e){t.itemConfigSidebar.openContent();return}t.pageConfigSidebar.openContent()},saveFinish(){this.isSaveSuccessful=!1},onPageSave(e=!1){if(this.onPageUpdate(),e){this.debouncedPageSave();return}this.onSave()},debouncedPageSave:r(function(){this.onSave()},800),onSave(){return(this.isSaveSuccessful=!1,this.pageIsValid())?this.onSaveEntity():(this.createNotificationError({message:this.$tc("sw-cms.detail.notification.pageInvalid")}),Promise.reject())},onSaveEntity(){return this.isLoading=!0,this.deleteEntityAndRequiredConfigKey(this.page.sections),this.pageRepository.save(this.page,Shopware.Context.api,!1).then(()=>(this.isLoading=!1,this.isSaveSuccessful=!0,this.loadPage(this.page.id))).catch(e=>(this.isLoading=!1,this.createNotificationError({message:e.message}),Promise.reject(e)))},addError({property:e=null,payload:t={},code:s=n.Z.REQUIRED_FIELD_ERROR_CODE,message:i=""}={}){let a=`cms_page.${this.page.id}.${e}`,o=new l({code:s,detail:i,meta:{parameters:t}});Shopware.State.commit("error/addApiError",{expression:a,error:o})},getError(e){return Shopware.State.getters["error/getApiError"](this.page,e)},getSlotValidations(){let e={},t=[];return this.page.sections.forEach(s=>{s.blocks.forEach(s=>{s.backgroundMedia=null,s.slots.forEach(i=>{if(this.page.type===n.Z.PAGE_TYPES.PRODUCT_DETAIL&&this.isProductPageElement(i)){let t=o.string.camelCase(i.type);e.hasOwnProperty(t)?(e[t].count+=1,e[t].blockIds.push(s.id),e[t].slotIds.push(i.id)):e[t]={type:t,count:1,blockIds:[s.id],slotIds:[i.id]};return}t.push(...this.checkRequiredSlotConfigField(i,s))})})}),{requiredMissingSlotConfigs:t,uniqueSlotCount:e}},pageIsValid(){"true"===localStorage.getItem("cmsMissingElementDontRemind")&&(this.cmsMissingElementDontRemind=!0),this.validationWarnings=[],Shopware.State.dispatch("error/resetApiErrors");let e=[this.missingFieldsValidation(),this.listingPageValidation(),this.pageSectionCountValidation(),this.slotValidation()].every(e=>e);return!this.cmsMissingElementDontRemind&&e&&this.validationWarnings.length>0&&(this.showMissingElementModal=!0),e},missingFieldsValidation(){return(!this.isSystemDefaultLanguage||!!this.page.name)&&!!this.page.type||(this.addError({property:"name",message:this.$tc("sw-cms.detail.notification.messageMissingFields")}),!1)},listingPageValidation(){return this.page.type!==n.Z.PAGE_TYPES.LISTING||(this.page.sections.some(e=>e.blocks.some(e=>"product-listing"===e.type))?(this.cmsBlocks["product-listing"].hidden=!0,!0):(this.addError({property:"blocks",code:"listingBlockNotFound",message:this.$tc("sw-cms.detail.notification.messageMissingProductListing")}),this.cmsBlocks["product-listing"].hidden=!1,!1))},pageSectionCountValidation(){return this.page.sections.length>=1||(this.addError({property:"sections",code:"noSectionsFound",message:this.$tc("sw-cms.detail.notification.messageMissingSections")}),!1)},slotValidation(){let e=!0,{requiredMissingSlotConfigs:t,uniqueSlotCount:s}=this.getSlotValidations(),i=[],a=[];if(this.page.type===n.Z.PAGE_TYPES.PRODUCT_DETAIL){if(n.Z.UNIQUE_SLOTS.forEach(t=>{s?.[t]?.count>1?(s[t].label=this.$tc(`sw-cms.elements.${t}.label`),i.push({...s[t]}),e=!1):s?.[t]||a.push(this.$tc(`sw-cms.elements.${t}.label`))}),i.length>0){let e=n.Z.UNIQUE_SLOTS.map(e=>this.$tc(`sw-cms.elements.${e}.label`)).join(", "),t=this.$tc("sw-cms.detail.notification.messageRedundantElements",0,{names:e});this.addError({property:"slots",code:"uniqueSlotsOnlyOnce",message:t,payload:{elements:i}})}a.length>0&&this.validationWarnings.push(...a)}return t.length>0&&(this.addError({property:"slotConfig",code:"requiredConfigMissing",message:this.$tc("sw-cms.detail.notification.messageMissingBlockFields"),payload:{elements:t}}),e=!1),e},deleteEntityAndRequiredConfigKey(e){e.forEach(e=>{e.blocks.forEach(e=>{e.slots.forEach(e=>{Object.values(e.config).forEach(e=>{e.entity&&delete e.entity,e.hasOwnProperty("required")&&delete e.required})})})})},checkRequiredSlotConfigField(e,t){return Object.keys(e.config).reduce((s,n)=>{let i={...e.config[n]};return i.required&&(null===i.value||i.value.length<1)&&(i.name=`${e.type}.${n}`,i.blockId=t.id,s.push(i)),s},[])},updateSectionAndBlockPositions(){this.page.sections.forEach((e,t)=>{e.position=t,this.updateBlockPositions(e)})},updateBlockPositions(e){e.blocks.forEach((e,t)=>{e.position=t})},onPageUpdate(){this.updateSectionAndBlockPositions(),this.updateDataMapping()},async onBlockDuplicate(e,{position:t=0}){let s={overwrites:{position:e.position+1},cloneChildren:!0},{id:n}=await this.blockRepository.clone(e.id,s,this.layoutVersionContext),i=await this.blockRepository.get(n,this.layoutVersionContext),a=this.page.sections[t];a.blocks.splice(i.position,0,i),this.updateBlockPositions(a),this.onSave()},async onSectionDuplicate(e){let t={overwrites:{position:e.position+1},cloneChildren:!0},{id:s}=await this.sectionRepository.clone(e.id,t,this.layoutVersionContext),n=await this.sectionRepository.get(s,this.layoutVersionContext);this.page.sections.splice(n.position,0,n),this.updateSectionAndBlockPositions(e),this.onSave()},onPageTypeChange(e){"string"==typeof e&&(this.cmsPageState.setCurrentPageType(e),this.page.type=e),this.page.type===n.Z.PAGE_TYPES.LISTING?this.processProductListingType():this.page.sections.forEach(e=>{e.blocks.forEach(t=>{"product-listing"===t.type&&e.blocks.remove(t.id)})}),this.page.type===n.Z.PAGE_TYPES.PRODUCT_DETAIL&&this.processProductDetailType(),this.checkSlotMappings(),this.onPageUpdate()},processProductListingType(){let e=this.blockRepository.create(),t=[{blockId:e.id,slot:"content",type:"product-listing",config:{}}];this.processBlock(e,"product-listing"),this.processElements(e,t)},processProductDetailType(){this.productDetailBlocks.forEach(e=>{let t=this.blockRepository.create();e.elements.forEach(e=>{e.blockId=t.id}),this.processBlock(t,e.type),this.processElements(t,e.elements)})},processBlock(e,t){let s=this.cmsBlocks[t].defaultConfig;this.isProductPage&&s&&(s={...s,marginLeft:"0",marginRight:"0",marginTop:"gallery-buybox"===t||"product-description-reviews"===t?"20px":"0",marginBottom:"product-heading"===t||"product-description-reviews"===t?"20px":"0"}),e.type=t,e.position=0,e.sectionId=this.page.sections[0].id,e.sectionPosition="main",Object.assign(e,d(this.blockConfigDefaults),d(s||{}))},processElements(e,t){t.forEach(t=>{let s=this.slotRepository.create();s.blockId=t.blockId,s.slot=t.slot,s.type=t.type,s.config=t.config,e.slots.push(s)}),this.page.sections[0].blocks.splice(0,0,e)},checkSlotMappings(){this.page.sections.forEach(e=>{e.blocks.forEach(e=>{e.slots.forEach(e=>{Object.keys(e.config).forEach(t=>{e.config[t]?.source==="mapped"&&e.config[t].value.split(".")[0]!==this.demoEntity&&(e.config[t].value=null,e.config[t].source="static")})})})})},isProductPageElement(e){return n.Z.UNIQUE_SLOTS_KEBAB.includes(e.type)},onOpenLayoutAssignment(){this.openLayoutAssignmentModal()},openLayoutAssignmentModal(){this.showLayoutAssignmentModal=!0},closeLayoutAssignmentModal(e=!1){this.showLayoutAssignmentModal=!1,e&&this.$nextTick(()=>{this.onSaveEntity()})},onOpenLayoutSetAsDefault(){this.showLayoutSetAsDefaultModal=!0},onCloseLayoutSetAsDefault(){this.showLayoutSetAsDefaultModal=!1},async onConfirmLayoutSetAsDefault(){let e="category_cms_page";"product_detail"===this.page.type&&(e="product_cms_page"),await this.systemConfigApiService.saveValues({[`core.cms.default_${e}`]:this.pageId}),this.isDefaultLayout=!0,this.showLayoutSetAsDefaultModal=!1},async setDefaultLayout(){let e=await this.systemConfigApiService.getValues("core.cms"),t=e["core.cms.default_category_cms_page"],s=e["core.cms.default_product_cms_page"];this.page.versionId===Shopware.Context.api.liveVersionId&&[t,s].includes(this.pageId)&&(this.isDefaultLayout=!0)},onCloseMissingElementModal(){this.showMissingElementModal=!1,this.cmsMissingElementDontRemind=!1,this.$nextTick(()=>{this.loadPage(this.pageId)})},onSaveMissingElementModal(){this.cmsMissingElementDontRemind&&localStorage.setItem("cmsMissingElementDontRemind",!0),this.showMissingElementModal=!1,this.$nextTick(()=>{this.onSaveEntity()})},onChangeDontRemindCheckbox(){this.cmsMissingElementDontRemind=!this.cmsMissingElementDontRemind},async onClickBack(){window.history.length>2?await this.$router.back():await this.$router.push({name:"sw.cms.index"})}}}},716417:function(e,t,s){var n=s(873283);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),s(745346).Z("03e91cd3",n,!0,{})}}]);