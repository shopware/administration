(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[12169],{285011:function(){},12169:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});let{Service:r}=Shopware;var o={namespaced:!0,state:()=>({customer:null,defaultSalesChannel:null,cart:{token:null,lineItems:[],price:{totalPrice:null},deliveries:[]},context:{token:"",customer:null,paymentMethod:{translated:{distinguishableName:""}},shippingMethod:{translated:{name:""}},currency:{isoCode:"EUR",symbol:"â‚¬",totalRounding:{decimals:2}},salesChannel:{id:""},context:{currencyId:"",languageIdChain:[]}},promotionCodes:[],disabledAutoPromotion:!1}),mutations:{setCustomer(e,t){e.context.customer=t,e.customer=t},setDefaultSalesChannel(e,t){e.defaultSalesChannel=t},setCartToken(e,t){e.cart.token=t},setCart(e,t){var n;let r=e.cart.lineItems.filter(e=>""===e.label);e.cart=t,e.cart.lineItems=((n=e.cart.lineItems).slice().reverse(),[...r,...n])},setCartLineItems(e,t){e.cart.lineItems=t},setCurrency(e,t){e.context.currency=t},setContext(e,t){e.context=t},setPromotionCodes(e,t){e.promotionCodes=t},removeEmptyLineItem(e,t){e.cart.lineItems=e.cart.lineItems.filter(e=>e.id!==t)},removeInvalidPromotionCodes(e){e.promotionCodes=e.promotionCodes.filter(e=>!e.isInvalid)},setDisabledAutoPromotion(e,t){e.disabledAutoPromotion=t}},getters:{isCustomerActive(e){return!!e?.context.customer?.active},isCartTokenAvailable(e){return!!e?.cart?.token},currencyId(e){return e?.context.context.currencyId??""},invalidPromotionCodes(e){return e.promotionCodes.filter(e=>e.isInvalid)},cartErrors(e){return e?.cart?.errors??null}},actions:{selectExistingCustomer({commit:e},{customer:t}){e("setCustomer",t),e("setDefaultSalesChannel",{...t?.salesChannel??null})},createCart({commit:e},{salesChannelId:t}){return r("cartStoreService").createCart(t).then(t=>{let n=t.data.token;return e("setCartToken",n),n}).then(n=>r("contextStoreService").getSalesChannelContext(t,n).then(t=>e("setContext",t.data)))},getCart({commit:e},{salesChannelId:t,contextToken:n}){if(32!==`${n}`.length)throw Error("Invalid context token");return Promise.all([r("cartStoreService").getCart(t,n).then(t=>e("setCart",t.data)),r("contextStoreService").getSalesChannelContext(t,n).then(t=>e("setContext",t.data))])},cancelCart(e,{salesChannelId:t,contextToken:n}){if(32!==`${n}`.length)throw Error("Invalid context token");return r("cartStoreService").cancelCart(t,n)},updateCustomerContext(e,{customerId:t,salesChannelId:n,contextToken:o}){return r("contextStoreService").updateCustomerContext(t,n,o)},updateOrderContext(e,{context:t,salesChannelId:n,contextToken:o}){return r("contextStoreService").updateContext(t,n,o)},getContext(e,{salesChannelId:t,contextToken:n}){return r("contextStoreService").getSalesChannelContext(t,n)},saveOrder(e,{salesChannelId:t,contextToken:n}){return r("checkoutStoreService").checkout(t,n)},removeLineItems({commit:e},{salesChannelId:t,contextToken:n,lineItemKeys:o}){return r("cartStoreService").removeLineItems(t,n,o).then(t=>e("setCart",t.data))},saveLineItem({commit:e},{salesChannelId:t,contextToken:n,item:o}){return r("cartStoreService").saveLineItem(t,n,o).then(t=>e("setCart",t.data))},saveMultipleLineItems({commit:e},{salesChannelId:t,contextToken:n,items:o}){return r("cartStoreService").addMultipleLineItems(t,n,o).then(t=>e("setCart",t.data))},addPromotionCode({commit:e},{salesChannelId:t,contextToken:n,code:o}){return r("cartStoreService").addPromotionCode(t,n,o).then(t=>e("setCart",t.data))},modifyShippingCosts({commit:e},{salesChannelId:t,contextToken:n,shippingCosts:o}){return r("cartStoreService")?.modifyShippingCosts(t,n,o).then(t=>e("setCart",t.data.data))},remindPayment(e,{orderTransactionId:t}){return r("orderStateMachineService").transitionOrderTransactionState(t,"remind")}}};n(74887);let{Context:a,State:s,Mixin:i}=Shopware,{Criteria:d}=Shopware.Data;var l=Shopware.Component.wrapComponentConfig({template:'\n{% block sw_order_create %}\n<sw-page class="sw-order-create">\n    \n    {% block sw_order_create_smart_bar_header %}\n    <template #smart-bar-header>\n        \n        {% block sw_order_create_smart_bar_header_title %}\n        <h2 v-if="!showInitialModal">\n            \n            {% block sw_order_create_smart_bar_header_title_text %}\n            {{ $tc(\'sw-order.create.textNewOrder\') }}\n            {% endblock %}\n        </h2>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_order_create_smart_bar_actions %}\n    <template #smart-bar-actions>\n        \n        {% block sw_order_create_smart_bar_actions_slot %}\n        <template v-if="!showInitialModal">\n            \n            {% block sw_order_create_smart_bar_actions_cancel %}\n            <sw-button @click="onCancelOrder">\n                {{ $tc(\'sw-order.create.buttonCancelOrder\') }}\n            </sw-button>\n            {% endblock %}\n            \n            {% block sw_order_create_smart_bar_actions_add %}\n            <sw-button-process\n                variant="primary"\n                :disabled="isLoading"\n                :is-loading="isLoading"\n                :process-success="isSaveSuccessful"\n                @update:process-success="saveFinish"\n                @click.prevent="onSaveOrder"\n            >\n                {{ $tc(\'sw-order.create.buttonSaveOrder\') }}\n            </sw-button-process>\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_order_create_language_switch %}\n    <template #language-switch>\n        <sw-language-switch\n            disabled\n        />\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_order_create_content %}\n    <template #content>\n        \n        {% block sw_order_create_content_view %}\n        <sw-card-view>\n            \n            {% block sw_order_create_content_tabs %}\n            <sw-tabs\n                v-if="!showInitialModal"\n                class="sw-order-create__tabs"\n                position-identifier="sw-order-create"\n            >\n                \n                {% block sw_order_create_content_tabs_general %}\n                <sw-tabs-item\n                    class="sw-order-create__tab-general"\n                    :route="{ name: \'sw.order.create.general\' }"\n                    :title="$tc(\'sw-order.detail.tabGeneral\')"\n                >\n                    {{ $tc(\'sw-order.detail.tabGeneral\') }}\n                </sw-tabs-item>\n                {% endblock %}\n\n                \n                {% block sw_order_create_content_tabs_details %}\n                <sw-tabs-item\n                    class="sw-order-create__tab-details"\n                    :route="{ name: \'sw.order.create.details\' }"\n                    :title="$tc(\'sw-order.detail.tabDetails\')"\n                >\n                    {{ $tc(\'sw-order.detail.tabDetails\') }}\n                </sw-tabs-item>\n                {% endblock %}\n            </sw-tabs>\n            {% endblock %}\n\n            \n            {% block sw_order_create_content_view %}\n            <router-view\n                v-slot="{ Component }"\n            >\n                <component\n                    :is="Component"\n                    @error="showError"\n                />\n            </router-view>\n            {% endblock %}\n        </sw-card-view>\n        {% endblock %}\n\n        \n        {% block sw_order_create_invalid_promotion_modal %}\n        <sw-order-create-invalid-promotion-modal\n            v-if="showInvalidCodeModal"\n            @confirm="removeInvalidCode"\n            @close="closeInvalidCodeModal"\n        />\n        {% endblock %}\n\n        \n        {% block sw_order_create_remind_payment_modal %}\n        <sw-modal\n            v-if="showRemindPaymentModal"\n            class="sw-order-create__remind-payment-modal"\n            :title="$tc(\'sw-order.create.remindPaymentModal.title\')"\n            :is-loading="remindPaymentModalLoading"\n            @modal-close="onRemindPaymentModalClose"\n        >\n            \n            {% block sw_order_create_remind_payment_modal_content %}\n            <p>{{ $tc(\'sw-order.create.remindPaymentModal.text\', 0, {paymentMethodName: paymentMethodName }) }}</p>\n            {% endblock %}\n\n            <template #modal-footer>\n                \n                {% block sw_order_create_remind_payment_modal_footer %}\n                <sw-button\n                    class="sw-order-create__remind-payment-modal-decline"\n                    size="small"\n                    @click="onRemindPaymentModalClose"\n                >\n                    {{ $tc(\'global.default.no\') }}\n                </sw-button>\n\n                <sw-button\n                    class="sw-order-create__remind-payment-modal-remind"\n                    variant="primary"\n                    size="small"\n                    @click="onRemindCustomer"\n                >\n                    {{ $tc(\'sw-order.create.remindPaymentModal.primaryAction\') }}\n                </sw-button>\n                {% endblock %}\n\n            </template>\n        </sw-modal>\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["repositoryFactory","feature"],mixins:[i.getByName("notification")],data(){return{isLoading:!1,isSaveSuccessful:!1,showInvalidCodeModal:!1,showRemindPaymentModal:!1,remindPaymentModalLoading:!1,orderId:null,orderTransaction:null,paymentMethodName:""}},computed:{customer(){return s.get("swOrder").customer},cart(){return s.get("swOrder").cart},invalidPromotionCodes(){return s.getters["swOrder/invalidPromotionCodes"]},isSaveOrderValid(){return this.customer&&this.cart.token&&this.cart.lineItems.length&&!this.invalidPromotionCodes.length},paymentMethodRepository(){return this.repositoryFactory.create("payment_method")},showInitialModal(){return"sw.order.create.initial"===this.$route.name}},beforeCreate(){s.registerModule("swOrder",o)},created(){this.createdComponent()},beforeDestroy(){this.unregisterModule()},methods:{createdComponent(){s.getters["context/isSystemDefaultLanguage"]||s.commit("context/resetLanguageToDefault")},unregisterModule(){s.unregisterModule("swOrder")},redirectToOrderList(){this.$router.push({name:"sw.order.index"})},saveFinish(){this.orderId&&(this.isSaveSuccessful=!1,s.commit("context/setLanguageId",localStorage.getItem("sw-admin-current-language")||Shopware.Defaults.systemLanguageId),this.$router.push({name:"sw.order.detail",params:{id:this.orderId}}))},onSaveOrder(){return this.isSaveOrderValid?(this.isLoading=!0,this.isSaveSuccessful=!1,s.dispatch("swOrder/saveOrder",{salesChannelId:this.customer?.salesChannelId,contextToken:this.cart.token}).then(e=>{this.orderId=e?.data?.id,this.orderTransaction=e?.data?.transactions?.[0],this.orderTransaction&&(this.paymentMethodRepository.get(this.orderTransaction.paymentMethodId,a.api,new d(1,1)).then(e=>{this.paymentMethodName=e?.translated?.distinguishableName??""}),this.showRemindPaymentModal=!0)}).catch(e=>this.showError(e)).finally(()=>{this.isLoading=!1})):(this.invalidPromotionCodes.length>0?this.openInvalidCodeModal():this.showError(),Promise.resolve())},onCancelOrder(){if(null===this.customer||null===this.cart){this.redirectToOrderList();return}s.dispatch("swOrder/cancelCart",{salesChannelId:this.customer.salesChannelId,contextToken:this.cart.token}).then(()=>this.redirectToOrderList())},showError(e=null){let t=e?.response?.data?.errors?.[0]?.detail||null;this.createNotificationError({message:t||this.$tc("sw-order.create.messageSaveError")})},openInvalidCodeModal(){this.showInvalidCodeModal=!0},closeInvalidCodeModal(){this.showInvalidCodeModal=!1},removeInvalidCode(){s.commit("swOrder/removeInvalidPromotionCodes"),this.closeInvalidCodeModal()},onRemindPaymentModalClose(){this.isSaveSuccessful=!0,this.showRemindPaymentModal=!1},onRemindCustomer(){this.remindPaymentModalLoading=!0,s.dispatch("swOrder/remindPayment",{orderTransactionId:this.orderTransaction?.id}).then(()=>{this.remindPaymentModalLoading=!1,this.onRemindPaymentModalClose()})}}})},74887:function(e,t,n){var r=n(285011);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),n(745346).Z("2a1c9b4b",r,!0,{})}}]);