{"version":3,"sources":["webpack:///./src/module/sw-order/component/sw-order-send-document-modal/index.js","webpack:///./src/module/sw-order/component/sw-order-send-document-modal/sw-order-send-document-modal.html.twig","webpack:///./src/module/sw-order/component/sw-order-send-document-modal/sw-order-send-document-modal.scss"],"names":["Criteria","Shopware","Data","template","inject","mixins","props","document","type","Object","required","order","data","isLoading","mailTemplateId","subject","recipient","content","computed","mailTemplateRepository","this","repositoryFactory","create","mailTemplateCriteria","criteria","addAssociation","addFilter","equalsAny","mailTemplateSendCriteria","primaryActionDisabled","length","dateFilter","Filter","getByName","created","createdComponent","methods","orderCustomer","email","setEmailTemplateAccordingToDocumentType","_this","documentMailTemplateMapping","invoice","credit_note","delivery_note","storno","hasOwnProperty","documentType","technicalName","search","Context","api","then","result","mailTemplate","filter","t","mailTemplateType","first","id","onMailTemplateChange","_this2","mailService","buildRenderPreview","onSendDocument","_this3","get","sendMailTemplate","concat","firstName","lastName","_objectSpread","getIds","salesChannelId","salesChannel","catch","createNotificationError","message","$tc","$emit","finally","__esModule","default","module","i","locals","exports","add"],"mappings":"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","file":"static/js/8b467a502c7fda457c8d.js","sourcesContent":["import template from './sw-order-send-document-modal.html.twig';\nimport './sw-order-send-document-modal.scss';\n\n/**\n * @package checkout\n */\n\nconst { Criteria } = Shopware.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    inject: [\n        'mailService',\n        'repositoryFactory',\n    ],\n\n    mixins: [\n        'notification',\n    ],\n\n    props: {\n        document: {\n            type: Object,\n            required: true,\n        },\n        order: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            isLoading: false,\n            mailTemplateId: null,\n            subject: '',\n            recipient: '',\n            content: '',\n        };\n    },\n\n    computed: {\n        mailTemplateRepository() {\n            return this.repositoryFactory.create('mail_template');\n        },\n\n        mailTemplateCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addAssociation('mailTemplateType');\n            criteria.addFilter(\n                Criteria.equalsAny(\n                    'mailTemplateType.technicalName',\n                    [\n                        'delivery_mail',\n                        'invoice_mail',\n                        'credit_note_mail',\n                        'cancellation_mail',\n                    ],\n                ),\n            );\n\n            return criteria;\n        },\n\n        mailTemplateSendCriteria() {\n            const criteria = new Criteria(1, 25);\n            criteria.addAssociation('mailTemplateType');\n\n            return criteria;\n        },\n\n        primaryActionDisabled() {\n            return this.mailTemplateId === null || this.subject.length <= 0 || this.recipient.length <= 0;\n        },\n\n        dateFilter() {\n            return Shopware.Filter.getByName('date');\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        createdComponent() {\n            this.recipient = this.order.orderCustomer.email;\n\n            this.setEmailTemplateAccordingToDocumentType();\n        },\n\n        setEmailTemplateAccordingToDocumentType() {\n            const documentMailTemplateMapping = {\n                invoice: 'invoice_mail',\n                credit_note: 'credit_note_mail',\n                delivery_note: 'delivery_mail',\n                storno: 'cancellation_mail',\n            };\n\n            if (!documentMailTemplateMapping.hasOwnProperty(this.document.documentType.technicalName)) {\n                return;\n            }\n\n            this.mailTemplateRepository.search(this.mailTemplateCriteria, Shopware.Context.api).then((result) => {\n                const mailTemplate = result.filter(\n                    t => t.mailTemplateType.technicalName === documentMailTemplateMapping[\n                        this.document.documentType.technicalName\n                    ],\n                ).first();\n\n                if (!mailTemplate) {\n                    return;\n                }\n\n                this.mailTemplateId = mailTemplate.id;\n                this.onMailTemplateChange(mailTemplate.id, mailTemplate);\n            });\n        },\n\n        onMailTemplateChange(mailTemplateId, mailTemplate) {\n            if (mailTemplateId === null) {\n                this.subject = '';\n                this.content = '';\n\n                return;\n            }\n\n            this.subject = mailTemplate.subject;\n            this.mailService.buildRenderPreview(mailTemplate.mailTemplateType, mailTemplate).then((result) => {\n                this.content = result;\n            });\n        },\n\n        onSendDocument() {\n            this.isLoading = true;\n\n            this.mailTemplateRepository.get(this.mailTemplateId, Shopware.Context.api, this.mailTemplateSendCriteria)\n                .then((mailTemplate) => {\n                    this.mailService.sendMailTemplate(\n                        this.recipient,\n                        `${this.order.orderCustomer.firstName} ${this.order.orderCustomer.lastName}`,\n                        {\n                            ...mailTemplate,\n                            ...{\n                                subject: this.subject,\n                                recipient: this.recipient,\n                            },\n                        },\n                        {\n                            getIds: () => {},\n                        },\n                        this.order.salesChannelId,\n                        false,\n                        [this.document.id],\n                        {\n                            order: this.order,\n                            salesChannel: this.order.salesChannel,\n                        },\n                    ).catch(() => {\n                        this.createNotificationError({\n                            message: this.$tc('sw-order.documentSendModal.errorMessage'),\n                        });\n                        this.$emit('modal-close');\n                    }).then(() => {\n                        this.$emit('document-sent');\n                    }).finally(() => {\n                        this.isLoading = false;\n                    });\n                });\n        },\n    },\n};\n","export default \"\\n{% block sw_order_send_document_modal %}\\n<sw-modal\\n    class=\\\"sw-order-send-document-modal\\\"\\n    :title=\\\"$tc('sw-order.documentCard.labelSendDocument')\\\"\\n    :is-loading=\\\"isLoading\\\"\\n    @modal-close=\\\"$emit('modal-close')\\\"\\n>\\n    \\n    {% block sw_order_send_document_modal_info %}\\n    <sw-container\\n        class=\\\"sw-order-send-document-modal__info-container\\\"\\n        columns=\\\"1fr 1fr 1fr\\\"\\n    >\\n        \\n        {% block sw_order_send_document_modal_info_number %}\\n        <sw-description-list>\\n            <dt>{{ $tc('sw-order.documentSendModal.labelNumber') }}</dt>\\n            <dd>{{ document.config.documentNumber }}</dd>\\n        </sw-description-list>\\n        {% endblock %}\\n\\n        \\n        {% block sw_order_send_document_modal_info_type %}\\n        <sw-description-list>\\n            <dt>{{ $tc('sw-order.documentSendModal.labelType') }}</dt>\\n            <dd>{{ document.documentType.name }}</dd>\\n        </sw-description-list>\\n        {% endblock %}\\n\\n        \\n        {% block sw_order_send_document_modal_info_date %}\\n        <sw-description-list>\\n            <dt>{{ $tc('sw-order.documentSendModal.labelDate') }}</dt>\\n            <dd>{{ dateFilter(document.createdAt, { hour: '2-digit', minute: '2-digit' }) }}</dd>\\n        </sw-description-list>\\n        {% endblock %}\\n    </sw-container>\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_send_document_modal_mail_template_select %}\\n    <sw-entity-single-select\\n        {% if VUE3 %}\\n        v-model:value=\\\"mailTemplateId\\\"\\n        {% else %}\\n        v-model=\\\"mailTemplateId\\\"\\n        {% endif %}\\n        entity=\\\"mail_template\\\"\\n        :criteria=\\\"mailTemplateCriteria\\\"\\n        label-property=\\\"mailTemplateType.name\\\"\\n        :label=\\\"$tc('sw-order.documentSendModal.labelMailTemplate')\\\"\\n        required\\n        {% if VUE3 %}\\n        @update:value=\\\"onMailTemplateChange\\\"\\n        {% else %}\\n        @change=\\\"onMailTemplateChange\\\"\\n        {% endif %}\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_send_document_modal_customer_mail_select %}\\n    <sw-text-field\\n        {% if VUE3 %}\\n        v-model:value=\\\"recipient\\\"\\n        {% else %}\\n        v-model=\\\"recipient\\\"\\n        {% endif %}\\n        :label=\\\"$tc('sw-order.documentSendModal.labelRecipient')\\\"\\n        required\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_send_document_modal_subject %}\\n    <sw-text-field\\n        {% if VUE3 %}\\n        v-model:value=\\\"subject\\\"\\n        {% else %}\\n        v-model=\\\"subject\\\"\\n        {% endif %}\\n        :label=\\\"$tc('sw-order.documentSendModal.labelSubject')\\\"\\n        required\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_send_document_modal_mail_content %}\\n    <div\\n        class=\\\"sw-order-send-document-modal__email-content-label\\\"\\n    >\\n        {{ $tc('sw-order.documentSendModal.labelContent') }}\\n    </div>\\n\\n    <div\\n        class=\\\"sw-order-send-document-modal__email-content\\\"\\n        v-html=\\\"$sanitize(content)\\\"\\n    >\\n    </div>\\n    {% endblock %}\\n\\n    <template #modal-footer>\\n        \\n        {% block sw_order_send_document_modal_secondary_action %}\\n        <sw-button\\n            @click=\\\"$emit('modal-close')\\\"\\n        >\\n            {{ $tc('sw-order.documentSendModal.labelClose') }}\\n        </sw-button>\\n        {% endblock %}\\n\\n        \\n        {% block sw_order_send_document_modal_primary_action %}\\n        <sw-button\\n            :disabled=\\\"primaryActionDisabled\\\"\\n            variant=\\\"primary\\\"\\n            @click=\\\"onSendDocument\\\"\\n        >\\n            {{ $tc('sw-order.documentCard.labelSendDocument') }}\\n        </sw-button>\\n        {% endblock %}\\n    </template>\\n</sw-modal>\\n{% endblock %}\\n\";","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--15-1!../../../../../node_modules/css-loader/dist/cjs.js??ref--15-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--15-3!./sw-order-send-document-modal.scss\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"0a9672f6\", content, true, {});"],"sourceRoot":""}