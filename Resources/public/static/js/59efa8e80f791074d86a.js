(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[9845],{525479:function(){},309845:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return c}}),t(286333);let{Component:o,State:l}=Shopware,i=Shopware.Utils,{cloneDeep:s}=Shopware.Utils.object,{mapGetters:a,mapState:r}=o.getComponentHelper();var c={template:'\n{% block sw_flow_detail_flow %}\n<div class="sw-flow-detail-flow">\n    \n    {% block sw_flow_detail_flow_content %}\n    <div\n        class="sw-flow-detail-flow__content"\n        :class="{\'sw-flow-detail-flow-template\': isTemplate }"\n        :style="flowContainerStyle"\n    >\n        <sw-alert\n            v-if="isUnknownTrigger"\n            variant="warning"\n            class="sw-flow-detail-flow__warning-unknow-trigger"\n        >\n            <p>{{ $tc(\'sw-flow.flowNotification.messageUnknownTriggerWarning\') }}</p>\n            <p>{{ $tc(\'sw-flow.flowNotification.textIntroduce\') }}</p>\n            <ul>\n                <li>{{ $tc(\'sw-flow.flowNotification.textGuide1\') }}</li>\n                <li>{{ $tc(\'sw-flow.flowNotification.textGuide2\') }}</li>\n                <li>{{ $tc(\'sw-flow.flowNotification.textGuide3\') }}</li>\n            </ul>\n        </sw-alert>\n\n        <sw-alert\n            v-if="!isLoading && !isUnknownTrigger && showActionWarning "\n            variant="warning"\n            class="sw-flow-detail-flow__warning-box"\n        >\n            {{ $tc(\'sw-flow.detail.warningText\') }}\n        </sw-alert>\n        \n        {% block sw_flow_detail_trigger_card %}\n        <div class="sw-flow-detail-flow__trigger-card">\n            \n            {% block sw_flow_detail_flow_trigger_select %}\n            <div class="sw-flow-detail-flow__trigger-select">\n                \n                {% block sw_flow_detail_flow_single_select %}\n                <sw-flow-trigger\n                    :disabled="!acl.can(\'flow.editor\')"\n                    :event-name="flow.eventName"\n                    :is-unknown-trigger="isUnknownTrigger"\n                    @option-select="onEventChange"\n                />\n                {% endblock %}\n            </div>\n            {% endblock %}\n\n            \n            {% block sw_flow_detail_flow_trigger_explains %}\n            <div\n                v-if="!flow.eventName"\n                class="sw-flow-detail-flow__trigger-explain"\n            >\n                \n                {% block sw_flow_detail_flow_trigger_explains_title %}\n                <h4>{{ $tc(\'sw-flow.detail.trigger.title\') }}</h4>\n                {% endblock %}\n\n                \n                {% block sw_flow_detail_flow_trigger_explains_help_text %}\n                <p v-html="$tc(\'sw-flow.detail.trigger.helpText\')"></p>\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </div>\n        {% endblock %}\n\n        \n        {% block sw_flow_detail_flow_sequence_diagram %}\n        <div\n            v-if="flow.eventName"\n            class="sw-flow-detail-flow__sequence-diagram"\n        >\n            \n            {% block sw_flow_detail_flow_start_line %}\n            <div class="sw-flow-detail-flow__oval"></div>\n            {% endblock %}\n\n            \n            {% block sw_flow_detail_flow_transition_group %}\n            <transition-group\n                name="list"\n                tag="div"\n            >\n                \n                {% block sw_flow_detail_flow_position %}\n                <div\n                    v-for="sequence in formatSequences"\n                    :key="getSequenceId(sequence)"\n                    class="sw-flow-detail-flow__position list-item"\n                >\n\n                    \n                    {% block sw_flow_sequence_icon_plus %}\n                    <div\n                        class="sw-flow-detail-flow__position-plus"\n                        :disabled="!acl.can(\'flow.editor\')"\n                        role="button"\n                        tabindex="0"\n                        @click="onAddRootSequence"\n                        @keydown.enter="onAddRootSequence"\n                    >\n                        <sw-icon\n                            small\n                            name="regular-plus-xs"\n                        />\n                    </div>\n                    {% endblock %}\n\n                    \n                    {% block sw_flow_sequence_icon_connection %}\n                    <div class="sw-flow-detail-flow__position-connection">\n                        <sw-icon\n                            small\n                            name="regular-chevron-right-s"\n                        />\n                    </div>\n                    {% endblock %}\n\n                    \n                    {% block sw_flow_detail_flow_sequences %}\n                    <div\n                        class="sw-flow-detail-flow__sequences"\n                    >\n                        <sw-flow-sequence\n                            name="root-sequence"\n                            :sequence="sequence"\n                            :disabled="!acl.can(\'flow.editor\')"\n                            :is-unknown-trigger="isUnknownTrigger"\n                        />\n                    </div>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n            </transition-group>\n            {% endblock %}\n        </div>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_flow_detail_flow_modal_extension %}\n    {% endblock %}\n</div>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["repositoryFactory","acl","flowActionService","ruleConditionDataProviderService"],props:{isLoading:{type:Boolean,required:!1,default:!1},isNewFlow:{type:Boolean,required:!1,default:!1},isTemplate:{type:Boolean,required:!1,default:!1},isUnknownTrigger:{type:Boolean,required:!1,default:!1}},data(){return{flowContainerStyle:null}},computed:{sequenceRepository(){return this.repositoryFactory.create("flow_sequence")},formatSequences(){return this.convertSequenceData()},rootSequences(){return this.sequences.filter(e=>!e.parentId)},showActionWarning(){return!!this.triggerActions.length&&!!this.sequences.length&&this.sequences.some(e=>{let{actionName:n,_isNew:t,ruleId:o}=e;return(!!n||!o)&&!t&&!this.hasAvailableAction(n)})},...r("swFlowState",["flow","triggerActions"]),...a("swFlowState",["sequences","availableActions","hasAvailableAction"])},watch:{rootSequences:{handler(e){if(this.flow.eventName&&!e.length){let e=this.createSequence();l.commit("swFlowState/addSequence",e)}},immediate:!0},sequences:{handler(){let e=document.getElementsByName("root-sequence"),n=0;this.$nextTick(()=>{if(Array.from(e).forEach(e=>{n=e.offsetWidth>n?e.offsetWidth:n}),n<=870){this.flowContainerStyle=null;return}if(n>870&&n<=1300){this.flowContainerStyle={"max-width":"1300px"};return}this.flowContainerStyle={"max-width":"100%"}})},immediate:!0}},created(){this.createdComponent()},methods:{createdComponent(){this.triggerActions?.length||this.getTriggerActions()},getTriggerActions(){return this.flowActionService.getActions().then(e=>{l.commit("swFlowState/setTriggerActions",e)})},convertSequenceData(){return this.sequences?Object.values(s(this.sequences).reduce((e,n)=>(Array.isArray(e[n.displayGroup])||(e[n.displayGroup]=[]),e[n.displayGroup].push(n),e),{})).reduce((e,n)=>{let t=this.convertToTreeData(n);return t&&e.push(t),e},[]):[]},convertToTreeData(e){let n=null;return e.forEach(t=>{if(!t.parentId){n=null===t.actionName?t:{...n,[t.id]:t};return}let o=e.findIndex(e=>e.id===t.parentId);e[o]&&(t.trueCase?e[o].trueBlock={...e[o].trueBlock,[t.id]:t}:e[o].falseBlock={...e[o].falseBlock,[t.id]:t})}),n},createSequence(){let e=this.sequenceRepository.create(),n={...e,parentId:null,ruleId:null,actionName:null,config:{},position:1,displayGroup:1,id:i.createId()};return Object.assign(e,n)},onEventChange(e){if(l.commit("swFlowState/setEventName",e),l.commit("error/removeApiError",{expression:`flow.${this.flow.id}.eventName`}),!this.rootSequences.length){let e=this.createSequence();l.commit("swFlowState/addSequence",e)}},onAddRootSequence(){if(!this.acl.can("flow.editor"))return;let e=this.createSequence();e.position=1,e.displayGroup=this.rootSequences[this.rootSequences.length-1].displayGroup+1,l.commit("swFlowState/addSequence",e)},getSequenceId(e){return e.id?e.displayGroup:Object.values(e)[0].displayGroup}}}},286333:function(e,n,t){var o=t(525479);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals),t(745346).Z("3d6c3ba6",o,!0,{})}}]);