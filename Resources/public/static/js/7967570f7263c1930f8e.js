(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[12],{"1IYm":function(e,t,n){},"2VZv":function(e,t,n){var s=n("1IYm");s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,n("P8hj").default)("0d852806",s,!0,{})},"9p8q":function(e,t,n){"use strict";n.r(t);var s=n("c1oF"),i=n.n(s),a=n("6lmj"),r=n.n(a),o=n("CsSd"),d=n.n(o),l=n("7yzw"),c=n.n(l),u=n("92Mt"),h=n.n(u),m=(n("2VZv"),n("LSHN"));function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=Shopware.Mixin,g=Shopware.Data.Criteria,k=Shopware.Utils.types,w=Shopware.Utils.array,v=w.intersectionBy,_=w.chunk,S=w.uniqBy;t.default={template:'\n{% block sw_bulk_edit_order %}\n<sw-page class="sw-bulk-edit-order">\n    \n    {% block sw_bulk_edit_order_search_bar %}\n    <template #search-bar>\n\n        <sw-search-bar />\n\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_bulk_edit_order_smart_bar_header %}\n    <template #smart-bar-header>\n\n        <h2>{{ $tc(\'sw-bulk-edit.order.textTitle\', selectedIds.length, { orderTotal: selectedIds.length }) }}</h2>\n\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_bulk_edit_order_content_smart_bar_actions %}\n    <template #smart-bar-actions>\n\n        \n        {% block sw_bulk_edit_order_actions_save %}\n        <sw-button-process\n            class="sw-bulk-edit-order__save-action"\n            variant="primary"\n            :is-loading="isLoading"\n            :process-success="false"\n            :disabled="isLoading || !hasChanges"\n            @click="openModal"\n        >\n            {{ $tc(\'sw-bulk-edit.applyChanges\') }}\n        </sw-button-process>\n        {% endblock %}\n\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_bulk_edit_order_content %}\n    <template #content>\n\n        <sw-card-view\n            v-if="selectedIds.length > 0 && isLoadedData"\n        >\n            <sw-card\n                v-if="restrictedFields.length"\n                class="sw-bulk-edit-order__restricted-fields"\n                position-identifier="sw-bulk-edit-order-restricted-fields"\n            >\n                <sw-alert\n                    :title="$tc(\'sw-bulk-edit.order.alertRestrictedFields.title\')"\n                    variant="warning"\n                >\n                    <span v-html="$tc(\'sw-bulk-edit.order.alertRestrictedFields.message\')"></span>\n                    <ul>\n                        <li\n                            v-for="(restrictedField, index) in restrictedFields"\n                            :key="index"\n                        >\n                            {{ $tc(`sw-bulk-edit.order.alertRestrictedFields.${restrictedField}`) }}\n                        </li>\n                    </ul>\n                </sw-alert>\n            </sw-card>\n\n            \n            {% block sw_bulk_edit_order_content_order_status_card %}\n            <sw-card\n                class="sw-bulk-edit-order-base__status"\n                position-identifier="sw-bulk-edit-order-status"\n                :title="$tc(\'sw-bulk-edit.order.status.cardTitle\')"\n                :is-loading="isLoading"\n            >\n                \n                {% block sw_bulk_edit_order_content_order_status_section %}\n                <sw-bulk-edit-change-type-field-renderer\n                    :form-fields="statusFormFields"\n                    :bulk-edit-data="bulkEditData"\n                    :entity="order"\n                />\n                {% endblock %}\n            </sw-card>\n            {% endblock %}\n\n            \n            {% block sw_bulk_edit_order_content_documents %}\n            <sw-card\n                class="sw-bulk-edit-order-base__documents"\n                position-identifier="sw-bulk-edit-order-documents"\n                :title="$tc(\'sw-bulk-edit.order.documents.cardTitle\')"\n                :is-loading="isLoading"\n            >\n                \n                {% block sw_bulk_edit_order_content_documents_content %}\n                <sw-bulk-edit-change-type-field-renderer\n                    :form-fields="documentsFormFields"\n                    :bulk-edit-data="bulkEditData"\n                    :entity="order"\n                    @change-value="onChangeDocument"\n                />\n                {% endblock %}\n            </sw-card>\n            {% endblock %}\n\n            \n            {% block sw_bulk_edit_order_tags_card %}\n            <sw-card\n                class="sw-bulk-edit-order-base__tags"\n                position-identifier="sw-bulk-edit-order-tags"\n                :title="$tc(\'sw-bulk-edit.order.tags.cardTitle\')"\n                :is-loading="isLoading"\n            >\n                \n                {% block sw_bulk_edit_order_tags %}\n                <sw-bulk-edit-change-type-field-renderer\n                    :form-fields="tagsFormFields"\n                    :bulk-edit-data="bulkEditData"\n                    :entity="order"\n                />\n                {% endblock %}\n            </sw-card>\n            {% endblock %}\n\n            \n            {% block sw_bulk_edit_order_custom_field_card %}\n            <sw-card\n                class="sw-bulk-edit-order-base__custom_fields"\n                position-identifier="sw-bulk-edit-order-custom-fields"\n                :title="$tc(\'sw-bulk-edit.order.customFields.cardTitle\')"\n                :is-loading="isLoading"\n            >\n                <sw-bulk-edit-custom-fields\n                    class="sw-bulk-edit__custom-fields"\n                    :sets="customFieldSets"\n                    @change="onCustomFieldsChange"\n                />\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n\n        \n        {% block sw_bulk_edit_order_empty_state %}\n        <sw-empty-state\n            v-if="selectedIds.length <= 0 && !isLoading"\n            :title="$tc(\'sw-bulk-edit.order.messageEmptyTitle\')"\n            :subline="$tc(\'sw-bulk-edit.order.messageEmptySubline\')"\n        />\n        {% endblock %}\n\n        \n        {% block sw_bulk_edit_order_save_modal %}\n        <router-view\n            :item-total="selectedIds.length"\n            :is-loading="isLoading"\n            :process-status="processStatus"\n            :bulk-edit-data="bulkEditData"\n            @modal-close="closeModal"\n            @bulk-save="onSave"\n        />\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["bulkEditApiFactory","repositoryFactory","feature","orderDocumentApiService"],mixins:[f.getByName("notification")],data:function(){return{isLoading:!1,isLoadedData:!1,bulkEditData:{},isStatusSelected:!1,isStatusMailsSelected:!1,orderStatus:[],transactionStatus:[],deliveryStatus:[],customFieldSets:[],itemsPerRequest:100,processStatus:"",order:{}}},metaInfo:function(){return{title:this.$createTitle()}},computed:{selectedIds:function(){return Shopware.State.get("shopwareApps").selectedIds},stateMachineStateRepository:function(){return this.repositoryFactory.create("state_machine_state")},orderRepository:function(){return this.repositoryFactory.create("order")},customFieldSetRepository:function(){return this.repositoryFactory.create("custom_field_set")},customFieldSetCriteria:function(){var e=new g(1,null);return e.addFilter(g.equals("relations.entityName","order")),e},hasChanges:function(){var e,t=null===(e=this.bulkEditData.customFields)||void 0===e?void 0:e.value,n=Object.values(this.bulkEditData).some((function(e){return e.isChanged})),s=!k.isEmpty(t)&&Object.keys(t).length>0;return n||s},restrictedFields:function(){var e=[];return"1"===this.$route.params.excludeDelivery&&(e=e.concat(["orderDeliveries"])),e},statusFormFields:function(){var e,t=this;return[{name:"orderTransactions",config:{componentName:"sw-single-select",changeLabel:this.$tc("sw-bulk-edit.order.status.payment.label"),entity:"state_machine_state",placeholder:this.$tc("sw-bulk-edit.order.status.payment.placeholder"),options:this.transactionStatus}},{name:"orderDeliveries",config:{componentName:"sw-single-select",changeLabel:this.$tc("sw-bulk-edit.order.status.shipping.label"),entity:"state_machine_state",placeholder:this.$tc("sw-bulk-edit.order.status.shipping.placeholder"),options:this.deliveryStatus}},{name:"orders",config:{componentName:"sw-single-select",changeLabel:this.$tc("sw-bulk-edit.order.status.order.label"),entity:"state_machine_state",placeholder:this.$tc("sw-bulk-edit.order.status.order.placeholder"),options:this.orderStatus}},{name:"statusMails",labelHelpText:this.$tc("sw-bulk-edit.order.status.statusMails.helpText"),config:{hidden:!0,changeLabel:this.$tc("sw-bulk-edit.order.status.statusMails.label")}},{name:"documents",labelHelpText:this.$tc("sw-bulk-edit.order.status.documents.helpText"),config:{componentName:"sw-bulk-edit-order-documents",changeLabel:this.$tc("sw-bulk-edit.order.status.documents.label"),documents:null===(e=this.bulkEditData)||void 0===e?void 0:e.documents}}].filter((function(e){return!t.restrictedFields.includes(e.name)}))},documentsFormFields:function(){return[{name:"invoice",labelHelpText:this.$tc("sw-bulk-edit.order.documents.generateInvoice.helpText"),config:{componentName:"sw-bulk-edit-order-documents-generate-invoice",changeLabel:this.$tc("sw-bulk-edit.order.documents.generateInvoice.label")}},{name:"storno",labelHelpText:this.$tc("sw-bulk-edit.order.documents.generateCancellationInvoice.helpText"),config:{componentName:"sw-bulk-edit-order-documents-generate-cancellation-invoice",changeLabel:this.$tc("sw-bulk-edit.order.documents.generateCancellationInvoice.label"),changeSubLabel:this.$tc("sw-bulk-edit.order.documents.generateCancellationInvoice.changeSubLabel")}},{name:"delivery_note",labelHelpText:this.$tc("sw-bulk-edit.order.documents.generateDeliveryNote.helpText"),config:{componentName:"sw-bulk-edit-order-documents-generate-delivery-note",changeLabel:this.$tc("sw-bulk-edit.order.documents.generateDeliveryNote.label")}},{name:"credit_note",labelHelpText:this.$tc("sw-bulk-edit.order.documents.generateCreditNote.helpText"),config:{componentName:"sw-bulk-edit-order-documents-generate-credit-note",changeLabel:this.$tc("sw-bulk-edit.order.documents.generateCreditNote.label"),changeSubLabel:this.$tc("sw-bulk-edit.order.documents.generateCreditNote.changeSubLabel")}},{name:"download",labelHelpText:this.$tc("sw-bulk-edit.order.documents.downloadDocuments.helpText"),config:{componentName:"sw-bulk-edit-order-documents-download-documents",changeLabel:this.$tc("sw-bulk-edit.order.documents.downloadDocuments.label")}}]},tagsFormFields:function(){return[{name:"tags",config:{componentName:"sw-entity-tag-select",entityCollection:this.order.tags,allowOverwrite:!0,allowClear:!0,allowAdd:!0,allowRemove:!0,changeLabel:this.$tc("sw-bulk-edit.order.tags.changeLabel"),placeholder:this.$tc("sw-bulk-edit.order.tags.placeholder")}}]}},watch:{bulkEditData:{handler:function(e){var t=e.orders,n=e.orderTransactions,s=e.orderDeliveries,i=e.statusMails;this.isStatusSelected=t.isChanged&&t.value||n.isChanged&&n.value||(null==s?void 0:s.isChanged)&&s.value,this.isStatusMailsSelected=i.isChanged},deep:!0},isStatusSelected:function(){this.isStatusSelected||(this.bulkEditData.statusMails.isChanged=!1),this.bulkEditData.statusMails.disabled=!this.isStatusSelected},isStatusMailsSelected:function(){this.isStatusMailsSelected||(this.bulkEditData.documents.isChanged=!1),this.bulkEditData.documents.disabled=!this.isStatusMailsSelected}},beforeCreate:function(){Shopware.State.registerModule("swBulkEdit",m.a)},created:function(){this.createdComponent()},beforeDestroy:function(){Shopware.State.unregisterModule("swBulkEdit")},methods:{createdComponent:function(){var e=this;return c()(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setRouteMetaModule(),e.isLoading=!0,e.order=e.orderRepository.create(Shopware.Context.api),t.next=5,Promise.all([e.fetchStatusOptions("orders.id"),e.fetchStatusOptions("orderTransactions.orderId"),e.fetchStatusOptions("orderDeliveries.orderId"),e.loadCustomFieldSets()]);case 5:e.isLoading=!1,e.isLoadedData=!0,e.loadBulkEditData();case 8:case"end":return t.stop()}}),t)})))()},setRouteMetaModule:function(){this.$set(this.$route.meta.$module,"color","#A092F0"),this.$set(this.$route.meta.$module,"icon","regular-shopping-bag")},loadBulkEditData:function(){var e=this;[this.statusFormFields,this.documentsFormFields,this.tagsFormFields].forEach((function(t){t.forEach((function(t){e.$set(e.bulkEditData,t.name,{isChanged:!1,type:"overwrite",value:null})}))})),this.$set(this.bulkEditData,"customFields",{type:"overwrite",value:null}),this.$set(this.bulkEditData,"statusMails",p(p({},this.bulkEditData.statusMails),{},{disabled:!0})),this.$set(this.bulkEditData,"documents",p(p({},this.bulkEditData.documents),{},{disabled:!0})),this.order.documents={documentType:{},skipSentDocuments:!0}},fetchStatusOptions:function(e){var t=this;return this.fetchStateMachineStates(e).then((function(e){return t.fetchToStateMachineTransitions(e)})).then((function(n){switch(e){case"orderTransactions.orderId":t.transactionStatus=n;break;case"orderDeliveries.orderId":t.deliveryStatus=n;break;default:t.orderStatus=n}})).catch((function(e){return t.createNotificationError({message:e})}))},fetchStateMachineStates:function(e){var t=this,n=_(this.selectedIds,this.itemsPerRequest),s=null;switch(e){case"orderTransactions.orderId":s="orderTransactions.orderVersionId";break;case"orderDeliveries.orderId":s="orderDeliveries.orderVersionId";break;default:s="orders.versionId"}var i=n.map((function(n){var i=new g(1,null);return i.addFilter(g.multi("AND",[g.equalsAny(e,n),g.equals(s,Shopware.Context.api.liveVersionId)])),t.stateMachineStateRepository.searchIds(i)}));return Promise.all(i).then((function(e){var t=[];return e.forEach((function(e){null!=e&&e.data&&(t=r()(e.data))})),t})).catch((function(e){return t.createNotificationError({message:e})}))},fetchToStateMachineTransitions:function(e){var t=this;return e.length?this.stateMachineStateRepository.search(this.toStateMachineStatesCriteria(e),Shopware.Context.api).then((function(e){if(!e.length)return[];var t=e.map((function(e){return null!=e&&e.fromStateMachineTransitions?e.fromStateMachineTransitions:null})).filter((function(e){return null!==e})),n=v.apply(void 0,r()(t).concat(["actionName"])).filter((function(e){return null==e?void 0:e.toStateMachineState}));return(n=S(n,(function(e){return e.toStateMachineState.technicalName}))).map((function(e){return{label:e.toStateMachineState.translated.name,value:e.actionName}}))})).catch((function(e){return t.createNotificationError({message:e})})):Promise.resolve([])},toStateMachineStatesCriteria:function(e){var t=new g(1,25);return t.addFilter(g.equalsAny("id",e)),t.addAssociation("fromStateMachineTransitions.toStateMachineState"),t},onProcessData:function(){var e=this,t={statusData:[],syncData:[]},n=["orderTransactions","orderDeliveries","orders"];return Object.entries(this.bulkEditData).forEach((function(s){var a=i()(s,2),r=a[0],o=a[1];if(o.isChanged||"customFields"===r&&o.value){var d={field:r,type:o.type,value:o.value};if(n.includes(r)){var l,c,u,h,m,b,p,f=null===(l=e.order)||void 0===l||null===(c=l.documents)||void 0===c?void 0:c.documentType;if(null!==(u=e.bulkEditData)&&void 0!==u&&null!==(h=u.documents)&&void 0!==h&&h.isChanged){var g=Object.keys(f).filter((function(e){return!0===f[e]}));g.length>0&&(d.documentTypes=g,d.skipSentDocuments=e.order.documents.skipSentDocuments)}d.sendMail=null===(m=e.bulkEditData)||void 0===m||null===(b=m.statusMails)||void 0===b?void 0:b.isChanged,d.value=null===(p=e.order)||void 0===p?void 0:p[r],t.statusData.push(d)}else"documents"!==r&&"statusMails"!==r&&t.syncData.push(d)}})),t},openModal:function(){this.$router.push({name:"sw.bulk.edit.order.save"})},closeModal:function(){this.$router.push({name:"sw.bulk.edit.order"})},onSave:function(){var e=this;this.isLoading=!0;var t=this.onProcessData(),n=t.statusData,s=t.syncData,i=this.bulkEditApiFactory.getHandler("order"),a=_(this.selectedIds,this.itemsPerRequest),r=[];return a.forEach((function(e){n.length&&r.push(i.bulkEditStatus(e,n)),s.length&&r.push(i.bulkEdit(e,s))})),Promise.all(r).then((function(){e.processStatus="success"})).catch((function(){e.processStatus="fail"})).finally((function(){e.isLoading=!1,e.getLatestOrderStatus().finally((function(){e.isLoading=!1}))}))},getLatestOrderStatus:function(){var e,t=[];return this.bulkEditData.orderTransactions.isChanged&&t.push(this.fetchStatusOptions("orderTransactions.order.id")),null!==(e=this.bulkEditData.orderDeliveries)&&void 0!==e&&e.isChanged&&t.push(this.fetchStatusOptions("orderDeliveries.order.id")),this.bulkEditData.orders.isChanged&&t.push(this.fetchStatusOptions("orders.id")),0===t.length?Promise.resolve():(this.isLoading=!0,Promise.all(t))},loadCustomFieldSets:function(){var e=this;return this.customFieldSetRepository.search(this.customFieldSetCriteria).then((function(t){e.customFieldSets=t}))},onCustomFieldsChange:function(e){this.bulkEditData.customFields.value=e},onChangeDocument:function(e,t){Shopware.State.commit("swBulkEdit/setOrderDocumentsIsChanged",{type:e,isChanged:t})}}}},LSHN:function(e,t,n){"use strict";var s=n("c1oF"),i=n.n(s);t.a={namespaced:!0,state:function(){var e=(new Date).toISOString();return{isFlowTriggered:!0,orderDocuments:{invoice:{isChanged:!1,value:{documentDate:e,documentComment:null}},storno:{isChanged:!1,value:{documentDate:e,documentComment:null}},delivery_note:{isChanged:!1,value:{custom:{deliveryDate:e,deliveryNoteDate:e},documentDate:e,documentComment:null}},credit_note:{isChanged:!1,value:{documentDate:e,documentComment:null}},download:{isChanged:!1,value:[]}}}},mutations:{setIsFlowTriggered:function(e,t){e.isFlowTriggered=t},setOrderDocumentsIsChanged:function(e,t){var n=t.type,s=t.isChanged;e.orderDocuments[n].isChanged=s},setOrderDocumentsValue:function(e,t){var n=t.type,s=t.value;e.orderDocuments[n].value=s}},getters:{documentTypeConfigs:function(e){var t=[];return Object.entries(e.orderDocuments).forEach((function(e){var n=i()(e,2),s=n[0],a=n[1];"download"!==s&&!0===a.isChanged&&t.push({fileType:"pdf",type:s,config:a.value})})),t}}}}}]);