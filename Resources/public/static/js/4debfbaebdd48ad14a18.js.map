{"version":3,"sources":["webpack:///./src/module/sw-product/component/sw-product-seo-form/index.js","webpack:///./src/module/sw-product/component/sw-product-seo-form/sw-product-seo-form.html.twig"],"names":["Mixin","Shopware","Criteria","Data","_Shopware$Component$g","Component","getComponentHelper","mapPropertyErrors","mapState","mapGetters","template","inject","mixins","getByName","props","allowEdit","type","Boolean","required","default","data","variants","searchTerm","canonicalProductSwitchEnabled","switchStateHasBeenSet","shouldKeepSelectValue","selectValue","computed","_objectSpread","productRepository","this","repositoryFactory","create","hasParent","parentProduct","id","hasVariants","product","childCount","variantCriteria","criteria","addAssociation","addFilter","equals","setTerm","split","filter","term","forEach","addQuery","contains","isCanonicalUrlSelectLoading","length","variantsWithResetOption","unshift","name","$tc","watch","handler","value","undefined","immediate","fetchVariants","isEnabled","canonicalProductId","isLoading","methods","_this","search","then","getItemName","item","translated","onSearch","_this2","$refs","canonicalProductSelect","results","$nextTick","resetActiveItem"],"mappings":"wtBAMA,IAAQA,EAAUC,SAAVD,MACAE,EAAaD,SAASE,KAAtBD,SACRE,EAAoDH,SAASI,UAAUC,qBAA/DC,EAAiBH,EAAjBG,kBAAmBC,EAAQJ,EAARI,SAAUC,EAAUL,EAAVK,WAGtB,WACXC,SCZW,+2JDcXC,OAAQ,CACJ,qBAGJC,OAAQ,CACJZ,EAAMa,UAAU,gBAGpBC,MAAO,CACHC,UAAW,CACPC,KAAMC,QACNC,UAAU,EAGVC,SAAS,IAIjBC,KAAI,WACA,MAAO,CACHC,SAAU,GACVC,WAAY,GACZC,+BAA+B,EAC/BC,uBAAuB,EACvBC,uBAAuB,EACvBC,YAAa,OAIrBC,SAAQC,MAAA,CACJC,kBAAiB,WACb,OAAOC,KAAKC,kBAAkBC,OAAO,YAGzCC,UAAS,WACL,QAASH,KAAKI,cAAcC,IAGhCC,YAAW,WACP,OAAON,KAAKO,QAAQC,WAAa,GAGrCC,gBAAe,WACX,IAAMC,EAAW,IAAItC,EAAS,EAAG,KAEjCsC,EAASC,eAAe,iBAExBD,EAASE,UACLxC,EAASyC,OAAO,WAAYb,KAAKO,QAAQF,KAGzCL,KAAKR,cACLkB,EAASI,QAAQd,KAAKR,YAGRQ,KAAKR,WACduB,MAAM,KACNC,QAAO,SAAAC,GACJ,MAAgB,KAATA,KAGTC,SAAQ,SAAAD,GACVP,EAASS,SAAS/C,EAASyC,OAAO,uBAAwBI,GAAO,MACjEP,EAASS,SAAS/C,EAASgD,SAAS,uBAAwBH,GAAO,SAI3E,OAAOP,GAGXW,4BAA2B,WACvB,OAAOrB,KAAKT,SAAS+B,OAAS,GAGlCC,wBAAuB,WACnB,IAAMhC,EAAWS,KAAKT,SAOtB,OALAA,EAASiC,QAAQ,CACbnB,GAAI,KACJoB,KAAMzB,KAAK0B,IAAI,oDAGZnC,IAGRZ,EAAW,kBAAmB,CAC7B,eAGDD,EAAS,kBAAmB,CAC3B,UACA,mBAGDD,EAAkB,UAAW,CAC5B,WACA,kBACA,eAKRkD,MAAO,CACH,6BAA8B,CAC1BC,QAAO,SAACC,QAKUC,IAAVD,GAAuB7B,KAAKN,wBAIhCM,KAAKP,gCAAkCoC,EACvC7B,KAAKN,uBAAwB,IAEjCqC,WAAW,GAGf,aAAc,CAEVH,QAAS,SAAUC,GACVA,GAIL7B,KAAKgC,iBAETD,WAAW,GAGftC,8BAA6B,SAACwC,GAC1B,GAAKjC,KAAKL,sBAAV,CASA,GAAIsC,EAIA,OAHAjC,KAAKO,QAAQ2B,mBAAqBlC,KAAKJ,iBACvCI,KAAKJ,YAAc,MAKvBI,KAAKJ,YAAcI,KAAKO,QAAQ2B,mBAChClC,KAAKO,QAAQ2B,mBAAqB,UAhB9BlC,KAAKL,uBAAwB,GAmBrCwC,UAAS,SAACA,GACFA,IAIJnC,KAAKJ,YAAcI,KAAKO,QAAQ2B,sBAIxCE,QAAS,CACLJ,cAAa,WAAI,IAADK,EAAA,KACZ,OAAOrC,KAAKD,kBAAkBuC,OAAOtC,KAAKS,iBAAiB8B,MAAK,SAAAhD,GAG5D,OAFA8C,EAAK9C,SAAWA,EAETA,MAIfiD,YAAW,SAACC,GACR,OAAKA,EAAKpC,GAIHoC,EAAKC,WAAWjB,MAAQzB,KAAKO,QAAQmC,WAAWjB,KAH5CgB,EAAKhB,MAMpBkB,SAAQ,SAACnD,GAAa,IAADoD,EAAA,KACjB5C,KAAKR,WAAaA,EAElBQ,KAAKgC,gBAAgBO,MAAK,SAAAhD,GACtBqD,EAAKC,MAAMC,uBAAuBC,QAAUxD,EAE5CqD,EAAKI,YAAYT,MAAK,WAClBK,EAAKC,MAAMC,uBAAuBG","file":"static/js/4debfbaebdd48ad14a18.js","sourcesContent":["/*\n * @package inventory\n */\n\nimport template from './sw-product-seo-form.html.twig';\n\nconst { Mixin } = Shopware;\nconst { Criteria } = Shopware.Data;\nconst { mapPropertyErrors, mapState, mapGetters } = Shopware.Component.getComponentHelper();\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    inject: [\n        'repositoryFactory',\n    ],\n\n    mixins: [\n        Mixin.getByName('placeholder'),\n    ],\n\n    props: {\n        allowEdit: {\n            type: Boolean,\n            required: false,\n            // TODO: Boolean props should only be opt in and therefore default to false\n            // eslint-disable-next-line vue/no-boolean-default\n            default: true,\n        },\n    },\n\n    data() {\n        return {\n            variants: [],\n            searchTerm: '',\n            canonicalProductSwitchEnabled: false,\n            switchStateHasBeenSet: false,\n            shouldKeepSelectValue: false,\n            selectValue: null,\n        };\n    },\n\n    computed: {\n        productRepository() {\n            return this.repositoryFactory.create('product');\n        },\n\n        hasParent() {\n            return !!this.parentProduct.id;\n        },\n\n        hasVariants() {\n            return this.product.childCount > 0;\n        },\n\n        variantCriteria() {\n            const criteria = new Criteria(1, 25);\n\n            criteria.addAssociation('options.group');\n\n            criteria.addFilter(\n                Criteria.equals('parentId', this.product.id),\n            );\n\n            if (this.searchTerm) {\n                criteria.setTerm(this.searchTerm);\n\n                // split search term by words\n                const terms = this.searchTerm\n                    .split(' ')\n                    .filter(term => {\n                        return term !== '';\n                    });\n\n                terms.forEach(term => {\n                    criteria.addQuery(Criteria.equals('product.options.name', term), 3500);\n                    criteria.addQuery(Criteria.contains('product.options.name', term), 500);\n                });\n            }\n\n            return criteria;\n        },\n\n        isCanonicalUrlSelectLoading() {\n            return this.variants.length < 1;\n        },\n\n        variantsWithResetOption() {\n            const variants = this.variants;\n\n            variants.unshift({\n                id: null,\n                name: this.$tc('sw-product.seoForm.placeholderCanonicalProduct'),\n            });\n\n            return variants;\n        },\n\n        ...mapGetters('swProductDetail', [\n            'isLoading',\n        ]),\n\n        ...mapState('swProductDetail', [\n            'product',\n            'parentProduct',\n        ]),\n\n        ...mapPropertyErrors('product', [\n            'keywords',\n            'metaDescription',\n            'metaTitle',\n        ]),\n    },\n\n\n    watch: {\n        'product.canonicalProductId': {\n            handler(value) {\n                /* Return if value is undefined or the switch state has been set the very first time.\n                 * The reason to return is that using `immediate` on this watcher the very first value is always `undefined`.\n                 * So when the product actually has a `canonicalProductId` the switch will be initially off instead off on.\n                 */\n                if (value === undefined || this.switchStateHasBeenSet) {\n                    return;\n                }\n\n                this.canonicalProductSwitchEnabled = !!value;\n                this.switchStateHasBeenSet = true;\n            },\n            immediate: true,\n        },\n\n        'product.id': {\n            // eslint-disable-next-line func-names\n            handler: function (value) {\n                if (!value) {\n                    return;\n                }\n\n                this.fetchVariants();\n            },\n            immediate: true,\n        },\n\n        canonicalProductSwitchEnabled(isEnabled) {\n            if (!this.shouldKeepSelectValue) {\n                this.shouldKeepSelectValue = true;\n\n                return;\n            }\n\n            /* When the switch state is false it saves the variant id internally.\n             * And when the switch is enabled and the value is not null it sets back the variant id.\n             */\n            if (isEnabled) {\n                this.product.canonicalProductId = this.selectValue;\n                this.selectValue = null;\n\n                return;\n            }\n\n            this.selectValue = this.product.canonicalProductId;\n            this.product.canonicalProductId = null;\n        },\n\n        isLoading(isLoading) {\n            if (isLoading) {\n                return;\n            }\n\n            this.selectValue = this.product.canonicalProductId;\n        },\n    },\n\n    methods: {\n        fetchVariants() {\n            return this.productRepository.search(this.variantCriteria).then(variants => {\n                this.variants = variants;\n\n                return variants;\n            });\n        },\n\n        getItemName(item) {\n            if (!item.id) {\n                return item.name;\n            }\n\n            return item.translated.name || this.product.translated.name;\n        },\n\n        onSearch(searchTerm) {\n            this.searchTerm = searchTerm;\n\n            this.fetchVariants().then(variants => {\n                this.$refs.canonicalProductSelect.results = variants;\n\n                this.$nextTick().then(() => {\n                    this.$refs.canonicalProductSelect.resetActiveItem();\n                });\n            });\n        },\n    },\n};\n","export default \"\\n{% block sw_product_seo_form %}\\n<div class=\\\"sw-product-seo-form\\\">\\n    \\n    {% block sw_product_seo_form_meta_title %}\\n    <sw-inherit-wrapper\\n        {% if VUE3 %}\\n        v-model:value=\\\"product.metaTitle\\\"\\n        {% else %}\\n        v-model=\\\"product.metaTitle\\\"\\n        {% endif %}\\n        :has-parent=\\\"hasParent\\\"\\n        :label=\\\"$tc('sw-product.seoForm.labelMetaTitle')\\\"\\n        :help-text=\\\"$tc('sw-product.seoForm.helpTextMetaTitle')\\\"\\n        :inherited-value=\\\"parentProduct.metaTitle\\\"\\n    >\\n        <template #content=\\\"props\\\">\\n            <sw-text-field\\n                :placeholder=\\\"$tc('sw-product.seoForm.placeholderMetaTitle')\\\"\\n                :error=\\\"productMetaTitleError\\\"\\n                :disabled=\\\"props.isInherited || !allowEdit\\\"\\n                :value=\\\"props.currentValue\\\"\\n                @change=\\\"props.updateCurrentValue\\\"\\n            />\\n        </template>\\n    </sw-inherit-wrapper>\\n    {% endblock %}\\n\\n    \\n    {% block sw_product_seo_form_meta_description %}\\n    <sw-inherit-wrapper\\n        {% if VUE3 %}\\n        v-model:value=\\\"product.metaDescription\\\"\\n        {% else %}\\n        v-model=\\\"product.metaDescription\\\"\\n        {% endif %}\\n        :has-parent=\\\"hasParent\\\"\\n        :label=\\\"$tc('sw-product.seoForm.labelMetaDescription')\\\"\\n        :help-text=\\\"$tc('sw-product.seoForm.helpTextMetaDescription')\\\"\\n        :inherited-value=\\\"parentProduct.metaDescription\\\"\\n    >\\n        <template #content=\\\"props\\\">\\n            <sw-textarea-field\\n                :placeholder=\\\"$tc('sw-product.seoForm.placeholderMetaDescription')\\\"\\n                :error=\\\"productMetaDescriptionError\\\"\\n                :disabled=\\\"props.isInherited || !allowEdit\\\"\\n                :value=\\\"props.currentValue\\\"\\n                @change=\\\"props.updateCurrentValue\\\"\\n            />\\n        </template>\\n    </sw-inherit-wrapper>\\n    {% endblock %}\\n\\n    \\n    {% block sw_product_seo_form_keywords %}\\n    <sw-inherit-wrapper\\n        {% if VUE3 %}\\n        v-model:value=\\\"product.keywords\\\"\\n        {% else %}\\n        v-model=\\\"product.keywords\\\"\\n        {% endif %}\\n        :has-parent=\\\"hasParent\\\"\\n        :label=\\\"$tc('sw-product.seoForm.labelKeywords')\\\"\\n        :help-text=\\\"$tc('sw-product.seoForm.helpTextKeywords')\\\"\\n        :inherited-value=\\\"parentProduct.keywords\\\"\\n    >\\n        <template #content=\\\"props\\\">\\n            <sw-text-field\\n                :placeholder=\\\"$tc('sw-product.seoForm.placeholderKeywords')\\\"\\n                :error=\\\"productKeywordsError\\\"\\n                :disabled=\\\"props.isInherited || !allowEdit\\\"\\n                :value=\\\"props.currentValue\\\"\\n                @change=\\\"props.updateCurrentValue\\\"\\n            />\\n        </template>\\n    </sw-inherit-wrapper>\\n    {% endblock %}\\n\\n    \\n    {% block sw_product_seo_form_canonical_url %}\\n    <template v-if=\\\"!hasParent && hasVariants\\\">\\n\\n        \\n        {% block sw_product_seo_form_canonical_url_switch %}\\n        <sw-switch-field\\n            {% if VUE3 %}\\n            v-model:value=\\\"canonicalProductSwitchEnabled\\\"\\n            {% else %}\\n            v-model=\\\"canonicalProductSwitchEnabled\\\"\\n            {% endif %}\\n            :label=\\\"$tc('sw-product.seoForm.labelCanonicalUrlMode')\\\"\\n        />\\n        {% endblock %}\\n\\n        \\n        {% block sw_product_seo_form_canonical_url_select %}\\n        <sw-single-select\\n            ref=\\\"canonicalProductSelect\\\"\\n            {% if VUE3 %}\\n            v-model:value=\\\"product.canonicalProductId\\\"\\n            {% else %}\\n            v-model=\\\"product.canonicalProductId\\\"\\n            {% endif %}\\n            :options=\\\"variants\\\"\\n            :disabled=\\\"!canonicalProductSwitchEnabled\\\"\\n            value-property=\\\"id\\\"\\n            :label=\\\"$tc('sw-product.seoForm.labelCanonicalProduct')\\\"\\n            :placeholder=\\\"$tc('sw-product.seoForm.placeholderCanonicalProduct')\\\"\\n            show-clearable-button\\n            @search=\\\"onSearch\\\"\\n        >\\n\\n            <template #selection-label-property=\\\"{ item }\\\">\\n                \\n                {% block sw_product_seo_form_canonical_url_select_selection %}\\n                <sw-product-variant-info\\n                    :variations=\\\"item.variation\\\"\\n                    :show-tooltip=\\\"false\\\"\\n                >\\n                    {{ getItemName(item) }}\\n                </sw-product-variant-info>\\n                {% endblock %}\\n            </template>\\n\\n            <template #result-label-property=\\\"{ item }\\\">\\n                \\n                {% block sw_product_seo_form_canonical_url_select_result %}\\n                <sw-product-variant-info\\n                    :variations=\\\"item.variation\\\"\\n                    :show-tooltip=\\\"false\\\"\\n                >\\n                    {{ getItemName(item) }}\\n                </sw-product-variant-info>\\n                {% endblock %}\\n            </template>\\n        </sw-single-select>\\n        {% endblock %}\\n    </template>\\n    {% endblock %}\\n</div>\\n{% endblock %}\\n\";"],"sourceRoot":""}