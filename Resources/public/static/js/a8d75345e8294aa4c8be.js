(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[95249],{46766:function(){},995249:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}}),s(602799);let{Criteria:n}=Shopware.Data;var o={template:'\n{% block sw_bulk_edit_save_modal_success %}\n<div class="sw-bulk-edit-save-modal-success">\n    \n    {% block sw_bulk_edit_save_modal_success_icon %}\n    <sw-label\n        class="sw-bulk-edit-save-modal__icon"\n        appearance="pill"\n        variant="success"\n    >\n        <sw-icon\n            name="regular-check-circle"\n            size="30px"\n        />\n    </sw-label>\n    {% endblock %}\n\n    \n    {% block sw_bulk_edit_save_modal_error_content %}\n    <p\n        class="sw-bulk-edit-save-modal__help-text"\n        v-html="description"\n    >\n    </p>\n    {% endblock %}\n\n    \n    {% block sw_bulk_edit_save_modal_success_download_document %}\n    <ul\n        v-if="selectedDocumentTypes.length > 0"\n        class="sw-bulk-edit-save-modal-success__download-document-container"\n    >\n        <li\n            v-for="selectedDocumentType in selectedDocumentTypes"\n            :key="selectedDocumentType.id"\n            class="sw-bulk-edit-save-modal-success__download-document"\n            :class="`is--${selectedDocumentType.technicalName}`"\n        >\n            <span class="label">\n                {{ selectedDocumentType.translated.name }}\n            </span>\n            <sw-button\n                class="action"\n                size="small"\n                :disabled="document[selectedDocumentType.technicalName].isDownloading"\n                @click="downloadDocument(selectedDocumentType.technicalName)"\n            >\n                {{ $tc(\'sw-bulk-edit.modal.success.buttonDownload\') }}\n            </sw-button>\n        </li>\n    </ul>\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","orderDocumentApiService"],mixins:[Shopware.Mixin.getByName("notification")],data(){return{latestDocuments:{},document:{invoice:{isDownloading:!1},storno:{isDownloading:!1},delivery_note:{isDownloading:!1},credit_note:{isDownloading:!1}}}},computed:{documentRepository(){return this.repositoryFactory.create("document")},selectedIds(){return Shopware.State.get("shopwareApps").selectedIds},downloadOrderDocuments(){return Shopware.State.get("swBulkEdit")?.orderDocuments?.download},latestDocumentsCriteria(){let e=new n(1,null);return e.addFilter(n.equalsAny("documentTypeId",this.selectedDocumentTypes.map(e=>e.id))),e.addFilter(n.equalsAny("orderId",this.selectedIds)),e.addSorting(n.sort("createdAt","DESC")),e},selectedDocumentTypes(){return this.downloadOrderDocuments&&this.downloadOrderDocuments.isChanged&&!(this.downloadOrderDocuments.value.length<=0)?this.downloadOrderDocuments.value.filter(e=>e.selected):[]},description(){return this.selectedDocumentTypes.length>0?this.$tc("sw-bulk-edit.modal.success.instruction"):this.$tc("sw-bulk-edit.modal.success.description")}},created(){this.createdComponent()},methods:{async createdComponent(){this.updateButtons(),this.setTitle(),await this.getLatestDocuments()},setTitle(){this.$emit("title-set",this.$tc("sw-bulk-edit.modal.success.title"))},updateButtons(){let e=[{key:"close",label:this.$tc("global.sw-modal.labelClose"),position:"right",variant:"primary",action:"",disabled:!1}];this.$emit("buttons-update",e)},async getLatestDocuments(){if(this.selectedDocumentTypes.length<=0)return;let e={},t=this.selectedIds.length,s=await this.documentRepository.search(this.latestDocumentsCriteria);this.selectedDocumentTypes.forEach(n=>{e[n.technicalName]??=[];let o=e[n.technicalName],c=s.filter(e=>e.documentTypeId===n.id),a={};c.forEach(e=>{Object.values(o).length!==t&&(a.hasOwnProperty(e.orderId)||(a[e.orderId]=e.id,o.push(e.id)))})}),this.latestDocuments=e},downloadDocument(e){let t=this.latestDocuments[e];return t&&0!==t.length?(this.$set(this.document[e],"isDownloading",!0),this.orderDocumentApiService.download(t).then(e=>{if(!e.data)return;let t=e.headers["content-disposition"].split("filename=")[1],s=document.createElement("a");s.href=URL.createObjectURL(e.data),s.download=t,s.dispatchEvent(new MouseEvent("click")),s.remove()}).catch(e=>{this.createNotificationError({message:e.message})}).finally(()=>{this.$set(this.document[e],"isDownloading",!1)})):(this.createNotificationInfo({message:this.$tc("sw-bulk-edit.modal.success.messageNoDocumentsFound")}),Promise.resolve())}}}},602799:function(e,t,s){var n=s(46766);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),s(745346).Z("2a0ba73a",n,!0,{})}}]);