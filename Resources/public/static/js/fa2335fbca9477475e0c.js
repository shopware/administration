(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[52655],{50407:function(){},52655:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return a}}),n(97074);let{Mixin:t,Context:o}=Shopware,{isEmpty:d}=Shopware.Utils.types;var a={template:'\n{% block sw_media_upload_v2 %}\n<div\n    class="sw-media-upload-v2 sw-product-variants-media-upload"\n    :class="{ \'is--disabled\': disabled }"\n>\n    \n    {% block sw_product_variants_media_upload_content %}\n    <div class="sw-media-upload-v2__content">\n        \n        {% block sw_product_variants_media_upload_drop_zone %}\n        <div\n            ref="dropzone"\n            class="sw-media-upload-v2__dropzone"\n        >\n            <div class="sw-product-variants-media-upload__preview-images">\n                \n                {% block sw_product_variants_media_upload_cover_preview %}\n                <div\n                    v-if="product.cover || cover"\n                    class="sw-product-variants-media-upload__preview-cover"\n                >\n                    \n                    {% block sw_product_variants_media_upload_cover_image %}\n                    <sw-media-preview-v2\n                        class="sw-product-variants-media-upload__cover-image"\n                        :source="coverImageSource"\n                    />\n                    {% endblock %}\n                </div>\n                <div\n                    v-else-if="source.media.length > 0"\n                    class="sw-product-variants-media-upload__preview-cover"\n                >\n                    \n                    {% block sw_product_variants_media_upload_cover_image_empty %}\n                    <sw-media-preview-v2\n                        class="sw-product-variants-media-upload__cover-image"\n                        :source="null"\n                    />\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                \n                {% block sw_product_variants_media_upload_preview %}\n                <div\n                    class="sw-product-variants-media-upload__images"\n                    :class="{ \'is--compact--button\': mediaSource.length > 2 }"\n                >\n                    <div\n                        v-for="(item, index) in mediaSource"\n                        :key="index"\n                        class="sw-product-variants-media-upload__image"\n                    >\n                        \n                        {% block ssw_product_variants_media_upload_content_preview_file %}\n                        <sw-media-preview-v2\n                            :key="item.id"\n                            class="sw-media-upload-v2__preview"\n                            :class="{ \'is--cover\': isCover(item), \'is--disabled\': disabled }"\n                            :source="item.media && item.productId ? item.media : item.mediaId"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_product_variants_media_upload_action_buttons %}\n                        <sw-context-button\n                            class="sw-product-variants-media-upload__context-button"\n                            :disabled="disabled"\n                        >\n                            \n                            {% block sw_product_variants_media_upload_context %}\n                            \n                            {% block sw_product_variants_media_upload_context_cover_action %}\n                            <sw-context-menu-item\n                                v-if="!isCover(item)"\n                                @click="markMediaAsCover(item)"\n                            >\n                                {{ $tc(\'global.sw-product-image.context.buttonAsCover\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            \n                            {% block sw_product_variants_media_upload_context_preview_action %}\n                            <sw-context-menu-item @click="previewMedia(item)">\n                                {{ $tc(\'global.sw-product-image.context.buttonPreviewImage\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            \n                            {% block sw_product_variants_media_upload_context_delete_action %}\n                            <sw-context-menu-item\n                                variant="danger"\n                                @click="removeMedia(item)"\n                            >\n                                {{ $tc(\'global.sw-product-image.context.buttonRemove\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n                            {% endblock %}\n                        </sw-context-button>\n                        {% endblock %}\n                    </div>\n                </div>\n                {% endblock %}\n            </div>\n            \n            {% block sw_product_variants_media_upload_actions %}\n            <div class="sw-media-upload-v2__actions">\n                \n                {% block sw_product_variants_media_upload_actions_regular %}\n                <div\n                    v-if="mediaSource.length <= 2"\n                    class="sw-product-variants-media-upload__regular-button"\n                >\n                    \n                    {% block sw_product_variants_media_upload_actions_regular_upload_button %}\n                    <sw-button\n                        class="sw-media-upload-v2__button upload"\n                        :disabled="disabled"\n                        variant="ghost"\n                        size="small"\n                        @click="onClickUpload"\n                    >\n                        {{ $tc(\'global.sw-media-upload-v2.buttonFilesUpload\') }}\n                    </sw-button>\n                    {% endblock %}\n\n                    \n                    {% block sw_product_variants_media_upload_actions_regular_open_button %}\n                    <sw-button\n                        variant="primary"\n                        :disabled="disabled"\n                        class="sw-product-variants-media-upload__browse-button"\n                        @click="showMediaModal = true"\n                    >\n                        <sw-icon\n                            class="sw-product-variants-media-upload__browse-icon"\n                            name="regular-image"\n                        />\n                    </sw-button>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                \n                {% block sw_product_variants_media_upload_actions_compact %}\n                <div\n                    v-else\n                    class="sw-product-variants-media-upload__compact-button"\n                >\n                    <sw-button\n                        variant="primary"\n                        :disabled="disabled"\n                        class="sw-product-variants-media-upload__browse-button"\n                    >\n                        <sw-icon\n                            class="sw-product-variants-media-upload__browse-icon"\n                            name="regular-plus"\n                        />\n                    </sw-button>\n                    <sw-context-button\n                        class="sw-product-variants-media-upload__context-button"\n                        :disabled="disabled"\n                    >\n                        \n                        {% block sw_product_variants_media_upload_actions_compact_button_context %}\n                        \n                        {% block sw_product_variants_media_upload_actions_compact_button_context_upload_action %}\n                        <sw-context-menu-item @click="onClickUpload">\n                            {{ $tc(\'global.sw-media-upload-v2.buttonFilesUpload\') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n\n                        \n                        {% block sw_product_variants_media_upload_actions_compact_button_context_open_action %}\n                        <sw-context-menu-item @click="showMediaModal = true">\n                            {{ $tc(\'global.sw-media-upload-v2.buttonOpenMedia\') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n                        {% endblock %}\n                    </sw-context-button>\n                </div>\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </div>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_file_input %}\n    <form\n        ref="fileForm"\n        class="sw-media-upload-v2__form"\n    >\n        \n        <input\n            :key="source.id"\n            ref="fileInput"\n            class="sw-media-upload-v2__file-input"\n            type="file"\n            :accept="fileAccept"\n            :multiple="multiSelect"\n            @change="onFileInputChange"\n        >\n    </form>\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_actions_media_modal %}\n    <sw-media-modal-v2\n        v-if="showMediaModal"\n        :initial-folder-id="mediaDefaultFolderId"\n        :entity-context="product.getEntityName()"\n        @modal-close="showMediaModal = false"\n        @media-modal-selection-change="onAddMedia"\n    />\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_listener %}\n    <sw-upload-listener\n        auto-upload\n        :upload-tag="uploadTag"\n        @media-upload-finish="onUploadMediaSuccessful"\n        @media-upload-fail="onUploadMediaFailed"\n    />\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_preview_modal %}\n    <sw-image-preview-modal\n        v-if="showPreviewModal"\n        :active-item-id="activeItemId"\n        :media-items="mediaSource"\n        @modal-close="onClosePreviewModal"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","mediaDefaultFolderService"],mixins:[t.getByName("notification")],props:{source:{type:Object,required:!0},parentProduct:{type:Object,required:!0},isInherited:{type:Boolean,required:!1,default:!1}},data(){return{showMediaModal:!1,mediaDefaultFolderId:null,showPreviewModal:!1,activeItemId:null}},computed:{productMediaRepository(){return this.repositoryFactory.create(this.source.media.entity)},product(){return this.isInherited?this.parentProduct:this.source},mediaSource(){return this.product?[...this.product.media].sort((e,i)=>e.position-i.position):[]},cover(){return this.product?this.product.media.find(e=>e.id===this.product.coverId):null},coverImageSource(){return this.cover?this.cover.media??this.cover.mediaId:this.product?.cover?.mediaId??this.product?.cover?.media}},created(){this.createdComponent()},methods:{createdComponent(){this.getMediaDefaultFolderId().then(e=>{this.mediaDefaultFolderId=e,this.updateMediaItemPositions()}).catch(()=>{this.mediaDefaultFolderId=null})},getMediaDefaultFolderId(){return this.mediaDefaultFolderService.getDefaultFolderId("product")},isCover(e){let i=this.product.cover?this.product.cover.id:this.product.coverId;return 0!==this.product.media.length&&e.id===i},markMediaAsCover(e){this.product.cover=e,this.product.coverId=e.id},removeMedia(e){this.product.coverId===e.id&&(this.product.cover=null,this.product.coverId=null),null===this.product.coverId&&this.product.media.length>0&&(this.product.coverId=this.product.media.first().id),this.product.media.remove(e.id)},onAddMedia(e){d(e)||(e.forEach(e=>{this.addMedia(e).catch(({fileName:e})=>{this.createNotificationError({message:this.$tc("sw-product.mediaForm.errorMediaItemDuplicated",0,{fileName:e})})})}),this.updateMediaItemPositions())},addMedia(e){if(this.isExistingMedia(e))return Promise.reject(e);let i=this.productMediaRepository.create(o.api);return i.mediaId=e.id,i.media={url:e.url,id:e.id},d(this.source.media)&&(this.source.cover=i,this.source.coverId=i.id),this.source.media.add(i),Promise.resolve()},isExistingMedia(e){return this.source.media.some(({id:i,mediaId:n})=>i===e.id||n===e.id)},onUploadMediaSuccessful({targetId:e}){if(this.isReplacedMedia(e))return;let i=this.productMediaRepository.create(o.api);i.productId=this.source.id,i.mediaId=e,d(this.source.media)?(i.position=0,this.source.coverId=i.id):i.position=this.source.media.length,this.source.media.add(i),this.updateMediaItemPositions()},isReplacedMedia(e){return this.source.media.find(i=>i.mediaId===e)},onUploadMediaFailed({targetId:e}){let i=this.source.media.find(i=>i.mediaId===e);i&&(this.source.coverId===i.id&&(this.source.coverId=null),this.source.media.remove(i.id)),this.source.isLoading=!1},previewMedia(e){this.activeItemId=e.id,this.showPreviewModal=!0},onClosePreviewModal(){this.activeItemId=null,this.showPreviewModal=!1},updateMediaItemPositions(){this.source.media.forEach((e,i)=>{e.position=i})}}}},97074:function(e,i,n){var t=n(50407);t.__esModule&&(t=t.default),"string"==typeof t&&(t=[[e.id,t,""]]),t.locals&&(e.exports=t.locals),n(45346).Z("25b9b9ae",t,!0,{})}}]);