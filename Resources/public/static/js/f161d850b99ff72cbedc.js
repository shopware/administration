(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[376],{"/ADE":function(e,n,i){var t=i("pkL5");t.__esModule&&(t=t.default),"string"==typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);(0,i("P8hj").default)("021cbdcb",t,!0,{})},km0x:function(e,n,i){"use strict";i.r(n);var t=i("6lmj"),o=i.n(t),d=(i("/ADE"),Shopware),a=d.Mixin,c=d.Context,s=Shopware.Utils.types.isEmpty;n.default={template:'\n{% block sw_media_upload_v2 %}\n<div\n    class="sw-media-upload-v2 sw-product-variants-media-upload"\n    :class="{ \'is--disabled\': disabled }"\n>\n    \n    {% block sw_product_variants_media_upload_content %}\n    <div class="sw-media-upload-v2__content">\n        \n        {% block sw_product_variants_media_upload_drop_zone %}\n        <div\n            ref="dropzone"\n            class="sw-media-upload-v2__dropzone"\n        >\n            <div class="sw-product-variants-media-upload__preview-images">\n                \n                {% block sw_product_variants_media_upload_cover_preview %}\n                <div\n                    v-if="product.cover || cover"\n                    class="sw-product-variants-media-upload__preview-cover"\n                >\n                    \n                    {% block sw_product_variants_media_upload_cover_image %}\n                    <sw-media-preview-v2\n                        class="sw-product-variants-media-upload__cover-image"\n                        :source="coverImageSource"\n                    />\n                    {% endblock %}\n                </div>\n                <div\n                    v-else-if="source.media.length > 0"\n                    class="sw-product-variants-media-upload__preview-cover"\n                >\n                    \n                    {% block sw_product_variants_media_upload_cover_image_empty %}\n                    <sw-media-preview-v2\n                        class="sw-product-variants-media-upload__cover-image"\n                        :source="null"\n                    />\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                \n                {% block sw_product_variants_media_upload_preview %}\n                <div\n                    class="sw-product-variants-media-upload__images"\n                    :class="{ \'is--compact--button\': mediaSource.length > 2 }"\n                >\n                    <div\n                        v-for="(item, index) in mediaSource"\n                        :key="index"\n                        class="sw-product-variants-media-upload__image"\n                    >\n                        \n                        {% block ssw_product_variants_media_upload_content_preview_file %}\n                        <sw-media-preview-v2\n                            :key="item.id"\n                            class="sw-media-upload-v2__preview"\n                            :class="{ \'is--cover\': isCover(item), \'is--disabled\': disabled }"\n                            :source="item.media && item.productId ? item.media : item.mediaId"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_product_variants_media_upload_action_buttons %}\n                        <sw-context-button\n                            class="sw-product-variants-media-upload__context-button"\n                            :disabled="disabled"\n                        >\n                            \n                            {% block sw_product_variants_media_upload_context %}\n                            \n                            {% block sw_product_variants_media_upload_context_cover_action %}\n                            <sw-context-menu-item\n                                v-if="!isCover(item)"\n                                @click="markMediaAsCover(item)"\n                            >\n                                {{ $tc(\'global.sw-product-image.context.buttonAsCover\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            \n                            {% block sw_product_variants_media_upload_context_preview_action %}\n                            <sw-context-menu-item @click="previewMedia(item)">\n                                {{ $tc(\'global.sw-product-image.context.buttonPreviewImage\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            \n                            {% block sw_product_variants_media_upload_context_delete_action %}\n                            <sw-context-menu-item\n                                variant="danger"\n                                @click="removeMedia(item)"\n                            >\n                                {{ $tc(\'global.sw-product-image.context.buttonRemove\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n                            {% endblock %}\n                        </sw-context-button>\n                        {% endblock %}\n                    </div>\n                </div>\n                {% endblock %}\n            </div>\n            \n            {% block sw_product_variants_media_upload_actions %}\n            <div class="sw-media-upload-v2__actions">\n                \n                {% block sw_product_variants_media_upload_actions_regular %}\n                <div\n                    v-if="mediaSource.length <= 2"\n                    class="sw-product-variants-media-upload__regular-button"\n                >\n                    \n                    {% block sw_product_variants_media_upload_actions_regular_upload_button %}\n                    <sw-button\n                        class="sw-media-upload-v2__button upload"\n                        :disabled="disabled"\n                        variant="ghost"\n                        size="small"\n                        @click="onClickUpload"\n                    >\n                        {{ $tc(\'global.sw-media-upload-v2.buttonFilesUpload\') }}\n                    </sw-button>\n                    {% endblock %}\n\n                    \n                    {% block sw_product_variants_media_upload_actions_regular_open_button %}\n                    <sw-button\n                        variant="primary"\n                        :disabled="disabled"\n                        class="sw-product-variants-media-upload__browse-button"\n                        @click="showMediaModal = true"\n                    >\n                        <sw-icon\n                            class="sw-product-variants-media-upload__browse-icon"\n                            name="regular-image"\n                        />\n                    </sw-button>\n                    {% endblock %}\n                </div>\n                {% endblock %}\n\n                \n                {% block sw_product_variants_media_upload_actions_compact %}\n                <div\n                    v-else\n                    class="sw-product-variants-media-upload__compact-button"\n                >\n                    <sw-button\n                        variant="primary"\n                        :disabled="disabled"\n                        class="sw-product-variants-media-upload__browse-button"\n                    >\n                        <sw-icon\n                            class="sw-product-variants-media-upload__browse-icon"\n                            name="regular-plus"\n                        />\n                    </sw-button>\n                    <sw-context-button\n                        class="sw-product-variants-media-upload__context-button"\n                        :disabled="disabled"\n                    >\n                        \n                        {% block sw_product_variants_media_upload_actions_compact_button_context %}\n                        \n                        {% block sw_product_variants_media_upload_actions_compact_button_context_upload_action %}\n                        <sw-context-menu-item @click="onClickUpload">\n                            {{ $tc(\'global.sw-media-upload-v2.buttonFilesUpload\') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n\n                        \n                        {% block sw_product_variants_media_upload_actions_compact_button_context_open_action %}\n                        <sw-context-menu-item @click="showMediaModal = true">\n                            {{ $tc(\'global.sw-media-upload-v2.buttonOpenMedia\') }}\n                        </sw-context-menu-item>\n                        {% endblock %}\n                        {% endblock %}\n                    </sw-context-button>\n                </div>\n                {% endblock %}\n            </div>\n            {% endblock %}\n        </div>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_file_input %}\n    <form\n        ref="fileForm"\n        class="sw-media-upload-v2__form"\n    >\n        \n        <input\n            :key="source.id"\n            ref="fileInput"\n            class="sw-media-upload-v2__file-input"\n            type="file"\n            :accept="fileAccept"\n            :multiple="multiSelect"\n            @change="onFileInputChange"\n        >\n    </form>\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_actions_media_modal %}\n    <sw-media-modal-v2\n        v-if="showMediaModal"\n        :initial-folder-id="mediaDefaultFolderId"\n        :entity-context="product.getEntityName()"\n        @modal-close="showMediaModal = false"\n        @media-modal-selection-change="onAddMedia"\n    />\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_listener %}\n    <sw-upload-listener\n        auto-upload\n        :upload-tag="uploadTag"\n        @media-upload-finish="onUploadMediaSuccessful"\n        @media-upload-fail="onUploadMediaFailed"\n    />\n    {% endblock %}\n\n    \n    {% block sw_product_variants_media_upload_preview_modal %}\n    <sw-image-preview-modal\n        v-if="showPreviewModal"\n        :active-item-id="activeItemId"\n        :media-items="mediaSource"\n        @modal-close="onClosePreviewModal"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","mediaDefaultFolderService"],mixins:[a.getByName("notification")],props:{source:{type:Object,required:!0},parentProduct:{type:Object,required:!0},isInherited:{type:Boolean,required:!1,default:!1}},data:function(){return{showMediaModal:!1,mediaDefaultFolderId:null,showPreviewModal:!1,activeItemId:null}},computed:{productMediaRepository:function(){return this.repositoryFactory.create(this.source.media.entity)},product:function(){return this.isInherited?this.parentProduct:this.source},mediaSource:function(){return this.product?o()(this.product.media).sort((function(e,n){return e.position-n.position})):[]},cover:function(){if(!this.product)return null;var e=this.product.cover?this.product.cover.mediaId:this.product.coverId;return this.product.media.find((function(n){return n.id===e}))},coverImageSource:function(){var e,n,i,t,o,d;return this.cover?null!==(d=this.cover.media)&&void 0!==d?d:this.cover.mediaId:null!==(e=null===(n=this.product)||void 0===n||null===(i=n.cover)||void 0===i?void 0:i.mediaId)&&void 0!==e?e:null===(t=this.product)||void 0===t||null===(o=t.cover)||void 0===o?void 0:o.media}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;this.getMediaDefaultFolderId().then((function(n){e.mediaDefaultFolderId=n,e.updateMediaItemPositions()})).catch((function(){e.mediaDefaultFolderId=null}))},getMediaDefaultFolderId:function(){return this.mediaDefaultFolderService.getDefaultFolderId("product")},isCover:function(e){var n=this.product.cover?this.product.cover.id:this.product.coverId;return 0!==this.product.media.length&&e.id===n},markMediaAsCover:function(e){this.product.cover=e,this.product.coverId=e.id},removeMedia:function(e){this.product.coverId===e.id&&(this.product.cover=null,this.product.coverId=null),null===this.product.coverId&&this.product.media.length>0&&(this.product.coverId=this.product.media.first().id),this.product.media.remove(e.id)},onAddMedia:function(e){var n=this;s(e)||(e.forEach((function(e){n.addMedia(e).catch((function(e){var i=e.fileName;n.createNotificationError({message:n.$tc("sw-product.mediaForm.errorMediaItemDuplicated",0,{fileName:i})})}))})),this.updateMediaItemPositions())},addMedia:function(e){if(this.isExistingMedia(e))return Promise.reject(e);var n=this.productMediaRepository.create(c.api);return n.mediaId=e.id,n.media={url:e.url,id:e.id},s(this.source.media)&&(this.source.cover=n,this.source.coverId=n.id),this.source.media.add(n),Promise.resolve()},isExistingMedia:function(e){return this.source.media.some((function(n){var i=n.id,t=n.mediaId;return i===e.id||t===e.id}))},onUploadMediaSuccessful:function(e){var n=e.targetId;if(!this.isReplacedMedia(n)){var i=this.productMediaRepository.create(c.api);i.productId=this.source.id,i.mediaId=n,s(this.source.media)?(i.position=0,this.source.coverId=i.id):i.position=this.source.media.length,this.source.media.add(i),this.updateMediaItemPositions()}},isReplacedMedia:function(e){return this.source.media.find((function(n){return n.mediaId===e}))},onUploadMediaFailed:function(e){var n=e.targetId,i=this.source.media.find((function(e){return e.mediaId===n}));i&&(this.source.coverId===i.id&&(this.source.coverId=null),this.source.media.remove(i.id)),this.source.isLoading=!1},previewMedia:function(e){this.activeItemId=e.id,this.showPreviewModal=!0},onClosePreviewModal:function(){this.activeItemId=null,this.showPreviewModal=!1},updateMediaItemPositions:function(){this.source.media.forEach((function(e,n){e.position=n}))}}}},pkL5:function(e,n,i){}}]);