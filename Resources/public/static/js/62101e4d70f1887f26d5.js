(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[331],{DOjU:function(e,t,o){"use strict";o.r(t);var n=o("CsSd"),i=o.n(n);o("m/t6");function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var a=Shopware.Component,d=Shopware.Data.ChangesetGenerator,c=a.getComponentHelper().mapState;t.default={template:'\n{% block sw_order_promotion_field %}\n<div class="sw-order-promotion-field">\n\n    \n    {% block sw_order_promotion_field_codes %}\n    <sw-order-promotion-tag-field\n        {% if VUE3 %}\n        v-model:value="promotionCodeTags"\n        {% else %}\n        v-model="promotionCodeTags"\n        {% endif %}\n        :disabled="!hasLineItem || isLoading || !acl.can(\'order_line_item.editor\')"\n        :currency="currency"\n        :label="$tc(\'sw-order.detailsTab.promotionsField.labelPromotions\')"\n        :placeholder="$tc(\'sw-order.detailsTab.promotionsField.placeholderPromotions\')"\n        :error="promotionError"\n        @on-remove-code="onRemoveExistingCode"\n    />\n    {% endblock %}\n\n    \n    {% block sw_order_promotion_field_switch %}\n    <sw-switch-field\n        {% if VUE3 %}\n        v-model:value="disabledAutoPromotions"\n        {% else %}\n        v-model="disabledAutoPromotions"\n        {% endif %}\n        :disabled="isLoading || !acl.can(\'order_line_item.editor\')"\n        :label="$tc(\'sw-order.detailsTab.promotionsField.labelToggleAutomaticPromotions\')"\n    />\n    {% endblock %}\n\n</div>\n{% endblock %}\n',inject:["repositoryFactory","orderService","acl"],mixins:["notification"],props:{isLoading:{type:Boolean,required:!1,default:!1}},data:function(){return{promotionError:null,disabledAutoPromotions:!1}},computed:s(s({},c("swOrderDetail",["order","versionContext"])),{},{orderLineItemRepository:function(){return this.repositoryFactory.create("order_line_item")},hasLineItem:function(){return this.order.lineItems.filter((function(e){return e.hasOwnProperty("id")})).length>0},currency:function(){return this.order.currency},manualPromotions:function(){return this.order.lineItems.filter((function(e){return"promotion"===e.type&&null!==e.referencedId}))},automaticPromotions:function(){return this.order.lineItems.filter((function(e){return"promotion"===e.type&&null===e.referencedId}))},promotionCodeTags:{get:function(){return this.manualPromotions.map((function(e){return e.payload}))},set:function(e){var t=this.manualPromotions;if(this.promotionError=null,!(e.length<t.length)){var o=t.length,n=e[o];e.length>t.length&&this.onSubmitCode(n.code),o>0&&n.isInvalid&&(this.promotionError={detail:this.$tc("sw-order.createBase.textInvalidPromotionCode")})}}},hasAutomaticPromotions:function(){return this.automaticPromotions.length>0},changesetGenerator:function(){return new d},hasOrderUnsavedChanges:function(){return null!==this.changesetGenerator.generate(this.order).changes}}),watch:{disabledAutoPromotions:function(e,t){t!==this.hasAutomaticPromotions&&this.toggleAutomaticPromotions(e)},automaticPromotions:function(){this.disabledAutoPromotions=!this.hasAutomaticPromotions}},created:function(){this.createdComponent()},methods:{createdComponent:function(){this.disabledAutoPromotions=!this.hasAutomaticPromotions},deleteAutomaticPromotions:function(){var e=this;return 0===this.automaticPromotions.length?Promise.resolve():this.orderLineItemRepository.syncDeleted(this.automaticPromotions.map((function(e){return e.id})),this.versionContext).then((function(){e.automaticPromotions.forEach((function(t){e.createNotificationSuccess({message:e.$tc("sw-order.detailBase.textPromotionRemoved",0,{promotion:t.label})})}))})).catch((function(t){e.$emit("loading-change",!1),e.$emit("error",t)}))},toggleAutomaticPromotions:function(e){var t=this;if(this.$emit("loading-change",!0),this.hasOrderUnsavedChanges)return this.$emit("loading-change",!1),this.handleUnsavedOrderChangesResponse(),void this.$nextTick((function(){t.disabledAutoPromotions=!e}));this.deleteAutomaticPromotions().then((function(){return t.orderService.toggleAutomaticPromotions(t.order.id,t.order.versionId,e)})).then((function(e){t.handlePromotionResponse(e),t.$emit("reload-entity-data")})).catch((function(e){t.$emit("loading-change",!1),t.$emit("error",e)}))},onSubmitCode:function(e){var t=this;if(this.$emit("loading-change",!0),this.hasOrderUnsavedChanges)return this.$emit("loading-change",!1),void this.handleUnsavedOrderChangesResponse();this.orderService.addPromotionToOrder(this.order.id,this.order.versionId,e).then((function(e){t.handlePromotionResponse(e),t.$emit("reload-entity-data")})).catch((function(e){t.$emit("loading-change",!1),t.$emit("error",e)}))},handlePromotionResponse:function(e){var t=this;Object.values(e.data.errors).forEach((function(e){switch(e.level){case 0:t.createNotificationSuccess({message:e.message});break;case 10:t.createNotificationWarning({message:e.message});break;default:t.createNotificationError({message:e.message})}}))},handleUnsavedOrderChangesResponse:function(){this.createNotificationWarning({message:this.$tc("sw-order.detailBase.textUnsavedChanges",0)})},onRemoveExistingCode:function(e){var t=this;if(this.$emit("loading-change",!0),this.hasOrderUnsavedChanges)return this.$emit("loading-change",!1),void this.handleUnsavedOrderChangesResponse();var o=this.order.lineItems.find((function(t){return"promotion"===t.type&&t.payload.code===e.code}));this.orderLineItemRepository.delete(o.id,this.versionContext).then((function(){t.$emit("reload-entity-data")})).catch((function(e){t.$emit("loading-change",!1),t.$emit("error",e)}))},getLineItemByPromotionCode:function(e){return this.order.lineItems.find((function(t){return"promotion"===t.type&&t.payload.code===e}))}}}},hjWP:function(e,t,o){},"m/t6":function(e,t,o){var n=o("hjWP");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,o("P8hj").default)("8e361e16",n,!0,{})}}]);
//# sourceMappingURL=62101e4d70f1887f26d5.js.map