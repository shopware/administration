(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[305],{EsKw:function(e,t,n){"use strict";n.r(t);var i=n("c1oF"),r=n.n(i),a=n("7yzw"),s=n.n(a),o=n("6lmj"),l=n.n(o),d=n("92Mt"),c=n.n(d),m=(n("LrWo"),Shopware),u=m.Mixin,p=m.Context,f=Shopware.Data.Criteria;t.default={template:'\n{% block sw_media_library %}\n<div class="sw-media-library">\n    \n    {% block sw_media_library_display_options %}\n    <div class="sw-media-library__options-container">\n        <sw-media-display-options\n            class="sw-media-library__display-options"\n            :presentation="presentation"\n            :sorting="sorting"\n            :hide-presentation="compact"\n            @media-presentation-change="presentation = $event"\n            @media-sorting-change="sorting = $event"\n        />\n\n        \n        {% block sw_media_index_create_folder %}\n        <sw-button\n            v-if="editable"\n            v-tooltip="{\n                message: $tc(\'sw-privileges.tooltip.warning\'),\n                disabled: acl.can(\'media.creator\'),\n                showOnDisabledElements: true\n            }"\n            :disabled="!acl.can(\'media.creator\')"\n            class="sw-media-index__create-folder-action"\n            variant="ghost"\n            size="small"\n            @click="createFolder"\n        >\n            {{ $tc(\'sw-media.index.buttonCreateFolder\') }}\n        </sw-button>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_media_library_scroll_container %}\n    <div\n        ref="scrollContainer"\n        class="sw-media-library__scroll-container"\n    >\n        <div class="sw-media-library__scroll-content">\n\n            \n            {% block sw_media_library_media_grid %}\n            <sw-media-grid\n                ref="mediaGrid"\n                class="sw-media-library_media-grid"\n                :presentation="gridPresentation"\n                @media-grid-selection-clear="clearSelection"\n            >\n\n                \n                {% block sw_media_library_back_to_parent_item %}\n                <sw-media-folder-item\n                    v-if="parentFolder && (!isLoading || selectableItems.length > 0)"\n                    :allow-edit="acl.can(\'media.editor\')"\n                    :allow-delete="acl.can(\'media.deleter\')"\n                    class="sw-media-library__parent-folder"\n                    :item="parentFolder"\n                    :show-selection-indicator="false"\n                    :show-context-menu-button="false"\n                    :allow-multi-select="allowMultiSelect"\n                    :is-list="showItemsAsList"\n                    is-parent\n                    @media-item-click="goToParentFolder"\n                />\n                {% endblock %}\n\n                \n                {% block sw_media_library_media_item_list %}\n                <sw-media-entity-mapper\n                    v-for="(gridItem, index) in selectableItems"\n                    :key="gridItem.getEntityName() + \'_\' + gridItem.id"\n                    :class="`sw-media-grid-item__item--${index}`"\n                    :item="gridItem"\n                    :allow-edit="acl.can(\'media.editor\')"\n                    :allow-delete="acl.can(\'media.deleter\')"\n                    :selected="showItemSelected(gridItem)"\n                    :show-selection-indicator="isListSelect"\n                    :show-context-menu-button="editable"\n                    :is-list="showItemsAsList"\n                    :editable="editable"\n                    :allow-multi-select="allowMultiSelect"\n                    @media-item-replaced="refreshList"\n                    @media-item-delete="refreshList"\n                    @media-folder-delete="refreshList"\n                    @media-folder-remove="removeNewFolder"\n                    @media-folder-dissolve="refreshList"\n                    @media-folder-move="refreshList"\n                    @media-folder-changed="refreshList"\n                    v-on="mediaItemSelectionHandler"\n                />\n                {% endblock %}\n\n                <template v-if="isLoading">\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                    <sw-skeleton variant="media" />\n                </template>\n\n                \n                {% block sw_media_library_load_more_button %}\n                <sw-button\n                    v-if="showLoadMoreButton"\n                    class="sw-media-library__load-more-button"\n                    @click="loadNextItems"\n                >\n                    {{ $tc(\'sw-media.mediaLibrary.labelButtonLoadMore\') }}\n                </sw-button>\n                {% endblock %}\n            </sw-media-grid>\n            {% endblock %}\n        </div>\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_media_library_empty_state %}\n    <sw-empty-state\n        v-if="shouldDisplayEmptyState"\n        :title="$tc(\'sw-empty-state.messageNoResultTitle\')"\n    >\n        <template #icon>\n            <img\n                :src="assetFilter(\'/administration/static/img/empty-states/media-empty-state.svg\')"\n                :alt="$tc(\'sw-empty-state.messageNoResultSubline\')"\n            >\n        </template>\n\n        <template #default>\n            {{ $tc(\'sw-empty-state.messageNoResultSublineBefore\') }}\n            <router-link\n                class="sw-empty-state__description-link"\n                :to="{ name: \'sw.profile.index.searchPreferences\' }"\n            >\n                {{ $tc(\'sw-empty-state.messageNoResultSublineLink\') }}\n            </router-link>\n            {{ $tc(\'sw-empty-state.messageNoResultSublineAfter\') }}\n        </template>\n    </sw-empty-state>\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","acl","searchRankingService","feature"],mixins:[u.getByName("media-grid-listener")],model:{prop:"selection",event:"media-selection-change"},props:{selection:{type:Array,required:!0},folderId:{type:String,required:!1,default:null},pendingUploads:{type:Array,required:!1,default:function(){return[]}},limit:{type:Number,required:!1,default:25,validValues:[1,5,25,50,100,500],validator:function(e){return[1,5,25,50,100,500].includes(e)}},term:{type:String,required:!1,default:""},compact:{type:Boolean,required:!1,default:!1},editable:{type:Boolean,required:!1,default:!1},allowMultiSelect:{type:Boolean,required:!1,default:!0}},data:function(){return{isLoading:!1,selectedItems:this.selection,pageItem:1,pageFolder:1,itemLoaderDone:!1,folderLoaderDone:!1,items:[],subFolders:[],currentFolder:null,parentFolder:null,presentation:"medium-preview",sorting:{sortBy:"fileName",sortDirection:"asc"},folderSorting:{sortBy:"name",sortDirection:"asc"}}},computed:{shouldDisplayEmptyState:function(){return!this.isLoading&&(0===this.selectableItems.length||this.isValidTerm(this.term)&&0===this.selectableItems.length)},mediaRepository:function(){return this.repositoryFactory.create("media")},mediaFolderRepository:function(){return this.repositoryFactory.create("media_folder")},mediaFolderConfigurationRepository:function(){return this.repositoryFactory.create("media_folder_configuration")},selectableItems:function(){return[].concat(l()(this.subFolders),l()(this.pendingUploads),l()(this.items))},rootFolder:function(){var e=this.mediaFolderRepository.create(p.api);return e.id="",e.name=this.$tc("sw-media.index.rootFolderName"),e},gridPresentation:function(){return this.compact?"list-preview":this.presentation},showItemsAsList:function(){return"list-preview"===this.gridPresentation},showLoadMoreButton:function(){return!this.isLoading&&!this.shouldDisplayEmptyState&&!(this.itemLoaderDone&&this.folderLoaderDone)},nextMediaCriteria:function(){var e=new f(this.pageItem,this.limit);return e.addSorting(f.sort(this.sorting.sortBy,this.sorting.sortDirection)).setTerm(this.term),["tags","productMedia.product","categories","productManufacturers.products","mailTemplateMedia.mailTemplate","documentBaseConfigs","avatarUsers","paymentMethods","shippingMethods","cmsBlocks.section.page","cmsSections.page","cmsPages"].forEach((function(t){var n=t.split(".");e.addAssociation(t);var i=null;n.forEach((function(t){i=i?"".concat(i,".").concat(t):t,e.getAssociation(i).setLimit(25)}))})),e},nextFoldersCriteria:function(){var e=new f(this.pageFolder,this.limit).addSorting(f.sort(this.folderSorting.sortBy,this.folderSorting.sortDirection)).setTerm(this.term);return this.term||e.addFilter(f.equals("parentId",this.folderId)),e},assetFilter:function(){return Shopware.Filter.getByName("asset")}},watch:{selection:function(){this.selectedItems=this.selection,null===this.listSelectionStartItem||this.selectedItems.includes(this.listSelectionStartItem)||(this.listSelectionStartItem=this.selectedItems[0]||null)},selectedItems:function(){this.feature.isActive("VUE3")?this.$emit("update:selection",this.selectedItems):this.$emit("media-selection-change",this.selectedItems)},sorting:function(){this.mapFolderSorting(),this.refreshList()},folderId:function(){this.refreshList()},term:function(){this.refreshList()}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;this.refreshList(),this.allowMultiSelect||(this.handleMediaItemClicked=function(t){var n=t.item;e._singleSelect(n)},this.handleMediaGridItemSelected=function(){})},refreshList:function(){var e=this;return s()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==e.isLoading){t.next=2;break}return t.abrupt("return");case 2:return e.subFolders=[],e.items=[],e.isLoading=!0,e.clearSelection(),t.next=8,e.fetchAssociatedFolders();case 8:e.pageItem=1,e.pageFolder=1,e.itemLoaderDone=!1,e.folderLoaderDone=!1,e.loadItems();case 13:case"end":return t.stop()}}),t)})))()},isValidTerm:function(e){var t;return(null==e||null===(t=e.trim())||void 0===t?void 0:t.length)>1},loadNextItems:function(){!0!==this.isLoading&&(this.isLoading=!0,this.loadItems())},mapFolderSorting:function(){switch(this.sorting.sortBy){case"createdAt":this.folderSorting.sortBy="createdAt",this.folderSorting.sortDirection=this.sorting.sortDirection;break;case"fileName":this.folderSorting.sortBy="name",this.folderSorting.sortDirection=this.sorting.sortDirection;break;default:this.folderSorting.sortBy="name",this.folderSorting.sortDirection="asc"}},isLoaderDone:function(e,t){return e.limit>=t.total||e.limit>t.length},loadItems:function(){var e=this;return s()(c.a.mark((function t(){var n,i,a,s,o,d;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,Promise.allSettled([e.nextFolders(),e.nextMedia()]);case 3:n=t.sent,i=r()(n,2),a=i[0],"fulfilled"===(s=i[1]).status?(o=e.items).push.apply(o,l()(s.value)):e.itemLoaderDone=!1,"fulfilled"===a.status?(d=e.subFolders).push.apply(d,l()(a.value)):e.folderLoaderDone=!1,e.isLoading=!1;case 10:case"end":return t.stop()}}),t)})))()},nextMedia:function(){var e=this;return s()(c.a.mark((function t(){var n,i,r;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.itemLoaderDone){t.next=2;break}return t.abrupt("return",[]);case 2:if(n=e.nextMediaCriteria,!e.isValidTerm(e.term)){t.next=12;break}return t.next=6,e.searchRankingService.getSearchFieldsByEntity("media");case 6:if((i=t.sent)&&!(Object.keys(i).length<1)){t.next=11;break}return e.isLoading=!1,e.itemLoaderDone=!0,t.abrupt("return",[]);case 11:n=e.searchRankingService.buildSearchQueriesForEntity(i,e.term,n);case 12:return e.isValidTerm(e.term)||n.addFilter(f.equals("mediaFolderId",e.folderId)),null!=e.folderId&&e.isValidTerm(e.term)&&n.addFilter(f.multi("OR",[f.equals("mediaFolderId",e.folderId),f.contains("mediaFolder.path",e.folderId)])),t.next=16,e.mediaRepository.search(n,p.api);case 16:return r=t.sent,e.itemLoaderDone=e.isLoaderDone(n,r),e.pageItem+=1,t.abrupt("return",r);case 20:case"end":return t.stop()}}),t)})))()},nextFolders:function(){var e=this;return s()(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.folderLoaderDone){t.next=2;break}return t.abrupt("return",[]);case 2:return t.next=4,e.mediaFolderRepository.search(e.nextFoldersCriteria,p.api);case 4:return n=t.sent,e.folderLoaderDone=e.isLoaderDone(e.nextFoldersCriteria,n),e.pageFolder+=1,t.abrupt("return",n);case 8:case"end":return t.stop()}}),t)})))()},fetchAssociatedFolders:function(){var e=this;return s()(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==e.folderId){t.next=4;break}return e.currentFolder=null,e.parentFolder=null,t.abrupt("return");case 4:return t.next=6,e.mediaFolderRepository.get(e.folderId,p.api);case 6:if(e.currentFolder=t.sent,!e.currentFolder||!e.currentFolder.parentId){t.next=13;break}return t.next=10,e.mediaFolderRepository.get(e.currentFolder.parentId,p.api);case 10:e.parentFolder=t.sent,t.next=14;break;case 13:e.parentFolder=e.rootFolder;case 14:case"end":return t.stop()}}),t)})))()},goToParentFolder:function(){this.$emit("media-folder-change",this.parentFolder.id||null)},clearSelection:function(){this.selectedItems=[],this.listSelectionStartItem=null},injectItem:function(e){if("media"!==e.getEntityName())throw new Error("Injected entity has to be of 'type media'");this.injectMedia(e)},injectMedia:function(e){e.mediaFolderId===this.folderId&&(this.items.some((function(t){return t.id===e.id}))||this.items.unshift(e))},createFolder:function(){var e=this;return s()(c.a.mark((function t(){var n,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.mediaFolderRepository.create(p.api)).parentId=e.folderId,n.name="",null===e.folderId){t.next=8;break}n.configurationId=e.currentFolder.configurationId,n.useParentConfiguration=!0,t.next=16;break;case 8:return(i=e.mediaFolderConfigurationRepository.create(p.api)).createThumbnails=!0,i.keepProportions=!0,i.thumbnailQuality=80,t.next=14,e.mediaFolderConfigurationRepository.save(i,p.api);case 14:n.configurationId=i.id,n.useParentConfiguration=!1;case 16:e.subFolders.unshift(n);case 17:case"end":return t.stop()}}),t)})))()},removeNewFolder:function(){this.subFolders.shift()}}}},LrWo:function(e,t,n){var i=n("Upn8");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,n("P8hj").default)("e1189400",i,!0,{})},Upn8:function(e,t,n){}}]);