(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[493],{"9w34":function(e,t,r){"use strict";r.r(t);var s=r("7yzw"),n=r.n(s),a=r("CsSd"),o=r.n(a),i=r("92Mt"),c=r.n(i),u=r("PMCM");function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m=Shopware.Component.getComponentHelper().mapPropertyErrors,p=Shopware.Classes.ShopwareError,h=Shopware.Mixin,f=Shopware.Data.Criteria;t.default={template:'{%  block sw_customer_create %}\n<sw-page class="sw-customer-create">\n\n    \n    {% block sw_customer_create_header %}\n    <template #smart-bar-header>\n        <h2>{{ salutationFilter(customer, $tc(\'sw-customer.general.newCustomer\')) }}</h2>\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_customer_create_language_switch %}\n    <template #language-switch>\n        <sw-language-switch\n            v-tooltip="{ message: $tc(\'sw-customer.general.tooltipLanguageSwitch\') }"\n            disabled\n        />\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_customer_create_actions %}\n    <template #smart-bar-actions>\n        <sw-button-process\n            class="sw-customer-create__save-action"\n            :is-loading="isLoading"\n            :disabled="isLoading"\n            :process-success="isSaveSuccessful"\n            variant="primary"\n            {% if VUE3 %}\n            @update:process-success="saveFinish"\n            {% else %}\n            @process-finish="saveFinish"\n            {% endif %}\n            @click.prevent="onSave"\n        >\n            {{ $tc(\'sw-customer.detail.buttonSave\') }}\n        </sw-button-process>\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_customer_create_content %}\n    <template #content>\n        <sw-card-view>\n            \n            {% block sw_customer_create_base_form %}\n            <sw-card\n                :title="$tc(\'sw-customer.detailBase.labelAccountCard\')"\n                position-identifier="sw-customer-create-base-form"\n            >\n                <sw-customer-base-form\n                    v-if="customer"\n                    :is-loading="isLoading"\n                    :customer="customer"\n                    @sales-channel-change="onChangeSalesChannel"\n                />\n            </sw-card>\n            {% endblock %}\n\n            \n            {% block sw_customer_create_adress_form %}\n            <sw-card\n                :title="$tc(\'sw-customer.detailBase.labelAddressesCard\')"\n                position-identifier="sw-customer-create-address-form"\n            >\n                <sw-customer-address-form\n                    v-if="customer"\n                    v-bind="{ customer, address }"\n                />\n            </sw-card>\n            {% endblock %}\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n{% endblock %}\n',inject:["repositoryFactory","numberRangeService","systemConfigApiService","customerValidationService"],mixins:[h.getByName("notification")],data:function(){return{customer:null,address:null,customerNumberPreview:"",isSaveSuccessful:!1,salesChannels:null,isLoading:!1,errorEmailCustomer:null,defaultMinPasswordLength:null}},computed:l(l({},m("address",["company"])),{},{customerRepository:function(){return this.repositoryFactory.create("customer")},validCompanyField:function(){var e;return this.customer.accountType!==u.a.ACCOUNT_TYPE_BUSINESS||(null===(e=this.address.company)||void 0===e?void 0:e.trim().length)},validPasswordField:function(){var e;return(null===(e=this.customer.password)||void 0===e?void 0:e.trim().length)>=this.defaultMinPasswordLength},languageRepository:function(){return this.repositoryFactory.create("language")},languageCriteria:function(){var e,t=new f;return t.setLimit(1),null!==(e=this.customer)&&void 0!==e&&e.salesChannelId&&t.addFilter(f.equals("salesChannelDefaultAssignments.id",this.customer.salesChannelId)),t},languageId:function(){var e;return this.loadLanguage(null===(e=this.customer)||void 0===e?void 0:e.salesChannelId)},salutationRepository:function(){return this.repositoryFactory.create("salutation")},salutationCriteria:function(){var e=new f(1,1);return e.addFilter(f.equals("salutationKey","not_specified")),e},salutationFilter:function(){return Shopware.Filter.getByName("salutation")}}),watch:{"customer.salesChannelId":function(e){var t=this;this.systemConfigApiService.getValues("core.systemWideLoginRegistration").then((function(r){r["core.systemWideLoginRegistration.isCustomerBoundToSalesChannel"]&&(t.customer.boundSalesChannelId=e)}))},"customer.accountType":function(e){e!==u.a.ACCOUNT_TYPE_BUSINESS&&this.addressCompanyError&&Shopware.State.dispatch("error/removeApiError",{expression:"customer_address.".concat(this.address.id,".company")})}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;return n()(c.a.mark((function t(){var r,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getDefaultSalutation();case 2:r=t.sent,Shopware.State.commit("context/resetLanguageToDefault"),e.customer=e.customerRepository.create(),s=e.repositoryFactory.create(e.customer.addresses.entity,e.customer.addresses.source),e.customer.accountType=u.a.ACCOUNT_TYPE_PRIVATE,e.address=s.create(),e.customer.addresses.add(e.address),e.customer.defaultBillingAddressId=e.address.id,e.customer.defaultShippingAddressId=e.address.id,e.customer.password="",e.customer.vatIds=[],e.customer.salutationId=r,e.address.salutationId=r;case 15:case"end":return t.stop()}}),t)})))()},saveFinish:function(){this.isSaveSuccessful=!1,this.$router.push({name:"sw.customer.detail",params:{id:this.customer.id}})},validateEmail:function(){var e=this,t=this.customer,r=t.id,s=t.email,n=t.boundSalesChannelId;return s?this.customerValidationService.checkCustomerEmail({id:r,email:s,boundSalesChannelId:n}).then((function(e){return e})).catch((function(t){Shopware.State.dispatch("error/addApiError",{expression:"customer.".concat(e.customer.id,".email"),error:new p(t.response.data.errors[0])})})):Promise.resolve({isValid:!0})},onSave:function(){var e=this;return n()(c.a.mark((function t(){var r,s,n,a,o;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,r=!1,t.next=4,e.validateEmail();case 4:if((s=t.sent)&&s.isValid||(r=!0),e.isSaveSuccessful=!1,n=Promise.resolve(),e.customerNumberPreview===e.customer.customerNumber&&(n=e.numberRangeService.reserve("customer",e.customer.salesChannelId).then((function(t){e.customerNumberPreview="reserved",e.customer.customerNumber=t.number}))),e.validCompanyField||(e.createErrorMessageForCompanyField(),r=!0),!r){t.next=14;break}return e.createNotificationError({message:e.$tc("sw-customer.detail.messageSaveError")}),e.isLoading=!1,t.abrupt("return",!1);case 14:return t.next=16,e.languageId;case 16:return a=t.sent,o=l(l({},Shopware.Context.api),{languageId:a}),t.abrupt("return",n.then((function(){return e.customerRepository.save(e.customer,o).then((function(t){return e.isLoading=!1,e.isSaveSuccessful=!0,t})).catch((function(){e.createNotificationError({message:e.$tc("sw-customer.detail.messageSaveError")}),e.isLoading=!1}))})));case 19:case"end":return t.stop()}}),t)})))()},onChangeSalesChannel:function(e){var t=this;this.customer.salesChannelId=e,this.numberRangeService.reserve("customer",e,!0).then((function(e){t.customerNumberPreview=e.number,t.customer.customerNumber=e.number}))},createErrorMessageForCompanyField:function(){this.isLoading=!1,Shopware.State.dispatch("error/addApiError",{expression:"customer_address.".concat(this.address.id,".company"),error:new Shopware.Classes.ShopwareError({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})}),this.createNotificationError({message:this.$tc("sw-customer.error.COMPANY_IS_REQUIRED")})},getDefaultRegistrationConfig:function(){var e=this;this.systemConfigApiService.getValues("core.register").then((function(t){e.defaultMinPasswordLength=t["core.register.minPasswordLength"]}))},loadLanguage:function(e){var t=this;return n()(c.a.mark((function r(){var s,n;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=Shopware.Context.api.languageId,e){r.next=3;break}return r.abrupt("return",s);case 3:return r.next=5,t.languageRepository.searchIds(t.languageCriteria);case 5:if(null!=(n=r.sent)&&n.data){r.next=8;break}return r.abrupt("return",s);case 8:return r.abrupt("return",n.data[0]);case 9:case"end":return r.stop()}}),r)})))()},getDefaultSalutation:function(){var e=this;return n()(c.a.mark((function t(){var r,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.salutationRepository.searchIds(e.salutationCriteria);case 2:return s=t.sent,t.abrupt("return",null===(r=s.data)||void 0===r?void 0:r[0]);case 4:case"end":return t.stop()}}),t)})))()}}}},PMCM:function(e,t,r){"use strict";t.a=Object.freeze({ACCOUNT_TYPE_PRIVATE:"private",ACCOUNT_TYPE_BUSINESS:"business"})}}]);