(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[53761],{19312:function(){},453761:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return r}});var t=n(86348);n(101561);var s={namespaced:!0,state(){return{shippingMethod:{},currencies:[]}},mutations:{setShippingMethod(e,i){e.shippingMethod=i},setCurrencies(e,i){e.currencies=i}},getters:{shippingPriceGroups(e){if(!e.shippingMethod.prices)return{};let i={};return e.shippingMethod.prices.forEach(e=>{let n=e.ruleId;e._inNewMatrix&&(n="new"),i[n]||(i[n]={isNew:"new"===n,ruleId:e.ruleId,rule:e.rule,calculation:e.calculation,prices:[]}),i[n].prices.push(e)}),Object.values(i).forEach(e=>{e.prices.sort((e,i)=>e.quantityStart-i.quantityStart)}),i},defaultCurrency(e){return e.currencies.find(e=>e.isSystemDefault)},usedRules(e,i){return Object.keys(i.shippingPriceGroups)},unrestrictedPriceMatrixExists(e){return e.shippingMethod.prices.some(e=>null===e.ruleId)},newPriceMatrixExists(e,i){return i.shippingPriceGroups.hasOwnProperty("new")}}};let{Mixin:a,Context:o}=Shopware,{mapState:l}=Shopware.Component.getComponentHelper(),{Criteria:d}=Shopware.Data,{warn:p}=Shopware.Utils.debug;var r={template:'\n\n{% block sw_settings_shipping_detail %}\n<sw-page class="sw-settings-shipping-detail">\n\n    \n    {% block sw_settings_shipping_detail_header %}\n    <template #smart-bar-header>\n        <h2>{{ placeholder(shippingMethod, \'name\', $tc(\'sw-settings-shipping.detail.textHeadline\')) }}</h2>\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_shipping_detail_actions %}\n    <template #smart-bar-actions>\n        \n        {% block sw_settings_shipping_detail_actions_abort %}\n        <sw-button\n            v-tooltip.bottom="tooltipCancel"\n            :disabled="isLoading || undefined"\n            @click="onCancel"\n        >\n            {{ $tc(\'sw-settings-shipping.detail.buttonCancel\') }}\n        </sw-button>\n        {% endblock %}\n\n        \n        {% block sw_settings_shipping_detail_actions_save %}\n        <sw-button-process\n            v-model:processSuccess="isSaveSuccessful"\n            v-tooltip.bottom="tooltipSave"\n            class="sw-settings-shipping-method-detail__save-action"\n            :is-loading="isProcessLoading"\n            :disabled="isProcessLoading || !acl.can(\'shipping.editor\') || undefined"\n            variant="primary"\n            @click.prevent="onSave"\n        >\n            {{ $tc(\'sw-settings-shipping.detail.buttonSave\') }}\n        </sw-button-process>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_shipping_detail_language_switch %}\n    <template #language-switch>\n        <sw-language-switch\n            :disabled="isNewShippingMethod || undefined"\n            :save-changes-function="saveOnLanguageChange"\n            :abort-change-function="abortOnLanguageChange"\n            @on-change="onChangeLanguage"\n        />\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_shipping_detail_content %}\n    <template #content>\n        <sw-card-view>\n            <template v-if="isLoading">\n                <sw-skeleton variant="detail-bold" />\n                <sw-skeleton />\n            </template>\n\n            <template v-else>\n                \n                {% block sw_settings_shipping_detail_content_language_info %}\n                <sw-language-info\n                    :is-new-entity="isNewShippingMethod"\n                    :entity-description="placeholder(shippingMethod, \'name\', $tc(\'sw-settings-shipping.detail.textHeadline\'))"\n                />\n                {% endblock %}\n\n                \n                {% block sw_settings_shipping_detail_base %}\n                <sw-card\n                    position-identifier="sw-settings-shipping-detail-base"\n                    :title="$tc(\'sw-settings-shipping.detail.labelBasicInfo\')"\n                    :is-loading="isLoading"\n                >\n                    <sw-container\n                        columns="3fr 3fr 1fr"\n                        gap="0px 30px"\n                    >\n                        \n                        {% block sw_settings_shipping_detail_base_content_field_name %}\n                        <sw-text-field\n                            v-model:value="shippingMethod.name"\n                            name="sw-field--shippingMethod-name"\n                            required\n                            :disabled="!acl.can(\'shipping.editor\') || undefined"\n                            :error="shippingMethodNameError"\n                            :label="$tc(\'sw-settings-shipping.detail.labelName\')"\n                            :placeholder="placeholder(shippingMethod, \'name\', $tc(\'sw-settings-shipping.detail.placeholderName\'))"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_shipping_detail_content_field_technical_name %}\n                        <sw-text-field\n                            v-model:value="shippingMethod.technicalName"\n                            name="sw-field--shippingMethod-technicalName"\n                            class="sw-settings-shipping-detail__field-technical-name"\n                            :required="feature.isActive(\'v6.7.0.0\')"\n                            :disabled="!acl.can(\'shipping.editor\') || undefined"\n                            :label="$tc(\'sw-settings-shipping.detail.labelTechnicalName\')"\n                            :placeholder="placeholder(shippingMethod, \'technicalName\', $tc(\'sw-settings-shipping.detail.placeholderTechnicalName\'))"\n                            :error="shippingMethodTechnicalNameError"\n                            :help-text="$tc(\'sw-settings-shipping.detail.helpTextTechnicalName\')"\n                            :class="!shippingMethod.technicalName ? \'has--warning\' : \'\'"\n                        >\n                            {# @deprecated tag:v6.7.0 - Hint can be removed: with technical names now required, the hint is no longer needed. Also remove the snippet and dynamic class has--warning #}\n                            <template #hint>\n                                <span v-if="!shippingMethod.technicalName">{{ $tc(\'sw-settings-shipping.detail.hintTextTechnicalName\') }}</span>\n                            </template>\n                        </sw-text-field>\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_shipping_detail_base_content_field_position %}\n                        <sw-number-field\n                            v-model:value="shippingMethod.position"\n                            name="sw-field--shippingMethod-position"\n                            class="sw-settings-shipping-detail__field-position"\n                            :disabled="!acl.can(\'shipping.editor\') || undefined"\n                            :label="$tc(\'sw-settings-shipping.detail.labelPosition\')"\n                            :placeholder="$tc(\'sw-settings-shipping.detail.placeholderPosition\')"\n                        />\n                        {% endblock %}\n                        \n                        {% block sw_settings_shipping_detail_base_content_field_active %}\n                        <sw-switch-field\n                            v-model:value="shippingMethod.active"\n                            name="sw-field--shippingMethod-active"\n                            bordered\n                            :disabled="!acl.can(\'shipping.editor\') || undefined"\n                            :label="$tc(\'sw-settings-shipping.detail.labelActive\')"\n                        />\n                        {% endblock %}\n                    </sw-container>\n                    <sw-container\n                        columns="repeat(auto-fit, minmax(250px, 1fr))"\n                        gap="0px 30px"\n                    >\n                        \n                        {% block sw_settings_shipping_detail_base_content_field_description %}\n                        <sw-textarea-field\n                            v-model:value="shippingMethod.description"\n                            name="sw-field--shippingMethod-description"\n                            :value="shippingMethod.description"\n                            class="sw-settings-shipping-detail__description"\n                            :disabled="!acl.can(\'shipping.editor\') || undefined"\n                            :label="$tc(\'sw-settings-shipping.detail.labelDescription\')"\n                            :placeholder="placeholder(shippingMethod, \'description\', $tc(\'sw-settings-shipping.detail.placeholderDescription\'))"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_shipping_detail_base_content_media_upload %}\n                        <sw-upload-listener\n                            :upload-tag="uploadTag"\n                            auto-upload\n                            @media-upload-finish="setMediaItem"\n                        />\n                        <sw-media-upload-v2\n                            v-if="!isLoading"\n                            :upload-tag="uploadTag"\n                            :source="logoMediaItem"\n                            class="sw-settings-shipping-detail__logo-image-upload"\n                            :allow-multi-select="false"\n                            variant="regular"\n                            :disabled="!acl.can(\'shipping.editor\') || undefined"\n                            :label="$tc(\'sw-settings-shipping.detail.labelLogoUpload\')"\n                            :default-folder="shippingMethod.getEntityName()"\n                            @media-drop="onDropMedia"\n                            @media-upload-sidebar-open="openMediaSidebar"\n                            @media-upload-remove-image="onUnlinkLogo"\n                        />\n                        {% endblock %}\n                    </sw-container>\n\n                    \n                    {% block sw_settings_shipping_detail_base_content_field_delivery_time %}\n                    <sw-entity-single-select\n                        v-model:value="shippingMethod.deliveryTimeId"\n                        name="sw-field--shippingMethod-deliveryTimeId"\n                        class="sw-settings-shipping-detail__delivery-time"\n                        entity="delivery_time"\n                        :disabled="!acl.can(\'shipping.editor\') || undefined"\n                        :criteria="deliveryTimeCriteria"\n                        :label="$tc(\'sw-settings-shipping.detail.labelDeliveryTime\')"\n                        :placeholder="$tc(\'sw-settings-shipping.detail.placeholderDeliveryTime\')"\n                        :error="shippingMethodDeliveryTimeIdError"\n                        show-clearable-button\n                        required\n                    />\n                    {% endblock %}\n\n                    \n                    {% block sw_settings_shipping_detail_base_content_tracking_url_field %}\n                    <sw-text-field\n                        v-model:value="shippingMethod.trackingUrl"\n                        name="sw-field--shippingMethod-trackingUrl"\n                        :disabled="!acl.can(\'shipping.editor\') || undefined"\n                        :label="$tc(\'sw-settings-shipping.detail.labelTrackingUrl\')"\n                        :placeholder="placeholder(shippingMethod, \'trackingUrl\', $tc(\'sw-settings-shipping.detail.placeholderTrackingUrl\'))"\n                        :help-text="$tc(\'sw-settings-shipping.detail.helpTextTrackingUrl\')"\n                    />\n                    {% endblock %}\n\n                    \n                    {% block sw_settings_shipping_detail_base_content_tags_field %}\n                    <sw-entity-tag-select\n                        v-if="!isLoading"\n                        v-model:entityCollection="shippingMethod.tags"\n                        :disabled="!acl.can(\'shipping.editor\') || undefined"\n                        :placeholder="$tc(\'sw-product.categoryForm.placeholderTags\')"\n                    />\n                    {% endblock %}\n                </sw-card>\n                {% endblock %}\n\n                \n                {% block sw_settings_shipping_detail_top_ruleshippingPriceStore %}\n                <sw-card\n                    position-identifier="sw-settings-shipping-detail-condition-container"\n                    class="sw-settings-shipping-detail__condition_container"\n                    :title="$tc(\'sw-settings-shipping.detail.topRule\')"\n                >\n                    \n                    {% block sw_settings_shipping_detail_top_rule_select %}\n                    <sw-select-rule-create\n                        :rule-id="shippingMethod.availabilityRuleId"\n                        :rule-filter="ruleFilter"\n                        :disabled="!acl.can(\'shipping.editor\') || undefined"\n                        :error="shippingMethodAvailabilityRuleIdError"\n                        :label="$tc(\'sw-settings-shipping.detail.topRule\')"\n                        class="sw-settings-shipping-detail__top-rule"\n                        rule-aware-group-key="shippingMethods"\n                        @save-rule="onSaveRule"\n                    />\n                    {% endblock %}\n                </sw-card>\n                {% endblock %}\n\n                \n                {% block sw_settings_shipping_detail_tax_cost %}\n                <sw-settings-shipping-tax-cost\n                    v-if="!isLoading"\n                    :disabled="!acl.can(\'shipping.editor\') || undefined"\n                />\n                {% endblock %}\n                <sw-skeleton v-else />\n\n                \n                {% block sw_settings_shipping_detail_price_matrices %}\n                <sw-settings-shipping-price-matrices\n                    v-if="!isLoading"\n                    ref="priceMatrices"\n                    :disabled="!acl.can(\'shipping.editor\') || undefined"\n                />\n                {% endblock %}\n                <sw-skeleton v-else />\n\n                \n                {% block sw_settings_shipping_detail_custom_field_sets %}\n                <sw-card\n                    v-if="showCustomFields"\n                    position-identifier="sw-settings-shipping-detail-custom-fields"\n                    :title="$tc(\'sw-settings-custom-field.general.mainMenuItemGeneral\')"\n                    :is-loading="isLoading"\n                >\n                    <sw-custom-field-set-renderer\n                        :entity="shippingMethod"\n                        :disabled="!acl.can(\'shipping.editor\') || undefined"\n                        :sets="customFieldSets"\n                    />\n                </sw-card>\n                {% endblock %}\n            </template>\n        </sw-card-view>\n    </template>\n    {% endblock %}\n\n    <template #sidebar>\n        \n        {% block sw_settings_shipping_detail_sidebar %}\n        <sw-sidebar :propagate-width="true">\n            \n            {% block sw_setting_shipping_detail_sidebar_media_item %}\n            <sw-sidebar-media-item ref="mediaSidebarItem">\n                <template\n                    #context-menu-items="media"\n                >\n                    <sw-context-menu-item @click="setMediaFromSidebar(media.mediaItem)">\n                        {{ $tc(\'sw-settings-shipping.sidebar.labelUseAsLogo\') }}\n                    </sw-context-menu-item>\n                </template>\n            </sw-sidebar-media-item>\n            {% endblock %}\n        </sw-sidebar>\n        {% endblock %}\n    </template>\n\n</sw-page>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["ruleConditionDataProviderService","repositoryFactory","acl","customFieldDataProviderService","feature"],mixins:[a.getByName("notification"),a.getByName("placeholder")],shortcuts:{"SYSTEMKEY+S":"onSave",ESCAPE:"onCancel"},props:{shippingMethodId:{type:String,required:!1,default:null}},data(){return{logoMediaItem:null,uploadTag:"sw-shipping-method-upload-tag",isSaveSuccessful:!1,isProcessLoading:!1,isLoading:!1,currenciesLoading:!1,customFieldSets:[]}},metaInfo(){return{title:this.$createTitle(this.identifier)}},computed:{...l("swShippingDetail",["shippingMethod","currencies"]),...(0,t.mapPropertyErrors)("shippingMethod",["name","technicalName","deliveryTimeId","availabilityRuleId"]),identifier(){return this.placeholder(this.shippingMethod,"name")},shippingMethodRepository(){return this.repositoryFactory.create("shipping_method")},shippingMethodPricesRepository(){return this.repositoryFactory.create("shipping_method_price")},currencyRepository(){return this.repositoryFactory.create("currency")},isNewShippingMethod(){return Object.keys(this.shippingMethod).length>0&&this.shippingMethod.isNew()},mediaRepository(){return this.repositoryFactory.create("media")},deliveryTimeRepository(){return this.repositoryFactory.create("delivery_time")},deliveryTimeCriteria(){let e=new d(1,25);return e.addSorting(d.sort("unit")),e.addSorting(d.sort("name")),e},tooltipSave(){let e=this.$device.getSystemKey();return{message:`${e} + S`,appearance:"light"}},tooltipCancel(){return{message:"ESC",appearance:"light"}},ruleFilter(){let e=new d(1,25);return e.addFilter(d.multi("OR",[d.contains("rule.moduleTypes.types","shipping"),d.equals("rule.moduleTypes",null)])),e.addAssociation("conditions"),e},shippingMethodCriteria(){let e=new d(1,25);return e.addAssociation("prices"),e.addAssociation("tags"),e.getAssociation("prices").addAssociation("calculationRule"),e.getAssociation("prices").addAssociation("rule"),e},showCustomFields(){return this.customFieldSets&&this.customFieldSets.length>0}},watch:{"shippingMethod.mediaId"(){this.shippingMethod.mediaId&&this.setMediaItem({targetId:this.shippingMethod.mediaId})},shippingMethodId(){this.createdComponent()}},beforeCreate(){Shopware.State.registerModule("swShippingDetail",s)},created(){this.createdComponent()},beforeUnmount(){Shopware.State.unregisterModule("swShippingDetail")},methods:{createdComponent(){if(this.shippingMethodId)this.loadEntityData();else{Shopware.State.commit("context/resetLanguageToDefault");let e=this.shippingMethodRepository.create(),i=this.shippingMethodPricesRepository.create();i.calculation=1,i.quantityStart=1,i.shippingMethodId=e.id,i.ruleId=null,e.prices.add(i),Shopware.State.commit("swShippingDetail/setShippingMethod",e)}this.loadCurrencies()},onSaveRule(e){this.shippingMethod.availabilityRuleId=e},loadCurrencies(){this.currenciesLoading=!0,this.currencyRepository.search(new d(1,500),o.api).then(e=>{Shopware.State.commit("swShippingDetail/setCurrencies",this.sortCurrencies(e)),this.currenciesLoading=!1})},loadEntityData(){this.shippingMethodId&&(this.isLoading=!0,this.shippingMethodRepository.get(this.shippingMethodId,Shopware.Context.api,this.shippingMethodCriteria).then(e=>{Shopware.State.commit("swShippingDetail/setShippingMethod",e),this.loadCustomFieldSets().then(()=>{this.isLoading=!1})}))},loadCustomFieldSets(){return this.customFieldDataProviderService.getCustomFieldSets("shipping_method").then(e=>{this.customFieldSets=e})},abortOnLanguageChange(){return this.shippingMethodRepository.hasChanges(this.shippingMethod)},saveOnLanguageChange(){return this.onSave()},onChangeLanguage(){this.loadEntityData()},onSave(){return this.filterIncompletePrices(),this.isSaveSuccessful=!1,this.isProcessLoading=!0,this.shippingMethodRepository.save(this.shippingMethod,o.api).then(()=>{this.isSaveSuccessful=!0,this.shippingMethodId||this.$router.push({name:"sw.settings.shipping.detail",params:{id:this.shippingMethod.id}}),this.$refs.mediaSidebarItem.getList(),this.loadEntityData()}).catch(e=>{throw this.onError(e),p(this._name,e.message,e.response),this.isProcessLoading=!1,e}).finally(()=>{this.isProcessLoading=!1})},onError(e){let i=null;try{i=e.response.data.errors[0].detail}catch(e){i=""}this.createNotificationError({title:this.$tc("global.default.error"),message:`${this.$tc("sw-settings-shipping.detail.messageSaveError",0,{name:this.shippingMethod.name})} ${i}`})},filterIncompletePrices(){this.getIncompletePrices().forEach(e=>{this.shippingMethod.prices.remove(e.id)})},getIncompletePrices(){return this.shippingMethod.prices.filter(e=>!e.calculation&&!e.calculationRuleId||e._inNewMatrix)},onCancel(){this.$router.push({name:"sw.settings.shipping.index"})},setMediaItem({targetId:e}){this.mediaRepository.get(e,o.api).then(e=>{this.logoMediaItem=e}),this.shippingMethod.mediaId=e},onDropMedia(e){this.setMediaItem({targetId:e.id})},setMediaFromSidebar(e){this.logoMediaItem=e,this.shippingMethod.mediaId=e.id},onUnlinkLogo(){this.logoMediaItem=null,this.shippingMethod.mediaId=null},openMediaSidebar(){this.$refs.mediaSidebarItem.openContent()},sortCurrencies(e){return e.sort((e,i)=>e.isSystemDefault?-1:i.isSystemDefault?1:e.translated.name<i.translated.name?-1:e.translated.name>i.translated.name?1:0),e}}}},101561:function(e,i,n){var t=n(19312);t.__esModule&&(t=t.default),"string"==typeof t&&(t=[[e.id,t,""]]),t.locals&&(e.exports=t.locals),n(745346).Z("852a82e2",t,!0,{})}}]);