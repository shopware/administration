(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[461],{"2Hh5":function(e,s,t){},SKFk:function(e,s,t){var n=t("2Hh5");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t("ydqr").default)("05795ccb",n,!0,{})},jgzQ:function(e,s,t){"use strict";t.r(s);t("SKFk");var n=Shopware,i=n.Mixin,r=n.Context,a=Shopware.Data.Criteria,c=Shopware.Utils.format;s.default={template:'\n{% block sw_settings_search_search_index %}\n<sw-card\n    position-identifier="sw-settings-search-search-index"\n    :title="$tc(\'sw-settings-search.generalTab.labelSearchIndex\')"\n    :is-loading="isLoading"\n>\n\n    \n    {% block sw_settings_search_search_index_description %}\n    <sw-alert\n        v-if="isRebuildInProgress"\n        class="sw-settings-search__search-index-warning-text"\n        variant="warning"\n    >\n\n        \n        {% block sw_settings_search_search_index_warning_top %}\n        <p class="sw-settings-search__search-index-warning-top">\n            {{ $tc(\'sw-settings-search.generalTab.textWarningOpenTab\') }}\n        </p>\n        {% endblock %}\n\n        \n        {% block sw_settings_search_search_index_warning_bottom %}\n        <p>{{ $tc(\'sw-settings-search.generalTab.textRebuildSearchIndexDescription\') }}</p>\n        {% endblock %}\n\n    </sw-alert>\n    {% endblock %}\n\n    \n    {% block sw_settings_search_search_index_rebuild_button %}\n    <sw-button-process\n        variant="ghost"\n        class="sw-settings-search__search-index-rebuild-button"\n        :is-loading="isRebuildInProgress"\n        :disabled="isRebuildInProgress || !acl.can(\'product_search_config.editor\')"\n        :process-success="isRebuildSuccess"\n        @process-finish="buildFinish"\n        @click="rebuildSearchIndex"\n    >\n        {{ $tc(\'sw-settings-search.generalTab.buttonRebuildSearchIndex\') }}\n    </sw-button-process>\n\n    \n    {% block sw_settings_search_search_index_lastest_build %}\n    <span class="sw-settings-search__search-index-latest-build">\n        {{ $tc(\'sw-settings-search.generalTab.textLastedBuild\') }} {{ latestBuild }}\n    </span>\n    {% endblock %}\n    {% endblock %}\n\n    \n    {% block sw_settings_search_search_index_rebuild_progress %}\n    <div\n        v-if="progressBarValue"\n        class="sw-settings-search__search-index-rebuilding-progress"\n    >\n\n        \n        {% block sw_settings_search_search_index_rebuild_progress_text %}\n        <span class="sw-settings-search__search-index-rebuilding-text">\n            {{ $tc(\'sw-settings-search.generalTab.textRebuildingSearchIndex\') }}\n        </span>\n        {% endblock %}\n\n        \n        {% block sw_settings_search_search_index_rebuild_progress_bar %}\n        <sw-progress-bar\n            :value="progressBarValue"\n            :max-value="100"\n        >\n            {{ $tc(\'sw-settings-search.generalTab.textRebuildingSearchIndex\') }}\n        </sw-progress-bar>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n</sw-card>\n{% endblock %}\n',inject:["productIndexService","repositoryFactory","acl"],mixins:[i.getByName("notification")],data:function(){return{isLoading:!0,isRebuildSuccess:!1,isRebuildInProgress:!1,progressBarValue:0,offset:0,syncPolling:null,totalProduct:0,latestProductIndexed:{}}},computed:{productRepository:function(){return this.repositoryFactory.create("product")},productSearchKeywordRepository:function(){return this.repositoryFactory.create("product_search_keyword")},productCriteria:function(){var e=new a(1,1);return e.addFilter(a.equals("product.parentId",null)),e},productSearchKeywordsCriteria:function(){var e=new a(1,1);return e.addSorting(a.sort("id","DESC",!0)),e},latestBuild:function(){if(!this.latestProductIndexed)return this.$tc("sw-settings-search.generalTab.textSearchNotIndexedYet");var e=new Date(this.latestProductIndexed.createdAt);return c.date(e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"})}},created:function(){this.createdComponent()},beforeDestroy:function(){this.beforeDestroyComponent()},methods:{createdComponent:function(){this.isLoading=!1,this.getTotalProduct(),this.getLatestProductKeywordIndexed()},beforeDestroyComponent:function(){this.clearPolling()},getLatestProductKeywordIndexed:function(){var e=this;this.isLoading=!0,this.productSearchKeywordRepository.search(this.productSearchKeywordsCriteria,r.api).then((function(s){e.latestProductIndexed=s[0]})).catch((function(s){e.createNotificationError({message:s.message})})).finally((function(){e.isLoading=!1}))},getTotalProduct:function(){var e=this;this.isLoading=!0,this.productRepository.search(this.productCriteria,r.api).then((function(s){e.totalProduct=null==s?void 0:s.total})).catch((function(s){e.createNotificationError({message:s.message})})).finally((function(){e.isLoading=!1}))},updateProgress:function(){var e=this;this.productIndexService.index(this.offset).then((function(s){var t,n=s.data;(e.isRebuildSuccess=n.finish,e.isRebuildSuccess)?(e.clearPolling(),e.getLatestProductKeywordIndexed(),e.progressBarValue=100,e.createNotificationSuccess({message:e.$tc("sw-settings-search.notification.index.success")})):(e.progressBarValue=(null!==(t=e.offset)&&void 0!==t?t:1)/e.totalProduct*100,e.offset=n.offset.offset,e.updateProgress())})).catch((function(s){e.createNotificationError({message:s.message}),e.isRebuildSuccess=!1}))},pollData:function(){null===this.syncPolling&&(this.syncPolling=setTimeout(this.updateProgress,3e3))},clearPolling:function(){null!==this.syncPolling&&(clearTimeout(this.syncPolling),this.syncPolling=null)},rebuildSearchIndex:function(){this.isRebuildInProgress=!0,this.progressBarValue=1,this.offset=0,this.$emit("edit-change",this.isRebuildInProgress),this.pollData(),this.createNotificationInfo({message:this.$tc("sw-settings-search.notification.index.started")})},buildFinish:function(){this.isRebuildSuccess=!1,this.isRebuildInProgress=!1,this.progressBarValue=0,this.$emit("edit-change",this.isRebuildInProgress)}}}}}]);