(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[362],{FSvn:function(e,i,t){},bsKu:function(e,i,t){"use strict";t.r(i);var o=t("CsSd"),r=t.n(o);t("ruhP");function d(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);i&&(o=o.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),t.push.apply(t,o)}return t}function n(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?d(Object(t),!0).forEach((function(i){r()(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}))}return e}var a=Shopware,c=a.Component,s=a.Mixin,u=c.getComponentHelper().mapGetters;i.default={template:'\n{% block sw_product_media_form %}\n<div\n    class="sw-product-media-form"\n    :class="{ \'is--disabled\': disabled }"\n>\n    \n    {% block sw_product_media_form_upload %}\n    <sw-upload-listener\n        v-if="!isLoading"\n        :upload-tag="product.id"\n        auto-upload\n        @media-upload-finish="successfulUpload"\n        @media-upload-fail="onUploadFailed"\n    />\n\n    <sw-media-upload-v2\n        v-if="!isLoading && acl.can(\'product.editor\')"\n        variant="regular"\n        :upload-tag="product.id"\n        :scroll-target="$parent.$el"\n        :default-folder="product.getEntityName()"\n        :file-accept="fileAccept"\n        @media-upload-sidebar-open="onOpenMedia"\n    />\n    {% endblock %}\n\n    \n    {% block sw_product_media_form_grid %}\n    <div class="sw-product-media-form__previews">\n        <div class="sw-product-media-form__cover-container sw-product-media-form__column">\n            \n            {% block sw_product_media_form_cover_preview %}\n            <div\n                v-if="product.cover || cover"\n                class="sw-product-media-form__preview-cover"\n            >\n                <div class="preview-cover">\n                    \n                    {% block sw_product_media_form_cover_image %}\n                    <sw-media-preview-v2\n                        class="sw-product-media-form__cover-image"\n                        :source="cover ? cover.mediaId : product.cover.mediaId"\n                    />\n                    {% endblock %}\n                    <span>{{ $tc(\'sw-product.mediaForm.coverSubline\') }}</span>\n                </div>\n            </div>\n            <div\n                v-else\n                class="sw-product-media-form__cover-image is--placeholder"\n            >\n                {{ $tc(\'sw-product.mediaForm.coverSubline\') }}\n            </div>\n            {% endblock %}\n        </div>\n\n        <div\n            v-if="!isLoading"\n            class="sw-product-media-form__grid sw-product-media-form__column"\n            :style="gridAutoRows"\n        >\n            {%  block sw_product_media_form_grid_items %}\n            <sw-product-image\n                v-for="mediaItem in mediaItems"\n                :key="mediaItem.id"\n                v-draggable="{ dragGroup: \'product-media\', data: mediaItem, onDragEnter: onMediaItemDragSort }"\n                v-droppable="{ dragGroup: \'product-media\', data: mediaItem }"\n                :is-cover="isCover(mediaItem)"\n                :is-spatial="isSpatial(mediaItem)"\n                :is-ar-ready="isArReady(mediaItem)"\n                :is-placeholder="mediaItem.isPlaceholder"\n                :media-id="mediaItem.mediaId"\n                :show-cover-label="showCoverLabel"\n                @sw-product-image-delete="removeFile(mediaItem)"\n                @sw-product-image-cover="markMediaAsCover(mediaItem)"\n            />\n            {% endblock %}\n        </div>\n        <sw-loader v-else />\n    </div>\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","acl"],mixins:[s.getByName("notification")],props:{disabled:{type:Boolean,required:!1,default:!1},isInherited:{type:Boolean,required:!1,default:!1},fileAccept:{type:String,required:!1,default:"*/*"}},data:function(){return{showCoverLabel:!0,isMediaLoading:!1,columnCount:5,columnWidth:90}},computed:n(n({product:function(){var e=Shopware.State.get("swProductDetail");return this.isInherited?e.parentProduct:e.product},mediaItems:function(){var e=this.productMedia.slice(),i=this.getPlaceholderCount(this.columnCount);if(0===i)return e;for(var t=0;t<i;t+=1)e.push(this.createPlaceholderMedia(e));return e},cover:function(){if(!this.product)return null;var e=this.product.cover?this.product.cover.mediaId:this.product.coverId;return this.product.media.find((function(i){return i.id===e}))}},u("swProductDetail",{isStoreLoading:"isLoading"})),{},{isLoading:function(){return this.isMediaLoading||this.isStoreLoading},productMediaRepository:function(){return this.repositoryFactory.create("product_media")},productMedia:function(){return this.product?this.product.media:[]},productMediaStore:function(){return this.product.getAssociation("media")},gridAutoRows:function(){return"grid-auto-rows: ".concat(this.columnWidth)},currentCoverID:function(){var e=this;return this.productMedia.find((function(i){return i.media.id===e.product.coverId})).id}}),methods:{onOpenMedia:function(){this.$emit("media-open")},updateColumnCount:function(){var e=this;this.$nextTick((function(){if(e.isLoading)return!1;var i=window.getComputedStyle(e.$refs.grid,null).getPropertyValue("grid-template-columns").split(" ");return e.columnCount=i.length,e.columnWidth=i[0],!0}))},getPlaceholderCount:function(e){this.productMedia.length+3<2*e&&(e*=2);var i=e;return 0!==this.productMedia.length&&(i=e-this.productMedia.length%e)===e?0:i},createPlaceholderMedia:function(e){return{isPlaceholder:!0,isCover:0===e.length,media:{isPlaceholder:!0,name:""},mediaId:e.length.toString()}},buildProductMedia:function(e){this.isLoading=!0;var i=this.productMediaStore.create();return i.mediaId=e,0===this.productMedia.length?(i.position=0,this.product.cover=i,this.product.coverId=i.id):i.position=this.productMedia.length+1,this.isLoading=!1,i},successfulUpload:function(e){var i=e.targetId;if(!this.product.media.find((function(e){return e.mediaId===i}))){var t=this.createMediaAssociation(i);this.product.media.add(t)}},createMediaAssociation:function(e){var i=this.productMediaRepository.create();return i.productId=this.product.id,i.mediaId=e,this.product.media.length<=0?(i.position=0,this.product.coverId=i.id):i.position=this.product.media.length,i},onUploadFailed:function(e){var i=this.product.media.find((function(i){return i.mediaId===e.targetId}));i&&(this.product.coverId===i.id&&(this.product.coverId=null),this.product.media.remove(i.id)),this.product.isLoading=!1},removeCover:function(){this.product.cover=null,this.product.coverId=null},isCover:function(e){var i=this.product.cover?this.product.cover.id:this.product.coverId;return 0!==this.product.media.length&&!e.isPlaceholder&&e.id===i},isSpatial:function(e){var i,t,o;return"glb"===(null===(i=e.media)||void 0===i?void 0:i.fileExtension)||!(null===(t=e.media)||void 0===t||null===(o=t.url)||void 0===o||!o.endsWith(".glb"))},isArReady:function(e){var i,t,o;return!(null===(i=e.media)||void 0===i||null===(t=i.config)||void 0===t||null===(o=t.spatial)||void 0===o||!o.arReady)},removeFile:function(e){this.product.coverId===e.id&&(this.product.cover=null,this.product.coverId=null),null===this.product.coverId&&this.product.media.length>0&&(this.product.coverId=this.product.media.first().id),this.product.media.remove(e.id)},markMediaAsCover:function(e){this.product.cover=e,this.product.coverId=e.id,this.product.media.moveItem(e.position,0),this.updateMediaItemPositions()},onDropMedia:function(e){if(!this.product.media.find((function(i){return i.mediaId===e.id}))){var i=this.createMediaAssociation(e.mediaItem.id);0===this.product.media.length&&(i.position=0,this.product.cover=i,this.product.coverId=i.id),this.product.media.add(i)}},onMediaItemDragSort:function(e,i,t){!0!==t||e.id===this.product.coverId&&0===e.position||i.id===this.product.coverId&&0===i.position||(this.product.media.moveItem(e.position,i.position),this.updateMediaItemPositions())},updateMediaItemPositions:function(){this.productMedia.forEach((function(e,i){e.position=i}))}}}},ruhP:function(e,i,t){var o=t("FSvn");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,t("P8hj").default)("1c4d2c2a",o,!0,{})}}]);