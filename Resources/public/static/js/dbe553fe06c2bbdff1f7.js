(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[19],{"/10g":function(e,t,n){},"8FeW":function(e,t,n){"use strict";n.r(t);var i=n("6lmj"),r=n.n(i),o=n("CsSd"),a=n.n(o),s=n("c1oF"),u=n.n(s),c=n("0MM5"),l=n.n(c),d=n("CTyi"),p=n.n(d),f=n("7gRN"),v=n.n(f),g=n("0ERT"),h=n.n(g),m=n("s33S"),w=n.n(m),_=n("EHdy"),b=n.n(_);function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=w()(e);if(t){var r=w()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var F=Shopware.Utils.object.deepCopyObject,O=Shopware.Utils.format.md5,x=function(e){v()(n,e);var t=y(n);function n(){var e;return l()(this,n),(e=t.call(this)).product=null,e.syncService=Shopware.Service("syncService"),e.httpClient=e.syncService.httpClient,e.languageId=null,e}return p()(n,[{key:"saveVariants",value:function(e){var t=this;return new Promise((function(n){t.emit("progress-max",{type:"delete",progress:e.deleteQueue.length});var i=e.deleteQueue.map((function(e){return{id:e}}));t.processQueue("delete",i,0,10,n)})).then((function(){return t.emit("progress-max",{type:"upsert",progress:e.createQueue.length}),new Promise((function(n){t.processQueue("upsert",e.createQueue,0,10,n)}))}))}},{key:"generateVariants",value:function(e,t){var n=this;this.product=t;var i=this.product.configuratorSettings;return this.product.variantListingConfig&&(this.product.variantListingConfig.displayParent||this.product.variantListingConfig.configuratorGroupConfig||this.product.variantListingConfig.mainVariantId)||(this.product.variantListingConfig={},this.product.variantListingConfig.displayParent=!0),new Promise((function(){var t=n.groupTheOptions(i);if(t.length<=0)n.loadExisting(n.product.id).then((function(e){var t=Object.keys(e).map((function(e){return e}));n.emit("queues",{createQueue:[],deleteQueue:t})}));else{var r=n.buildCombinations(t);n.loadExisting(n.product.id).then((function(t){return n.filterVariations(r,t,e)})).then((function(e){n.emit("queues",e)}))}}))}},{key:"filterVariations",value:function(e,t,n){var i=this,r=this.product.configuratorSettings;return new Promise((function(o){for(var a=[],s={},c={},l={},d=0,p=Object.entries(t);d<p.length;d++){var f=u()(p[d],2),v=f[0],g=f[1],h=O(JSON.stringify(g.options.sort()));s[h]=v,l[h]=g.productNumber,c[g.productNumber]=!0}var m=F(s),w=e.map((function(e){return e.sort()})),_=r.reduce((function(e,t){return e.push({id:t.option.id,price:t.price}),e}),[]);i.emit("progress-max",{type:"calc",progress:w.length});var b=1;w.forEach((function(e){var t=O(JSON.stringify(e));void 0!==s[t]&&delete m[t]})),Object.keys(m).forEach((function(e){delete c[l[e]]})),w.forEach((function(e){var t=O(JSON.stringify(e));if(void 0===s[t]){var r=e.map((function(e){return{id:e}})),o={};r.map((function(e){return e.id})).forEach((function(e){_.forEach((function(t){t.price&&t.id===e&&t.price.forEach((function(e){var t,r=e.currencyId,a=t=o[r]?o[r]:i.product.price.find((function(t){return t.currencyId===e.currencyId}));if(!t){var s=n.find((function(e){return e.isSystemDefault})),u=i.product.price.find((function(e){return e.currencyId===s.id})),c=n.find((function(t){return t.id===e.currencyId}));a={net:u.net*c.factor,gross:u.gross*c.factor}}var l=a.gross+e.gross,d=a.net+e.net;o[r]={currencyId:e.currencyId,gross:l,linked:e.linked,net:d}}))}))}));var u=i.createNumber(i.product.productNumber,b,c);b=u.increment;var l={parentId:i.product.id,options:r,stock:0,productNumber:u.number};(o=Object.values(o)).length>0&&(l.price=o),a.push(l)}})),m=Object.values(m);var y=i.filterRestrictions(a);o({deleteQueue:m,createQueue:y})}))}},{key:"createNumber",value:function(e,t,n){for(var i=!0,r=null;i;)r="".concat(e,".").concat(t),i=n.hasOwnProperty(r),t+=1;return{number:r,increment:t}}},{key:"filterRestrictions",value:function(e){var t=(this.product.variantRestrictions||[]).map((function(e){return e.values.map((function(e){return e.options}))}));return t.length<=0?e:e.filter((function(e){var n=e.options.map((function(e){return e.id}));return t.reduce((function(e,t){return!t.reduce((function(e,t){return!!t.find((function(e){return n.indexOf(e)>=0}))&&e}),!0)&&e}),!0)}))}},{key:"loadExisting",value:function(e){return this.httpClient.get("/_action/product/".concat(e,"/combinations"),{headers:this.syncService.getBasicHeaders()}).then((function(e){return e.data}))}},{key:"groupTheOptions",value:function(e){var t=e.reduce((function(e,t){var n=t.option.groupId,i=e[n];return i?(i.push(t.option.id),e):(e[n]=[t.option.id],e)}),{});return Object.values(t)}},{key:"buildCombinations",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=[];return null!==i&&n.push(i),r>=e.length?(o.push(n),o):(e[r].forEach((function(i){t.buildCombinations(e,n.slice(),i,r+1).forEach((function(e){o.push(e)}))})),o)}},{key:"processQueue",value:function(e,t,n,i,r){var o=this,a=t.slice(n,n+i);if(a.length<=0)r();else{this.emit("progress-actual",{type:e,progress:n});var s=[{action:e,entity:"product",payload:a}];this.syncService.sync(s,{},{"single-operation":1}).then((function(){o.processQueue(e,t,n+i,i,r)}))}}}]),n}(b.a);n("fURA");function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=Shopware.Data.Criteria,E=Shopware,C=E.Mixin,Q=E.Context,S=Shopware.Component.getComponentHelper().mapState;t.default={template:'\n{% block sw_product_modal_variant_generation %}\n<sw-modal\n    v-if="!showUploadModal"\n    :title="$tc(\'sw-product.variations.configuratorModal.title\')"\n    class="sw-product-modal-variant-generation"\n    @modal-close="$emit(\'modal-close\')"\n>\n\n    \n    {% block sw_product_modal_variant_generation_sidebar %}\n    <div class="sw-product-modal-variant-generation__sidebar">\n        \n        {% block sw_product_modal_variant_generation_sidebar_tabs %}\n        <sw-tabs\n            is-vertical\n            position-identifier="sw-product-modal-variant-generation"\n        >\n            \n            {% block sw_product_modal_variant_generation_sidebar_tabs_items %}\n\n            \n            {% block sw_product_modal_variant_generation_sidebar_tabs_item_options %}\n            <sw-tabs-item\n                class="sw-variant-modal__option-selection"\n                :active="activeTab == \'options\'"\n                @click="activeTab = \'options\'"\n            >\n                {{ $tc(\'sw-product.variations.configuratorModal.selectOptions\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            \n            {% block sw_product_modal_variant_generation_sidebar_tabs_item_prices %}\n            <sw-tabs-item\n                v-show="variantsNumber"\n                class="sw-variant-modal__surcharge-configuration"\n                :active="activeTab == \'prices\'"\n                @click="activeTab = \'prices\'"\n            >\n                {{ $tc(\'sw-product.variations.configuratorModal.priceSurcharges\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            \n            {% block sw_product_modal_variant_generation_sidebar_tabs_item_restrictions %}\n            <sw-tabs-item\n                v-show="variantsNumber"\n                class="sw-variant-modal__restriction-configuration"\n                :active="activeTab == \'restrictions\'"\n                @click="activeTab = \'restrictions\'"\n            >\n                {{ $tc(\'sw-product.variations.configuratorModal.defineRestrictions\') }}\n            </sw-tabs-item>\n            {% endblock %}\n\n            {% endblock %}\n        </sw-tabs>\n        {% endblock %}\n\n        \n        {% block sw_product_modal_variant_generation_sidebar_descriptions %}\n        \n        {% block sw_product_modal_variant_generation_sidebar_descriptions_options %}\n        <p v-if="activeTab == \'options\'">\n            {{ $tc(\'sw-product.variations.configuratorModal.selectOptionsExplanation\') }}\n        </p>\n        {% endblock %}\n\n        \n        {% block sw_product_modal_variant_generation_sidebar_descriptions_restrictions %}\n        <p v-else-if="activeTab == \'restrictions\'">\n            {{ $tc(\'sw-product.variations.configuratorModal.selectRestrictionsExplanation\') }}\n        </p>\n        {% endblock %}\n\n        \n        {% block sw_product_modal_variant_generation_sidebar_descriptions_prices %}\n        <p v-else-if="activeTab == \'prices\'">\n            {{ $tc(\'sw-product.variations.configuratorModal.selectPricesExplanation\') }}\n        </p>\n        {% endblock %}\n        {% endblock %}\n\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_product_modal_variant_generation_main %}\n    <div class="sw-product-modal-variant-generation__main">\n        \n        {% block sw_product_modal_variant_generation_main_configurator_selection %}\n        <sw-product-variants-configurator-selection\n            v-show="activeTab == \'options\'"\n            :product="product"\n            :options="product.configuratorSettings"\n            :overlay="false"\n            :collapsible="false"\n            @variations-finish-generate="$emit(\'variations-finish-generate\')"\n            @option-select="calcVariantsNumber()"\n        />\n        {% endblock %}\n\n        \n        {% block sw_product_modal_variant_generation_main_configurator_prices %}\n        <sw-product-variants-configurator-prices\n            v-if="activeTab == \'prices\'"\n            :product="product"\n            :selected-groups="selectedGroups"\n        />\n        {% endblock %}\n\n        \n        {% block sw_product_modal_variant_generation_main_configurator_restrictions %}\n        <sw-product-variants-configurator-restrictions\n            v-if="activeTab == \'restrictions\'"\n            :product="product"\n            :selected-groups="selectedGroups"\n        />\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_product_modal_variant_generation_footer %}\n    <template #modal-footer>\n        \n        {% block sw_product_modal_variant_generation_footer_cancel %}\n        <sw-button\n            size="small"\n            @click="$emit(\'modal-close\')"\n        >\n            {{ $tc(\'sw-product.variations.cancelVariationsButton\') }}\n        </sw-button>\n        {% endblock %}\n        \n        {% block sw_product_modal_variant_generation_footer_generate %}\n        <sw-button\n            class="sw-product-variant-generation__next-action"\n            variant="primary"\n            size="small"\n            @click="showNextStep"\n        >\n            {{ $tc(\'sw-product.variations.nextModalButton\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n</sw-modal>\n\n<sw-modal\n    v-else\n    :title="$tc(\'sw-product.variations.configuratorModal.title\')"\n    class="sw-product-modal-variant-generation sw-product-modal-variant-generation__upload_files"\n    @modal-close="$emit(\'modal-close\')"\n>\n    <div class="sw-product-modal-variant-generation__infoBox">\n        {{ $tc(\'sw-product.variations.configuratorModal.uploadInfoBoxHeader\') }}\n        <div class="sw-product-modal-variant-generation__infoBoxContent">\n            <span class="sw-product-modal-variant-generation__variant-amount">\n                {{ $tc(\'sw-product.variations.configuratorModal.uploadInfoBoxCount\', variantGenerationQueue.createQueue.length, { count: variantGenerationQueue.createQueue.length }) }}\n            </span>\n            {{ $tc(\'sw-product.variations.configuratorModal.uploadInfoBoxCreateLabel\', variantGenerationQueue.createQueue.length, { count: variantGenerationQueue.createQueue.length }) }}\n\n            <span class="sw-product-modal-variant-generation__variant-amount">\n                {{ $tc(\'sw-product.variations.configuratorModal.uploadInfoBoxCount\', variantGenerationQueue.deleteQueue.length, { count: variantGenerationQueue.deleteQueue.length }) }}\n            </span>\n            {{ $tc(\'sw-product.variations.configuratorModal.uploadInfoBoxDeleteLabel\', variantGenerationQueue.deleteQueue.length, { count: variantGenerationQueue.deleteQueue.length }) }}\n        </div>\n    </div>\n\n    <template v-if="variantGenerationQueue.createQueue.length > 0">\n        <div class="sw-product-modal-variant-generation__upload-card">\n            <div class="sw-product-modal-variant-generation__card-title">\n                {{ $tc(\'sw-product.variations.configuratorModal.uploadCardDescription\') }}\n            </div>\n\n            <div class="sw-product-modal-variant-generation__upload-all-container">\n                <sw-switch-field\n                    :label="$tc(\'sw-product.variations.configuratorModal.digitalVariantSwitch\')"\n                    {% if VUE3 %}\n                    @update:value="onChangeAllVariantValues"\n                    {% else %}\n                    @change="onChangeAllVariantValues"\n                    {% endif %}\n                />\n                <div class="sw-product-modal-variant-generation__upload-all">\n                    <sw-upload-listener\n                        upload-tag="upload_all"\n                        auto-upload\n                        @media-upload-finish="successfulUpload"\n                    />\n                    <sw-media-compact-upload-v2\n                        v-if="productDownloadFolderId"\n                        :button-label="$tc(\'sw-product.variations.configuratorModal.uploadAllButton\')"\n                        :remove-button-label="$tc(\'sw-product.variations.configuratorModal.removeAllButton\')"\n                        upload-tag="upload_all"\n                        private-filesystem\n                        :source-multiselect="downloadFilesForAllVariants.length > 0 ? downloadFilesForAllVariants : null"\n                        allow-multi-select\n                        add-files-on-multiselect\n                        :target-folder-id="productDownloadFolderId"\n                        file-accept="*/*"\n                        @delete-item="(file) => removeFileForAllVariants(file)"\n                    />\n                </div>\n            </div>\n\n            <div class="sw-product-modal-variant-generation__toolbar">\n                <sw-card-filter\n                    :placeholder="$tc(\'sw-product.variations.configuratorModal.uploadCardSearchPlaceholder\')"\n                    @sw-card-filter-term-change="onTermChange"\n                />\n            </div>\n\n            <sw-data-grid\n                class="sw-product-modal-variant-generation__grid"\n                :data-source="paginatedVariantArray"\n                :show-selection="false"\n                :show-header="false"\n                :show-actions="false"\n                :compact-mode="false"\n                :plain-appearance="true"\n                :columns="[\n                    { property: \'options\', label: \'Optionen\' },\n                ]"\n            >\n                <template #column-options="{ item }">\n                    <div>\n                        <template\n                            v-for="(option, index) in item.options"\n                            {% if VUE3 %}\n                            :key="index"\n                            {% endif %}\n                        >\n                            <span\n                                v-if="option.entity"\n                                {% if VUE2 %}\n                                :key="index"\n                                {% endif %}\n                            >\n                                {{ option.entity.group.translated?.name || option.entity.group.name }}:\n                                {{ option.entity.translated?.name || option.entity.name }}\n                                <template v-if="index != Object.keys(item.options).length - 1">|</template>\n                            </span>\n                        </template>\n                    </div>\n\n                    <div\n                        :key="item.id"\n                        class="sw-data-grid__item"\n                    >\n                        <sw-switch-field\n                            label="Digital"\n                            :value="item.productStates.includes(\'is-download\')"\n                            {% if VUE3 %}\n                            @update:value="(event) => onChangeVariantValue(event, item)"\n                            {% else %}\n                            @change="(event) => onChangeVariantValue(event, item)"\n                            {% endif %}\n                        />\n                        <sw-upload-listener\n                            :upload-tag="item.productNumber"\n                            auto-upload\n                            @media-upload-finish="(event) => successfulUpload(event, item)"\n                        />\n                        <sw-media-compact-upload-v2\n                            v-if="productDownloadFolderId"\n                            :upload-tag="item.productNumber"\n                            :disabled="item.productStates.length === 0"\n                            private-filesystem\n                            allow-multi-select\n                            add-files-on-multiselect\n                            :source-multiselect="item.downloads.length > 0 ? item.downloads : null"\n                            :target-folder-id="productDownloadFolderId"\n                            file-accept="*/*"\n                            @delete-item="(file) => removeFile(`${file.fileName}.${file.fileExtension}`, item)"\n                        />\n                    </div>\n                </template>\n\n                <template #pagination>\n                    <sw-pagination\n                        :page="page"\n                        :limit="limit"\n                        :total="total"\n                        :total-visible="7"\n                        @page-change="handlePageChange"\n                    />\n                </template>\n            </sw-data-grid>\n        </div>\n    </template>\n\n    <template #modal-footer>\n        <sw-button\n            size="small"\n            @click="showUploadModal = false"\n        >\n            {{ $tc(\'sw-product.variations.backVariationsButton\') }}\n        </sw-button>\n\n        <sw-button\n            :disabled="isGenerateButtonDisabled"\n            class="sw-product-variant-generation__generate-action"\n            :variant="buttonVariant"\n            size="small"\n            @click="generateVariants()"\n        >\n            {{ buttonLabel }}\n        </sw-button>\n    </template>\n\n    <template #modal-loader>\n        <transition name="generate-variant-progress-bar-transition">\n            <div\n                v-if="isLoading"\n                class="generate-variant-progress-bar__wrapper"\n            >\n                <sw-progress-bar\n                    class="generate-variant-progress-bar"\n                    :value="progressInPercentage"\n                />\n\n                <span class="generate-variant-progress-bar__description">\n                    {{ actualProgress }} {{ $tc(\'sw-product.variations.progressTypeOf\') }} {{ maxProgress }} {{ $tc(\'sw-product.variations.progressTypeVariation\') }} {{ progressMessage }}\n                </span>\n            </div>\n        </transition>\n    </template>\n</sw-modal>\n{% endblock %}\n',inject:["repositoryFactory","mediaService"],mixins:[C.getByName("listing")],props:{product:{type:Object,required:!0},groups:{type:Array,required:!0},selectedGroups:{type:Array,required:!0},actualStatus:{type:String,default:"is-physical",required:!1}},data:function(){return{activeTab:"options",isLoading:!1,actualProgress:0,maxProgress:0,progressType:"",variantsNumber:0,variantsGenerator:null,showUploadModal:!1,variantGenerationQueue:{createQueue:[],deleteQueue:[]},term:"",paginatedVariantArray:[],disableRouteParams:!0,downloadFilesForAllVariants:[],usageOfFiles:{},idToIndex:{},productDownloadFolderId:null}},computed:L(L({},S("swProductDetail",["currencies"])),{},{productRepository:function(){return this.repositoryFactory.create("product")},optionRepository:function(){return this.repositoryFactory.create("property_group_option")},mediaRepository:function(){return this.repositoryFactory.create("media")},progressInPercentage:function(){return this.actualProgress/(100*this.maxProgress)},progressMessage:function(){return"delete"===this.progressType?this.$tc("sw-product.variations.progressTypeDeleted"):"upsert"===this.progressType?this.$tc("sw-product.variations.progressTypeGenerated"):"calc"===this.progressType?this.$tc("sw-product.variations.progressTypeCalculated"):""},buttonVariant:function(){return this.variantsNumber<=0?"danger":"primary"},buttonLabel:function(){return this.variantsNumber<=0?this.$tc("sw-product.variations.deleteVariationsButton"):this.$tc("sw-product.variations.generateVariationsButton")},isGenerateButtonDisabled:function(){return this.variantGenerationQueue.createQueue.some((function(e){var t;return 0===e.downloads.length&&(null===(t=e.productStates)||void 0===t?void 0:t.includes("is-download"))}))}}),watch:{variantGenerationQueue:function(){this.getList(),this.showUploadModal=!0}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;this.mediaService.getDefaultFolderId("product_download").then((function(t){e.productDownloadFolderId=t})),this.variantsGenerator=new x,this.term="",this.variantsGenerator.on("queues",(function(t){var n=e.product.configuratorSettings.reduce((function(e,t){return e.indexOf(t.option.id)<0&&e.push(t.option.id),e}),[]);if(n.length>0){var i=new V(1,500);i.addFilter(V.equalsAny("id",n)),i.addAssociation("group"),e.optionRepository.search(i).then((function(n){t.createQueue.forEach((function(t,i){t.options.forEach((function(e){e.entity=n.get(e.id)})),t.options.sort((function(e,t){var n=e.entity.group.name,i=t.entity.group.name;return n.localeCompare(i)})),t.downloads=[],t.productStates=[],t.id=t.productNumber,e.idToIndex[t.id]=i})),e.variantGenerationQueue=t,e.total=t.createQueue.length}))}else e.variantGenerationQueue=t,e.total=t.createQueue.length;e.isLoading=!1})),this.variantsGenerator.on("progress-max",(function(t){e.maxProgress=t.progress,e.progressType=t.type})),this.variantsGenerator.on("progress-actual",(function(t){e.actualProgress=t.progress,e.progressType=t.type}))},removeFile:function(e,t){t.downloads=t.downloads.filter((function(t){return"".concat(t.fileName,".").concat(t.fileExtension)!==e})),this.usageOfFiles[e]=this.usageOfFiles[e].filter((function(e){return e!==t.id})),0===this.usageOfFiles[e].length&&delete this.usageOfFiles[e],this.usageOfFiles[e]||(this.downloadFilesForAllVariants=this.downloadFilesForAllVariants.filter((function(t){return"".concat(t.fileName,".").concat(t.fileExtension)!==e})))},removeFileForAllVariants:function(e){var t=this,n="".concat(e.fileName,".").concat(e.fileExtension),i=this.usageOfFiles[n];i&&(i.forEach((function(e){var i=t.idToIndex[e],r=t.variantGenerationQueue.createQueue[i];r.downloads=r.downloads.filter((function(e){return"".concat(e.fileName,".").concat(e.fileExtension)!==n}))})),delete this.usageOfFiles[n]),this.downloadFilesForAllVariants=this.downloadFilesForAllVariants.filter((function(t){return t.id!==e.id}))},getList:function(){var e=this;if(this.variantGenerationQueue){var t=[];this.variantGenerationQueue.createQueue.forEach((function(n){n.options.some((function(i){var r;return!(!((null===(r=i.entity.translated)||void 0===r?void 0:r.name)||i.entity.name).toUpperCase().includes(e.term.toUpperCase())&&""!==e.term)&&(t.push(n),!0)}))}));var n=this.page*this.limit-this.limit,i=n+this.limit;this.total=t.length,this.paginatedVariantArray=t.slice(n,i)}else this.paginatedVariantArray=[]},handlePageChange:function(e){this.onPageChange(e),this.getList()},generateVariants:function(){var e=this;this.isLoading=!0,this.variantGenerationQueue.createQueue.forEach((function(e){delete e.id,e.productStates.includes("is-download")&&(e.maxPurchase=1,e.minPurchase=1,e.isCloseout=!1,e.shippingFree=!1);var t=[];e.downloads.forEach((function(e){t.push({mediaId:e.id})})),e.downloads=t})),this.variantsGenerator.saveVariants(this.variantGenerationQueue).then((function(){return e.productRepository.save(e.product)})).then((function(){e.$emit("variations-finish-generate"),e.$emit("modal-close"),e.isLoading=!1,e.actualProgress=0,e.maxProgress=0,e.$root.$emit("product-reload")}))},showNextStep:function(){this.isLoading=!0,this.variantsGenerator.generateVariants(this.currencies,this.product),this.isLoading=!1},calcVariantsNumber:function(){var e=this.product.configuratorSettings.reduce((function(e,t){var n=t.option.groupId,i=e[n];return i?(i.push(t.option.id),e):(e[n]=[t.option.id],e)}),{}),t=Object.values(e);this.variantsNumber=t.length>0?t.map((function(e){return e.length})).reduce((function(e,t){return e*t})):0},onChangeAllVariantValues:function(e){var t=this,n=this.variantGenerationQueue.createQueue;if(this.term&&(n=this.paginatedVariantArray),!e)return this.usageOfFiles={},n.forEach((function(e){e.downloads=[],e.productStates=[]})),void this.getList();n.forEach((function(e){e.downloads=r()(t.downloadFilesForAllVariants),t.updateUsageForAllVariantFiles(e.id),e.productStates=["is-download"]})),this.getList()},onChangeVariantValue:function(e,t){var n=this;if(!e)return Object.keys(this.usageOfFiles).forEach((function(e){n.usageOfFiles[e]=n.usageOfFiles[e].filter((function(e){return e!==t.id})),0===n.usageOfFiles[e].length&&(delete n.usageOfFiles[e],n.downloadFilesForAllVariants=n.downloadFilesForAllVariants.filter((function(t){return"".concat(t.fileName,".").concat(t.fileExtension)!==e})))})),t.downloads=[],void(t.productStates=[]);t.downloads=r()(this.downloadFilesForAllVariants),this.updateUsageForAllVariantFiles(t.id),t.productStates=["is-download"]},isUploadDisabled:function(e){return 0===e.downloads.length},isExistingMedia:function(e,t){return e.some((function(e){return e.id===t}))},successfulUpload:function(e,t){var n=this;this.mediaRepository.get(e.targetId,Q.api).then((function(i){if(t){if(n.isExistingMedia(t.downloads,e.targetId))return;return t.downloads.push(i),void n.pushFileToUsageList("".concat(i.fileName,".").concat(i.fileExtension),t.id)}n.isExistingMedia(n.downloadFilesForAllVariants,e.targetId)||n.downloadFilesForAllVariants.push(i);var r=n.variantGenerationQueue.createQueue;n.term&&(r=n.paginatedVariantArray),r.forEach((function(t){if(t.productStates.includes("is-download")){if(n.isExistingMedia(t.downloads,e.targetId))return;t.downloads.push(i),n.pushFileToUsageList("".concat(i.fileName,".").concat(i.fileExtension),t.id)}}))}))},updateUsageForAllVariantFiles:function(e){var t=this;this.downloadFilesForAllVariants.forEach((function(n){t.pushFileToUsageList("".concat(n.fileName,".").concat(n.fileExtension),e)}))},pushFileToUsageList:function(e,t){this.usageOfFiles[e]||(this.usageOfFiles[e]=[]),this.usageOfFiles[e].push(t)},onTermChange:function(e){this.term=e,this.getList()}}}},EHdy:function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,i){function r(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,r),i(n)},e.once("error",o)),e.once(t,r)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var r,o,a,s;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=l(e))>0&&a.length>r&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,s=u,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=p.bind(i);return r.listener=n,i.wrapFn=r,r}function v(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):h(r,r.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,l=h(u,c);for(n=0;n<c;++n)o(l[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,o,a;if(c(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return v(this,e,!0)},s.prototype.rawListeners=function(e){return v(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},s.prototype.listenerCount=g,s.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},fURA:function(e,t,n){var i=n("/10g");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,n("P8hj").default)("5af93224",i,!0,{})}}]);