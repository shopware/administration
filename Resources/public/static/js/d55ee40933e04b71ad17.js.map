{"version":3,"sources":["webpack:///./src/module/sw-order/component/sw-order-nested-line-items-modal/index.js","webpack:///./src/module/sw-order/component/sw-order-nested-line-items-modal/sw-order-nested-line-items-modal.html.twig","webpack:///./src/module/sw-order/component/sw-order-nested-line-items-modal/sw-order-nested-line-items-modal.scss"],"names":["Filter","Shopware","Criteria","Data","template","inject","props","lineItem","type","Object","required","order","data","isLoading","computed","lineItemRepository","this","repositoryFactory","create","modalTitle","price","getByName","totalPrice","currency","shortName","$tc","lineItemLabel","label","created","createdComponent","methods","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","abrupt","nestingLevel","enrichNestedLineItems","children","stop","nestedLineItems","_arguments","arguments","_this2","_callee2","parentIds","criteria","descendants","_context2","length","undefined","map","id","addFilter","equalsAny","getAssociation","addSorting","naturalSorting","search","Context","api","sent","forEach","nestedLineItem","filter","child","parentId","sort","naturalSort","push","apply","_toConsumableArray","a","b","localeCompare","numeric","ignorePunctuation","onCloseModal","$emit","content","__esModule","default","module","i","locals","exports","add"],"mappings":"iMAOQA,G,UAAWC,SAAXD,QACAE,EAAaD,SAASE,KAAtBD,SAGO,WACXE,SCZW,8nGDcXC,OAAQ,CACJ,qBAGJC,MAAO,CACHC,SAAU,CACNC,KAAMC,OACNC,UAAU,GAGdC,MAAO,CACHH,KAAMC,OACNC,UAAU,IAIlBE,KAAI,WACA,MAAO,CACHC,WAAW,IAInBC,SAAU,CACNC,mBAAkB,WACd,OAAOC,KAAKC,kBAAkBC,OAAO,oBAGzCC,WAAU,WACN,IAAMC,EAAQpB,EAAOqB,UAAU,WAAjBrB,CAA6BgB,KAAKT,SAASe,WAAYN,KAAKL,MAAMY,SAASC,WAEzF,OAAOR,KAAKS,IAAI,4CAA6C,EAAG,CAC5DC,cAAeV,KAAKT,SAASoB,MAC7BP,YAKZQ,QAAO,WACHZ,KAAKa,oBAGTC,QAAS,CACCD,iBAAgB,WAAI,IAADE,EAAA,YAAAC,IAAAC,IAAAC,MAAA,SAAAC,IAAA,OAAAF,IAAAG,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACC,OAAlBR,EAAKxB,SAAiB,CAAA8B,EAAAE,KAAA,eAAAF,EAAAG,OAAA,iBAIK,OAD/BT,EAAKlB,WAAY,EACjBkB,EAAKxB,SAASkC,aAAe,EAAEJ,EAAAE,KAAA,EAEzBR,EAAKW,sBAAsBX,EAAKxB,SAASoC,UAAU,KAAD,mBAAAN,EAAAO,UAAAT,MAPnCH,IAiBnBU,sBAAqB,SAACG,GAAoC,IAADC,EAAAC,UAAAC,EAAA,YAAAhB,IAAAC,IAAAC,MAAA,SAAAe,IAAA,IAAAR,EAAAS,EAAAC,EAAAR,EAAAS,EAAA,OAAAnB,IAAAG,MAAA,SAAAiB,GAAA,cAAAA,EAAAf,KAAAe,EAAAd,MAAA,OAAF,GAAhBE,EAAYK,EAAAQ,OAAA,QAAAC,IAAAT,EAAA,GAAAA,EAAA,GAAG,IAChC,OAApBD,GAA4BA,EAAgBS,QAAU,GAAC,CAAAD,EAAAd,KAAA,QAChC,OAAvBS,EAAKnC,WAAY,EAAMwC,EAAAb,OAAA,iBAWuB,OAN5CU,EAAYL,EAAgBW,KAAI,SAAAjD,GAAQ,OAAIA,EAASkD,OACrDN,EAAY,IAAIjD,EAAS,EAAG,IAC7BwD,UAAUxD,EAASyD,UAAU,WAAYT,KAGzCU,eAAe,YACfC,WAAW3D,EAAS4D,eAAe,UAAUT,EAAAd,KAAA,EAE3BS,EAAKjC,mBAAmBgD,OAAOZ,EAAUlD,SAAS+D,QAAQC,KAAK,KAAD,EASlF,OATGtB,EAAQU,EAAAa,KAERd,EAAc,GACpBP,EAAgBsB,SAAQ,SAACC,GACrBA,EAAe3B,aAAeA,EAC9B2B,EAAezB,SAAWA,EAAS0B,QAAO,SAAAC,GAAK,OAAIA,EAAMC,WAAaH,EAAeX,MACrFW,EAAezB,SAAS6B,KAAKxB,EAAKyB,aAElCrB,EAAYsB,KAAIC,MAAhBvB,EAAWwB,IAASR,EAAezB,cACpCU,EAAAd,KAAA,GAEGS,EAAKN,sBAAsBU,EAAaX,EAAe,GAAG,KAAD,oBAAAY,EAAAT,UAAAK,MA1BJjB,IA6B/DyC,YAAW,SAACI,EAAGC,GACX,OAAOD,EAAElD,MAAMoD,cACXD,EAAEnD,MACF,QACA,CACIqD,SAAS,EACTC,mBAAmB,KAK/BC,aAAY,WACRlE,KAAKmE,MAAM,mB,8CE/GvB,IAAIC,EAAU,EAAQ,QACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACG,EAAOC,EAAIJ,EAAS,MAC7DA,EAAQK,SAAQF,EAAOG,QAAUN,EAAQK,SAG/BE,EADH,EAAQ,QAAwEL,SACzE,WAAYF,GAAS,EAAM","file":"static/js/d55ee40933e04b71ad17.js","sourcesContent":["import template from './sw-order-nested-line-items-modal.html.twig';\nimport './sw-order-nested-line-items-modal.scss';\n\n/**\n * @package checkout\n */\n\nconst { Filter } = Shopware;\nconst { Criteria } = Shopware.Data;\n\n// eslint-disable-next-line sw-deprecation-rules/private-feature-declarations\nexport default {\n    template,\n\n    inject: [\n        'repositoryFactory',\n    ],\n\n    props: {\n        lineItem: {\n            type: Object,\n            required: true,\n        },\n\n        order: {\n            type: Object,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            isLoading: false,\n        };\n    },\n\n    computed: {\n        lineItemRepository() {\n            return this.repositoryFactory.create('order_line_item');\n        },\n\n        modalTitle() {\n            const price = Filter.getByName('currency')(this.lineItem.totalPrice, this.order.currency.shortName);\n\n            return this.$tc('sw-order.nestedLineItemsModal.titlePrefix', 0, {\n                lineItemLabel: this.lineItem.label,\n                price,\n            });\n        },\n    },\n\n    created() {\n        this.createdComponent();\n    },\n\n    methods: {\n        async createdComponent() {\n            if (this.lineItem === null) {\n                return;\n            }\n            this.isLoading = true;\n            this.lineItem.nestingLevel = 0;\n\n            await this.enrichNestedLineItems(this.lineItem.children);\n        },\n\n        /**\n         * Fetches all children by their parentIds and also adds the children of that result via association.\n         * Therefore, each recursive loop iteration will add 2 additional nesting levels at once with one request.\n         *\n         * @param nestedLineItems - A (children) lineItem collection, to be enriched with all descendants\n         * @return {Promise<void>}\n         */\n        async enrichNestedLineItems(nestedLineItems, nestingLevel = 1) {\n            if (nestedLineItems === null || nestedLineItems.length <= 0) {\n                this.isLoading = false;\n\n                return;\n            }\n\n            const parentIds = nestedLineItems.map(lineItem => lineItem.id);\n            const criteria = (new Criteria(1, 25))\n                .addFilter(Criteria.equalsAny('parentId', parentIds));\n\n            criteria\n                .getAssociation('children')\n                .addSorting(Criteria.naturalSorting('label'));\n\n            const children = await this.lineItemRepository.search(criteria, Shopware.Context.api);\n\n            const descendants = [];\n            nestedLineItems.forEach((nestedLineItem) => {\n                nestedLineItem.nestingLevel = nestingLevel;\n                nestedLineItem.children = children.filter(child => child.parentId === nestedLineItem.id);\n                nestedLineItem.children.sort(this.naturalSort);\n\n                descendants.push(...nestedLineItem.children);\n            });\n\n            await this.enrichNestedLineItems(descendants, nestingLevel + 1);\n        },\n\n        naturalSort(a, b) {\n            return a.label.localeCompare(\n                b.label,\n                'en-GB',\n                {\n                    numeric: true,\n                    ignorePunctuation: true,\n                },\n            );\n        },\n\n        onCloseModal() {\n            this.$emit('modal-close');\n        },\n    },\n};\n","export default \"\\n{% block sw_order_nested_line_item_modal %}\\n<sw-modal\\n    class=\\\"sw-order-nested-line-items-modal\\\"\\n    variant=\\\"large\\\"\\n    :title=\\\"modalTitle\\\"\\n    @modal-close=\\\"onCloseModal\\\"\\n>\\n\\n    \\n    {% block sw_order_nested_line_item_modal_loader %}\\n    <sw-loader\\n        v-if=\\\"isLoading\\\"\\n        class=\\\"sw-order-nested-line-items-modal__loader\\\"\\n    />\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_nested_line_item_modal_container %}\\n    <div\\n        v-else\\n        class=\\\"sw-order-nested-line-items-modal__container\\\"\\n    >\\n\\n        \\n        {% block sw_order_nested_line_item_modal_header_container %}\\n        <div class=\\\"sw-order-nested-line-items-modal__header-container\\\">\\n\\n            \\n            {% block sw_order_nested_line_item_modal_header_label %}\\n            <div class=\\\"sw-order-nested-line-items-modal__header-label sw-order-nested-line-items-modal__header-item\\\">\\n                {{ $tc('sw-order.nestedLineItemsModal.headerLabel') }}\\n            </div>\\n            {% endblock %}\\n\\n            \\n            {% block sw_order_nested_line_item_modal_header_unit_price %}\\n            <div class=\\\"sw-order-nested-line-items-modal__header-unit-price sw-order-nested-line-items-modal__header-item\\\">\\n                {{ $tc('sw-order.nestedLineItemsModal.headerUnitPrice') }}\\n            </div>\\n            {% endblock %}\\n\\n            \\n            {% block sw_order_nested_line_item_modal_header_quantity %}\\n            <div class=\\\"sw-order-nested-line-items-modal__header-quantity sw-order-nested-line-items-modal__header-item\\\">\\n                {{ $tc('sw-order.nestedLineItemsModal.headerQuantity') }}\\n            </div>\\n            {% endblock %}\\n\\n            \\n            {% block sw_order_nested_line_item_modal_header_total_price %}\\n            <div class=\\\"sw-order-nested-line-items-modal__header-total-price sw-order-nested-line-items-modal__header-item\\\">\\n                {{ $tc('sw-order.nestedLineItemsModal.headerTotalPrice') }}\\n            </div>\\n            {% endblock %}\\n\\n            \\n            {% block sw_order_nested_line_item_modal_header_tax %}\\n            <div class=\\\"sw-order-nested-line-items-modal__header-tax sw-order-nested-line-items-modal__header-item\\\">\\n                {{ $tc('sw-order.nestedLineItemsModal.headerTax') }}\\n            </div>\\n            {% endblock %}\\n\\n        </div>\\n        {% endblock %}\\n\\n        \\n        {% block sw_order_nested_line_item_modal_content %}\\n        <sw-order-nested-line-items-row\\n            class=\\\"sw-order-nested-line-items-modal__content\\\"\\n            :line-item=\\\"lineItem\\\"\\n            :currency=\\\"order.currency\\\"\\n        />\\n        {% endblock %}\\n\\n    </div>\\n    {% endblock %}\\n\\n    \\n    {% block sw_order_nested_line_item_modal_footer %}\\n    <template #modal-footer>\\n\\n        \\n        {% block sw_order_nested_line_item_modal_footer_content %}\\n        <sw-button\\n            variant=\\\"primary\\\"\\n            size=\\\"small\\\"\\n            @click=\\\"onCloseModal\\\"\\n        >\\n            {{ $tc('global.default.close') }}\\n        </sw-button>\\n        {% endblock %}\\n\\n    </template>\\n    {% endblock %}\\n\\n</sw-modal>\\n{% endblock %}\\n\";","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--15-1!../../../../../node_modules/css-loader/dist/cjs.js??ref--15-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--15-3!./sw-order-nested-line-items-modal.scss\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"740d6f22\", content, true, {});"],"sourceRoot":""}