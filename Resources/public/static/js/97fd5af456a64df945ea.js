(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[477],{"41ws":function(t,e,n){"use strict";n.r(e);var a=n("7yzw"),i=n.n(a),s=n("92Mt"),l=n.n(s),o=(n("TWyo"),Shopware.Mixin),r=Shopware.Data.Criteria;e.default={template:'\n{% block sw_settings_list %}\n\n{% block sw_settings_tax_index %}\n<sw-page class="sw-settings-tax-list">\n    \n    {% block sw_settings_tax_list_search_bar %}\n    <template #search-bar>\n        <sw-search-bar\n            initial-search-type="tax"\n            :placeholder="$tc(\'sw-settings-tax.general.placeholderSearchBar\')"\n            :initial-search="term"\n            @search="onSearch"\n        />\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_tax_list_smart_bar_header %}\n    <template #smart-bar-header>\n        \n        {% block sw_settings_tax_list_smart_bar_header_title %}\n        <h2>\n            \n            {% block sw_settings_tax_list_smart_bar_header_title_text %}\n            {{ $tc(\'sw-settings.index.title\') }} <sw-icon\n                name="regular-chevron-right-xs"\n                small\n            /> {{ $tc(\'sw-settings-tax.list.textHeadline\') }}\n            {% endblock %}\n\n            \n            {% block sw_settings_tax_list_smart_bar_header_amount %}\n            <span\n                v-if="!isLoading"\n                class="sw-page__smart-bar-amount"\n            >\n                ({{ total }})\n            </span>\n            {% endblock %}\n        </h2>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    \n    {% block sw_settings_tax_list_smart_bar_actions %}\n    <template #smart-bar-actions>\n        \n        {% block sw_settings_tax_list_smart_bar_actions_add %}\n        <sw-button\n            v-tooltip.bottom="{\n                message: $tc(\'sw-privileges.tooltip.warning\'),\n                disabled: acl.can(\'tax.creator\'),\n                showOnDisabledElements: true\n            }"\n            class="sw-settings-tax-list__button-create"\n            variant="primary"\n            :disabled="!acl.can(\'tax.creator\')"\n            :router-link="{ name: \'sw.settings.tax.create\' }"\n        >\n            {{ $tc(\'sw-settings-tax.list.buttonAddTax\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n\n    <template #language-switch>\n        <sw-language-switch\n            @on-change="onChangeLanguage"\n        />\n    </template>\n\n    \n    {% block sw_settings_tax_list_content %}\n    <template #content>\n        <sw-card-view>\n            \n            {% block sw_settings_tax_list_content_card %}\n            <sw-card\n                position-identifier="sw-settings-tax-list-content"\n                class="sw-tax-card"\n                :title="$tc(\'sw-settings-tax.list.taxCardTitle\')"\n                :is-loading="isLoading"\n            >\n                <template #grid>\n                    \n                    {% block sw_settings_tax_list_grid %}\n                    <sw-entity-listing\n                        ref="swSettingsTaxGrid"\n                        class="sw-settings-tax-list-grid"\n                        detail-route="sw.settings.tax.detail"\n                        :items="tax"\n                        :columns="getTaxColumns()"\n                        :repository="taxRepository"\n                        :full-page="false"\n                        :show-selection="false"\n                        :is-loading="isLoading"\n                        :allow-view="acl.can(\'tax.viewer\')"\n                        :allow-edit="acl.can(\'tax.editor\')"\n                        :allow-inline-edit="acl.can(\'tax.editor\')"\n                        :allow-delete="acl.can(\'tax.deleter\')"\n                        :disable-data-fetching="true"\n                        :sort-by="sortBy"\n                        :sort-direction="sortDirection"\n                        @column-sort="onSortColumn"\n                        @page-change="onPageChange"\n                        @inline-edit-save="onInlineEditSave"\n                        @inline-edit-cancel="onInlineEditCancel"\n                    >\n                        \n                        {% block sw_settings_tax_list_grid_column_default_name %}\n                        <template #column-name="{ item, column, isInlineEdit, compact }">\n                            {# if it is not a default tax, the default slot content will be rendered #}\n                            <router-link\n                                v-if="isShopwareDefaultTax(item)"\n                                class="sw-data-grid__cell-value"\n                                :to="{ name: column.routerLink, params: { id: item.id } }"\n                            >\n                                {{ getLabel(item) }}\n                            </router-link>\n                        </template>\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_tax_list_grid_column_default_tax_rate %}\n                        <template #column-taxRate="{ item, isInlineEdit, compact }">\n                            <template v-if="isInlineEdit">\n                                <sw-number-field\n                                    {% if VUE3 %}\n                                    v-model:value="item.taxRate"\n                                    {% else %}\n                                    v-model="item.taxRate"\n                                    {% endif %}\n                                    :digits="3"\n                                    :size="compact ? \'small\' : \'default\'"\n                                >\n                                    <template #suffix>\n                                        <span>\n                                            <span v-html="$sanitize($tc(\'sw-settings-tax.general.taxRateSymbol\'))"></span>\n                                        </span>\n                                    </template>\n                                </sw-number-field>\n                            </template>\n                            <template v-else>\n                                {{ item.taxRate }}%\n                            </template>\n                        </template>\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_tax_list_grid_column_default %}\n                        <template #column-default="{ item, isInlineEdit }">\n                            <template v-if="isInlineEdit">\n                                \n                                {% block sw_settings_tax_list_grid_column_default_editor %}\n                                <sw-checkbox-field\n                                    :value="isSelectedDefaultRate(item)"\n                                    {% if VUE3 %}\n                                    @update:value="value => setSelectedDefaultRate(value, item.id)"\n                                    {% else %}\n                                    @change="value => setSelectedDefaultRate(value, item.id)"\n                                    {% endif %}\n                                />\n                                {% endblock %}\n                            </template>\n                            <template v-else>\n                                \n                                {% block sw_settings_tax_list_grid_column_default_label %}\n                                <sw-icon\n                                    v-if="isSelectedDefaultRate(item)"\n                                    name="regular-checkmark-xs"\n                                    small\n                                    class="is--active"\n                                />\n                                <div v-else></div>\n                                {% endblock %}\n                            </template>\n                        </template>\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_tax_list_grid_columns_actions %}\n                        <template #actions="{ item }">\n                            \n                            {% block sw_settings_tax_list_grid_columns_actions_edit %}\n                            <sw-context-menu-item\n                                class="sw-tax-list__edit-action"\n                                :disabled="!acl.can(\'tax.editor\')"\n                                :router-link="{\n                                    name: \'sw.settings.tax.detail\',\n                                    params: { id: item.id, edit: \'edit\' }\n                                }"\n                            >\n                                {{ $tc(\'sw-settings-tax.list.contextMenuEdit\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n\n                            \n                            {% block sw_settings_tax_list_grid_columns_actions_delete %}\n                            <sw-context-menu-item\n                                class="sw-tax-list__delete-action"\n                                variant="danger"\n                                :disabled="!acl.can(\'tax.deleter\')"\n                                @click="onDelete(item.id)"\n                            >\n                                {{ $tc(\'sw-settings-tax.list.contextMenuDelete\') }}\n                            </sw-context-menu-item>\n                            {% endblock %}\n                        </template>\n                        {% endblock %}\n\n                        \n                        {% block sw_settings_tax_list_grid_action_modals %}\n                        <template #action-modals="{ item }">\n                            \n                            {% block sw_settings_tax_list_delete_modal %}\n                            <sw-modal\n                                v-if="showDeleteModal === item.id"\n                                :title="$tc(\'global.default.warning\')"\n                                variant="small"\n                                @modal-close="onCloseDeleteModal"\n                            >\n                                \n                                {% block sw_settings_tax_list_delete_modal_confirm_delete_text %}\n                                <p class="sw-settings-tax-list__confirm-delete-text">\n                                    {{ $tc(\'sw-settings-tax.list.textDeleteConfirm\', 0, { name: item.name }) }}\n                                </p>\n                                {% endblock %}\n\n                                \n                                {% block sw_settings_tax_list_delete_modal_footer %}\n                                <template #modal-footer>\n                                    \n                                    {% block sw_settings_tax_list_delete_modal_cancel %}\n                                    <sw-button\n                                        size="small"\n                                        @click="onCloseDeleteModal"\n                                    >\n                                        {{ $tc(\'sw-settings-tax.list.buttonCancel\') }}\n                                    </sw-button>\n                                    {% endblock %}\n\n                                    \n                                    {% block sw_settings_tax_list_delete_modal_confirm %}\n                                    <sw-button\n                                        variant="danger"\n                                        size="small"\n                                        @click="onConfirmDelete(item.id)"\n                                    >\n                                        {{ $tc(\'sw-settings-tax.list.buttonDelete\') }}\n                                    </sw-button>\n                                    {% endblock %}\n                                </template>\n                                {% endblock %}\n                            </sw-modal>\n                            {% endblock %}\n                        </template>\n                        {% endblock %}\n                    </sw-entity-listing>\n                    {% endblock %}\n                </template>\n            </sw-card>\n            {% endblock %}\n\n            <sw-card\n                position-identifier="sw-settings-tax-provider-list-content"\n                class="sw-settings-tax-provider-list-content"\n                :title="$tc(\'sw-settings-tax.list.taxProvider.cardTitle\')"\n                :is-loading="isLoading"\n            >\n                <template #grid>\n                    <template v-if="showChangePriority">\n                        <div class="sw-settings-tax-provider-list-content__bg">\n                            <sw-button-process\n                                class="sw-settings-tax-provider-list-button__change-priority"\n                                :disabled="isLoading"\n                                :is-loading="isLoading"\n                                :process-success="false"\n                                variant="ghost"\n                                @click="showSortingModal = true"\n                            >\n                                {{ $tc(\'sw-settings-tax.list.taxProvider.changePriorityButton\') }}\n                            </sw-button-process>\n                        </div>\n                    </template>\n\n                    <template v-if="!isLoading">\n                        <sw-empty-state\n                            v-if="noTaxProvidersFound"\n                            :title="$tc(\'sw-settings-tax.list.taxProvider.messageEmptyTitle\')"\n                            :absolute="false"\n                            :show-description="false"\n                        />\n\n                        <div\n                            v-else\n                            class="sw-tax-provider-items"\n                        >\n                            <template\n                                v-for="taxProvider in taxProviders"\n                            >\n                                <div\n                                    :key="taxProvider.id"\n                                    class="sw-tax-provider-item"\n                                >\n                                    <div class="sw-tax-provider__name">\n                                        {{ taxProvider.translated.name }}\n                                    </div>\n\n                                    <div class="sw-tax-provider__link">\n                                        <router-link\n                                            class="sw-tax-provider__show-detail-link"\n                                            :to="editLink(taxProvider.id)"\n                                            :disabled="!acl.can(\'tax.editor\')"\n                                        >\n                                            {{ $tc(\'sw-settings-tax.list.taxProvider.editDetailsLink\') }}\n                                        </router-link>\n                                    </div>\n\n                                    <sw-switch-field\n                                        :label="$tc(\'sw-settings-tax.list.taxProvider.labelActive\')"\n                                        :disabled="!acl.can(\'tax.editor\')"\n                                        :value="taxProvider.active"\n                                        {% if VUE3 %}\n                                        @update:value="onChangeTaxProviderActive(taxProvider)"\n                                        {% else %}\n                                        @change="onChangeTaxProviderActive(taxProvider)"\n                                        {% endif %}\n                                    />\n                                </div>\n                            </template>\n                        </div>\n                    </template>\n\n                    <template v-else>\n                        <sw-skeleton />\n                    </template>\n                </template>\n            </sw-card>\n\n            <sw-settings-tax-provider-sorting-modal\n                v-if="showSortingModal"\n                :tax-providers="taxProviders"\n                @modal-close="showSortingModal = false"\n                @modal-save="loadTaxProviders"\n            />\n        </sw-card-view>\n    </template>\n    {% endblock %}\n</sw-page>\n    {% endblock %}\n{% endblock %}\n',inject:["repositoryFactory","acl","systemConfigApiService"],mixins:[o.getByName("listing"),o.getByName("notification")],data:function(){return{tax:null,taxProviders:null,sortBy:"position",isLoading:!1,sortDirection:"ASC",naturalSorting:!1,showDeleteModal:!1,defaultTaxRateId:null,selectedDefaultTaxRateId:null,showSortingModal:!1}},metaInfo:function(){return{title:this.$createTitle()}},computed:{taxRepository:function(){return this.repositoryFactory.create("tax")},taxProviderRepository:function(){return this.repositoryFactory.create("tax_provider")},taxProviderCriteria:function(){var t=new r(this.page,this.limit);return t.addSorting(r.sort("priority","DESC")),t},showChangePriority:function(){var t;return(null===(t=this.taxProviders)||void 0===t?void 0:t.length)>1},noTaxProvidersFound:function(){var t;return(null===(t=this.taxProviders)||void 0===t?void 0:t.length)<1}},methods:{getList:function(){var t=this,e=new r(this.page,this.limit);this.isLoading=!0,this.naturalSorting="name"===this.sortBy,e.setTerm(this.term),e.addSorting(r.sort(this.sortBy,this.sortDirection,this.naturalSorting)),"name"!==this.sortBy&&e.addSorting(r.sort("name","ASC",!0)),this.getDefaultTaxRate().then((function(e){t.defaultTaxRateId=e,t.selectedDefaultRate=e})),this.taxRepository.search(e).then((function(e){return t.total=e.total,t.tax=e,t.isLoading=!1,e})).catch((function(){t.isLoading=!1})),this.loadTaxProviders()},editLink:function(t){return{name:"sw.settings.tax.tax_provider.detail",params:{id:t}}},onChangeLanguage:function(t){Shopware.State.commit("context/setApiLanguageId",t),this.getList()},onInlineEditSave:function(t,e){var n=this;return i()(l.a.mark((function a(){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.then((function(){n.selectedDefaultTaxRateId!==n.defaultTaxRateId?n.systemConfigApiService.saveValues({"core.tax.defaultTaxRate":n.selectedDefaultTaxRateId}).then((function(){n.defaultTaxRateId=n.selectedDefaultTaxRateId,n.createNotificationSuccess({message:n.$tc("sw-settings-tax.detail.messageSaveSuccess",0,{name:e.name})})})).catch((function(){n.getList(),n.createNotificationError({message:n.$tc("sw-settings-tax.detail.messageSaveError")})})):n.createNotificationSuccess({message:n.$tc("sw-settings-tax.detail.messageSaveSuccess",0,{name:e.name})})})).catch((function(){n.createNotificationError({message:n.$tc("sw-settings-tax.detail.messageSaveError")})}));case 1:case"end":return a.stop()}}),a)})))()},onInlineEditCancel:function(t){var e=this;return i()(l.a.mark((function n(){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t;case 2:e.selectedDefaultTaxRateId=null,e.getDefaultTaxRate().then((function(t){e.defaultTaxRateId=t}));case 4:case"end":return n.stop()}}),n)})))()},onDelete:function(t){this.showDeleteModal=t},onCloseDeleteModal:function(){this.showDeleteModal=!1},onConfirmDelete:function(t){var e=this;return this.showDeleteModal=!1,this.taxRepository.delete(t).then((function(){e.getList()}))},getTaxColumns:function(){return[{property:"name",dataIndex:"name",inlineEdit:"string",label:"sw-settings-tax.list.columnName",routerLink:"sw.settings.tax.detail",width:"250px",primary:!0},{property:"taxRate",inlineEdit:"number",label:"sw-settings-tax.list.columnDefaultTaxRate"},{property:"default",inlineEdit:"boolean",label:"sw-settings-tax.list.columnDefault"}]},isShopwareDefaultTax:function(t){return this.$te("global.tax-rates.".concat(t.name),"en-GB")},getLabel:function(t){return this.isShopwareDefaultTax(t)?this.$tc("global.tax-rates.".concat(t.name)):t.name},isSelectedDefaultRate:function(t){return this.defaultTaxRateId===t.id},setSelectedDefaultRate:function(t,e){this.selectedDefaultTaxRateId=t?e:null},getDefaultTaxRate:function(){return this.systemConfigApiService.getValues("core.tax").then((function(t){var e;return null!==(e=t["core.tax.defaultTaxRate"])&&void 0!==e?e:null})).catch((function(){return null}))},loadTaxProviders:function(){var t=this;this.isLoading=!0,this.taxProviderRepository.search(this.taxProviderCriteria).then((function(e){t.taxProviders=e})).finally((function(){t.isLoading=!1}))},onChangeTaxProviderActive:function(t){var e=this;t.active=!t.active,this.taxProviderRepository.save(t,Shopware.Context.api).then((function(){var n=t.active?"active":"inactive";e.createNotificationSuccess({message:e.$tc("sw-settings-tax.list.taxProvider.statusChangedSuccess.".concat(n),0,{name:t.translated.name})})}))}}}},TWyo:function(t,e,n){var a=n("VUAr");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n("P8hj").default)("4cbc8826",a,!0,{})},VUAr:function(t,e,n){}}]);