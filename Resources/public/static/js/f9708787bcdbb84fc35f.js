(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[571],{HFQo:function(t,e,n){"use strict";n.r(e);var a=n("7yzw"),r=n.n(a),o=n("6lmj"),i=n.n(o),s=n("92Mt"),l=n.n(s),d=Shopware,c=d.Component,m=d.Mixin,u=Shopware.Data.Criteria;e.default=c.wrapComponentConfig({template:'\n{% block sw_order_state_history_modal %}\n<sw-modal\n    :title="$tc(\'sw-order.stateHistoryModal.modalTitle\')"\n    :is-loading="isLoading"\n    variant="large"\n    @modal-close="onClose"\n>\n    \n    {% block sw_order_state_history_modal_content %}\n    <sw-data-grid\n        :columns="columns"\n        :data-source="dataSource"\n        :is-loading="isLoading || statesLoading"\n        :plain-appearance="true"\n        :show-selection="false"\n        :show-actions="false"\n    >\n\n        \n        {% block sw_order_state_history_modal_content_columns_created_at %}\n        <template #column-createdAt="{ item }">\n            <sw-time-ago :date="item.createdAt" />\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_order_state_history_modal_content_columns_entity %}\n        <template #column-entity="{ item }">\n            {{ $tc(\'global.entities.\' + item.entity) }}\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_order_state_history_modal_content_columns_user %}\n        <template #column-user="{ item }">\n            {{ item.user?.username ?? $tc(\'sw-order.stateHistoryModal.labelSystemUser\') }}\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_order_state_history_modal_content_columns_order_state %}\n        <template #column-order="{ item }">\n            <sw-label\n                :variant="getVariantState(\'order\', item.order)"\n                appearance="badged"\n            >\n                {{ item.order.translated.name }}\n            </sw-label>\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_order_state_history_modal_content_columns_delivery_state %}\n        <template #column-delivery="{ item }">\n            <sw-label\n                v-if="item.delivery"\n                :variant="getVariantState(\'order_delivery\', item.delivery)"\n                appearance="badged"\n            >\n                {{ item.delivery.translated.name }}\n            </sw-label>\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_order_state_history_modal_content_columns_transaction_state %}\n        <template #column-transaction="{ item }">\n            <sw-label\n                :variant="getVariantState(\'order_transaction\', item.transaction)"\n                appearance="badged"\n            >\n                {{ item.transaction.translated.name }}\n            </sw-label>\n        </template>\n        {% endblock %}\n\n        <template #pagination>\n            <sw-pagination\n                :page="page"\n                :limit="limit"\n                :total="total"\n                :steps="steps"\n                @page-change="onPageChange"\n            />\n        </template>\n    </sw-data-grid>\n    {% endblock %}\n\n    \n    {% block sw_order_state_history_modal_actions %}\n    <template #modal-footer>\n        \n        {% block sw_order_state_history_modal_action_close %}\n        <sw-button\n            size="small"\n            @click="onClose"\n        >\n            {{ $tc(\'global.default.close\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n\n',inject:["repositoryFactory","stateStyleDataProviderService"],mixins:[m.getByName("notification")],props:{order:{type:Object,required:!0},isLoading:{type:Boolean,required:!0}},data:function(){return{dataSource:[],statesLoading:!0,limit:10,page:1,total:0,steps:[5,10,25]}},computed:{stateMachineHistoryRepository:function(){return this.repositoryFactory.create("state_machine_history")},stateMachineHistoryCriteria:function(){var t,e,n=new u(this.page,this.limit),a=[this.order.id].concat(i()((null!==(t=this.order.transactions)&&void 0!==t?t:[]).map((function(t){return t.id}))),i()((null!==(e=this.order.deliveries)&&void 0!==e?e:[]).map((function(t){return t.id}))));return n.addFilter(u.equalsAny("state_machine_history.entityId.id",a)),n.addFilter(u.equalsAny("state_machine_history.entityName",["order","order_transaction","order_delivery"])),n.addAssociation("fromStateMachineState"),n.addAssociation("toStateMachineState"),n.addAssociation("user"),n.addSorting({field:"state_machine_history.createdAt",order:"ASC",naturalSorting:!1}),n},columns:function(){return[{property:"createdAt",label:this.$tc("sw-order.stateHistoryModal.column.createdAt")},{property:"entity",label:this.$tc("sw-order.stateHistoryModal.column.entity")},{property:"user",label:this.$tc("sw-order.stateHistoryModal.column.user")},{property:"transaction",label:this.$tc("sw-order.stateHistoryModal.column.transaction")},{property:"delivery",label:this.$tc("sw-order.stateHistoryModal.column.delivery")},{property:"order",label:this.$tc("sw-order.stateHistoryModal.column.order")}]}},created:function(){this.createdComponent()},methods:{createdComponent:function(){this.loadHistory()},loadHistory:function(){var t=this;return r()(l.a.mark((function e(){var n,a,r,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.statesLoading=!0,e.prev=1,e.next=4,t.getStateHistoryEntries();case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),i=(null===e.t0||void 0===e.t0||null===(n=e.t0.response)||void 0===n||null===(a=n.data)||void 0===a||null===(r=a.errors)||void 0===r||null===(o=r[0])||void 0===o?void 0:o.detail)||"",t.createNotificationError({message:i});case 10:return e.prev=10,t.statesLoading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[1,6,10,13]])})))()},getStateHistoryEntries:function(){var t=this;return this.stateMachineHistoryRepository.search(this.stateMachineHistoryCriteria).then((function(e){var n;return t.dataSource=t.buildStateHistory(e),t.total=null!==(n=e.total)&&void 0!==n?n:1,Promise.resolve(e)}))},buildStateHistory:function(t){var e,n,a,r,o,i,s,l,d,c,m=this,u={order:null!==(e=null===(n=t.filter((function(t){return"order"===t.entityName}))[0])||void 0===n?void 0:n.fromStateMachineState)&&void 0!==e?e:this.order.stateMachineState,order_transaction:null!==(a=null===(r=t.filter((function(t){return"order_transaction"===t.entityName}))[0])||void 0===r?void 0:r.fromStateMachineState)&&void 0!==a?a:null===(o=this.order.transactions)||void 0===o||null===(i=o.last())||void 0===i?void 0:i.stateMachineState,order_delivery:null!==(s=null===(l=t.filter((function(t){return"order_delivery"===t.entityName}))[0])||void 0===l?void 0:l.fromStateMachineState)&&void 0!==s?s:null===(d=this.order.deliveries)||void 0===d||null===(c=d.first())||void 0===c?void 0:c.stateMachineState},y=[];return 1===this.page&&y.push(this.createEntry(u,this.order)),t.forEach((function(t){u[t.entityName]=t.toStateMachineState,y.push(m.createEntry(u,t))})),y},createEntry:function(t,e){return{order:t.order,transaction:t.order_transaction,delivery:t.order_delivery,createdAt:"orderDateTime"in e?e.orderDateTime:e.createdAt,user:"user"in e?e.user:void 0,entity:"entityName"in e?e.entityName:"order"}},getVariantState:function(t,e){return this.stateStyleDataProviderService.getStyle("".concat(t,".state"),e.technicalName).variant},onClose:function(){this.$emit("modal-close")},onPageChange:function(t){var e=t.page,n=t.limit;this.page=e,this.limit=n,this.loadHistory()}}})}}]);
//# sourceMappingURL=f9708787bcdbb84fc35f.js.map