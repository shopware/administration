(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[255],{SvYt:function(e,t,n){},reWF:function(e,t,n){"use strict";n.r(t);var i=n("c1oF"),l=n.n(i),a=n("6lmj"),o=n.n(a),s=n("CsSd"),r=n.n(s),c=n("2wIO");n("x9U4");function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=Shopware,u=p.Component,f=p.Utils,w=p.Classes.ShopwareError,h=Shopware.Data.Criteria,_=u.getComponentHelper().mapState;t.default={template:'\n{% block sw_flow_mail_send_modal %}\n<sw-modal\n    class="sw-flow-mail-send-modal"\n    :title="$tc(\'sw-flow.modals.mail.titleSendMail\')"\n    :closable="false"\n    @modal-close="onClose"\n>\n    <sw-single-select\n        :value="replyToSelection"\n        class="sw-flow-mail-send-modal__use-different-reply-to"\n        :options="replyToOptions"\n        :label="$tc(\'sw-flow.modals.mail.useDifferentReplyToLabel\')"\n        :help-text="buildReplyToTooltip(\'sw-flow.modals.mail.tooltipDifferentReplyTo\')"\n        {% if VUE3 %}\n        @update:value="changeShowReplyToField"\n        {% else %}\n        @change="changeShowReplyToField"\n        {% endif %}\n    />\n\n    <sw-text-field\n        v-if="showReplyToField"\n        {% if VUE3 %}\n        v-model:value="replyTo"\n        {% else %}\n        v-model="replyTo"\n        {% endif %}\n        class="sw-flow-mail-send-modal__reply-to"\n        :label="$tc(\'sw-flow.modals.mail.labelReplyTo\')"\n        :placeholder="$tc(\'sw-flow.modals.mail.placeholderReplyTo\')"\n        :error="replyToError"\n        required\n        @change="replyToError = null"\n    />\n\n    \n    {% block sw_flow_mail_send_modal_recipient %}\n    <sw-single-select\n        {% if VUE3 %}\n        v-model:value="mailRecipient"\n        {% else %}\n        v-model="mailRecipient"\n        {% endif %}\n        class="sw-flow-mail-send-modal__recipient"\n        :options="recipientOptions"\n        :label="$tc(\'sw-flow.modals.mail.labelRecipient\')"\n        :placeholder="$tc(\'sw-flow.modals.mail.placeholderRecipient\')"\n        {% if VUE3 %}\n        @update:value="onChangeRecipient"\n        {% else %}\n        @change="onChangeRecipient"\n        {% endif %}\n    />\n    {% endblock %}\n    \n    {% block sw_flow_mail_send_modal_recipient_emails_grid %}\n    <sw-data-grid\n        v-if="showRecipientEmails"\n        ref="recipientsGrid"\n        class="sw-flow-mail-send-modal__recipient-grid"\n        :class="recipientGridError ? \'has--error\' : \'\'"\n        :data-source="recipients"\n        :columns="recipientColumns"\n        :show-selection="false"\n        :plain-appearance="true"\n        @inline-edit-save="saveRecipient"\n        @inline-edit-cancel="cancelSaveRecipient"\n    >\n\n        \n        {% block sw_event_action_detail_recipients_grid_column_email %}\n        <template #column-email="{ item, column, isInlineEdit, compact }">\n            <sw-text-field\n                v-if="isInlineEdit"\n                {% if VUE3 %}\n                v-model:value="item.email"\n                {% else %}\n                v-model="item.email"\n                {% endif %}\n                class="sw-flow-mail-send-modal__recipient-email"\n                :size="compact ? \'small\' : \'default\'"\n                :error="item.errorMail"\n                :placeholder="$tc(\'sw-flow.modals.mail.placeholderRecipientEmailAddress\')"\n            />\n            <template v-else>\n                {{ item.email }}\n            </template>\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_event_action_detail_recipients_grid_column_name %}\n        <template #column-name="{ item, column, isInlineEdit, compact }">\n            <sw-text-field\n                v-if="isInlineEdit"\n                {% if VUE3 %}\n                v-model:value="item.name"\n                {% else %}\n                v-model="item.name"\n                {% endif %}\n                class="sw-flow-mail-send-modal__recipient-name"\n                :size="compact ? \'small\' : \'default\'"\n                :error="item.errorName"\n                :placeholder="$tc(\'sw-flow.modals.mail.placeholderRecipientName\')"\n            />\n            <template v-else>\n                {{ item.name }}\n            </template>\n        </template>\n        {% endblock %}\n\n        <template #actions="{ item, itemIndex }">\n            \n            {% block sw_event_action_detail_recipients_grid_action_edit %}\n            <sw-context-menu-item\n                class="sw-flow-mail-send-modal__grid-action-edit"\n                @click="onEditRecipient(item)"\n            >\n                {{ $tc(\'global.default.edit\') }}\n            </sw-context-menu-item>\n            {% endblock %}\n\n            \n            {% block sw_event_action_detail_recipients_grid_action_delete %}\n            <sw-context-menu-item\n                class="sw-flow-mail-send-modal__grid-action-delete"\n                variant="danger"\n                :disabled="!allowDeleteRecipient(itemIndex)"\n                @click="onDeleteRecipient(itemIndex)"\n            >\n                {{ $tc(\'global.default.delete\') }}\n            </sw-context-menu-item>\n            {% endblock %}\n        </template>\n    </sw-data-grid>\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_modal_mail_template_select %}\n    <sw-entity-single-select\n        {% if VUE3 %}\n        v-model:value="mailTemplateId"\n        {% else %}\n        v-model="mailTemplateId"\n        {% endif %}\n        class="sw-flow-mail-send-modal__mail-template-select"\n        required\n        entity="mail_template"\n        value-property="title"\n        label-property="description"\n        :criteria="mailTemplateCriteria"\n        :label="$tc(\'sw-flow.modals.mail.labelEmailTemplate\')"\n        :placeholder="$tc(\'sw-flow.modals.mail.placeholderEmailTemplate\')"\n        :error="mailTemplateIdError"\n        {% if VUE3 %}\n        @update:value="(id, template) => onChangeMailTemplate(id, template)"\n        {% else %}\n        @change="(id, template) => onChangeMailTemplate(id, template)"\n        {% endif %}\n    >\n\n        <template #before-item-list>\n\n            \n            {% block sw_flow_mail_send_modal_mail_template_select_before_list %}\n            <ul class="sw-select-result__item-list">\n                <li\n                    class="sw-select-result sw-select-result__create-new-template"\n                    role="button"\n                    tabindex="0"\n                    @click="onCreateMailTemplate"\n                    @keydown.enter="onCreateMailTemplate"\n                >\n                    {{ $tc(\'sw-flow.modals.mail.titleNewEmailTemplate\') }}\n                </li>\n            </ul>\n            {% endblock %}\n        </template>\n\n        <template #selection-label-property="{ item }">\n            <strong>{{ item.translated.description }}</strong>\n            <template v-if="item.translated.description">\n                -\n            </template>\n            {{ item.mailTemplateType.translated.name }}\n        </template>\n\n        <template #result-label-property="{ item, highlightSearchTerm, labelProperty, searchTerm }">\n            <strong>\n                <sw-highlight-text\n                    :text="item.translated.description"\n                    :search-term="searchTerm"\n                />\n            </strong>\n            {{ item.mailTemplateType.translated.name }}\n        </template>\n    </sw-entity-single-select>\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_modal_mail_template_detail_link %}\n    <div class="sw-flow-mail-send-modal__mail-template-detail">\n        <router-link\n            v-if="mailTemplateId"\n            target="_blank"\n            rel="noopener"\n            :to="{ name: \'sw.mail.template.detail\', params: { id: mailTemplateId } }"\n        >\n            {{ $tc(\'sw-flow.modals.mail.fieldMailTemplateDetailLink\') }}\n        </router-link>\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_modal_document_types %}\n    <sw-entity-multi-id-select\n        {% if VUE3 %}\n        v-model:ids="documentTypeIds"\n        {% else %}\n        v-model="documentTypeIds"\n        {% endif %}\n        :repository="documentTypeRepository"\n        class="sw-flow-mail-send-modal__document-types"\n        :label="$tc(\'sw-flow.modals.mail.labelLatestDocuments\')"\n        :placeholder="$tc(\'sw-flow.modals.mail.placeholderLatestDocuments\')"\n    />\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_create_new_template %}\n    <sw-flow-create-mail-template-modal\n        v-if="showCreateMailTemplateModal"\n        class="sw-flow-mail-send-modal__create-mail-template"\n        @process-finish="onCreateMailTemplateSuccess"\n        @modal-close="onCloseCreateMailTemplateModal"\n    />\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_modal_document_warning %}\n    <sw-alert\n        class="sw-flow-mail-send-modal__document_warning"\n        variant="info"\n    >\n        {{ $tc(\'sw-flow.modals.mail.documentDescription\') }}\n    </sw-alert>\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_modal_custom %}\n    {% endblock %}\n\n    \n    {% block sw_flow_mail_send_modal_footer %}\n    <template #modal-footer>\n        \n        {% block sw_flow_mail_send_modal_footer_cancel_button %}\n        <sw-button\n            class="sw-flow-mail-send-modal__cancel-button"\n            size="small"\n            @click="onClose"\n        >\n            {{ $tc(\'global.default.cancel\') }}\n        </sw-button>\n        {% endblock %}\n\n        \n        {% block sw_flow_mail_send_modal_footer_save_button %}\n        <sw-button\n            class="sw-flow-mail-send-modal__save-button"\n            variant="primary"\n            size="small"\n            @click="onAddAction"\n        >\n            {{ sequence.id ? $tc(\'sw-flow.modals.buttonSaveAction\') : $tc(\'sw-flow.modals.buttonAddAction\') }}\n        </sw-button>\n        {% endblock %}\n    </template>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n',inject:["repositoryFactory"],props:{sequence:{type:Object,required:!0}},data:function(){return{showCreateMailTemplateModal:!1,mailTemplateId:"",showRecipientEmails:!1,mailRecipient:null,documentTypeIds:[],recipients:[],selectedRecipient:null,mailTemplateIdError:null,recipientGridError:null,replyTo:null,replyToError:null}},computed:d({mailTemplateCriteria:function(){var e=new h(1,25);return e.addAssociation("mailTemplateType"),e},documentTypeRepository:function(){return this.repositoryFactory.create("document_type")},isNewMail:function(){var e;return!(null!==(e=this.sequence)&&void 0!==e&&e.id)},recipientCustomer:function(){return[{value:"default",label:this.$tc("sw-flow.modals.mail.labelCustomer")}]},recipientAdmin:function(){return[{value:"admin",label:this.$tc("sw-flow.modals.mail.labelAdmin")}]},recipientCustom:function(){return[{value:"custom",label:this.$tc("sw-flow.modals.mail.labelCustom")}]},recipientDefault:function(){return[{value:"default",label:this.$tc("sw-flow.modals.mail.labelDefault")}]},recipientContactFormMail:function(){return[{value:"contactFormMail",label:this.$tc("sw-flow.modals.mail.labelContactFormMail")}]},entityAware:function(){return["CustomerAware","UserAware","OrderAware","CustomerGroupAware"]},recipientOptions:function(){var e,t=this,n=null!==(e=this.triggerEvent.aware)&&void 0!==e?e:[],i=[];return n.forEach((function(e){var t=(e=e.slice(e.lastIndexOf("\\")+1)).charAt(0).toUpperCase()+e.slice(1);i.includes(t)||i.push(t)})),0===i.length?this.recipientCustom:"contact_form.send"===this.triggerEvent.name?[].concat(o()(this.recipientDefault),o()(this.recipientContactFormMail),o()(this.recipientAdmin),o()(this.recipientCustom)):["newsletter.confirm","newsletter.register","newsletter.unsubscribe"].includes(this.triggerEvent.name)||i.some((function(e){return t.entityAware.includes(e)}))?[].concat(o()(this.recipientCustomer),o()(this.recipientAdmin),o()(this.recipientCustom)):[].concat(o()(this.recipientAdmin),o()(this.recipientCustom))},recipientColumns:function(){return[{property:"email",label:"sw-flow.modals.mail.columnRecipientMail",inlineEdit:"string"},{property:"name",label:"sw-flow.modals.mail.columnRecipientName",inlineEdit:"string"}]},replyToOptions:function(){return"contact_form.send"===this.triggerEvent.name?[].concat(o()(this.recipientDefault),o()(this.recipientContactFormMail),o()(this.recipientCustom)):[].concat(o()(this.recipientDefault),o()(this.recipientCustom))},replyToSelection:function(){switch(this.replyTo){case null:return"default";case"contactFormMail":return"contactFormMail";default:return"custom"}},showReplyToField:function(){return!(null===this.replyTo||"contactFormMail"===this.replyTo)}},_("swFlowState",["mailTemplates","triggerEvent","triggerActions"])),created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;if(this.mailRecipient=this.recipientOptions[0].value,!this.isNewMail){var t,n,i=this.sequence.config;this.mailRecipient=null===(t=i.recipient)||void 0===t?void 0:t.type,"custom"===(null===(n=i.recipient)||void 0===n?void 0:n.type)&&(Object.entries(i.recipient.data).forEach((function(t){var n=l()(t,2),i=n[0],a=n[1],o=f.createId();e.recipients.push({id:o,email:i,name:a,isNew:!1})})),this.addRecipient(),this.showRecipientEmails=!0),i.replyTo&&(this.replyTo=i.replyTo),this.mailTemplateId=i.mailTemplateId,this.documentTypeIds=i.documentTypeIds}},onClose:function(){this.$emit("modal-close")},getRecipientData:function(){var e={};return"custom"!==this.mailRecipient||this.recipients.forEach((function(t){(t.email||t.name)&&Object.assign(e,r()({},t.email,t.name))})),e},isRecipientGridError:function(){if("custom"!==this.mailRecipient)return!1;if(1===this.recipients.length&&!this.recipients[0].email&&!this.recipients[0].name)return this.validateRecipient(this.recipients[0],0),!0;var e=this.recipients.filter((function(e){return!e.isNew})).findIndex((function(e){return!e.name||!e.email||!Object(c.b)(e.email)}));return e>=0&&this.validateRecipient(this.recipients[e],e),e>=0},onAddAction:function(){var e=this;if(this.mailTemplateIdError=this.mailTemplateError(this.mailTemplateId),this.showReplyToField&&(this.replyToError=this.setMailError(this.replyTo)),this.recipientGridError=this.isRecipientGridError(),!(this.mailTemplateIdError||this.replyToError||this.recipientGridError)){this.resetError();var t=d(d({},this.sequence),{},{config:{mailTemplateId:this.mailTemplateId,documentTypeIds:this.documentTypeIds,recipient:{type:this.mailRecipient,data:this.getRecipientData()},replyTo:this.replyTo}});this.$nextTick((function(){e.$emit("process-finish",t)}))}},onCreateMailTemplate:function(){this.showCreateMailTemplateModal=!0},onCloseCreateMailTemplateModal:function(){this.showCreateMailTemplateModal=!1},onCreateMailTemplateSuccess:function(e){this.mailTemplateId=e.id,this.onChangeMailTemplate(e.id,e)},onChangeMailTemplate:function(e,t){e&&(this.mailTemplateIdError=null),!this.mailTemplates.find((function(t){return t.id===e}))&&t&&Shopware.State.commit("swFlowState/setMailTemplates",[].concat(o()(this.mailTemplates),[t]))},onChangeRecipient:function(e){"custom"===e?(this.showRecipientEmails=!0,this.addRecipient()):this.showRecipientEmails=!1},addRecipient:function(){var e=this,t=f.createId();this.recipients.push({id:t,email:"",name:"",isNew:!0}),this.$nextTick((function(){e.$refs.recipientsGrid.currentInlineEditId=t,e.$refs.recipientsGrid.enableInlineEdit()}))},saveRecipient:function(e){var t=this,n=this.recipients.findIndex((function(t){return t.id===e.id}));this.validateRecipient(e,n)?this.$nextTick((function(){t.$refs.recipientsGrid.currentInlineEditId=e.id,t.$refs.recipientsGrid.enableInlineEdit()})):(e.isNew&&(this.addRecipient(),this.recipients[n].isNew=!1),this.resetError())},cancelSaveRecipient:function(e){var t=this;if(e.isNew)e.name="",e.email="";else{var n=this.recipients.findIndex((function(e){return e.id===t.selectedRecipient.id}));this.recipients[n]=this.selectedRecipient}this.resetError()},onEditRecipient:function(e){var t=this.recipients.findIndex((function(t){return e.id===t.id}));e.name||e.email?this.validateRecipient(e,t):(this.$set(this.recipients,t,d(d({},e),{},{errorName:null})),this.$set(this.recipients,t,d(d({},e),{},{errorMail:null}))),this.$refs.recipientsGrid.currentInlineEditId=e.id,this.$refs.recipientsGrid.enableInlineEdit(),this.selectedRecipient=d({},e)},onDeleteRecipient:function(e){this.recipients.splice(e,1)},mailTemplateError:function(e){return e?null:new w({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})},setNameError:function(e){return e?null:new w({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})},setMailError:function(e){var t=null;return e||(t=new w({code:"c1051bb4-d103-4f74-8988-acbcafc7fdc3"})),Object(c.b)(e)||(t=new w({code:"INVALID_MAIL"})),t},validateRecipient:function(e,t){var n=this.setNameError(e.name),i=this.setMailError(e.email);return this.$set(this.recipients,t,d(d({},e),{},{errorName:n,errorMail:i})),n||i},resetError:function(){this.recipientGridError=null,this.recipients.forEach((function(e){e.errorName=null,e.errorMail=null}))},allowDeleteRecipient:function(e){return e!==this.recipients.length-1},changeShowReplyToField:function(e){switch(e){case"default":return this.replyToError=null,void(this.replyTo=null);case"contactFormMail":return this.replyToError=null,void(this.replyTo="contactFormMail");default:this.replyTo=""}},buildReplyToTooltip:function(e){var t={settingsLink:this.$router.resolve({name:"sw.settings.basic.information.index"}).href};return this.$tc(e,0,t)}}}},x9U4:function(e,t,n){var i=n("SvYt");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,n("P8hj").default)("1d93a5f7",i,!0,{})}}]);
//# sourceMappingURL=1fe434e8cacf03ccac9c.js.map