(this.webpackJsonpAdministration=this.webpackJsonpAdministration||[]).push([[209],{ALOk:function(e,s,t){var d=t("OLBo");d.__esModule&&(d=d.default),"string"==typeof d&&(d=[[e.i,d,""]]),d.locals&&(e.exports=d.locals);(0,t("ydqr").default)("45e831fe",d,!0,{})},OLBo:function(e,s,t){},cKWB:function(e,s,t){"use strict";t.r(s);var d=t("o+SG"),n=(t("ALOk"),Shopware),r=n.Mixin,i=n.EntityDefinition,o=Shopware.Data.Criteria;s.default={template:'\n{% block sw_customer_detail_addresses %}\n<div class="sw-customer-detail-addresses">\n\n    \n    {% block sw_customer_detail_addresses_card %}\n    <sw-card\n        position-identifier="sw-customer-detail-addresses"\n        :is-loading="isLoading"\n        :large="true"\n    >\n        \n        {% block sw_customer_detail_addresses_toolbar %}\n        <template #toolbar>\n            <sw-card-filter\n                placeholder=""\n                @sw-card-filter-term-change="onChange"\n            >\n                <template #filter>\n                    \n                    {% block sw_customer_detail_addresses_add_button %}\n                    <sw-button\n                        class="sw-customer-detail-addresses__add-address-action"\n                        :disabled="!customerEditMode"\n                        size="small"\n                        @click="onCreateNewAddress"\n                    >\n                        <sw-icon\n                            name="regular-plus-circle-s"\n                            small\n                        />\n                        {{ $tc(\'sw-customer.detailAddresses.buttonAddAddress\') }}\n                    </sw-button>\n                    {% endblock %}\n                </template>\n            </sw-card-filter>\n        </template>\n        {% endblock %}\n\n        \n        {% block sw_customer_detail_addresses_add_modal %}\n        <sw-modal\n            v-if="currentAddress"\n            :title="$tc(\'sw-customer.detailAddresses.modalTitleAddress\')"\n            @modal-close="onCloseAddressModal"\n        >\n\n            \n            {% block sw_customer_detail_addresses_add_modal_address_form %}\n            <sw-customer-address-form\n                :address="currentAddress"\n                :customer="activeCustomer"\n            >\n\n                <sw-customer-address-form-options\n                    :address="currentAddress"\n                    :customer="activeCustomer"\n                    :custom-field-sets="customerAddressCustomFieldSets"\n                    @default-address-change="onChangeDefaultAddress"\n                />\n\n            </sw-customer-address-form>\n            {% endblock %}\n\n            \n            {% block sw_customer_detail_addresses_add_modal_footer %}\n            <template #modal-footer>\n                \n                {% block sw_customer_detail_addresses_add_modal_cancel %}\n                <sw-button\n                    size="small"\n                    @click="onCloseAddressModal"\n                >\n                    {{ $tc(\'sw-customer.detailAddresses.buttonCancel\') }}\n                </sw-button>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_add_modal_apply %}\n                <sw-button\n                    variant="primary"\n                    size="small"\n                    @click="onSaveAddress"\n                >\n                    {{ $tc(\'sw-customer.detailAddresses.buttonApply\') }}\n                </sw-button>\n                {% endblock %}\n            </template>\n            {% endblock %}\n        </sw-modal>\n        {% endblock %}\n\n        \n        {% block sw_customer_detail_addresses_grid %}\n        <template #grid>\n            <sw-one-to-many-grid\n                ref="addressGrid"\n                :collection="sortedAddresses"\n                :local-mode="false"\n                :columns="addressColumns"\n                :show-selection="false"\n                :sort-direction="addressSortDirection"\n                :sort-by="addressSortProperty"\n                :is-loading="isLoading"\n                @column-sort="setAddressSorting"\n            >\n                \n                {% block sw_customer_detail_addresses_grid_columns %}\n                \n                {% block sw_customer_detail_addresses_grid_columns_default_shipping_address %}\n                <template #column-defaultShippingAddress="{ item }">\n                    <sw-radio-field\n                        v-model="activeCustomer.defaultShippingAddressId"\n                        :disabled="!customerEditMode"\n                        name="defaultShippingAddress"\n                        :options="[{ value: item.id }]"\n                        @change="onChangeDefaultShippingAddress"\n                    />\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_default_billing_address %}\n                <template #column-defaultBillingAddress="{ item }">\n                    <sw-radio-field\n                        v-model="activeCustomer.defaultBillingAddressId"\n                        :disabled="!customerEditMode"\n                        name="defaultBillingAddress"\n                        :options="[{ value: item.id }]"\n                        @change="onChangeDefaultBillingAddress"\n                    />\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_last_name %}\n                <template #column-lastName="{ item }">\n                    \n                    <a\n                        v-if="customerEditMode"\n                        @click="onEditAddress(item.id)"\n                    >\n                        {{ item.lastName }}\n                    </a>\n\n                    <template v-else>\n                        {{ item.lastName }}\n                    </template>\n                </template>\n                {% endblock %}\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_actions %}\n                <template #actions="{ item }">\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_edit %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onEditAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuEdit\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_duplicate %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onDuplicateAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDuplicate\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_defaultShippingAddress %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onChangeDefaultShippingAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDefaultShippingAddress\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_defaultBillingAddress %}\n                    <sw-context-menu-item\n                        :disabled="!customerEditMode"\n                        @click="onChangeDefaultBillingAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDefaultBillingAddress\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n\n                    \n                    {% block sw_customer_detail_addresses_grid_columns_actions_delete %}\n                    <sw-context-menu-item\n                        variant="danger"\n                        :disabled="!customerEditMode || isDefaultAddress(item.id)"\n                        @click="onDeleteAddress(item.id)"\n                    >\n                        {{ $tc(\'sw-customer.detailAddresses.contextMenuDelete\') }}\n                    </sw-context-menu-item>\n                    {% endblock %}\n                </template>\n                {% endblock %}\n\n                \n                {% block sw_customer_detail_addresses_grid_columns_action_modals %}\n                <template #action-modals="{ item }">\n                    \n                    {% block sw_customer_detail_addresses_delete_modal %}\n                    <sw-modal\n                        v-if="showDeleteAddressModal === item.id"\n                        :title="$tc(\'global.default.warning\')"\n                        variant="small"\n                        @modal-close="onCloseDeleteAddressModal"\n                    >\n                        \n                        {% block sw_customer_detail_addresses_delete_modal_confirm_delete_text %}\n                        <p class="sw-customer-detail-addresses__confirm-delete-text">\n                            {{ $tc(\'sw-customer.detailAddresses.textDeleteAddressConfirm\') }}\n                        </p>\n                        {% endblock %}\n\n                        \n                        {% block sw_customer_detail_addresses_delete_modal_address_item %}\n                        <sw-address\n                            class="sw-customer-detail-addresses__confirm-delete-address"\n                            :address="item"\n                        />\n                        {% endblock %}\n\n                        \n                        {% block sw_customer_detail_addresses_delete_modal_footer %}\n                        <template #modal-footer>\n                            \n                            {% block sw_customer_detail_addresses_delete_modal_cancel %}\n                            <sw-button\n                                size="small"\n                                @click="onCloseDeleteAddressModal"\n                            >\n                                {{ $tc(\'sw-customer.detailAddresses.buttonCancel\') }}\n                            </sw-button>\n                            {% endblock %}\n\n                            \n                            {% block sw_customer_detail_addresses_delete_modal_confirm %}\n                            <sw-button\n                                variant="danger"\n                                size="small"\n                                @click="onConfirmDeleteAddress(item.id)"\n                            >\n                                {{ $tc(\'sw-customer.detailAddresses.buttonDelete\') }}\n                            </sw-button>\n                            {% endblock %}\n                        </template>\n                        {% endblock %}\n                    </sw-modal>\n                    {% endblock %}\n                </template>\n                {% endblock %}\n            </sw-one-to-many-grid>\n        </template>\n        {% endblock %}\n    </sw-card>\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory"],mixins:[r.getByName("notification")],props:{customer:{type:Object,required:!0},customerEditMode:{type:Boolean,required:!0}},data:function(){return{isLoading:!1,activeCustomer:this.customer,showAddAddressModal:!1,showEditAddressModal:!1,showDeleteAddressModal:!1,addressSortProperty:null,addressSortDirection:"",currentAddress:null,customerAddressCustomFieldSets:null}},computed:{customerRepository:function(){return this.repositoryFactory.create("customer")},customFieldSetRepository:function(){return this.repositoryFactory.create("custom_field_set")},customerAddressRepository:function(){return this.repositoryFactory.create("customer_address")},addressColumns:function(){return this.getAddressColumns()},addressRepository:function(){return this.repositoryFactory.create(this.activeCustomer.addresses.entity,this.activeCustomer.addresses.source)},sortedAddresses:function(){var e=this;return this.addressSortProperty?this.activeCustomer.addresses.sort((function(s,t){var d=s[e.addressSortProperty],n=t[e.addressSortProperty],r=null;return"string"==typeof d&&"string"==typeof n&&(r=d.toUpperCase()>n.toUpperCase()),"number"==typeof d&&"number"==typeof n&&(r=d-n>0),null!==r?"DESC"===e.addressSortDirection?r?-1:1:r?1:-1:0})):this.activeCustomer.addresses}},created:function(){this.createdComponent()},methods:{createdComponent:function(){var e=this;if(this.isLoading=!0,this.activeCustomer.id||!this.$route.params.id)if(this.activeCustomer.id){var s=new o(1,25);s.addFilter(o.equals("relations.entityName","customer_address")),this.customFieldSetRepository.search(s).then((function(s){e.customerAddressCustomFieldSets=s})),this.isLoading=!1}else this.$router.push({name:"sw.customer.detail.base",params:{id:this.$route.params.id}});else this.customerRepository.get(this.$route.params.id).then((function(s){e.activeCustomer=s,e.isLoading=!1}))},getAddressColumns:function(){return[{property:"defaultShippingAddress",label:this.$tc("sw-customer.detailAddresses.columnDefaultShippingAddress"),align:"center",iconLabel:"regular-shopping-cart"},{property:"defaultBillingAddress",label:this.$tc("sw-customer.detailAddresses.columnDefaultBillingAddress"),align:"center",iconLabel:"regular-file-text"},{property:"lastName",label:this.$tc("sw-customer.detailAddresses.columnLastName")},{property:"firstName",label:this.$tc("sw-customer.detailAddresses.columnFirstName")},{property:"company",label:this.$tc("sw-customer.detailAddresses.columnCompany")},{property:"street",label:this.$tc("sw-customer.detailAddresses.columnStreet")},{property:"zipcode",label:this.$tc("sw-customer.detailAddresses.columnZipCode"),align:"right"},{property:"city",label:this.$tc("sw-customer.detailAddresses.columnCity")}]},setAddressSorting:function(e){this.addressSortProperty=e.property;var s="ASC";this.addressSortProperty===e.dataIndex&&this.addressSortDirection===s&&(s="DESC"),this.addressSortProperty=e.dataIndex,this.addressSortDirection=s},onCreateNewAddress:function(){this.showAddAddressModal=!0,this.createNewCustomerAddress()},createNewCustomerAddress:function(){var e=this.addressRepository.create();e.customerId=this.activeCustomer.id,this.currentAddress=e},onSaveAddress:function(){if(null!==this.currentAddress)if(this.isValidAddress(this.currentAddress)){var e=this.activeCustomer.addresses.get(this.currentAddress.id);null==e&&(e=this.addressRepository.create(Shopware.Context.api,this.currentAddress.id)),Object.assign(e,this.currentAddress),this.customer.addresses.has(e.id)&&this.customer.addresses.remove(e.id),this.customer.addresses.push(e),this.currentAddress=null}else this.createNotificationError({message:this.$tc("sw-customer.notification.requiredFields")})},isValidAddress:function(e){var s=["createdAt"];return Object.keys(i.getRequiredFields("customer_address")).every((function(t){return-1!==s.indexOf(t)||Object(d.c)(e[t])}))},onCloseAddressModal:function(){this.hasOwnProperty("defaultShippingAddressId")&&(this.activeCustomer.defaultShippingAddressId=this.defaultShippingAddressId),this.hasOwnProperty("defaultBillingAddressId")&&(this.activeCustomer.defaultBillingAddressId=this.defaultBillingAddressId),this.$route.query.hasOwnProperty("detailId")&&(this.$route.query.detailId=null),this.currentAddress=null},onEditAddress:function(e){var s=this.addressRepository.create(Shopware.Context.api,e);Object.assign(s,this.activeCustomer.addresses.get(e)),this.currentAddress=s,this.showEditAddressModal=e},onDeleteAddress:function(e){this.isDefaultAddress(e)||(this.showDeleteAddressModal=e)},onConfirmDeleteAddress:function(e){var s=this;return this.onCloseDeleteAddressModal(),this.customerAddressRepository.delete(e).then((function(){s.refreshList()}))},onCloseDeleteAddressModal:function(){this.showDeleteAddressModal=!1},isDefaultAddress:function(e){return this.activeCustomer.defaultBillingAddressId===e||this.activeCustomer.defaultShippingAddressId===e},onChangeDefaultBillingAddress:function(e){this.activeCustomer.defaultBillingAddressId=e,this.customer.defaultBillingAddressId=e},onChangeDefaultShippingAddress:function(e){this.activeCustomer.defaultShippingAddressId=e,this.customer.defaultShippingAddressId=e},onDuplicateAddress:function(e){var s=this;this.customerAddressRepository.clone(e).then((function(){s.refreshList()}))},onChangeDefaultAddress:function(e){if(!e.value)return this.hasOwnProperty("defaultShippingAddressId")&&(this.activeCustomer.defaultShippingAddressId=this.defaultShippingAddressId),void(this.hasOwnProperty("defaultBillingAddressId")&&(this.activeCustomer.defaultBillingAddressId=this.defaultBillingAddressId));var s=this.createPrefix(e.name,"-address"),t="default".concat(s,"AddressId");this[t]=this.activeCustomer[t],this.activeCustomer[t]=e.id,this.customer[t]=e.id},onChange:function(e){this.activeCustomer.addresses.criteria.setPage(1),this.activeCustomer.addresses.criteria.setTerm(e),this.refreshList()},refreshList:function(){this.$refs.addressGrid.load()},createPrefix:function(e,s){var t=e.replace(s,"");return"".concat(t.charAt(0).toUpperCase()).concat(t.slice(1))}}}}}]);