(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[36881],{26434:function(){},36881:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}}),n(82348);let{Component:s,State:i}=Shopware,{mapPropertyErrors:r,mapState:l,mapGetters:o}=s.getComponentHelper(),a=Shopware.Utils,{camelCase:c,capitalizeString:h}=Shopware.Utils.string,{isEmpty:d}=a.types;var m={template:'\n{% block sw_flow_trigger %}\n<div\n    class="sw-flow-trigger"\n    :class="swFlowTriggerClasses"\n>\n    \n    {% block sw_flow_trigger_select_field %}\n    <div class="sw-flow-trigger__select-toolbar">\n        <sw-contextual-field\n            v-tooltip="{\n                message: getEventName(eventName),\n                disabled: !eventName || isUnknownTrigger,\n            }"\n            class="sw-flow-trigger__search-field"\n            :required="!isTemplate"\n            :label="$tc(\'sw-flow.detail.trigger.name\')"\n            :disabled="disabled"\n            :error="flowEventNameError"\n        >\n            <template #sw-field-input="{ identification, disabled, error, size, setFocusClass, removeFocusClass }">\n                \n                {% block sw_flow_trigger_select_field_input %}\n                \n                <input\n                    ref="searchInput"\n                    v-model="searchTerm"\n                    type="text"\n                    class="sw-flow-trigger__input-field"\n                    :placeholder="triggerNamePlaceholder"\n                    :disabled="disabled"\n                    @focus="openDropdown({ setFocusClass, removeFocusClass });"\n                >\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_loader %}\n                <sw-loader\n                    v-if="isLoading"\n                    class="sw-flow-trigger__loader"\n                    size="16px"\n                />\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_dropdown_icon %}\n                <sw-icon\n                    class="sw-flow-trigger__dropdown-icon"\n                    name="regular-chevron-down-xs"\n                    size="10px"\n                    @click="openDropdown({ setFocusClass, removeFocusClass });"\n                />\n                {% endblock %}\n            </template>\n        </sw-contextual-field>\n    </div>\n    {% endblock %}\n\n    \n    {% block sw_flow_trigger_select_transition %}\n    <transition name="sw-flow-trigger__fade-down">\n        \n        {% block sw_flow_trigger_event_selection %}\n        <div\n            v-if="isExpanded"\n            class="sw-flow-trigger__event-selection"\n        >\n\n            \n            {% block sw_flow_trigger_container %}\n            <sw-container class="sw-flow-trigger__event-container">\n\n                \n                {% block sw_flow_trigger_select_tree %}\n                <sw-tree\n                    v-if="showTreeView"\n                    ref="flowTriggerTree"\n                    :active-tree-item-id="eventName"\n                    route-params-active-element-id="eventName"\n                    :sortable="false"\n                    :items="eventTree"\n                    :searchable="false"\n                    :disable-context-menu="true"\n                    :on-change-route="changeTrigger"\n                    bind-items-to-folder\n                >\n\n                    \n                    {% block sw_flow_trigger_tree_headline %}\n                    <template #headline>\n                        <span></span>\n                    </template>\n                    {% endblock %}\n\n                    \n                    {% block sw_flow_trigger_tree_search %}\n                    <template #search>\n                        <span></span>\n                    </template>\n                    {% endblock %}\n\n                    <template\n                        #items="{\n                            treeItems,\n                            sortable,\n                            disableContextMenu,\n                            onChangeRoute,\n                            newElementId,\n                            checkItem\n                        }"\n                    >\n                        <sw-tree-item\n                            v-for="item in treeItems"\n                            :key="item.id"\n                            should-focus\n                            :active-focus-id="selectedTreeItem.id"\n                            :sortable="sortable"\n                            :item="item"\n                            :on-change-route="onChangeRoute"\n                            :display-checkbox="false"\n                            @check-item="checkItem"\n                        >\n\n                            \n                            {% block sw_flow_trigger_tree_item_actions %}\n                            <template #actions>\n                                <span></span>\n                            </template>\n                            {% endblock %}\n                        </sw-tree-item>\n                    </template>\n                </sw-tree>\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_search_list %}\n                <ul\n                    v-else-if="searchResult.length > 0 && searchTerm.length > 0"\n                    class="sw-flow-trigger__search-results"\n                >\n                    \n                    {% block sw_flow_trigger_search_list_item %}\n                    <li\n                        v-for="item in searchResult"\n                        :key="item.id"\n                        class="sw-flow-trigger__search-result"\n                        :class="{ \'is--focus\': isSearchResultInFocus(item)}"\n                        role="button"\n                        tabindex="0"\n                        @click="onClickSearchItem(item)"\n                        @keydown.enter="onClickSearchItem(item)"\n                    >\n                        \n                        {% block sw_flow_trigger_search_list_item_icon %}\n                        <div class="sw-flow-trigger__search-result-icon">\n                            <sw-icon\n                                name="regular-circle-xxs"\n                                size="18"\n                            />\n                        </div>\n                        {% endblock %}\n\n                        \n                        {% block sw_flow_trigger_search_list_item_name %}\n                        <span class="sw-flow-trigger__search-result-name">\n                            \n                            {% block sw_flow_trigger_search_list_item_name_highlight %}\n                            <sw-highlight-text\n                                :search-term="searchTerm"\n                                :text="getEventName(item.name)"\n                            />\n                            {% endblock %}\n                        </span>\n                        {% endblock %}\n                    </li>\n                    {% endblock %}\n                </ul>\n                {% endblock %}\n\n                \n                {% block sw_flow_trigger_search_empty %}\n                <p\n                    v-else\n                    class="sw-flow-trigger__empty"\n                >\n                    {{ $tc(\'sw-flow.detail.trigger.textNoEvent\') }}\n                </p>\n                {% endblock %}\n\n            </sw-container>\n        {% endblock %}\n        </div>\n        {% endblock %}\n    </transition>\n    {% endblock %}\n\n    \n    {% block sw_flow_event_change_confirm_modal %}\n    <sw-flow-event-change-confirm-modal\n        v-if="showConfirmModal"\n        @modal-confirm="onConfirm"\n        @modal-close="onCloseConfirm"\n    />\n    {% endblock %}\n</div>\n{% endblock %}\n',inject:["repositoryFactory","businessEventService"],props:{overlay:{type:Boolean,required:!1,default:!0},disabled:{type:Boolean,required:!1,default:!1},eventName:{type:String,required:!0},isUnknownTrigger:{type:Boolean,required:!1,default:!1}},data(){return{isExpanded:!1,isLoading:!1,searchTerm:"",searchResult:[],searchResultFocusItem:{},selectedTreeItem:{},setInputFocusClass:null,removeInputFocusClass:null,showConfirmModal:!1,triggerSelect:{}}},computed:{swFlowTriggerClasses(){return{overlay:this.overlay}},formatEventName(){return this.eventName?this.getEventName(this.eventName):this.eventName},showTreeView(){return this.eventTree.length>=0&&(this.searchTerm.length<=0||this.searchTerm===this.formatEventName)},eventTree(){return this.getEventTree(this.triggerEvents)},isTemplate(){return this.$route.query?.type==="template"},triggerNamePlaceholder(){return this.isUnknownTrigger?this.$tc("sw-flow.detail.trigger.unknownTriggerPlaceholder"):this.$tc("sw-flow.detail.trigger.placeholder")},...l("swFlowState",["flow","triggerEvents"]),...o("swFlowState",["isSequenceEmpty"]),...r("flow",["eventName"])},watch:{eventName:{immediate:!0,handler(e){e&&(this.$route.params.eventName=e,this.searchTerm=this.getEventName(e))}},searchTerm(e){if(!e||e===this.formatEventName)return;let t=e.split(/[\W_]+/ig);this.searchResult=this.triggerEvents.filter(e=>{let n=this.getEventName(e.name).toLowerCase();return t.every(e=>n.includes(e.toLowerCase()))}),this.searchResult.length>0&&(this.searchResultFocusItem=this.searchResult[0])},selectedTreeItem(e){e?.id&&a.debounce(()=>{let t=this.findTreeItemVNodeById(e.id).$el,n=0,s=!1,i=t;for(;!s;)i.classList.contains("sw-tree__content")?s=!0:(n+=i.offsetTop,i=i.offsetParent);i.scrollTo({top:n-i.clientHeight/2-50,behavior:"smooth"})},50)()}},created(){this.createdComponent()},beforeDestroy(){this.beforeDestroyComponent()},methods:{createdComponent(){document.addEventListener("click",this.handleClickEvent),document.addEventListener("keydown",this.handleGeneralKeyEvents),this.isLoading=!0,Shopware.State.dispatch("swFlowState/fetchTriggerActions"),i.commit("swFlowState/setTriggerEvent",this.getDataByEvent(this.eventName)),i.dispatch("swFlowState/setRestrictedRules",this.eventName),this.isLoading=!1},beforeDestroyComponent(){document.removeEventListener("click",this.handleClickEvent),document.removeEventListener("keydown",this.handleGeneralKeyEvents)},handleClickEvent(e){let t=e.target;if(!t.closest(".sw-tree-item .is--no-children.is--disabled")){if(t.closest(".sw-tree-item .is--no-children .sw-tree-item__content")||t.closest(".sw-flow-trigger__search-result")){this.closeDropdown();return}if(null===t.closest(".sw-flow-trigger")){if(t.closest("svg"))return;this.closeDropdown(),this.searchTerm!==this.formatEventName&&(this.searchTerm=this.formatEventName)}}},handleGeneralKeyEvents(e){if("keydown"===e.type&&this.isExpanded)switch(e.key.toLowerCase()){case"tab":case"escape":this.closeDropdown();break;case"arrowdown":case"arrowleft":case"arrowright":case"arrowup":this.handleArrowKeyEvents(e);break;case"enter":if(this.searchTerm.length>0&&this.searchTerm!==this.formatEventName)this.onClickSearchItem(this.searchResultFocusItem),this.closeDropdown();else{if(this.selectedTreeItem?.childCount>0)return;this.changeTrigger(this.selectedTreeItem),this.closeDropdown()}}},handleArrowKeyEvents(e){let t=e.key.toLowerCase();if(this.searchTerm.length>0&&this.searchTerm!==this.formatEventName){switch(t){case"arrowdown":e.preventDefault(),this.changeSearchSelection("next");break;case"arrowup":e.preventDefault(),this.changeSearchSelection("previous")}return}let n=this.findTreeItemVNodeById();switch(t){case"arrowdown":if(n?.item?.id){if(n.opened){let e=this.getFirstChildById(n.item.id);e&&(this.selectedTreeItem=e);break}let e=this.getSibling(!0,n.item);if(e){this.selectedTreeItem=e;break}(e=this.getClosestSiblingAncestor(n.item.parentId))&&(this.selectedTreeItem=e)}break;case"arrowup":if(n?.item?.id){let e=this.findTreeItemVNodeById(n.item.parentId);if(e?.item?.children[0].id===n.item.id){let t=e.item;t&&(this.selectedTreeItem=t);break}let t=this.getSibling(!1,n.item);t&&(this.selectedTreeItem=this.getClosestSiblingDescendant(t))}break;case"arrowright":this.toggleSelectedTreeItem(!0);break;case"arrowleft":if(!this.toggleSelectedTreeItem(!1)){let e=n.item.parentId,t=this.findTreeItemVNodeById(e);t&&(this.selectedTreeItem=t.item)}}},getClosestSiblingAncestor(e){let t=this.findTreeItemVNodeById(e);return this.getSibling(!0,t.item)||(t?.item?.parentId?this.getClosestSiblingAncestor(t.item.parentId):null)},getClosestSiblingDescendant(e){let t=this.findTreeItemVNodeById(e.id);if(t.opened&&t.item.childCount>0){let e=t.item.children.length-1,n=t.item.children[e];return 0===n.childCount?n:this.getClosestSiblingDescendant(n)}return e},getFirstChildById(e,t=this.$refs.flowTriggerTree.treeItems){let n=t.find(t=>t.id===e);if(n)return n.children[0];for(let n=0;n<t.length;n+=1){let s=this.getFirstChildById(e,t[n].children);if(s)return s}return null},getSibling(e,t,n=this.$refs.flowTriggerTree.treeItems){if(!t)return null;let s=null,i=n.indexOf(t);if(s=i<0?null:e?n[i+1]:n[i-1])return s;for(let s=0;s<n.length;s+=1){let i=this.getSibling(e,t,n[s].children);if(i)return i}return null},changeSearchSelection(e="next"){let t=this.searchResult.indexOf(this.searchResultFocusItem),n=this.searchResult[t+("previous"===e?-1:1)];void 0!==n&&(this.searchResultFocusItem=n)},toggleSelectedTreeItem(e){let t=this.findTreeItemVNodeById();return!!t?.openTreeItem&&t.opened!==e&&(t.openTreeItem(),!0)},findTreeItemVNodeById(e=this.selectedTreeItem.id,t=this.$refs.flowTriggerTree.$children){let n=!1;if(Array.isArray(t)?n=t.find(t=>!!t?.item?.id&&t.item.id===e):t?.item?.id&&(n=t.item.id===e),n)return n;let s=!1;for(let n=0;n<t.length&&!(s=this.findTreeItemVNodeById(e,t[n].$children));n+=1);return s},openDropdown({setFocusClass:e,removeFocusClass:t}){this.setInputFocusClass=e,this.removeInputFocusClass=t,this.setInputFocusClass(),this.isExpanded=!0,this.isLoading||this.$nextTick(()=>{if(this.searchTerm===this.formatEventName){let e=this.eventTree.find(e=>e.id===this.eventName);this.selectedTreeItem=e||this.$refs.flowTriggerTree.treeItems[0]}})},closeDropdown(){this.removeInputFocusClass&&this.removeInputFocusClass(),this.isExpanded=!1},changeTrigger(e){if(!(e?.disabled||e?.childCount>0)){if(this.isSequenceEmpty){let{id:t}=e.data;i.commit("swFlowState/setTriggerEvent",this.getDataByEvent(t)),i.dispatch("swFlowState/setRestrictedRules",t),this.$emit("option-select",t)}else this.showConfirmModal=this.flow.eventName!==e.id,this.triggerSelect=this.getDataByEvent(e.id)}},onConfirm(){i.commit("swFlowState/setTriggerEvent",this.triggerSelect),i.dispatch("swFlowState/setRestrictedRules",this.triggerSelect.name),this.$emit("option-select",this.triggerSelect.name)},onCloseConfirm(){this.showConfirmModal=!1,this.triggerSelect={}},getLastEventName({parentId:e=null,id:t}){let[n]=e?t.split(".").reverse():[t];return this.getEventNameTranslated(n)},getDataByEvent(e){return this.triggerEvents.find(t=>t.name===e)},hasOnlyStopFlow(e){return 0===(this.triggerEvents.find(t=>t.name===e).aware||[]).length},getEventTree(e){let t={};e.forEach(e=>{let n=e.name.split(".");if(0===n.length)return;let s=(e,t,n)=>{let i=t[e],r=t[e+1];n[i]=n[i]||{id:i,parentId:null,children:{}},r&&(n[i].children[r]=n[i].children[r]||{id:`${n[i].id}.${r}`,parentId:n[i].id,children:{}},s(e+1,t,n[i].children))};s(0,n,t)});let n=(e,t=[])=>(e.forEach(e=>{let s=e.children?Object.values(e.children):[];t.push({id:e.id,name:this.getLastEventName(e),childCount:s.length,parentId:e.parentId,disabled:d(e.children)&&this.hasOnlyStopFlow(e.id),disabledToolTipText:d(e.children)&&this.hasOnlyStopFlow(e.id)?this.$tc("sw-flow.detail.trigger.textHint"):null}),s.length>0&&(t=n(s,t))}),t);return n(Object.values(t))},getBreadcrumb(e){return e?e.split(".").map(e=>h(e)).join(" / ").replace(/_|-/g," "):""},onClickSearchItem(e){this.searchTerm=this.formatEventName,this.searchResult=[],this.isSequenceEmpty?(this.$emit("option-select",e.name),i.commit("swFlowState/setTriggerEvent",e),i.dispatch("swFlowState/setRestrictedRules",e.name)):(this.showConfirmModal=!0,this.triggerSelect=e)},getEventName(e){return this.isUnknownTrigger?"":e?e.split(".").map(e=>this.getEventNameTranslated(e)).join(" / "):e},isSearchResultInFocus(e){return e.name===this.searchResultFocusItem.name},getEventNameTranslated(e){let t=c(e),n=[`sw-flow-app.triggers-app.${t}`,`sw-flow-custom-event.event-tree.${t}`,`sw-flow.triggers.${t}`].find(e=>this.$te(e));return n?this.$tc(n):e.replace(/_|-/g," ")}}}},82348:function(e,t,n){var s=n(26434);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals),n(45346).Z("51b0b1a5",s,!0,{})}}]);